"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4022],{4022:(f,g,r)=>{r.r(g),r.d(g,{InsufficientStockDialogComponent:()=>Z});var l=r(70655),p=r(88798),n=r(29863),i=r(23349),m=r(94030),d=r(69808);function _(u,c){if(1&u&&(n.TgZ(0,"ion-item",25),n.TgZ(1,"div",26),n.TgZ(2,"div",27),n.TgZ(3,"div",28),n._UZ(4,"ion-icon",29),n.TgZ(5,"span",30),n._uU(6),n.qZA(),n.qZA(),n.TgZ(7,"div",31),n.TgZ(8,"ion-badge",0),n._uU(9),n.qZA(),n.qZA(),n.qZA(),n.TgZ(10,"div",32),n.TgZ(11,"div",33),n.TgZ(12,"span",34),n._uU(13,"\u0627\u0644\u0645\u0637\u0644\u0648\u0628:"),n.qZA(),n.TgZ(14,"span",35),n._uU(15),n.qZA(),n.qZA(),n.TgZ(16,"div",33),n.TgZ(17,"span",34),n._uU(18,"\u0627\u0644\u0645\u062a\u0648\u0641\u0631:"),n.qZA(),n.TgZ(19,"span",36),n._uU(20),n.qZA(),n.qZA(),n.TgZ(21,"div",37),n.TgZ(22,"span",34),n._uU(23,"\u0627\u0644\u0646\u0642\u0635:"),n.qZA(),n.TgZ(24,"span",38),n._uU(25),n.qZA(),n.qZA(),n.qZA(),n.TgZ(26,"div",39),n.TgZ(27,"span",40),n.TgZ(28,"span",41),n._uU(29,"\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621:"),n.qZA(),n.TgZ(30,"span",42),n._uU(31),n.qZA(),n.qZA(),n.TgZ(32,"span",40),n.TgZ(33,"span",41),n._uU(34,"\u0633\u0639\u0631 \u0627\u0644\u0628\u064a\u0639:"),n.qZA(),n.TgZ(35,"span",42),n._uU(36),n.qZA(),n.qZA(),n.TgZ(37,"span",40),n.TgZ(38,"span",41),n._uU(39,"\u0642\u064a\u0645\u0629 \u0627\u0644\u0646\u0642\u0635:"),n.qZA(),n.TgZ(40,"span",43),n._uU(41),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&u){const t=c.$implicit;n.ekj("even-row",c.index%2==0),n.xp6(6),n.Oqu(t.item_name),n.xp6(1),n.ekj("critical",t.shortage>2*t.available_quantity),n.xp6(2),n.hij("\u0646\u0642\u0635: ",t.shortage,""),n.xp6(6),n.Oqu(t.requested_quantity),n.xp6(5),n.Oqu(t.available_quantity),n.xp6(5),n.Oqu(t.shortage),n.xp6(6),n.Oqu(t.perch_price),n.xp6(5),n.Oqu(t.pay_price),n.xp6(5),n.Oqu(+t.pay_price*+t.shortage)}}let Z=(()=>{class u{constructor(t,o,e){this.modalController=t,this.alertController=o,this.router=e,this.insufficientItems=[]}ngOnInit(){if(console.log("Insufficient items:",this.insufficientItems),console.log("First item structure:",this.insufficientItems[0]),this.insufficientItems.length>0){const t=this.insufficientItems[0];console.log("pay_price:",t.pay_price),console.log("perch_price:",t.perch_price),console.log("All properties:",Object.keys(t))}}dismissModal(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.modalController.dismiss()})}createPurchaseInvoice(){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"\u062a\u0623\u0643\u064a\u062f \u0625\u0646\u0634\u0627\u0621 \u0641\u0627\u062a\u0648\u0631\u0629 \u0634\u0631\u0627\u0621",mode:"ios",message:"\u0647\u0644 \u062a\u0631\u064a\u062f \u0625\u0646\u0634\u0627\u0621 \u0641\u0627\u062a\u0648\u0631\u0629 \u0634\u0631\u0627\u0621 \u062a\u062a\u0636\u0645\u0646 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0646\u0627\u0642\u0635\u0629\u061f",buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel",cssClass:"secondary"},{text:"\u0645\u0648\u0627\u0641\u0642",handler:()=>{this.openPurchaseModal(this.insufficientItems)}}]})).present()})}openPurchaseModal(t){return(0,l.mG)(this,void 0,void 0,function*(){const o=t.map(e=>({id:e.item_id,item_name:e.item_name,item_desc:e.item_desc,part_no:e.part_no||"",brand:e.brand||"",model:e.model||"",item_unit:e.item_unit||"",realPerchPrice:e.perch_price,perch_price:e.pay_price||0,pay_price:e.pay_price||0,qty:e.shortage,tot:(e.pay_price*e.shortage).toFixed(2)||0,availQty:e.shortage,aliasEn:e.aliasEn||""}));try{const e=yield this.modalController.create({component:p.Z,componentProps:{modalMode:!0,modalStatus:"newInvoFromItemsPage",modalSelectedItemsList:o},cssClass:"purchase-full-modal",showBackdrop:!0,backdropDismiss:!1});e.onDidDismiss().then(s=>{s.data&&s.data.success&&(console.log("Purchase completed successfully:",s.data),this.dismissModal())}),yield e.present()}catch(e){console.error("Error opening purchase modal:",e),this.navigateToInvoicePage(t,"purchase")}})}navigateToInvoicePage(t,o){const e=t.map(a=>({id:a.item_id,item_name:a.item_name,item_desc:a.item_desc,part_no:a.part_no||"",brand:a.brand||"",model:a.model||"",item_unit:a.item_unit||"",realPerchPrice:a.perch_price,perch_price:a.pay_price||0,pay_price:a.pay_price||0,qty:a.shortage,tot:(a.pay_price*a.shortage).toFixed(2)||0,availQty:a.shortage,aliasEn:a.aliasEn||""}));let s={queryParams:{status:"newInvoFromItemsPage",selectedItemsList:JSON.stringify(e)},replaceUrl:!0};this.modalController.dismiss().then(()=>{setTimeout(()=>{this.router.navigate(["folder/purchase"],s)},100)})}getTotalShortage(){return this.insufficientItems.reduce((t,o)=>t+o.shortage,0)}getTotalValue(){return this.insufficientItems.reduce((t,o)=>t+o.pay_price*o.shortage,0)}getItemKeys(t){return Object.keys(t).join(", ")}}return u.\u0275fac=function(t){return new(t||u)(n.Y36(i.IN),n.Y36(i.Br),n.Y36(m.F0))},u.\u0275cmp=n.Xpm({type:u,selectors:[["app-insufficient-stock-dialog"]],inputs:{insufficientItems:"insufficientItems",store_info:"store_info",user_info:"user_info",year:"year"},decls:58,vars:4,consts:[["color","danger"],[1,"ion-text-center"],["name","warning",1,"title-icon"],["slot","end"],["fill","clear",3,"click"],["name","close","slot","icon-only"],[1,"ion-padding"],[1,"alert-section"],["color","light"],[1,"alert-message"],["name","alert-circle","color","warning",1,"alert-icon"],[1,"alert-text"],[1,"summary-section"],["size","4"],[1,"summary-item"],[1,"summary-label"],[1,"summary-value"],[1,"items-section"],[1,"items-container"],["class","item-row",3,"even-row",4,"ngFor","ngForOf"],[1,"action-buttons"],["expand","block","color","danger",1,"cancel-button",3,"click"],["name","close-circle","slot","start"],["expand","block","color","primary",1,"purchase-button",3,"click"],["name","add-circle","slot","start"],[1,"item-row"],[1,"item-content"],[1,"item-header"],[1,"item-name"],["name","cube","color","primary",1,"item-icon"],[1,"name-text"],[1,"item-shortage"],[1,"quantity-section"],[1,"quantity-item"],[1,"quantity-label"],[1,"quantity-value","requested"],[1,"quantity-value","available"],[1,"quantity-item","shortage-highlight"],[1,"quantity-value","shortage"],[1,"price-section"],[1,"price-item"],[1,"price-label"],[1,"price-value"],[1,"price-value","total"]],template:function(t,o){1&t&&(n.TgZ(0,"ion-header"),n.TgZ(1,"ion-toolbar",0),n.TgZ(2,"ion-title",1),n._UZ(3,"ion-icon",2),n._uU(4," \u0627\u0644\u0643\u0645\u064a\u0629 \u063a\u064a\u0631 \u0643\u0627\u0641\u064a\u0629 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646 "),n.qZA(),n.TgZ(5,"ion-buttons",3),n.TgZ(6,"ion-button",4),n.NdJ("click",function(){return o.dismissModal()}),n._UZ(7,"ion-icon",5),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(8,"ion-content",6),n.TgZ(9,"div",7),n.TgZ(10,"ion-card",8),n.TgZ(11,"ion-card-content"),n.TgZ(12,"div",9),n._UZ(13,"ion-icon",10),n.TgZ(14,"p",11),n._uU(15," \u0644\u0627 \u064a\u0645\u0643\u0646 \u062d\u0641\u0638 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0623\u0646 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u062a\u0627\u0644\u064a\u0629 \u062a\u062a\u0637\u0644\u0628 \u0643\u0645\u064a\u0629 \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0645\u062a\u0648\u0641\u0631 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646 "),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(16,"div",12),n.TgZ(17,"ion-card"),n.TgZ(18,"ion-card-header"),n.TgZ(19,"ion-card-title"),n._uU(20,"\u0645\u0644\u062e\u0635 \u0627\u0644\u0646\u0642\u0635"),n.qZA(),n.qZA(),n.TgZ(21,"ion-card-content"),n.TgZ(22,"ion-row"),n.TgZ(23,"ion-col",13),n.TgZ(24,"div",14),n.TgZ(25,"span",15),n._uU(26,"\u0639\u062f\u062f \u0627\u0644\u0623\u0635\u0646\u0627\u0641:"),n.qZA(),n.TgZ(27,"span",16),n._uU(28),n.qZA(),n.qZA(),n.qZA(),n.TgZ(29,"ion-col",13),n.TgZ(30,"div",14),n.TgZ(31,"span",15),n._uU(32,"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0646\u0642\u0635:"),n.qZA(),n.TgZ(33,"span",16),n._uU(34),n.qZA(),n.qZA(),n.qZA(),n.TgZ(35,"ion-col",13),n.TgZ(36,"div",14),n.TgZ(37,"span",15),n._uU(38,"\u0627\u0644\u0642\u064a\u0645\u0629 \u0627\u0644\u0645\u0642\u062f\u0631\u0629:"),n.qZA(),n.TgZ(39,"span",16),n._uU(40),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(41,"div",17),n.TgZ(42,"ion-card"),n.TgZ(43,"ion-card-header"),n.TgZ(44,"ion-card-title"),n._uU(45,"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0646\u0627\u0642\u0635\u0629"),n.qZA(),n.qZA(),n.TgZ(46,"ion-card-content"),n.TgZ(47,"div",18),n.YNc(48,_,42,12,"ion-item",19),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(49,"ion-footer"),n.TgZ(50,"ion-toolbar"),n.TgZ(51,"div",20),n.TgZ(52,"ion-button",21),n.NdJ("click",function(){return o.dismissModal()}),n._UZ(53,"ion-icon",22),n._uU(54," \u0625\u063a\u0644\u0627\u0642 "),n.qZA(),n.TgZ(55,"ion-button",23),n.NdJ("click",function(){return o.createPurchaseInvoice()}),n._UZ(56,"ion-icon",24),n._uU(57," \u0625\u0646\u0634\u0627\u0621 \u0641\u0627\u062a\u0648\u0631\u0629 \u0634\u0631\u0627\u0621 "),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(28),n.Oqu(o.insufficientItems.length),n.xp6(6),n.Oqu(o.getTotalShortage()),n.xp6(6),n.Oqu(o.getTotalValue().toFixed(2)),n.xp6(8),n.Q6J("ngForOf",o.insufficientItems))},directives:[i.Gu,i.sr,i.wd,i.gu,i.Sm,i.YG,i.W2,i.PM,i.FN,i.Zi,i.Dq,i.Nd,i.wI,d.sg,i.fr,i.Ie,i.yp],styles:["[_nghost-%COMP%]{--ion-color-danger: #e74c3c;--ion-color-warning: #f39c12;--ion-color-success: #27ae60;--ion-color-primary: #3498db}.title-icon[_ngcontent-%COMP%]{margin-left:8px;font-size:1.2em}.alert-section[_ngcontent-%COMP%]{margin-bottom:16px}.alert-message[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center}.alert-message[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{font-size:2em;margin-left:12px;min-width:40px}.alert-message[_ngcontent-%COMP%]   .alert-text[_ngcontent-%COMP%]{margin:0;font-size:1.1em;line-height:1.4;color:var(--ion-color-medium-shade)}.summary-section[_ngcontent-%COMP%]{margin-bottom:16px}.summary-item[_ngcontent-%COMP%]{text-align:center;padding:8px}.summary-item[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]{display:block;font-size:.9em;color:var(--ion-color-medium);margin-bottom:4px}.summary-item[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{display:block;font-size:1.3em;font-weight:700;color:var(--ion-color-primary)}.items-section[_ngcontent-%COMP%]{flex:1;margin-bottom:16px}.items-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;border-radius:8px}.items-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.items-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--ion-color-light);border-radius:4px}.items-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--ion-color-medium);border-radius:4px}.item-row[_ngcontent-%COMP%]{--border-radius: 8px;--padding-start: 0;--padding-end: 0;--inner-padding-start: 16px;--inner-padding-end: 16px;margin-bottom:8px;border:1px solid var(--ion-color-light-shade)}.item-row.even-row[_ngcontent-%COMP%]{--background: var(--ion-color-light-tint)}.item-row[_ngcontent-%COMP%]:hover{--background: var(--ion-color-light);transform:translateY(-1px);box-shadow:0 2px 8px #0000001a}.item-content[_ngcontent-%COMP%]{width:100%;padding:12px 0}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.item-name[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.item-name[_ngcontent-%COMP%]   .item-icon[_ngcontent-%COMP%]{margin-left:8px;font-size:1.1em}.item-name[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em;color:var(--ion-color-dark)}.item-shortage.critical[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{--background: var(--ion-color-danger);animation:pulse 2s infinite}@keyframes pulse{0%{opacity:1}50%{opacity:.7}to{opacity:1}}.item-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:8px;gap:8px;margin-bottom:12px}.detail-row[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-row[_ngcontent-%COMP%]   .detail-label[_ngcontent-%COMP%]{font-size:.9em;color:var(--ion-color-medium);margin-left:8px;min-width:60px}.detail-row[_ngcontent-%COMP%]   .detail-value[_ngcontent-%COMP%]{font-size:.9em;color:var(--ion-color-dark);font-weight:500}.quantity-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;grid-gap:12px;gap:12px;margin-bottom:12px;padding:12px;background:var(--ion-color-light-tint);border-radius:6px}.quantity-item[_ngcontent-%COMP%]{text-align:center}.quantity-item[_ngcontent-%COMP%]   .quantity-label[_ngcontent-%COMP%]{display:block;font-size:.8em;color:var(--ion-color-medium);margin-bottom:4px}.quantity-item[_ngcontent-%COMP%]   .quantity-value[_ngcontent-%COMP%]{display:block;font-size:1.2em;font-weight:700}.quantity-item[_ngcontent-%COMP%]   .quantity-value.requested[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.quantity-item[_ngcontent-%COMP%]   .quantity-value.available[_ngcontent-%COMP%]{color:var(--ion-color-success)}.quantity-item[_ngcontent-%COMP%]   .quantity-value.shortage[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.quantity-item.shortage-highlight[_ngcontent-%COMP%]{background:rgba(231,76,60,.1);border-radius:4px;padding:4px}.price-section[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;gap:12px;padding:12px;background:var(--ion-color-light);border-radius:6px;border:1px solid var(--ion-color-light-shade)}.price-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;flex:1}.price-item[_ngcontent-%COMP%]   .price-label[_ngcontent-%COMP%]{font-size:.8em;color:var(--ion-color-dark);margin-bottom:4px;font-weight:500}.price-item[_ngcontent-%COMP%]   .price-value[_ngcontent-%COMP%]{font-size:1em;font-weight:700;color:var(--ion-color-dark)}.price-item[_ngcontent-%COMP%]   .price-value.total[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-weight:700}.action-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:12px;gap:12px;padding:12px}.cancel-button[_ngcontent-%COMP%]{--color: white;--background: var(--ion-color-medium);height:48px;font-weight:700}.purchase-button[_ngcontent-%COMP%]{--color: white;--background: var(--ion-color-primary);height:48px;font-weight:700}.purchase-button[_ngcontent-%COMP%]:hover{--background: var(--ion-color-primary-shade)}ion-content[_ngcontent-%COMP%]{direction:rtl}@media (max-width: 768px){.item-details[_ngcontent-%COMP%]{grid-template-columns:1fr}.quantity-section[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:8px}.price-section[_ngcontent-%COMP%]{flex-direction:row;gap:8px;padding:8px}.price-section[_ngcontent-%COMP%]   .price-item[_ngcontent-%COMP%]   .price-label[_ngcontent-%COMP%]{font-size:.75em}.price-section[_ngcontent-%COMP%]   .price-item[_ngcontent-%COMP%]   .price-value[_ngcontent-%COMP%]{font-size:.9em}.action-buttons[_ngcontent-%COMP%]{grid-template-columns:1fr}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:4em;color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:1.1em}"]}),u})()}}]);