"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[486],{486:(S,M,g)=>{g.r(M),g.d(M,{CurrencyManagementPageModule:()=>Y});var y=g(69808),_=g(34182),i=g(23349),f=g(94030),d=g(70655),b=g(42654),e=g(29863),C=g(6612),Z=g(91472),r=g(90849);function c(s,p){if(1&s&&(e.TgZ(0,"ion-segment-button",35),e.TgZ(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"small"),e._uU(4),e.qZA(),e.qZA()),2&s){const t=p.$implicit;e.Q6J("value",t.currency_code),e.xp6(2),e.Oqu(t.currency_code),e.xp6(2),e.Oqu(t.currency_name_ar)}}function u(s,p){if(1&s&&(e.TgZ(0,"div",36),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" ",t.getFieldErrorMessage("target_currency")," ")}}function m(s,p){if(1&s&&(e.TgZ(0,"div",36),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" ",t.getFieldErrorMessage("exchange_rate")," ")}}function P(s,p){if(1&s&&(e.TgZ(0,"div",36),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" ",t.getFieldErrorMessage("rate_date")," ")}}function F(s,p){if(1&s){const t=e.EpF();e.TgZ(0,"ion-button",37),e.NdJ("click",function(){return e.CHM(t),e.oxw().delete()}),e._UZ(1,"ion-icon",38),e._uU(2," \u062d\u0630\u0641 "),e.qZA()}}let w=(()=>{class s{constructor(t,n,o,a,l,h,v,x,O){this.fb=t,this.modalController=n,this.currencyService=o,this.toastController=a,this.loadingController=l,this.alertController=h,this.servicesService=v,this.storage=x,this.datePipe=O,this.mode="create",this.rateData=null,this.store_info=null,this.year=null,this.supportedCurrencies=[],this.isLoading=!1,this.maxDate=(new Date).toISOString().split("T")[0],this.subscription=new b.w,this.user_info=null,this.localStoreInfo=null,this.localYear=null,this.initForm()}ngOnInit(){var t,n,o,a;this.getAppInfo(),this.loadSupportedCurrencies(),"edit"===this.mode&&this.rateData&&(console.log("Populating form with rate data:",this.rateData),this.populateForm());const l=(null===(t=this.localStoreInfo)||void 0===t?void 0:t.id)||(null===(n=this.store_info)||void 0===n?void 0:n.id),h=(null===(o=this.localYear)||void 0===o?void 0:o.id)||(null===(a=this.year)||void 0===a?void 0:a.id);l&&h&&this.rateForm.patchValue({store_id:l,year_id:h}),console.log("Form after initialization:",this.rateForm.value)}ngOnDestroy(){this.subscription.unsubscribe()}initForm(){this.rateForm=this.fb.group({base_currency:["SDG"],target_currency:["",_.kI.required],exchange_rate:[0,[_.kI.required,_.kI.min(1e-6),_.kI.max(999999999)]],rate_date:[(new Date).toISOString().split("T")[0],_.kI.required],store_id:[null,_.kI.required],year_id:[null,_.kI.required],created_by:[1],updated_by:[1]})}populateForm(){this.rateForm.patchValue({base_currency:this.rateData.base_currency||"SDG",target_currency:this.rateData.target_currency,exchange_rate:this.rateData.exchange_rate,rate_date:this.rateData.rate_date,store_id:this.rateData.store_id,year_id:this.rateData.year_id})}loadSupportedCurrencies(){this.subscription.add(this.currencyService.getSupportedCurrencies().subscribe(t=>{t&&t.data&&(this.supportedCurrencies=t.data.filter(n=>"SDG"!==n.currency_code&&!0===n.is_active))},t=>{console.error("Error loading currencies:",t),this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0639\u0645\u0644\u0627\u062a","danger"),this.supportedCurrencies=[{currency_code:"USD",currency_name_ar:"\u062f\u0648\u0644\u0627\u0631 \u0623\u0645\u0631\u064a\u0643\u064a",currency_symbol:"$"},{currency_code:"AED",currency_name_ar:"\u062f\u0631\u0647\u0645 \u0625\u0645\u0627\u0631\u0627\u062a\u064a",currency_symbol:"\u062f.\u0625"},{currency_code:"SAR",currency_name_ar:"\u0631\u064a\u0627\u0644 \u0633\u0639\u0648\u062f\u064a",currency_symbol:"\u0631.\u0633"}]}))}save(){var t;return(0,d.mG)(this,void 0,void 0,function*(){if(!this.rateForm.valid)return void this.presentToast("\u064a\u0631\u062c\u0649 \u0645\u0644\u0621 \u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0642\u0648\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629","warning");const n=yield this.loadingController.create({message:"create"===this.mode?"\u0625\u0636\u0627\u0641\u0629 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641...":"\u062a\u062d\u062f\u064a\u062b \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641..."});yield n.present();try{const o=Object.assign({},this.rateForm.value),a=(null===(t=this.rateData)||void 0===t?void 0:t.id)&&null!==this.rateData.id;this.subscription.add("create"!==this.mode&&a?this.currencyService.updateCurrencyRate(this.rateData.id,o).subscribe(l=>(0,d.mG)(this,void 0,void 0,function*(){yield n.dismiss(),l&&"success"===l.status?(yield this.presentToast("\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 \u0628\u0646\u062c\u0627\u062d","success"),this.modalController.dismiss({saved:!0,data:l})):yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u062f\u064a\u062b \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")}),l=>(0,d.mG)(this,void 0,void 0,function*(){yield n.dismiss(),console.error("Error updating rate:",l),yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u062f\u064a\u062b \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")})):this.currencyService.createCurrencyRate(o).subscribe(l=>(0,d.mG)(this,void 0,void 0,function*(){yield n.dismiss(),l&&"success"===l.status?(yield this.presentToast("\u062a\u0645 \u062d\u0641\u0638 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 \u0628\u0646\u062c\u0627\u062d","success"),this.modalController.dismiss({saved:!0,data:l})):yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")}),l=>(0,d.mG)(this,void 0,void 0,function*(){yield n.dismiss(),console.error("Error creating rate:",l),yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")})))}catch(o){yield n.dismiss(),console.error("Error in save method:",o),yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639","danger")}})}delete(){var t;return(0,d.mG)(this,void 0,void 0,function*(){(null===(t=this.rateData)||void 0===t?void 0:t.id)?yield(yield this.alertController.create({header:"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641",message:"\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 \u0647\u0630\u0627\u061f \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062a\u0631\u0627\u062c\u0639 \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0625\u062c\u0631\u0627\u0621.",buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel"},{text:"\u062d\u0630\u0641",cssClass:"danger-button",handler:()=>(0,d.mG)(this,void 0,void 0,function*(){const o=yield this.loadingController.create({message:"\u062c\u0627\u0631\u064a \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641..."});yield o.present();try{this.subscription.add(this.currencyService.deleteCurrencyRate(this.rateData.id).subscribe(a=>(0,d.mG)(this,void 0,void 0,function*(){yield o.dismiss(),a&&"success"===a.status?(yield this.presentToast("\u062a\u0645 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 \u0628\u0646\u062c\u0627\u062d","success"),this.modalController.dismiss({deleted:!0,data:a})):yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")}),a=>(0,d.mG)(this,void 0,void 0,function*(){yield o.dismiss(),console.error("Error deleting rate:",a),yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")})))}catch(a){yield o.dismiss(),console.error("Error in delete method:",a),yield this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639","danger")}})}]})).present():yield this.presentToast("\u0644\u0627 \u064a\u0645\u0643\u0646 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0635\u0631\u0641 \u063a\u064a\u0631 \u0645\u062d\u0641\u0648\u0638","warning")})}presentToast(t,n){return(0,d.mG)(this,void 0,void 0,function*(){yield(yield this.toastController.create({message:t,duration:3e3,color:n,position:"top",cssClass:"rtl-toast"})).present()})}dismiss(){this.modalController.dismiss()}getModalTitle(){return"create"===this.mode?"\u0625\u0636\u0627\u0641\u0629 \u0633\u0639\u0631 \u0635\u0631\u0641":"\u062a\u0639\u062f\u064a\u0644 \u0633\u0639\u0631 \u0635\u0631\u0641"}getSaveButtonText(){return"create"===this.mode?"\u0625\u0636\u0627\u0641\u0629":"\u062a\u062d\u062f\u064a\u062b"}getCurrencyDisplayText(t){return`${t.currency_name_ar} (${t.currency_code})`}onCurrencySegmentChange(t){this.rateForm.patchValue({target_currency:t.detail.value})}getAppInfo(){this.storage.get("year").then(t=>{var n;t&&(this.localYear=t,!this.year&&!(null===(n=this.rateForm.get("year_id"))||void 0===n?void 0:n.value)&&this.rateForm.patchValue({year_id:t.id}))}),this.storage.get("STORE_INFO").then(t=>{var n;t&&(this.localStoreInfo=t,!this.store_info&&!(null===(n=this.rateForm.get("store_id"))||void 0===n?void 0:n.value)&&this.rateForm.patchValue({store_id:t.id}))}),this.storage.get("USER_INFO").then(t=>{t&&(this.user_info=t,this.rateForm.patchValue({created_by:t.id,updated_by:t.id}))})}resetForm(){var t,n,o,a,l,h;this.rateForm.reset(),this.rateForm.patchValue({base_currency:"SDG",rate_date:(new Date).toISOString().split("T")[0],store_id:(null===(t=this.localStoreInfo)||void 0===t?void 0:t.id)||(null===(n=this.store_info)||void 0===n?void 0:n.id),year_id:(null===(o=this.localYear)||void 0===o?void 0:o.id)||(null===(a=this.year)||void 0===a?void 0:a.id),created_by:(null===(l=this.user_info)||void 0===l?void 0:l.id)||1,updated_by:(null===(h=this.user_info)||void 0===h?void 0:h.id)||1})}isFieldInvalid(t){const n=this.rateForm.get(t);return!!n&&n.invalid&&(n.dirty||n.touched)}getFieldErrorMessage(t){const n=this.rateForm.get(t);if(n&&n.errors){if(n.errors.required)return"\u0647\u0630\u0627 \u0627\u0644\u062d\u0642\u0644 \u0645\u0637\u0644\u0648\u0628";if(n.errors.min)return"\u0627\u0644\u0642\u064a\u0645\u0629 \u064a\u062c\u0628 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0623\u0643\u0628\u0631 \u0645\u0646 \u0635\u0641\u0631";if(n.errors.max)return"\u0627\u0644\u0642\u064a\u0645\u0629 \u0643\u0628\u064a\u0631\u0629 \u062c\u062f\u0627\u064b - \u0627\u0644\u062d\u062f \u0627\u0644\u0623\u0642\u0635\u0649 999,999,999"}return""}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(_.qu),e.Y36(i.IN),e.Y36(C.i),e.Y36(i.yF),e.Y36(i.HT),e.Y36(i.Br),e.Y36(Z.r),e.Y36(r.K),e.Y36(y.uU))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-currency-rate-modal"]],inputs:{mode:"mode",rateData:"rateData",store_info:"store_info",year:"year"},decls:56,vars:12,consts:[[1,"ion-no-border"],["color","primary"],["slot","end"],["fill","clear",3,"click"],["name","close","color","light"],[1,"ion-padding"],[3,"formGroup","ngSubmit"],[1,"form-grid"],[1,"form-row"],["size-lg","6","size-md","6","size","12",1,"form-field-col"],[1,"field-label"],[1,"required-asterisk"],[1,"currency-section"],["scrollable","true",1,"compact-segment","currency-segment",3,"value","disabled","ionChange"],["class","compact-segment-button",3,"value",4,"ngFor","ngForOf"],["class","error-message",4,"ngIf"],[1,"custInput","rate-input"],["type","number","formControlName","exchange_rate","step","0.000001","placeholder","450.50",1,"form-input"],[1,"custInput","date-input"],["type","date","formControlName","rate_date",1,"date-picker",3,"max"],["type","hidden","formControlName","base_currency"],["type","hidden","formControlName","store_id"],["type","hidden","formControlName","year_id"],["type","hidden","formControlName","created_by"],["type","hidden","formControlName","updated_by"],[1,"action-buttons-row"],[1,"ion-text-center"],[1,"button-group"],["type","submit","color","primary","size","small",1,"action-btn","save-btn",3,"disabled"],["name","save-outline","slot","start"],["fill","outline","color","medium","size","small",1,"action-btn","reset-btn",3,"click"],["name","refresh-outline","slot","start"],["fill","outline","color","danger","size","small","class","action-btn delete-btn",3,"click",4,"ngIf"],["fill","outline","color","medium","size","small",1,"action-btn","cancel-btn",3,"click"],["name","close-outline","slot","start"],[1,"compact-segment-button",3,"value"],[1,"error-message"],["fill","outline","color","danger","size","small",1,"action-btn","delete-btn",3,"click"],["name","trash-outline","slot","start"]],template:function(t,n){if(1&t&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",2),e.TgZ(5,"ion-button",3),e.NdJ("click",function(){return n.dismiss()}),e._UZ(6,"ion-icon",4),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"ion-content",5),e.TgZ(8,"form",6),e.NdJ("ngSubmit",function(){return n.save()}),e.TgZ(9,"ion-grid",7),e.TgZ(10,"ion-row",8),e.TgZ(11,"ion-col",9),e.TgZ(12,"ion-label",10),e._uU(13," \u0627\u0644\u0639\u0645\u0644\u0629 "),e.TgZ(14,"span",11),e._uU(15,"*"),e.qZA(),e.qZA(),e.TgZ(16,"div",12),e.TgZ(17,"ion-segment",13),e.NdJ("ionChange",function(a){return n.onCurrencySegmentChange(a)}),e.YNc(18,c,5,3,"ion-segment-button",14),e.qZA(),e.qZA(),e.YNc(19,u,2,1,"div",15),e.qZA(),e.TgZ(20,"ion-col",9),e.TgZ(21,"ion-label",10),e._uU(22," \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 (\u0645\u0642\u0627\u0628\u0644 \u0627\u0644\u062c\u0646\u064a\u0647 \u0627\u0644\u0633\u0648\u062f\u0627\u0646\u064a) "),e.TgZ(23,"span",11),e._uU(24,"*"),e.qZA(),e.qZA(),e.TgZ(25,"ion-item",16),e._UZ(26,"ion-input",17),e.qZA(),e.YNc(27,m,2,1,"div",15),e.qZA(),e.qZA(),e.TgZ(28,"ion-row",8),e.TgZ(29,"ion-col",9),e.TgZ(30,"ion-label",10),e._uU(31," \u0627\u0644\u062a\u0627\u0631\u064a\u062e "),e.TgZ(32,"span",11),e._uU(33,"*"),e.qZA(),e.qZA(),e.TgZ(34,"ion-item",18),e._UZ(35,"ion-input",19),e.qZA(),e.YNc(36,P,2,1,"div",15),e.qZA(),e._UZ(37,"ion-col",9),e.qZA(),e._UZ(38,"input",20),e._UZ(39,"input",21),e._UZ(40,"input",22),e._UZ(41,"input",23),e._UZ(42,"input",24),e.TgZ(43,"ion-row",25),e.TgZ(44,"ion-col",26),e.TgZ(45,"div",27),e.TgZ(46,"ion-button",28),e._UZ(47,"ion-icon",29),e._uU(48),e.qZA(),e.TgZ(49,"ion-button",30),e.NdJ("click",function(){return n.resetForm()}),e._UZ(50,"ion-icon",31),e._uU(51," \u0625\u0639\u0627\u062f\u0629 \u062a\u0639\u064a\u064a\u0646 "),e.qZA(),e.YNc(52,F,3,0,"ion-button",32),e.TgZ(53,"ion-button",33),e.NdJ("click",function(){return n.dismiss()}),e._UZ(54,"ion-icon",34),e._uU(55," \u0625\u0644\u063a\u0627\u0621 "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t){let o;e.xp6(3),e.Oqu(n.getModalTitle()),e.xp6(5),e.Q6J("formGroup",n.rateForm),e.xp6(9),e.Q6J("value",null==(o=n.rateForm.get("target_currency"))?null:o.value)("disabled","edit"===n.mode),e.xp6(1),e.Q6J("ngForOf",n.supportedCurrencies),e.xp6(1),e.Q6J("ngIf",n.isFieldInvalid("target_currency")),e.xp6(8),e.Q6J("ngIf",n.isFieldInvalid("exchange_rate")),e.xp6(8),e.Q6J("max",n.maxDate),e.xp6(1),e.Q6J("ngIf",n.isFieldInvalid("rate_date")),e.xp6(10),e.Q6J("disabled",!n.rateForm.valid||n.isLoading),e.xp6(2),e.hij(" ",n.getSaveButtonText()," "),e.xp6(4),e.Q6J("ngIf","edit"===n.mode&&(null==n.rateData?null:n.rateData.id))}},directives:[i.Gu,i.sr,i.wd,i.Sm,i.YG,i.gu,i.W2,_._Y,_.JL,_.sg,i.jY,i.Nd,i.wI,i.Q$,i.cJ,i.QI,y.sg,y.O5,i.Ie,i.pK,i.as,_.JJ,_.u,i.j9,_.Fj,i.GO],styles:["ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light)}.form-grid[_ngcontent-%COMP%]{margin-bottom:20px}.form-row[_ngcontent-%COMP%]{margin-bottom:8px}.form-field-col[_ngcontent-%COMP%]{padding:4px 8px}.field-label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:600;color:var(--ion-color-primary);margin-bottom:4px;text-align:right;direction:rtl}.required-asterisk[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-weight:700}.custInput[_ngcontent-%COMP%]{--background: var(--ion-color-light-tint);--border-color: var(--ion-color-medium-tint);--border-radius: 6px;--border-width: 1px;--border-style: solid;--padding-start: 12px;--padding-end: 12px;--min-height: 36px;margin:0;font-size:13px;box-shadow:0 1px 3px #0000001a}.custInput[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], .custInput[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--color: var(--ion-color-dark);font-size:13px}.rate-input[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%], .rate-input[_ngcontent-%COMP%]   .date-picker[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]   .date-picker[_ngcontent-%COMP%]{--color: var(--ion-color-dark);--placeholder-color: var(--ion-color-medium);font-size:13px}.currency-section[_ngcontent-%COMP%]{margin-top:4px}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]{border-radius:12px;background:rgba(255,255,255,.8);border:1px solid rgba(0,0,0,.1);overflow:hidden;min-height:40px;width:100%}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background: transparent;--background-checked: var(--ion-color-primary);--color: var(--ion-color-dark);--color-checked: white;--indicator-color: transparent;--border-radius: 10px;--padding-start: 6px;--padding-end: 6px;min-height:38px;font-size:11px;font-weight:500;transition:all .3s ease;flex-direction:column}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;font-size:12px;line-height:1.2}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:9px;opacity:.8;line-height:1.1;margin-top:1px}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]:hover{--background: rgba(var(--ion-color-primary-rgb), .1)}.date-input[_ngcontent-%COMP%]   .date-picker[_ngcontent-%COMP%]{text-align:right;direction:rtl}.error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:11px;margin-top:-8px;margin-bottom:8px;margin-right:12px;font-weight:500}.action-buttons-row[_ngcontent-%COMP%]{margin-top:16px;padding-top:12px;border-top:1px solid var(--ion-color-light-shade)}.button-group[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px;flex-wrap:wrap}.action-btn[_ngcontent-%COMP%]{--height: 32px;--border-radius: 6px;font-size:12px;margin:2px;min-width:80px}.action-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.save-btn[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: white;font-weight:600}.reset-btn[_ngcontent-%COMP%], .cancel-btn[_ngcontent-%COMP%]{--border-color: var(--ion-color-medium);--color: var(--ion-color-medium-shade)}@media (min-width: 992px){.form-field-col[_ngcontent-%COMP%]{max-width:50%;flex:0 0 50%}.button-group[_ngcontent-%COMP%]{justify-content:center}}@media (max-width: 991px) and (min-width: 768px){.form-field-col[_ngcontent-%COMP%]{max-width:50%;flex:0 0 50%}.field-label[_ngcontent-%COMP%]{font-size:11px}.custInput[_ngcontent-%COMP%]{--min-height: 34px;font-size:12px}.button-group[_ngcontent-%COMP%]{justify-content:center;gap:6px}}@media (max-width: 767px){.form-field-col[_ngcontent-%COMP%]{max-width:100%;flex:0 0 100%}ion-content[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px}.field-label[_ngcontent-%COMP%]{font-size:11px}.custInput[_ngcontent-%COMP%]{--min-height: 32px;font-size:12px}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]{min-height:36px}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{min-height:34px;font-size:10px;--padding-start: 4px;--padding-end: 4px}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:8px}.action-btn[_ngcontent-%COMP%]{--height: 30px;font-size:11px;min-width:70px}.action-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:4px}}ion-label[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%], ion-select[_ngcontent-%COMP%], ion-datetime[_ngcontent-%COMP%]{text-align:right;direction:rtl}ion-button[_ngcontent-%COMP%]{direction:rtl}ion-select-option[_ngcontent-%COMP%]{text-align:right;direction:rtl}.custInput.item-has-focus[_ngcontent-%COMP%]{--border-color: var(--ion-color-primary);--border-width: 2px}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.6}.action-btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 8px #00000026}@media (prefers-color-scheme: dark){.custInput[_ngcontent-%COMP%]{--background: var(--ion-color-dark-tint);--border-color: var(--ion-color-medium-shade)}.field-label[_ngcontent-%COMP%]{color:var(--ion-color-primary-tint)}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]{background:rgba(var(--ion-color-dark-rgb),.8);border-color:var(--ion-color-medium-shade)}.currency-section[_ngcontent-%COMP%]   .currency-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--color: var(--ion-color-light);--color-checked: white}.action-buttons-row[_ngcontent-%COMP%]{border-top-color:var(--ion-color-dark-shade)}}.rtl-toast[_ngcontent-%COMP%]{direction:rtl;text-align:right}"]}),s})();function U(s,p){1&s&&e._UZ(0,"ion-progress-bar",22)}function E(s,p){if(1&s){const t=e.EpF();e.TgZ(0,"ion-button",32),e.NdJ("click",function(o){e.CHM(t);const a=e.oxw().$implicit;return e.oxw().deleteRate(a),o.stopPropagation()}),e._UZ(1,"ion-icon",33),e.qZA()}}function R(s,p){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item",23),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw().openRateModal(a)}),e.TgZ(1,"ion-avatar",0),e.TgZ(2,"div",11),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"ion-label"),e.TgZ(5,"h3"),e._uU(6),e.qZA(),e.TgZ(7,"div",24),e.TgZ(8,"span",25),e._uU(9),e.qZA(),e.TgZ(10,"span",26),e._uU(11,"="),e.qZA(),e.TgZ(12,"span",27),e._uU(13),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"div",28),e.TgZ(15,"ion-button",29),e.NdJ("click",function(o){const l=e.CHM(t).$implicit;return e.oxw().openRateModal(l),o.stopPropagation()}),e._UZ(16,"ion-icon",30),e.qZA(),e.YNc(17,E,2,0,"ion-button",31),e.qZA(),e.qZA()}if(2&s){const t=p.$implicit,n=e.oxw();e.xp6(3),e.Oqu(t.currency),e.xp6(3),e.Oqu((null==t.currency_info?null:t.currency_info.currency_name_ar)||t.currency),e.xp6(3),e.hij("1 ",t.currency,""),e.xp6(4),e.hij("",n.formatNumberEnglish(n.getRateValue(t.rate))," SDG"),e.xp6(4),e.Q6J("ngIf",t.id)}}function I(s,p){1&s&&(e.TgZ(0,"ion-item",10),e.TgZ(1,"div",34),e._UZ(2,"ion-icon",35),e.TgZ(3,"h4"),e._uU(4,"\u0644\u0627 \u062a\u0648\u062c\u062f \u0623\u0633\u0639\u0627\u0631 \u0635\u0631\u0641 \u0645\u062d\u062f\u062f\u0629"),e.qZA(),e.TgZ(5,"p"),e._uU(6,'\u0627\u0636\u063a\u0637 \u0639\u0644\u0649 "\u0625\u0636\u0627\u0641\u0629 \u0633\u0639\u0631" \u0644\u0625\u0636\u0627\u0641\u0629 \u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0635\u0631\u0641'),e.qZA(),e.qZA(),e.qZA())}function G(s,p){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item",36),e.TgZ(1,"ion-avatar",0),e.TgZ(2,"div",11),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"ion-label"),e.TgZ(5,"h3"),e._uU(6),e.qZA(),e.TgZ(7,"p"),e._uU(8),e.qZA(),e.qZA(),e.TgZ(9,"div",37),e.TgZ(10,"ion-button",38),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw().setCurrency(a.currency_code)}),e._UZ(11,"ion-icon",39),e.qZA(),e.TgZ(12,"ion-toggle",40),e.NdJ("ionChange",function(){const a=e.CHM(t).$implicit;return e.oxw().toggleCurrencyStatus(a)}),e.qZA(),e.qZA(),e.qZA()}if(2&s){const t=p.$implicit,n=e.oxw();e.xp6(3),e.Oqu(t.currency_code),e.xp6(3),e.Oqu(t.currency_name_ar),e.xp6(2),e.AsE("",t.currency_name_en," (",t.currency_symbol,")"),e.xp6(2),e.Q6J("disabled",n.currentCurrency===t.currency_code),e.xp6(2),e.Q6J("checked",t.is_active)}}const k=[{path:"",component:(()=>{class s{constructor(t,n,o,a,l,h,v,x){this.route=t,this.alertController=n,this.storage=o,this.loadingController=a,this.api=l,this.toast=h,this.currencyService=v,this.modalController=x,this.currencies=[],this.rates=[],this.currentCurrency="SDG",this.isLoading=!1,this.subscription=new b.w}ngOnInit(){return(0,d.mG)(this,void 0,void 0,function*(){yield this.getAppInfo(),yield this.initializeCurrency(),yield this.loadCurrencies(),this.loadRates()})}ngOnDestroy(){this.subscription.unsubscribe()}initializeCurrency(){return(0,d.mG)(this,void 0,void 0,function*(){try{yield this.currencyService.initializeCurrency(),this.subscription.add(this.currencyService.getCurrentCurrency().subscribe(t=>{this.currentCurrency=t}))}catch(t){console.error("Error initializing currency:",t)}})}getAppInfo(){return(0,d.mG)(this,void 0,void 0,function*(){this.user_info=yield this.storage.get("USER_INFO"),this.year=yield this.storage.get("year"),this.store_info=yield this.storage.get("STORE_INFO")})}loadCurrencies(){return(0,d.mG)(this,void 0,void 0,function*(){try{this.isLoading=!0,yield this.currencyService.loadSupportedCurrencies(),this.subscription.add(this.currencyService.getSupportedCurrenciesObservable().subscribe(t=>{this.currencies=t,(!this.currencies||0===this.currencies.length)&&(this.currencies=[{id:1,currency_code:"USD",currency_name_ar:"\u062f\u0648\u0644\u0627\u0631 \u0623\u0645\u0631\u064a\u0643\u064a",currency_name_en:"US Dollar",currency_symbol:"$",is_active:!0},{id:2,currency_code:"AED",currency_name_ar:"\u062f\u0631\u0647\u0645 \u0625\u0645\u0627\u0631\u0627\u062a\u064a",currency_name_en:"UAE Dirham",currency_symbol:"\u062f.\u0625",is_active:!0},{id:3,currency_code:"SAR",currency_name_ar:"\u0631\u064a\u0627\u0644 \u0633\u0639\u0648\u062f\u064a",currency_name_en:"Saudi Riyal",currency_symbol:"\u0631.\u0633",is_active:!0},{id:4,currency_code:"SDG",currency_name_ar:"\u062c\u0646\u064a\u0647 \u0633\u0648\u062f\u0627\u0646\u064a",currency_name_en:"Sudanese Pound",currency_symbol:"\u062c.\u0633",is_active:!0}])}))}catch(t){this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0639\u0645\u0644\u0627\u062a","danger")}finally{this.isLoading=!1}})}loadRates(){return(0,d.mG)(this,void 0,void 0,function*(){if(this.store_info&&this.year)try{yield this.currencyService.loadRatesByYear(this.store_info.id,this.year.id),this.subscription.add(this.currencyService.getCurrentExchangeRates().subscribe(t=>{this.rates=Array.isArray(t)?t.map(n=>Object.assign(Object.assign({},n),{currency:n.target_currency||n.currency,rate:n.exchange_rate||n.rate,currency_info:this.currencies.find(o=>o.currency_code===(n.target_currency||n.currency))})):t&&"object"==typeof t?Object.entries(t).map(([n,o])=>({currency:n,rate:o,currency_info:this.currencies.find(a=>a.currency_code===n)})):[]}))}catch(t){this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u0645\u064a\u0644 \u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0635\u0631\u0641","danger")}})}openRateModal(t){var n,o,a,l,h,v;return(0,d.mG)(this,void 0,void 0,function*(){let x="create",O=null;t&&"object"==typeof t&&t.currency?(x="edit",O={id:t.id||null,base_currency:t.base_currency||"SDG",target_currency:t.target_currency||t.currency,exchange_rate:t.exchange_rate||this.getRateValue(t.rate),rate_date:t.rate_date||(new Date).toISOString().split("T")[0],store_id:t.store_id||(null===(n=this.store_info)||void 0===n?void 0:n.id),year_id:t.year_id||(null===(o=this.year)||void 0===o?void 0:o.id)}):O=t&&"string"==typeof t?{base_currency:"SDG",target_currency:t,exchange_rate:0,rate_date:(new Date).toISOString().split("T")[0],store_id:null===(a=this.store_info)||void 0===a?void 0:a.id,year_id:null===(l=this.year)||void 0===l?void 0:l.id}:{base_currency:"SDG",target_currency:"",exchange_rate:0,rate_date:(new Date).toISOString().split("T")[0],store_id:null===(h=this.store_info)||void 0===h?void 0:h.id,year_id:null===(v=this.year)||void 0===v?void 0:v.id};const D=yield this.modalController.create({component:w,componentProps:{mode:x,rateData:O,store_info:this.store_info,year:this.year}});return D.onDidDismiss().then(q=>(0,d.mG)(this,void 0,void 0,function*(){var T,A;(null===(T=q.data)||void 0===T?void 0:T.saved)?(yield this.refreshRates(),this.presentToast("\u062a\u0645 \u062d\u0641\u0638 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 \u0628\u0646\u062c\u0627\u062d","success")):(null===(A=q.data)||void 0===A?void 0:A.deleted)&&(yield this.refreshRates(),this.presentToast("\u062a\u0645 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 \u0628\u0646\u062c\u0627\u062d","success"))})),yield D.present()})}deleteRate(t){return(0,d.mG)(this,void 0,void 0,function*(){(null==t?void 0:t.id)?yield(yield this.alertController.create({header:"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641",message:`\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0635\u0631\u0641 ${t.currency}\u061f \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062a\u0631\u0627\u062c\u0639 \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0625\u062c\u0631\u0627\u0621.`,buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel"},{text:"\u062d\u0630\u0641",cssClass:"danger-button",handler:()=>(0,d.mG)(this,void 0,void 0,function*(){const o=yield this.loadingController.create({message:"\u062c\u0627\u0631\u064a \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641..."});yield o.present();try{this.currencyService.deleteCurrencyRate(t.id).subscribe(a=>(0,d.mG)(this,void 0,void 0,function*(){yield o.dismiss(),a&&"success"===a.status?(yield this.refreshRates(),this.presentToast("\u062a\u0645 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641 \u0628\u0646\u062c\u0627\u062d","success")):this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")}),a=>(0,d.mG)(this,void 0,void 0,function*(){yield o.dismiss(),console.error("Error deleting rate:",a),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0627\u0644\u0635\u0631\u0641","danger")}))}catch(a){yield o.dismiss(),console.error("Error in delete method:",a),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639","danger")}})}]})).present():this.presentToast("\u0644\u0627 \u064a\u0645\u0643\u0646 \u062d\u0630\u0641 \u0633\u0639\u0631 \u0635\u0631\u0641 \u063a\u064a\u0631 \u0645\u062d\u0641\u0648\u0638","warning")})}toggleCurrencyStatus(t){return(0,d.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"\u062a\u0623\u0643\u064a\u062f",message:`\u0647\u0644 \u062a\u0631\u064a\u062f ${t.is_active?"\u0625\u0644\u063a\u0627\u0621 \u062a\u0641\u0639\u064a\u0644":"\u062a\u0641\u0639\u064a\u0644"} \u0639\u0645\u0644\u0629 ${t.currency_name_ar}\u061f`,buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel"},{text:"\u062a\u0623\u0643\u064a\u062f",handler:()=>(0,d.mG)(this,void 0,void 0,function*(){try{const o=yield this.loadingController.create({message:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u062f\u064a\u062b..."});yield o.present();const a=Object.assign(Object.assign({},t),{is_active:!t.is_active});this.currencyService.updateSupportedCurrency(a.id,a).subscribe(l=>(0,d.mG)(this,void 0,void 0,function*(){yield o.dismiss(),console.log("Currency update response:",l),l&&"success"===l.status?(this.loadCurrencies(),this.presentToast("\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0639\u0645\u0644\u0629 \u0628\u0646\u062c\u0627\u062d","success")):this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0639\u0645\u0644\u0629","danger")}),l=>(0,d.mG)(this,void 0,void 0,function*(){yield o.dismiss(),console.error("Currency update error:",l),this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0639\u0645\u0644\u0629","danger")}))}catch(o){this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0639\u0645\u0644\u0629","danger")}})}]})).present()})}setCurrency(t){return(0,d.mG)(this,void 0,void 0,function*(){this.currencyService.setCurrency(t),this.presentToast(`\u062a\u0645 \u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0639\u0645\u0644\u0629 \u0625\u0644\u0649 ${this.getCurrencyName(t)}`,"success")})}getCurrencyName(t){const n=this.currencies.find(o=>o.currency_code===t);return n?n.currency_name_ar:t}getExchangeRate(t){return this.currencyService.getExchangeRate(t)}formatCurrency(t,n){const o=this.currencyService.formatCurrency(t,n);return this.convertToEnglishNumbers(o)}getRateValue(t){return"number"==typeof t?t:"string"==typeof t?parseFloat(t)||0:"object"==typeof t&&null!==t&&parseFloat(t.exchange_rate||t.rate||t.value||"0")||0}convertToEnglishNumbers(t){if(!t)return t;const n=["\u0660","\u0661","\u0662","\u0663","\u0664","\u0665","\u0666","\u0667","\u0668","\u0669"],o=["0","1","2","3","4","5","6","7","8","9"];let a=t.toString();for(let l=0;l<n.length;l++)a=a.replace(new RegExp(n[l],"g"),o[l]);return a}formatNumberEnglish(t,n=6){if(null==t)return"0";const o=t.toLocaleString("en-US",{minimumFractionDigits:0===n?0:2,maximumFractionDigits:n});return this.convertToEnglishNumbers(o)}presentToast(t,n){return(0,d.mG)(this,void 0,void 0,function*(){(yield this.toast.create({message:t,duration:2e3,color:n,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})}refreshRates(){return(0,d.mG)(this,void 0,void 0,function*(){if(this.store_info&&this.year)try{this.isLoading=!0,yield this.currencyService.loadRatesByYear(this.store_info.id,this.year.id),this.loadRates(),this.presentToast("\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0635\u0631\u0641","success")}catch(t){this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0635\u0631\u0641","danger")}finally{this.isLoading=!1}})}goBack(){this.route.navigate(["/analytics-dashboard"])}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(f.F0),e.Y36(i.Br),e.Y36(r.K),e.Y36(i.HT),e.Y36(Z.r),e.Y36(i.yF),e.Y36(C.i),e.Y36(i.IN))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-currency-management"]],decls:66,vars:6,consts:[["slot","start"],[3,"click"],["slot","end"],["fill","clear",3,"click"],["name","refresh-outline"],["type","indeterminate",4,"ngIf"],[1,"ion-margin-top"],["dir","rtl",1,"ion-justify-content-center"],["size","12"],[1,"current-currency-display"],["lines","none"],[1,"currency-avatar"],["slot","end","color","primary"],[1,"section-header"],["fill","outline","size","small",3,"click"],["name","add","slot","start"],[1,"ion-margin-top","ion-margin-bottom"],["button","",3,"click",4,"ngFor","ngForOf"],["slot","end",1,"rate-display"],["color","primary"],["lines","none",4,"ngIf"],["button","",4,"ngFor","ngForOf"],["type","indeterminate"],["button","",3,"click"],[1,"exchange-rate-display"],[1,"currency-from"],[1,"equals"],[1,"currency-to"],["slot","end",1,"rate-actions"],["fill","clear","size","small","color","primary",3,"click"],["name","create-outline","slot","icon-only"],["fill","clear","size","small","color","danger",3,"click",4,"ngIf"],["fill","clear","size","small","color","danger",3,"click"],["name","trash-outline","slot","icon-only"],[1,"empty-state"],["name","wallet-outline","size","large","color","medium"],["button",""],["slot","end",1,"currency-actions"],["fill","clear","size","small",3,"disabled","click"],["name","checkmark-circle-outline"],[3,"checked","ionChange"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-buttons",0),e.TgZ(3,"ion-back-button",1),e.NdJ("click",function(){return n.goBack()}),e.qZA(),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0639\u0645\u0644\u0627\u062a"),e.qZA(),e.TgZ(6,"ion-buttons",2),e.TgZ(7,"ion-button",3),e.NdJ("click",function(){return n.refreshRates()}),e._UZ(8,"ion-icon",4),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"ion-content"),e.YNc(10,U,1,0,"ion-progress-bar",5),e.TgZ(11,"ion-grid",6),e.TgZ(12,"ion-row",7),e.TgZ(13,"ion-col",8),e.TgZ(14,"h5"),e._uU(15,"\u0627\u0644\u0639\u0645\u0644\u0629 \u0627\u0644\u062d\u0627\u0644\u064a\u0629"),e.qZA(),e.TgZ(16,"ion-card"),e.TgZ(17,"ion-card-content"),e.TgZ(18,"div",9),e.TgZ(19,"ion-item",10),e.TgZ(20,"ion-avatar",0),e.TgZ(21,"div",11),e._uU(22),e.qZA(),e.qZA(),e.TgZ(23,"ion-label"),e.TgZ(24,"h3"),e._uU(25),e.qZA(),e.TgZ(26,"p"),e._uU(27,"\u0627\u0644\u0639\u0645\u0644\u0629 \u0627\u0644\u0645\u062d\u062f\u062f\u0629 \u062d\u0627\u0644\u064a\u0627\u064b"),e.qZA(),e.qZA(),e.TgZ(28,"ion-chip",12),e.TgZ(29,"ion-label"),e._uU(30,"\u0641\u0639\u0627\u0644"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(31,"ion-row",7),e.TgZ(32,"ion-col",8),e.TgZ(33,"div",13),e.TgZ(34,"h5"),e._uU(35,"\u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0635\u0631\u0641"),e.qZA(),e.TgZ(36,"ion-button",14),e.NdJ("click",function(){return n.openRateModal()}),e._UZ(37,"ion-icon",15),e._uU(38," \u0625\u0636\u0627\u0641\u0629 \u0633\u0639\u0631 "),e.qZA(),e.qZA(),e.TgZ(39,"ion-card"),e.TgZ(40,"ion-list",16),e.TgZ(41,"ion-item-divider"),e.TgZ(42,"ion-label"),e._uU(43,"\u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0635\u0631\u0641 \u0645\u0642\u0627\u0628\u0644 \u0627\u0644\u062c\u0646\u064a\u0647 \u0627\u0644\u0633\u0648\u062f\u0627\u0646\u064a (SDG)"),e.qZA(),e.qZA(),e.YNc(44,R,18,5,"ion-item",17),e.TgZ(45,"ion-item"),e.TgZ(46,"ion-avatar",0),e.TgZ(47,"div",11),e._uU(48,"SDG"),e.qZA(),e.qZA(),e.TgZ(49,"ion-label"),e.TgZ(50,"h3"),e._uU(51,"\u062c\u0646\u064a\u0647 \u0633\u0648\u062f\u0627\u0646\u064a"),e.qZA(),e.TgZ(52,"p"),e._uU(53,"\u0627\u0644\u0639\u0645\u0644\u0629 \u0627\u0644\u0623\u0633\u0627\u0633\u064a\u0629"),e.qZA(),e.qZA(),e.TgZ(54,"div",18),e.TgZ(55,"ion-chip",19),e.TgZ(56,"ion-label"),e._uU(57,"\u0639\u0645\u0644\u0629 \u0623\u0633\u0627\u0633\u064a\u0629"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(58,I,7,0,"ion-item",20),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(59,"ion-row",7),e.TgZ(60,"ion-col",8),e.TgZ(61,"h5"),e._uU(62,"\u0627\u0644\u0639\u0645\u0644\u0627\u062a \u0627\u0644\u0645\u062f\u0639\u0648\u0645\u0629"),e.qZA(),e.TgZ(63,"ion-card"),e.TgZ(64,"ion-list",16),e.YNc(65,G,13,6,"ion-item",21),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(10),e.Q6J("ngIf",n.isLoading),e.xp6(12),e.Oqu(n.currentCurrency),e.xp6(3),e.Oqu(n.getCurrencyName(n.currentCurrency)),e.xp6(19),e.Q6J("ngForOf",n.rates),e.xp6(14),e.Q6J("ngIf",0===n.rates.length),e.xp6(7),e.Q6J("ngForOf",n.currencies))},directives:[i.Gu,i.sr,i.Sm,i.oU,i.cs,i.wd,i.YG,i.gu,i.W2,y.O5,i.jY,i.Nd,i.wI,i.PM,i.FN,i.Ie,i.BJ,i.Q$,i.hM,i.q_,i.rH,y.sg,i.X7,i.ho,i.w],styles:[".current-currency-display[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--ion-color-primary-tint), var(--ion-color-primary));--color: white;border-radius:12px}.currency-avatar[_ngcontent-%COMP%]{width:40px;height:40px;background:var(--ion-color-secondary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px}.currency-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}.rate-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.exchange-rate-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:.95rem;margin-top:4px}.exchange-rate-display[_ngcontent-%COMP%]   .currency-from[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:600;min-width:60px}.exchange-rate-display[_ngcontent-%COMP%]   .equals[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-weight:500;font-size:1.1rem}.exchange-rate-display[_ngcontent-%COMP%]   .currency-to[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:600;font-family:Courier New,monospace;letter-spacing:.5px}.conversion-rate-display[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:2px}.conversion-rate-display[_ngcontent-%COMP%]   .converted-amount[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:700;font-size:1.1rem;font-family:Courier New,monospace;letter-spacing:.5px}.conversion-rate-display[_ngcontent-%COMP%]   .currency-name[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.85rem;font-weight:400}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem;width:100%}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9rem}.conversion-example[_ngcontent-%COMP%]   .conversion-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--ion-color-primary);margin-bottom:.25rem}.conversion-example[_ngcontent-%COMP%]   .conversion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0;font-size:.9rem}.conversion-example[_ngcontent-%COMP%]   .conversion-results[_ngcontent-%COMP%]   .conversion-result[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;border-bottom:1px solid var(--ion-color-light)}.conversion-example[_ngcontent-%COMP%]   .conversion-results[_ngcontent-%COMP%]   .conversion-result[_ngcontent-%COMP%]:last-child{border-bottom:none}.conversion-example[_ngcontent-%COMP%]   .conversion-results[_ngcontent-%COMP%]   .conversion-result[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--ion-color-success)}.conversion-example[_ngcontent-%COMP%]   .conversion-results[_ngcontent-%COMP%]   .conversion-result[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9rem}ion-card[_ngcontent-%COMP%]{margin:1rem 0}ion-list[_ngcontent-%COMP%]{padding:0}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 16px}ion-chip[_ngcontent-%COMP%]{--color: white}h5[_ngcontent-%COMP%]{color:var(--ion-color-dark);margin-bottom:.5rem;font-weight:600}[dir=rtl][_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .currency-actions[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .rate-display[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .exchange-rate-display[_ngcontent-%COMP%]{direction:rtl}[dir=rtl][_ngcontent-%COMP%]   .exchange-rate-display[_ngcontent-%COMP%]   .currency-from[_ngcontent-%COMP%]{text-align:right}[dir=rtl][_ngcontent-%COMP%]   .exchange-rate-display[_ngcontent-%COMP%]   .currency-to[_ngcontent-%COMP%]{text-align:left}[dir=rtl][_ngcontent-%COMP%]   .conversion-results[_ngcontent-%COMP%]{direction:rtl}[dir=rtl][_ngcontent-%COMP%]   .conversion-rate-display[_ngcontent-%COMP%]{align-items:flex-end}[dir=rtl][_ngcontent-%COMP%]   .conversion-rate-display[_ngcontent-%COMP%]   .converted-amount[_ngcontent-%COMP%]{text-align:left}[dir=rtl][_ngcontent-%COMP%]   .conversion-rate-display[_ngcontent-%COMP%]   .currency-name[_ngcontent-%COMP%]{text-align:right}"]}),s})()}];let N=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[f.Bz.forChild(k)],f.Bz]}),s})();var z=g(62279);let Y=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[y.ez,_.u5,i.Pc,N,z.m]]}),s})()},62279:(S,M,g)=>{g.d(M,{m:()=>b});var y=g(69808),_=g(34182),i=g(23349),f=g(32090),d=g(29863);let b=(()=>{class e{}return e.\u0275fac=function(Z){return new(Z||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({providers:[y.uU],imports:[[y.ez,_.u5,_.UX,i.Pc,f.Fw]]}),e})()},6612:(S,M,g)=>{g.d(M,{i:()=>e});var y=g(70655),_=g(40520),i=g(591),f=g(29863),d=g(90849),b=g(91472);let e=(()=>{class C{constructor(r,c,u){this.http=r,this.storage=c,this.servicesService=u,this.currentCurrency=new i.X("SDG"),this.currentYear=new i.X(null),this.exchangeRates=new i.X({}),this.supportedCurrencies=new i.X([]),this.ratesCache=new Map,this.api=this.servicesService.api}getCurrentCurrency(){return this.currentCurrency.asObservable()}getCurrentCurrencyValue(){return this.currentCurrency.value}setCurrency(r){this.currentCurrency.next(r),this.storage.set("selectedCurrency",r)}setCurrentYear(r){this.currentYear.next(r)}loadRatesByYear(r,c){return(0,y.mG)(this,void 0,void 0,function*(){try{const u=(new _.LE).set("store_id",r).set("year_id",c),m=yield this.http.get(this.api+"currency_rates/latest.php",{params:u}).toPromise();return m&&m.data&&(this.cacheRates(m.data,c),this.exchangeRates.next(m.data)),m}catch(u){return console.error("Error loading currency rates:",u),null}})}getExchangeRate(r){if("SDG"===r)return 1;const c=this.exchangeRates.value;if(Array.isArray(c)){const u=c.find(m=>m.target_currency===r);return u?parseFloat(u.exchange_rate):1}return 1}createCurrencyRate(r){const c={headers:new _.WM({"Content-Type":"application/json"})};return this.http.post(this.api+"currency_rates/create.php",r,c)}getCurrencyRates(r){let c=new _.LE;return Object.keys(r).forEach(u=>{r[u]&&(c=c.set(u,r[u]))}),this.http.get(this.api+"currency_rates/read.php",{params:c})}updateCurrencyRate(r,c){const u=Object.assign({id:r},c),m={headers:new _.WM({"Content-Type":"application/json"})};return this.http.put(this.api+"currency_rates/update.php",u,m)}deleteCurrencyRate(r){const c=(new _.LE).set("id",r);return this.http.delete(this.api+"currency_rates/delete.php",{params:c})}getNearestRate(r,c,u,m){const P=(new _.LE).set("currency",r).set("date",c).set("store_id",u).set("year_id",m);return this.http.get(this.api+"currency_rates/nearestDate.php",{params:P})}convertFromSDG(r,c){return"SDG"!==c&&r?r/this.getExchangeRate(c):r}convertToSDG(r,c){return"SDG"!==c&&r?r*this.getExchangeRate(c):r}formatCurrency(r,c){return`${r.toLocaleString("en-US",{minimumFractionDigits:2})} ${{SDG:"\u062c.\u0633",USD:"$",AED:"\u062f.\u0625",SAR:"\u0631.\u0633"}[c]||c}`}getSupportedCurrencies(){return this.http.get(this.api+"currencies/read.php")}getActiveCurrencies(){const r=(new _.LE).set("active_only","true");return this.http.get(this.api+"currencies/read.php",{params:r})}addSupportedCurrency(r){return this.http.post(this.api+"currencies/create.php",r)}updateSupportedCurrency(r,c){return this.http.put(this.api+"currencies/update.php",Object.assign({id:r},c))}deleteSupportedCurrency(r){const c=(new _.LE).set("id",r);return this.http.delete(this.api+"currencies/delete.php",{params:c})}cacheKey(r,c,u){return`${r}_${c}_${u}`}cacheRates(r,c){Array.isArray(r)&&r.forEach(u=>{const m=this.cacheKey(u.target_currency,u.rate_date,c);this.ratesCache.set(m,u)})}getCachedRate(r,c,u){const m=this.cacheKey(r,c,u);return this.ratesCache.get(m)}clearCache(){this.ratesCache.clear()}initializeCurrency(){return(0,y.mG)(this,void 0,void 0,function*(){try{yield this.storage.create();const r=yield this.storage.get("selectedCurrency");r&&this.currentCurrency.next(r)}catch(r){console.error("Error initializing currency:",r)}})}getCurrentExchangeRates(){return this.exchangeRates.asObservable()}getSupportedCurrenciesObservable(){return this.supportedCurrencies.asObservable()}loadSupportedCurrencies(){return(0,y.mG)(this,void 0,void 0,function*(){try{const r=yield this.getSupportedCurrencies().toPromise();r&&r.data&&this.supportedCurrencies.next(r.data)}catch(r){console.error("Error loading supported currencies:",r)}})}formatAmount(r,c){const u=c||this.getCurrentCurrencyValue();let m=r;return"SDG"!==u&&(m=this.convertFromSDG(r,u)),this.formatCurrency(m,u)}convertToCurrentCurrency(r,c="SDG"){const u=this.getCurrentCurrencyValue();if(c===u)return r;if("SDG"===c)return this.convertFromSDG(r,u);if("SDG"===u)return this.convertToSDG(r,c);{const m=this.convertToSDG(r,c);return this.convertFromSDG(m,u)}}getCurrentCurrencySymbol(){const r=this.getCurrentCurrencyValue();return{SDG:"\u062c.\u0633",USD:"$",AED:"\u062f.\u0625",SAR:"\u0631.\u0633"}[r]||r}getCurrentCurrencySymbolForHeader(r){return`${r} (${this.getCurrentCurrencySymbol()})`}formatAmountWithoutSymbol(r,c){const u=c||this.getCurrentCurrencyValue();let m=r;return"SDG"!==u&&(m=this.convertFromSDG(r,u)),m.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}}return C.\u0275fac=function(r){return new(r||C)(f.LFG(_.eN),f.LFG(d.K),f.LFG(b.r))},C.\u0275prov=f.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()}}]);