"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1174,1212],{30752:(q,A,m)=>{m.d(A,{y:()=>H});var f=m(70655),e=m(29863),u=m(3671),h=m(23349),T=m(94030),y=m(91472),Z=m(90849),O=m(69808),w=m(34182);const C=["searchInput"],b=["inputWrapper"],s=["qtyId"],d=["popover"],a=["popInput"];function _(l,P){1&l&&(e.TgZ(0,"ion-col",9),e.TgZ(1,"ion-item",4),e._UZ(2,"ion-input",10),e._UZ(3,"ion-spinner"),e.qZA(),e.qZA()),2&l&&(e.xp6(2),e.Q6J("disabled",!0))}function r(l,P){1&l&&e._UZ(0,"ion-spinner",31)}function c(l,P){if(1&l&&(e.TgZ(0,"p",40),e._uU(1),e.qZA()),2&l){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.item_desc)}}function g(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"ion-item",35),e.NdJ("click",function(){const i=e.CHM(t).$implicit;return e.oxw(3).selectItem(i)})("mousedown",function(o){return o.preventDefault()})("mouseenter",function(){const i=e.CHM(t).index;return e.oxw(3).highlightedIndex=i}),e.TgZ(1,"ion-label"),e.TgZ(2,"h3"),e._uU(3),e.qZA(),e.YNc(4,c,2,1,"p",36),e.TgZ(5,"div",37),e.TgZ(6,"span",38),e._uU(7),e.qZA(),e.TgZ(8,"span",39),e._uU(9),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&l){const t=P.$implicit,n=P.index,o=e.oxw(3);e.ekj("highlighted",n===o.highlightedIndex),e.xp6(3),e.Oqu(t.item_name),e.xp6(1),e.Q6J("ngIf",t.item_desc),e.xp6(3),e.hij("\u0628\u064a\u0639: ",t.pay_price,""),e.xp6(2),e.hij("\u0634\u0631\u0627\u0621: ",t.perch_price,"")}}function M(l,P){if(1&l&&(e.TgZ(0,"div",32),e.TgZ(1,"ion-list",33),e.YNc(2,g,10,6,"ion-item",34),e.qZA(),e.qZA()),2&l){const t=e.oxw(2);e.Udp("top",t.dropdownPosition.top)("left",t.dropdownPosition.left)("width",t.dropdownPosition.width),e.xp6(2),e.Q6J("ngForOf",t.getFilteredItems())("ngForTrackBy",t.trackByItemId)}}function k(l,P){if(1&l&&(e.TgZ(0,"div",32),e.TgZ(1,"ion-list",33),e.TgZ(2,"ion-item",41),e.TgZ(3,"ion-label"),e.TgZ(4,"p"),e._uU(5,"\u0644\u0627 \u062a\u0648\u062c\u062f \u0646\u062a\u0627\u0626\u062c \u0645\u0637\u0627\u0628\u0642\u0629"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&l){const t=e.oxw(2);e.Udp("top",t.dropdownPosition.top)("left",t.dropdownPosition.left)("width",t.dropdownPosition.width)}}function I(l,P){1&l&&(e.TgZ(0,"div",42),e._UZ(1,"ion-spinner",43),e.TgZ(2,"ion-text",44),e._uU(3,"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."),e.qZA(),e.qZA())}function E(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"ion-button",57),e.NdJ("click",function(){return e.CHM(t),e.oxw(3).viewSelectedItemReport()}),e._UZ(1,"ion-icon",58),e.TgZ(2,"ion-text",53),e._uU(3," \u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0635\u0646\u0641 "),e.qZA(),e.qZA()}}function D(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"div",45),e.TgZ(1,"div",46),e.TgZ(2,"ion-text"),e._uU(3,"\u0627\u0644\u0645\u062e\u0632\u0648\u0646: "),e.qZA(),e.TgZ(4,"ion-text",47),e._uU(5),e.qZA(),e.TgZ(6,"ion-button",48),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).refreshQuantity()}),e._UZ(7,"ion-icon",49),e.qZA(),e.qZA(),e.TgZ(8,"div",50),e.TgZ(9,"ion-label"),e.TgZ(10,"strong"),e._uU(11," | "),e.qZA(),e.qZA(),e.YNc(12,E,4,0,"ion-button",51),e.qZA(),e.TgZ(13,"div",52),e.TgZ(14,"ion-label"),e.TgZ(15,"strong"),e._uU(16," | "),e.qZA(),e.qZA(),e.TgZ(17,"ion-text",53),e._uU(18,"\u0634\u0631\u0627\u0621"),e.qZA(),e.TgZ(19,"ion-text",53),e._uU(20),e.qZA(),e.TgZ(21,"ion-label"),e.TgZ(22,"strong"),e._uU(23," | "),e.qZA(),e.qZA(),e.TgZ(24,"ion-text",53),e._uU(25,"\u0628\u064a\u0639"),e.qZA(),e.TgZ(26,"ion-text",53),e._uU(27),e.qZA(),e.TgZ(28,"ion-label"),e.TgZ(29,"strong"),e._uU(30," | "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(31,"div",54),e.TgZ(32,"ion-button",55),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).viewSelectedItemDetails()}),e._UZ(33,"ion-icon",56),e._uU(34," \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0635\u0646\u0641 "),e.qZA(),e.qZA(),e.qZA()}if(2&l){const t=e.oxw(2);e.xp6(5),e.Oqu(t.availQty),e.xp6(7),e.Q6J("ngIf",t.selectedItem&&t.selectedItem.id),e.xp6(8),e.Oqu(t.selectedItem.perch_price),e.xp6(7),e.Oqu(t.selectedItem.pay_price)}}function F(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"div",59),e.TgZ(1,"ion-text",60),e._uU(2),e.qZA(),e.TgZ(3,"ion-button",48),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).refreshQuantity()}),e._UZ(4,"ion-icon",61),e.qZA(),e.qZA()}if(2&l){const t=e.oxw(2);e.xp6(2),e.Oqu(t.qtyErrorMsg)}}function Q(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"ion-col",9),e.TgZ(1,"ion-grid",11),e.TgZ(2,"ion-row"),e.TgZ(3,"ion-col",12),e.TgZ(4,"div",13),e.TgZ(5,"div",14),e.TgZ(6,"ion-button",15),e.NdJ("click",function(){return e.CHM(t),e.oxw().refresh()}),e._UZ(7,"ion-icon",16),e.qZA(),e.TgZ(8,"ion-button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().presentModal2()}),e._UZ(9,"ion-icon",18),e.qZA(),e.YNc(10,r,1,0,"ion-spinner",19),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"ion-row"),e.TgZ(12,"ion-item",20),e.TgZ(13,"div",21,22),e.TgZ(15,"ion-input",23,24),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().searchTerm=o})("ngModelChange",function(o){return e.CHM(t),e.oxw().onModelChange(o)})("ionInput",function(o){return e.CHM(t),e.oxw().onSearchInput(o)})("ionClear",function(o){return e.CHM(t),e.oxw().onInputClear(o)})("ionFocus",function(){return e.CHM(t),e.oxw().onInputFocus()})("ionBlur",function(){return e.CHM(t),e.oxw().onInputBlur()})("click",function(){return e.CHM(t),e.oxw().onInputFocus()})("keydown",function(o){return e.CHM(t),e.oxw().onKeyDown(o)}),e.qZA(),e.qZA(),e.qZA(),e.YNc(17,M,3,8,"div",25),e.YNc(18,k,6,6,"div",25),e.qZA(),e.qZA(),e.TgZ(19,"div",26),e.YNc(20,I,4,0,"div",27),e.TgZ(21,"div",28),e.YNc(22,D,35,4,"div",29),e.qZA(),e.YNc(23,F,5,1,"div",30),e.qZA(),e.qZA()}if(2&l){const t=e.oxw();e.xp6(6),e.Q6J("disabled",t.loadingItems),e.xp6(1),e.ekj("spin",t.loadingItems),e.xp6(3),e.Q6J("ngIf",t.loadingItems),e.xp6(5),e.Q6J("ngModel",t.searchTerm)("placeholder",t.placeholder)("disabled",t.loadingItems)("clearInput",!0),e.xp6(2),e.Q6J("ngIf",t.showDropdown&&t.getFilteredItems().length>0),e.xp6(1),e.Q6J("ngIf",t.showDropdown&&0===t.getFilteredItems().length&&t.searchTerm.length>0),e.xp6(2),e.Q6J("ngIf",t.loadingQty&&t.selectedItem.id),e.xp6(2),e.Q6J("ngIf",t.items.length>0&&t.selectedItem.id&&!t.qtyError&&!t.loadingQty),e.xp6(1),e.Q6J("ngIf",t.qtyError&&t.selectedItem.id&&!t.loadingQty)}}const U=function(l){return{"qty-warning":l}};function z(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"ion-col",2),e.TgZ(1,"ion-label",3),e.TgZ(2,"strong"),e._uU(3,"\u0627\u0644\u0643\u0645\u064a\u0629"),e.qZA(),e.qZA(),e.TgZ(4,"ion-item",62),e.TgZ(5,"ion-input",63,64),e.NdJ("keyup.enter",function(){return e.CHM(t),e.oxw().addToList()})("ionFocus",function(o){return e.CHM(t),e.oxw().isFocused(o)})("ngModelChange",function(o){return e.CHM(t),e.oxw().selectedItem.qty=o})("ionChange",function(o){return e.CHM(t),e.oxw().qtyChange(o)}),e.qZA(),e.qZA(),e.qZA()}if(2&l){const t=e.oxw();e.xp6(4),e.Q6J("ngClass",e.VKq(2,U,t.showQtyWarning)),e.xp6(1),e.Q6J("ngModel",t.selectedItem.qty)}}function j(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"ion-col",2),e.TgZ(1,"ion-label",3),e.TgZ(2,"strong"),e._uU(3,"\u0633\u0639\u0631 \u0627\u0644\u0648\u062d\u062f\u0629"),e.qZA(),e.qZA(),e.TgZ(4,"ion-item",4),e.TgZ(5,"ion-input",65),e.NdJ("keyup.enter",function(){return e.CHM(t),e.oxw().addToList()})("ngModelChange",function(o){return e.CHM(t),e.oxw().selectedItem.pay_price=o})("ionChange",function(o){return e.CHM(t),e.oxw().onPayPriceChange(o)}),e.qZA(),e.qZA(),e.qZA()}if(2&l){const t=e.oxw();e.xp6(5),e.Q6J("ngModel",t.selectedItem.pay_price)}}function N(l,P){if(1&l){const t=e.EpF();e.TgZ(0,"ion-col",2),e.TgZ(1,"ion-label",3),e.TgZ(2,"strong"),e._uU(3,"\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621"),e.qZA(),e.qZA(),e.TgZ(4,"ion-item",4),e.TgZ(5,"ion-input",65),e.NdJ("keyup.enter",function(){return e.CHM(t),e.oxw().addToList()})("ngModelChange",function(o){return e.CHM(t),e.oxw().selectedItem.perch_price=o})("ionChange",function(o){return e.CHM(t),e.oxw().onPerchPriceChange(o)}),e.qZA(),e.qZA(),e.qZA()}if(2&l){const t=e.oxw();e.xp6(5),e.Q6J("ngModel",t.selectedItem.perch_price)}}let H=(()=>{class l{constructor(t,n,o,i,p,x,v,S,B){this.alertController=t,this.router=n,this.api=o,this.storage=i,this.toast=p,this.modalController=x,this.loadingController=v,this.datePipe=S,this.cdr=B,this.showDropdown=!1,this.highlightedIndex=-1,this.loadingQty=!1,this.updateSuccess=!1,this.selectedIndex=-1,this.isOpen=!1,this.popoverSize={},this.items=[],this.loadingItems=!1,this.searchLang=0,this.payRef="",this.showQuantityInput=!0,this.showPriceInput=!0,this.showPerchPriceInput=!0,this.placeholder="\u0627\u062e\u062a\u0631 \u0627\u0644\u0635\u0646\u0641",this.dropdownPosition={top:"0px",left:"0px",width:"250px"},this.enablePriceUpdateConfirmation=!0,this.autoFocusAfterAdd=!0,this.focusQuantityAfterSelect=!0,this.originalPayPrice=0,this.originalPerchPrice=0,this.pricesChanged=!1,this.itemSelected=new e.vpe,this.itemAdded=new e.vpe,this.refreshItems=new e.vpe,this.parentPage="",this.payPriceInputElement=null,this.showQtyWarning=!1,this.searchTerm="",this.availQty=0,this.componentHasFocus=!1,this.payTotQty=0,this.perchTotQty=0,this.firstQty=0,this.qtyReal=0,this.qtyError=!1,this.qtyErrorMsg="",this.logHistoryArr=[],this.getItemLoader=!1,this.initializeSelectedItem()}ngOnInit(){this.getAppInfo()}ngOnChanges(){console.log("\u{1f4ca} ITEMS CHANGED - ngOnChanges triggered"),console.log("New items count:",this.items.length)}calculateDropdownPosition(){var t;const n=null===(t=this.inputWrapper)||void 0===t?void 0:t.nativeElement;if(n){const o=n.getBoundingClientRect();this.dropdownPosition={top:o.bottom+4+"px",left:o.left+"px",width:o.width+"px"},console.log("Dropdown position calculated:",this.dropdownPosition),console.log("Element used for positioning:",n.tagName,n.className)}else console.warn("Could not find element for dropdown positioning")}resetAllFieldsAndSelection(){console.log("\u{1f504} Starting resetAllFieldsAndSelection..."),this.initializeSelectedItem(),this.resetQuantityValues(),this.loadingQty=!1,this.updateSuccess=!1,this.pricesChanged=!1,this.originalPayPrice=0,this.originalPerchPrice=0,this.showQtyWarning=!1,this.searchTerm="",this.showDropdown=!1,this.highlightedIndex=-1,this.syncInputFields(),this.itemSelected.emit(null),console.log("\u2705 resetAllFieldsAndSelection completed")}syncInputFields(){return(0,f.mG)(this,void 0,void 0,function*(){if(console.log("\u{1f504} Syncing input fields - searchTerm:",this.searchTerm,"selectedItem.qty:",this.selectedItem.qty),this.searchInput)try{const t=yield this.searchInput.getInputElement();t&&(t.value=this.searchTerm,console.log("\u{1f504} Search input value set to:",this.searchTerm))}catch(t){console.log("\u{1f504} Error syncing search input:",t)}this.qtyId&&this.qtyId.nativeElement&&(this.qtyId.nativeElement.value=this.selectedItem.qty||"0",console.log("\u{1f504} Quantity input value set to:",this.qtyId.nativeElement.value)),this.cdr.detectChanges(),console.log("\u{1f504} Input field sync completed")})}applyFilters(){}getFilteredItems(){if(!this.items||0===this.items.length)return[];if(this.searchTerm&&""!==this.searchTerm.trim()){const t=this.searchTerm.toLowerCase();return this.items.filter(n=>n.item_name.toLowerCase().includes(t)||n.item_desc&&n.item_desc.toLowerCase().includes(t))}return this.items.slice(0,50)}getAppInfo(){this.storage.get("USER_INFO").then(t=>{t&&(this.user_info=t,console.log(this.user_info))})}viewItemReport(t){if(!t||!t.id)return void this.presentToast("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0635\u0646\u0641 \u0623\u0648\u0644\u0627\u064b","warning");let n={queryParams:{item:JSON.stringify(t)}};this.router.navigate(["folder/items-report"],n)}viewSelectedItemReport(){this.selectedItem&&this.selectedItem.id?this.viewItemReport(this.selectedItem):this.presentToast("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0635\u0646\u0641 \u0623\u0648\u0644\u0627\u064b","warning")}presentModal2(){return(0,f.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:u.X,componentProps:{item:this.selectedItem,status:"save"}});return t.onDidDismiss().then(n=>{null!==n&&(console.log(n),this.doAfterDismiss(n))}),yield t.present()})}presentModal(t,n){return(0,f.mG)(this,void 0,void 0,function*(){if(!t||"null"===t)return void this.presentToast("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0635\u0646\u0641 \u0623\u0648\u0644\u0627\u064b","warning");let o;if("edit"===n){let p=this.items.filter(x=>x.id==t);if(0===p.length)return void this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0635\u0646\u0641","danger");o={id:p[0].id,item_desc:p[0].item_desc,model:p[0].model,item_name:p[0].item_name,min_qty:p[0].min_qty,part_no:p[0].part_no,brand:p[0].brand,item_unit:p[0].item_unit,item_parcode:p[0].item_parcode,pay_price:p[0].pay_price,perch_price:p[0].perch_price,aliasEn:p[0].aliasEn}}const i=yield this.modalController.create({component:u.X,componentProps:{item:o,colSetting:{},filterArrayOrign:this.items,filterArray:this.items,status:n}});return i.onDidDismiss().then(p=>{null!==p&&(console.log("Modal dismissed with data:",p),this.doAfterDismiss(p))}),yield i.present()})}doAfterDismiss(t){"edit"===t.role?(console.log("Item edited:",t.data),this.update(t.data)):"save"===t.role?(console.log("Item saved:",t.data),this.saveItem(t.data)):"dele"==t.role&&(console.log("dele"),this.delete())}handleItemUpdate(t){console.log("Received updated data:",t);const n=t;console.log("Updated Item:",n),this.selectedItem.id===n.id&&(this.selectedItem=Object.assign(Object.assign({},this.selectedItem),{item_name:n.item_name,item_desc:n.item_desc,pay_price:n.pay_price,perch_price:n.perch_price}),this.originalPayPrice=n.pay_price,this.originalPerchPrice=n.perch_price);const o=this.items.findIndex(p=>p.id===n.id);-1!==o&&(this.items[o]=Object.assign(Object.assign({},this.items[o]),n));const i=this.items.findIndex(p=>p.id===n.id);-1!==i&&(this.items[i]=Object.assign(Object.assign({},this.items[i]),n)),this.presentToast("\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0635\u0646\u0641","success")}update(t){this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),this.api.updateItem(t[0]).subscribe(n=>{console.log(n),"Post Not Updated"!=n.message?(this.presentToast("\u062a\u0645 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 \u0628\u0646\u062c\u0627\u062d","success"),this.handleItemUpdate(t[0])):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},n=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}delete(){this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),this.api.deleteItems(this.selectedItem.id).subscribe(t=>{if("Post Not Deleted"!=t.message){this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0630\u0641 \u0628\u0646\u062c\u0627\u062d","success");const n=this.items.findIndex(i=>i.id===this.selectedItem.id);-1!==n&&this.items.splice(n,1);const o=this.items.findIndex(i=>i.id===this.selectedItem.id);-1!==o&&this.items.splice(o,1),this.initializeSelectedItem()}else this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveItem(t){console.log("mdata[0]",t[0]),this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),"imageUrl"in t[0]&&delete t[0].imageUrl,"tax"in t[0]&&delete t[0].tax,this.api.saveItem(t[0]).subscribe(n=>{console.log(n),"Post Not Created"!=n.message?(this.firstq={id:null,item_id:n.message,store_id:this.store_info.id,quantity:t[1].quantity,pay_price:t[0].pay_price,perch_price:t[0].perch_price,fq_year:this.year.id,item_name:t[0].item_name},this.saveFierstQty(t)):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},n=>{console.log(n),this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss()})}saveFierstQty(t){return(0,f.mG)(this,void 0,void 0,function*(){this.api.saveFirstQty(this.firstq).subscribe(n=>{console.log(n),this.selectedItem={id:this.firstq.item_id,dateCreated:"",pay_ref:this.payRef,item_desc:t[0].item_desc,item_name:t[0].item_name,item_unit:t[0].item_unit,parcode:t[0].parcode,pay_price:t[0].pay_price,perch_price:t[0].perch_price,qty:1,tot:t[0].perch_price,aliasEn:t[0].aliasEn,availQty:t[1].quantity},this.setFocusOnInput("qtyId"),this.getItemLoader=!0,this.items.push({aliasEn:t[0].aliasEn,availQty:t[1].quantity,brand:t[0].brand,firstQuantity:t[1].quantity,id:this.firstq.item_id,item_desc:t[0].item_desc,item_name:t[0].item_name,item_parcode:t[0].item_parcode,item_unit:t[0].item_unit,min_qty:t[0].min_qty,model:t[0].model,part_no:t[0].part_no,pay_price:t[0].pay_price,perch_price:t[0].perch_price,qtyReal:0,salesQuantity:0,totalCount:0,tswiaQuantity:0,quantity:t[1].quantity,tax:t[0].tax,imageUrl:t[0].imageUrl}),console.log("Updated items",this.items),this.storage.set("itemsLocal",this.items).then(o=>{this.getItemLoader=!1}),this.presentToast("\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0635\u0646\u0641 \u0628\u0646\u062c\u0627\u062d","success")},n=>{console.log(n),this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss()},()=>{this.loadingController.dismiss()})})}viewSelectedItemDetails(){this.selectedItem&&this.selectedItem.id?this.presentModal(this.selectedItem.id,"edit"):this.presentToast("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0635\u0646\u0641 \u0623\u0648\u0644\u0627\u064b","warning")}presentLoadingWithOptions(t){return(0,f.mG)(this,void 0,void 0,function*(){const n=yield this.loadingController.create({spinner:"bubbles",mode:"ios",duration:5e3,message:t,translucent:!0,backdropDismiss:!1});yield n.present();const{role:o}=yield n.onDidDismiss();console.log("Loading dismissed with role:",o)})}initializeSelectedItem(){this.selectedItem={id:void 0,dateCreated:"",pay_ref:this.payRef,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:""},this.resetQuantityValues()}resetQuantityValues(){this.availQty=0,this.payTotQty=0,this.perchTotQty=0,this.firstQty=0,this.qtyReal=0,this.qtyError=!1,this.qtyErrorMsg=""}searchItem(t){this.searchTerm=t.target.value||t.detail.value||"",this.highlightedIndex=-1}onInputFocus(){console.log("Input focused, items:",this.items.length),this.componentHasFocus=!0,this.highlightedIndex=-1,this.items.length>0?setTimeout(()=>{this.calculateDropdownPosition(),this.showDropdown=!0},10):console.warn("No items available to show in dropdown")}onInputBlur(){console.log("Input blur triggered"),this.componentHasFocus=!1,setTimeout(()=>{this.componentHasFocus||(console.log("Hiding dropdown after blur delay"),this.showDropdown=!1,this.highlightedIndex=-1)},150)}onDocumentClick(t){var n;const o=t.target;if(!o)return;const i=null===(n=this.inputWrapper)||void 0===n?void 0:n.nativeElement,p=document.querySelectorAll(".dropdown-container, .category-dropdown-container");let x=!1,v=!1;i&&(x=i.contains(o)||null!==o.closest(".item-selector-wrapper")),p.forEach(S=>{S.contains(o)&&(v=!0)}),!x&&!v&&this.showDropdown&&(console.log("Hiding item dropdown due to outside click"),this.showDropdown=!1,this.highlightedIndex=-1,this.componentHasFocus=!1)}onDocumentFocusIn(t){var n;const o=t.target;if(!o)return;const i=null===(n=this.inputWrapper)||void 0===n?void 0:n.nativeElement;if(i&&!i.contains(o)){const p=document.querySelectorAll(".dropdown-container, .category-dropdown-container");let x=!1;p.forEach(v=>{v.contains(o)&&(x=!0)}),x||(this.showDropdown&&(console.log("Hiding item dropdown due to focus change"),this.showDropdown=!1,this.highlightedIndex=-1),this.componentHasFocus=!1)}else i&&i.contains(o)&&(this.componentHasFocus=!0)}onSearchInput(t){this.searchTerm=t.target.value||t.detail.value||"",console.log("Search term changed to:",this.searchTerm),0===this.searchTerm.length&&(this.initializeSelectedItem(),this.itemSelected.emit(null)),this.highlightedIndex=-1,this.updateDropdownVisibility(),console.log("Showing dropdown with",this.getFilteredItems().length,"filtered items")}onInputClear(t){var n;console.log("\u{1f534} Clear button clicked - resetting component"),console.log("\u{1f534} Current focus state before clear:",{componentHasFocus:this.componentHasFocus,activeElement:null===(n=document.activeElement)||void 0===n?void 0:n.tagName}),this.searchTerm="",this.resetAllFieldsAndSelection(),this.showDropdown=!1,this.highlightedIndex=-1,setTimeout(()=>{this.searchInput&&this.searchInput.setFocus().then(()=>{this.componentHasFocus=!0,console.log("\u{1f534} Focus restored to search input after clear")}).catch(o=>{console.log("\u{1f534} Error restoring focus after clear:",o)})},50),console.log("\u{1f7e2} Clear button reset completed")}onModelChange(t){console.log("\u{1f504} Model changed to:",t),this.searchTerm=t||"",(!t||0===t.length)&&(this.initializeSelectedItem(),this.itemSelected.emit(null)),this.highlightedIndex=-1,this.updateDropdownVisibility()}updateDropdownVisibility(){if(0===this.items.length)return void(this.showDropdown=!1);const t=this.searchTerm&&this.searchTerm.length>0,n=this.getFilteredItems().length>0;t||this.componentHasFocus&&n?this.showDropdown||(this.calculateDropdownPosition(),this.showDropdown=!0):this.showDropdown=!1}resetAfterAddingItem(){console.log("\u{1f4e6} Item added - resetting fields and showing dropdown"),console.log("\u{1f4e6} Configuration - autoFocusAfterAdd:",this.autoFocusAfterAdd,"items available:",this.items.length),this.resetAllFieldsAndSelection(),this.selectedItem.pay_ref=this.payRef,this.items.length>0&&this.autoFocusAfterAdd?(console.log("\u{1f4e6} Calling focusSearchInputAndShowDropdown"),this.focusSearchInputAfterAdd()):console.log("\u{1f4e6} Skipping focus - conditions not met:",{hasItems:this.items.length>0,autoFocusEnabled:this.autoFocusAfterAdd})}focusSearchInputAndShowDropdown(){setTimeout(()=>{this.searchInput&&(this.qtyId&&this.qtyId.nativeElement&&this.qtyId.nativeElement.blur(),this.searchInput.setFocus().then(()=>{this.calculateDropdownPosition(),this.showDropdown=!0,console.log("\u{1f3af} Search input focused and dropdown shown")}).catch(t=>{console.log("\u{1f3af} Error focusing search input:",t)}))},150)}focusSearchInputAfterAdd(t=1,n=3){setTimeout(()=>{var i,p;console.log(`\u{1f504} Attempt ${t}: Focusing search input after item add`),console.log("\u{1f504} Current active element:",null===(i=document.activeElement)||void 0===i?void 0:i.tagName,null===(p=document.activeElement)||void 0===p?void 0:p.className),this.qtyId&&this.qtyId.nativeElement&&(this.qtyId.nativeElement.blur(),console.log("\u{1f504} Blurred quantity input")),this.componentHasFocus=!1;let x=!1;if(this.searchInput&&!x)try{return console.log("\u{1f504} Trying Ionic setFocus method"),void this.searchInput.setFocus().then(()=>{console.log("\u{1f3af} Ionic setFocus successful - showing dropdown"),this.componentHasFocus=!0,this.calculateDropdownPosition(),this.showDropdown=!0,x=!0}).catch(v=>{console.log("\u{1f504} Ionic setFocus failed, trying fallback methods:",v),this.tryFallbackFocusMethods(t,n)})}catch(v){console.log("\u{1f504} setFocus method threw error:",v)}this.tryFallbackFocusMethods(t,n)},1===t?400:300*t)}tryFallbackFocusMethods(t,n){return(0,f.mG)(this,void 0,void 0,function*(){console.log(`\u{1f504} Trying fallback focus methods, attempt ${t}`);const o=yield this.getSearchInputElement();if(o){console.log("\u{1f504} Found search input element using strategy:",o.strategy);try{o.element.focus(),this.componentHasFocus=!0,setTimeout(()=>{const i=document.activeElement,p=i===o.element;console.log("\u{1f504} Fallback focus verification:",{isFocused:p,activeElementTag:null==i?void 0:i.tagName,strategy:o.strategy}),p?(this.calculateDropdownPosition(),this.showDropdown=!0,console.log("\u{1f3af} Search input focused successfully with fallback method")):t<n&&(console.log(`\u{1f504} Fallback focus verification failed, retrying attempt ${t+1}/${n}`),this.focusSearchInputAfterAdd(t+1,n))},50)}catch(i){console.log("\u{1f504} Error with fallback focus:",i),t<n&&this.focusSearchInputAfterAdd(t+1,n)}}else console.log("\u{1f504} No search input element found with fallback methods"),t<n&&this.focusSearchInputAfterAdd(t+1,n)})}getSearchInputElement(){return(0,f.mG)(this,void 0,void 0,function*(){if(this.searchInput)try{const o=yield this.searchInput.getInputElement();if(o)return console.log("\u{1f50d} Strategy 1: Ionic getInputElement available"),{element:o,strategy:"Ionic.getInputElement"}}catch(o){console.log("\u{1f50d} Strategy 1 failed:",o)}if(this.searchInput)try{console.log("\u{1f50d} Strategy 2: Trying Ionic setFocus method"),this.searchInput.setFocus().then(()=>{console.log("\u{1f50d} Strategy 2: Ionic setFocus successful"),this.componentHasFocus=!0,this.calculateDropdownPosition(),this.showDropdown=!0}).catch(o=>{console.log("\u{1f50d} Strategy 2: Ionic setFocus failed:",o)})}catch(o){console.log("\u{1f50d} Strategy 2 failed:",o)}if(this.searchInput)try{const o=this.searchInput;if(o.getInputElement){const i=o.getInputElement();if(i instanceof Promise)return i.then(p=>{if(p)return console.log("\u{1f50d} Strategy 2b: Async getInputElement found element"),{element:p,strategy:"getInputElement-async"}}),null;if(i)return console.log("\u{1f50d} Strategy 2b: Sync getInputElement found element"),{element:i,strategy:"getInputElement"}}}catch(o){console.log("\u{1f50d} Strategy 2b failed:",o)}if(this.inputWrapper&&this.inputWrapper.nativeElement){const o=this.inputWrapper.nativeElement.querySelector("input");if(o)return console.log("\u{1f50d} Strategy 3: Found input via querySelector in wrapper"),{element:o,strategy:"querySelector-wrapper"}}const t=document.querySelector("ion-input.item-selector-input input");if(t)return console.log("\u{1f50d} Strategy 4: Found input via global querySelector"),{element:t,strategy:"querySelector-global"};const n=document.querySelector(".item-selector-wrapper input");return n?(console.log("\u{1f50d} Strategy 5: Found input via wrapper class selector"),{element:n,strategy:"querySelector-wrapper-class"}):(console.log("\u{1f50d} All strategies failed to find search input element"),null)})}focusQuantityInput(t=1,n=3){this.focusQuantityAfterSelect?this.showQuantityInput?setTimeout(()=>{if(this.qtyId)try{this.qtyId.setFocus().then(()=>{console.log("\u{1f3af} Quantity input focused successfully with setFocus()")}).catch(i=>{console.log("\u{1f3af} setFocus failed:",i),this.tryNativeFocus()})}catch(i){console.log("\u{1f3af} Error calling setFocus:",i),this.tryNativeFocus()}else console.log(`\u{1f3af} Attempt ${t}: Quantity input element not available:`,{qtyIdExists:!!this.qtyId,showQuantityInput:this.showQuantityInput}),t<n&&(console.log(`\u{1f3af} Retrying focus attempt ${t+1}/${n}`),this.focusQuantityInput(t+1,n))},1===t?100:200*t):console.log("\u{1f3af} Quantity input not shown - cannot focus"):console.log("\u{1f3af} Quantity focus disabled by configuration")}tryNativeFocus(){if(this.qtyId&&this.qtyId.nativeElement)try{console.log("\u{1f3af} Attempting native focus on element:",this.qtyId.nativeElement),this.qtyId.nativeElement.focus(),console.log("\u{1f3af} Quantity input focused via native element"),setTimeout(()=>{const t=document.activeElement;console.log("\u{1f3af} Active element after native focus:",null==t?void 0:t.tagName,null==t?void 0:t.className),console.log("\u{1f3af} Is quantity input focused?:",t===this.qtyId.nativeElement)},50)}catch(t){console.log("\u{1f3af} Native focus also failed:",t)}else console.log("\u{1f3af} tryNativeFocus: Element not available:",{qtyIdExists:!!this.qtyId,nativeElementExists:!(!this.qtyId||!this.qtyId.nativeElement)})}toggleDropdown(){console.log("Toggle dropdown clicked, items:",this.items.length),this.items.length>0?(this.showDropdown=!this.showDropdown,this.showDropdown&&(this.calculateDropdownPosition(),this.searchInput&&setTimeout(()=>{this.searchInput.setFocus()},100)),this.highlightedIndex=-1):console.warn("No items loaded yet")}presentDropdown(t){this.highlightedIndex=-1,this.clearSearch(),this.items.length>0&&(this.calculateDropdownPosition(),this.showDropdown=!0,setTimeout(()=>{this.searchInput&&this.searchInput.setFocus()},100))}clearSelection(){this.selectedItem={id:void 0,dateCreated:"",pay_ref:this.payRef,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:""},this.searchTerm="",this.showDropdown=!1,this.highlightedIndex=-1,this.itemSelected.emit(null)}onKeyDown(t){if(this.showDropdown&&0!==this.getFilteredItems().length)switch(t.key){case"ArrowDown":t.preventDefault(),this.highlightedIndex=Math.min(this.highlightedIndex+1,this.getFilteredItems().length-1),this.scrollHighlightedItemIntoView();break;case"ArrowUp":t.preventDefault(),this.highlightedIndex=Math.max(this.highlightedIndex-1,-1),this.scrollHighlightedItemIntoView();break;case"Enter":t.preventDefault(),this.highlightedIndex>=0&&this.highlightedIndex<this.getFilteredItems().length&&this.selectItem(this.getFilteredItems()[this.highlightedIndex]);break;case"Escape":t.preventDefault(),this.showDropdown=!1,this.highlightedIndex=-1;break;case"Tab":this.showDropdown=!1,this.highlightedIndex=-1}else"ArrowDown"===t.key&&this.getFilteredItems().length>0&&(t.preventDefault(),this.showDropdown=!0,this.highlightedIndex=0,this.calculateDropdownPosition())}scrollHighlightedItemIntoView(){this.highlightedIndex>=0&&setTimeout(()=>{const t=document.querySelector(".dropdown-container"),n=document.querySelector(".item-item.highlighted");if(t&&n){const o=t.getBoundingClientRect(),i=n.getBoundingClientRect();i.bottom>o.bottom?t.scrollTop+=i.bottom-o.bottom+10:i.top<o.top&&(t.scrollTop-=o.top-i.top+10)}},10)}selectItem(t){var n,o;if(this.selectedItem={id:t.id,dateCreated:t.dateCreated,pay_ref:this.payRef,item_desc:t.item_desc,item_name:t.item_name,item_unit:t.item_unit,parcode:t.parcode,pay_price:t.pay_price,perch_price:t.perch_price,qty:"",tot:t.pay_price,availQty:t.quantity,aliasEn:t.aliasEn},this.originalPayPrice=t.pay_price,this.originalPerchPrice=t.perch_price,this.pricesChanged=!1,this.searchTerm=t.item_name,this.showDropdown=!1,this.highlightedIndex=-1,this.componentHasFocus=!1,this.cdr.detectChanges(),this.searchInput&&setTimeout(()=>(0,f.mG)(this,void 0,void 0,function*(){try{const i=yield this.searchInput.getInputElement();if(i){i.value=t.item_name;const p=new Event("input",{bubbles:!0});i.dispatchEvent(p)}}catch(i){console.log("Error updating input value:",i)}}),10),this.itemSelected.emit(this.selectedItem),this.selectedItem.id){if(console.log("\u{1f50d} selectItem: Loading quantity data and focusing input for item:",this.selectedItem.item_name),console.log("\u{1f50d} selectItem: Configuration - focusQuantityAfterSelect:",this.focusQuantityAfterSelect,"showQuantityInput:",this.showQuantityInput),console.log("\u{1f50d} selectItem: Current active element:",null===(n=document.activeElement)||void 0===n?void 0:n.tagName,null===(o=document.activeElement)||void 0===o?void 0:o.className),this.searchInput)try{this.searchInput.getInputElement().then(i=>{i&&i.blur()})}catch(i){console.log("Error blurring search input:",i)}this.readItemByIdQty(),this.focusQuantityInput()}}reopenDropdown(){setTimeout(()=>{this.highlightedIndex=-1,this.clearSearch(),this.presentDropdown()},50)}clearSearch(){this.searchTerm="",this.highlightedIndex=-1}selectFromPop(t){this.selectedItem={id:t.id,dateCreated:t.dateCreated,pay_ref:this.payRef,item_desc:t.item_desc,item_name:t.item_name,item_unit:t.item_unit,parcode:t.parcode,pay_price:t.pay_price,perch_price:t.perch_price,qty:"",tot:t.pay_price,availQty:t.quantity,aliasEn:t.aliasEn},this.originalPayPrice=t.pay_price,this.originalPerchPrice=t.perch_price,this.pricesChanged=!1,this.searchTerm=t.item_name,this.itemSelected.emit(this.selectedItem),this.isOpen=!1,this.focusQuantityInput()}checkPriceChanges(){return this.pricesChanged=+this.selectedItem.pay_price!=+this.originalPayPrice||+this.selectedItem.perch_price!=+this.originalPerchPrice,this.pricesChanged}getChangedPricesInfo(){let t=[];return+this.selectedItem.pay_price!=+this.originalPayPrice&&t.push(`\u0633\u0639\u0631 \u0627\u0644\u0628\u064a\u0639: ${this.originalPayPrice} \u2190 ${this.selectedItem.pay_price}`),+this.selectedItem.perch_price!=+this.originalPerchPrice&&t.push(`\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621: ${this.originalPerchPrice} \u2190 ${this.selectedItem.perch_price}`),t.join("\n")}updatePayPrice(t){return new Promise((n,o)=>{this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),this.api.updatePayPrice(t).subscribe(i=>{"Post Not Updated"!=i.message?(this.presentToast("\u062a\u0645 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 \u0628\u0646\u062c\u0627\u062d","success"),this.originalPayPrice=+this.selectedItem.pay_price,this.originalPerchPrice=+this.selectedItem.perch_price,this.pricesChanged=!1,this.updateItemInArray(),this.updateSuccess=!0,n(!0)):(this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),n(!1))},i=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),n(!1)},()=>{this.loadingController.dismiss()})})}updateItemInArray(){const t=this.items.findIndex(o=>o.id===this.selectedItem.id);-1!==t&&(this.items[t].pay_price=this.selectedItem.pay_price,this.items[t].perch_price=this.selectedItem.perch_price);const n=this.items.findIndex(o=>o.id===this.selectedItem.id);-1!==n&&(this.items[n].pay_price=this.selectedItem.pay_price,this.items[n].perch_price=this.selectedItem.perch_price)}showPriceUpdateConfirmation(){return(0,f.mG)(this,void 0,void 0,function*(){return new Promise(t=>(0,f.mG)(this,void 0,void 0,function*(){const n=this.getChangedPricesInfo();yield(yield this.alertController.create({cssClass:"price-update-alert",header:"\u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0623\u0633\u0639\u0627\u0631",mode:"ios",message:`\n        <div style="text-align: right; direction: rtl;">\n          <p><strong>\u062a\u0645 \u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0623\u0633\u0639\u0627\u0631 \u0644\u0644\u0635\u0646\u0641:</strong></p>\n          <p><strong>${this.selectedItem.item_name}</strong></p>\n          <br>\n          <p><strong>\u0627\u0644\u062a\u063a\u064a\u064a\u0631\u0627\u062a:</strong></p>\n          <p style="color: #3880ff; white-space: pre-line;">${n}</p>\n          <br>\n          <p>\u0647\u0644 \u062a\u0631\u064a\u062f \u062d\u0641\u0638 \u0627\u0644\u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u062c\u062f\u064a\u062f\u0629\u061f</p>\n        </div>\n      `,buttons:[{text:"\u0627\u0644\u0645\u062a\u0627\u0628\u0639\u0629 \u0628\u062f\u0648\u0646 \u062d\u0641\u0638",cssClass:"tertiary",handler:()=>{t(!1)}},{text:"\u062d\u0641\u0638 \u0648\u0625\u0636\u0627\u0641\u0629",cssClass:"primary",handler:()=>{t(!0)}}]})).present()}))})}trackByItemId(t,n){return n.id||t}readItemByIdQty(){!this.selectedItem.id||!this.store_info||!this.year||(this.resetQuantityValues(),this.loadingQty=!0,this.api.readItemByIdQty(this.store_info.id,this.selectedItem.id,this.year.id).subscribe(t=>{console.log("readItemByIdQty",t);let n=t;"No record Found"!=n.message?(this.payTotQty=n.data[0].salesQuantity,this.availQty=n.data[0].availQty,this.qtyReal=n.data[0].qtyReal,this.perchTotQty=n.data[0].perchQuantity,this.firstQty=n.data[0].firstQuantity,console.log("readItemByIdQty",this.payTotQty,this.availQty,this.qtyReal,this.perchTotQty,this.firstQty),this.getQtyTotalItemId(),this.qtyError=!1):(this.qtyError=!0,this.qtyErrorMsg="\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0644\u0635\u0646\u0641"),this.loadingQty=!1},t=>{console.log(t),this.qtyError=!0,this.qtyErrorMsg="\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644",this.loadingQty=!1,this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649","danger")}))}getQtyTotalItemId(){console.log("perchTotQty",this.perchTotQty,this.payTotQty),+this.availQty-+this.qtyReal<0?this.perchTotQty=+this.perchTotQty+Math.abs(+this.availQty-+this.qtyReal):+this.availQty-+this.qtyReal>0&&(this.payTotQty=+this.availQty-+this.qtyReal+ +this.payTotQty),this.availQty=+this.firstQty+ +this.perchTotQty-+this.payTotQty,this.selectedItem.availQty=this.availQty,console.log("Final availQty:",this.availQty)}refreshQuantity(){this.selectedItem.id&&this.readItemByIdQty()}qtyChange(t){const o="purchase"===this.parentPage||"edit-perch"===this.parentPage;("sales"===this.parentPage||"edit-sales"===this.parentPage)&&(this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2),this.selectedItem.qty>+this.availQty&&this.showPayPriceWarning()),o&&(this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.perch_price).toFixed(2))}onPayPriceChange(t){("sales"===this.parentPage||"edit-sales"===this.parentPage)&&(this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2)),this.enablePriceUpdateConfirmation&&this.checkPriceChanges()}onPerchPriceChange(t){("purchase"===this.parentPage||"edit-perch"===this.parentPage)&&(this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.perch_price).toFixed(2)),this.enablePriceUpdateConfirmation&&this.checkPriceChanges()}addToList(){return(0,f.mG)(this,void 0,void 0,function*(){if(""==this.selectedItem.item_name||""==this.selectedItem.id||0==+this.selectedItem.qty)this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u0635\u0646\u0641 \u0648\u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0643\u0645\u064a\u0629","danger");else{if(this.enablePriceUpdateConfirmation&&this.checkPriceChanges()){const o=yield this.showPriceUpdateConfirmation();if(console.log("User chose not to save prices",o),o&&this.pricesChanged){let i={id:this.selectedItem.id,pay_price:this.selectedItem.pay_price,perch_price:this.selectedItem.perch_price};if(!(yield this.updatePayPrice(i))&&!(yield this.askContinueWithoutUpdate()))return}}this.itemAdded.emit(Object.assign({},this.selectedItem)),this.resetAfterAddingItem()}})}askContinueWithoutUpdate(){return(0,f.mG)(this,void 0,void 0,function*(){return new Promise(t=>(0,f.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"\u0641\u0634\u0644 \u0627\u0644\u062a\u062d\u062f\u064a\u062b",mode:"ios",message:"\u0641\u0634\u0644 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0623\u0633\u0639\u0627\u0631. \u0647\u0644 \u062a\u0631\u064a\u062f \u0627\u0644\u0645\u062a\u0627\u0628\u0639\u0629 \u0628\u0627\u0644\u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u062c\u062f\u064a\u062f\u0629 \u0628\u062f\u0648\u0646 \u062d\u0641\u0638\u0647\u0627\u061f",buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel",handler:()=>t(!1)},{text:"\u0645\u062a\u0627\u0628\u0639\u0629",handler:()=>t(!0)}]})).present()}))})}resetSelectedItem(){this.selectedItem={id:void 0,dateCreated:"",pay_ref:null,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:""}}showPayPriceWarning(){this.findPayPriceInput(),this.payPriceInputElement&&(this.payPriceInputElement.classList.add("qty-warning-border"),setTimeout(()=>{this.payPriceInputElement&&this.payPriceInputElement.classList.remove("qty-warning-border")},3e3)),this.showQtyWarning=!0,setTimeout(()=>{this.showQtyWarning=!1},3e3)}findPayPriceInput(){const t=['ion-input[ng-reflect-model*="pay_price"] input','ion-input[ng-reflect-model*="selectedItem.pay_price"] input',".pay-price-input input","ion-col:nth-child(3) ion-input input"];for(const n of t){const o=document.querySelector(n);if(o){this.payPriceInputElement=o;break}}this.payPriceInputElement||document.querySelectorAll("ion-input input").forEach(o=>{o.value==this.selectedItem.pay_price.toString()&&(this.payPriceInputElement=o)})}presentDropdownFromEvent(t){this.presentDropdown(t)}refresh(){this.refreshItems.emit()}refreshItemsList(){console.log("Manual refresh triggered by user"),this.showDropdown=!1,this.highlightedIndex=-1,this.selectedItem&&this.selectedItem.id&&this.clearSelection(),this.refreshItems.emit()}setFocusOnInput(t){console.log("\u{1f50d} setFocusOnInput called with:",t),"dstPop"===t||"searchInput"===t?this.focusSearchInputAndShowDropdown():"qtyId"===t&&this.focusQuantityInput()}isFocused(t){}presentToast(t,n){return(0,f.mG)(this,void 0,void 0,function*(){(yield this.toast.create({message:t,duration:2e3,color:n,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})}presentPopover(t){this.presentDropdown(t)}didDismiss(){this.showDropdown=!1,this.highlightedIndex=-1}scrollToSelected(){this.scrollHighlightedItemIntoView()}reopenPopover(){this.reopenDropdown()}}return l.\u0275fac=function(t){return new(t||l)(e.Y36(h.Br),e.Y36(T.F0),e.Y36(y.r),e.Y36(Z.K),e.Y36(h.yF),e.Y36(h.IN),e.Y36(h.HT),e.Y36(O.uU),e.Y36(e.sBO))},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-item-selector"]],viewQuery:function(t,n){if(1&t&&(e.Gf(C,5),e.Gf(b,5),e.Gf(s,5),e.Gf(d,5),e.Gf(a,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.searchInput=o.first),e.iGM(o=e.CRH())&&(n.inputWrapper=o.first),e.iGM(o=e.CRH())&&(n.qtyId=o.first),e.iGM(o=e.CRH())&&(n.popover=o.first),e.iGM(o=e.CRH())&&(n.popInput=o.first)}},hostBindings:function(t,n){1&t&&e.NdJ("click",function(i){return n.onDocumentClick(i)},!1,e.evT)("focusin",function(i){return n.onDocumentFocusIn(i)},!1,e.evT)},inputs:{items:"items",loadingItems:"loadingItems",searchLang:"searchLang",store_info:"store_info",year:"year",payRef:"payRef",showQuantityInput:"showQuantityInput",showPriceInput:"showPriceInput",showPerchPriceInput:"showPerchPriceInput",placeholder:"placeholder",enablePriceUpdateConfirmation:"enablePriceUpdateConfirmation",autoFocusAfterAdd:"autoFocusAfterAdd",focusQuantityAfterSelect:"focusQuantityAfterSelect",parentPage:"parentPage"},outputs:{itemSelected:"itemSelected",itemAdded:"itemAdded",refreshItems:"refreshItems"},features:[e.TTD],decls:17,vars:7,consts:[["size","4",4,"ngIf"],["size","2","class","ion-margin-top",4,"ngIf"],["size","2",1,"ion-margin-top"],[1,"ion-padding"],[1,"custInput"],[3,"readonly","ngModel","ngModelChange"],["size","2",1,"ion-margin-top","ion-padding-top"],["expand","block","routerDirection","root","color","primary",1,"ion-margin-top",3,"click"],[1,"ion-text-center"],["size","4"],[3,"disabled"],[1,"ion-no-margin","ion-no-padding"],["size","12",1,"ion-no-margin","ion-no-padding"],[1,"label-with-buttons-container"],[1,"action-buttons-left"],["fill","clear","size","small",1,"item-refresh-btn-left",3,"disabled","click"],["name","refresh","color","primary"],["size","small","fill","clear",1,"add-item-btn-left",3,"click"],["name","add-circle-outline","color","primary","slot","icon-only"],["name","dots","class","item-loading-spinner-left",4,"ngIf"],[1,"custInput","item-selector-wrapper"],[1,"input-container-wrapper"],["inputWrapper",""],[1,"item-selector-input",3,"ngModel","placeholder","disabled","clearInput","ngModelChange","ionInput","ionClear","ionFocus","ionBlur","click","keydown"],["searchInput",""],["class","dropdown-container",3,"top","left","width",4,"ngIf"],[1,"stock-info-container"],["class","stock-info-line",4,"ngIf"],[1,"stock-display-container"],["class","stock-info-single-line",4,"ngIf"],["class","stock-info-line error-line",4,"ngIf"],["name","dots",1,"item-loading-spinner-left"],[1,"dropdown-container"],[1,"item-dropdown"],["button","","class","item-item",3,"highlighted","click","mousedown","mouseenter",4,"ngFor","ngForOf","ngForTrackBy"],["button","",1,"item-item",3,"click","mousedown","mouseenter"],["class","item-desc",4,"ngIf"],[1,"item-prices-compact"],[1,"price-sale"],[1,"price-purchase"],[1,"item-desc"],[1,"no-results"],[1,"stock-info-line"],["name","crescent","color","primary"],[1,"loading-text"],[1,"stock-info-single-line"],[1,"stock-section"],["color","danger",1,"qty-value"],["fill","clear","size","small",1,"refresh-btn",3,"click"],["name","refresh-outline","color","primary"],[1,"report-section"],["fill","outline","fill","clear","size","small","color","primary",3,"click",4,"ngIf"],[1,"price-info-section"],["color","dark"],[1,"action-button-section"],["fill","clear","size","small","color","primary",2,"cursor","pointer","z-index","1000","position","relative",3,"click"],["name","information-circle-outline","slot","start"],["fill","outline","fill","clear","size","small","color","primary",3,"click"],["name","analytics-outline","slot","icon-only"],[1,"stock-info-line","error-line"],["color","danger",1,"error-text"],["name","refresh-outline","color","danger"],[1,"custInput",3,"ngClass"],["select-all","",3,"ngModel","keyup.enter","ionFocus","ngModelChange","ionChange"],["qtyId",""],[3,"ngModel","keyup.enter","ngModelChange","ionChange"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-grid"),e.TgZ(1,"ion-row"),e.YNc(2,_,4,1,"ion-col",0),e.YNc(3,Q,24,13,"ion-col",0),e.YNc(4,z,7,4,"ion-col",1),e.YNc(5,j,6,1,"ion-col",1),e.YNc(6,N,6,1,"ion-col",1),e.TgZ(7,"ion-col",2),e.TgZ(8,"ion-label",3),e.TgZ(9,"strong"),e._uU(10,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639"),e.qZA(),e.qZA(),e.TgZ(11,"ion-item",4),e.TgZ(12,"ion-input",5),e.NdJ("ngModelChange",function(i){return n.selectedItem.tot=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"ion-col",6),e.TgZ(14,"ion-button",7),e.NdJ("click",function(){return n.addToList()}),e.TgZ(15,"ion-label",8),e._uU(16,"+"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngIf",1==n.loadingItems),e.xp6(1),e.Q6J("ngIf",0==n.loadingItems),e.xp6(1),e.Q6J("ngIf",n.showQuantityInput),e.xp6(1),e.Q6J("ngIf",n.showPriceInput),e.xp6(1),e.Q6J("ngIf",n.showPerchPriceInput),e.xp6(6),e.Q6J("readonly",!0)("ngModel",n.selectedItem.tot))},directives:[h.jY,h.Nd,O.O5,h.wI,h.Q$,h.Ie,h.pK,h.j9,w.JJ,w.On,h.YG,h.PQ,h.gu,h.q_,O.sg,h.yW,O.mk],styles:[".custInput[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;margin:5px 0}.red[_ngcontent-%COMP%]{--background: #ffebee;--color: #c62828}.darko[_ngcontent-%COMP%]{--background: #f5f5f5;--color: #333}.cust_Toast[_ngcontent-%COMP%]{--border-radius: 10px;--box-shadow: 0 10px 15px -3px rgba(0, 0, 0, .1)}.label-with-buttons-container[_ngcontent-%COMP%]{direction:rtl;display:flex;justify-content:space-between;align-items:center;position:relative;text-align:right}.label-with-buttons-container[_ngcontent-%COMP%]   .action-buttons-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;order:1}.label-with-buttons-container[_ngcontent-%COMP%]   .item-label-center[_ngcontent-%COMP%]{flex:1;text-align:center;order:2}.item-refresh-btn-left[_ngcontent-%COMP%]{--color: var(--ion-color-success);--padding-start: 3px;--padding-end: 3px;height:32px;width:32px;margin:0}.item-refresh-btn-left[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;transition:transform .3s ease}.item-refresh-btn-left[_ngcontent-%COMP%]   ion-icon.spin[_ngcontent-%COMP%]{animation:spin 1s linear infinite}.item-refresh-btn-left[_ngcontent-%COMP%]:hover{--color: var(--ion-color-success-shade);--background: rgba(var(--ion-color-success-rgb), .1)}.item-refresh-btn-left[disabled][_ngcontent-%COMP%]{--color: var(--ion-color-medium);opacity:.5}.add-item-btn-left[_ngcontent-%COMP%]{--color: var(--ion-color-success);--padding-start: 3px;--padding-end: 3px;height:32px;width:32px;margin:0}.add-item-btn-left[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.add-item-btn-left[_ngcontent-%COMP%]:hover{--color: var(--ion-color-success-shade);--background: rgba(var(--ion-color-success-rgb), .1)}.item-loading-spinner-left[_ngcontent-%COMP%]{width:18px;height:18px;margin:0}.dropdown-filter-container[_ngcontent-%COMP%]{background:var(--ion-color-light-tint);border-bottom:1px solid var(--ion-color-light-shade)}.filter-toggle-header[_ngcontent-%COMP%]{padding:8px 12px;background:var(--ion-color-light)}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;margin:0;width:100%;justify-content:space-between;display:flex;align-items:center}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]   .button-inner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;margin-left:6px;transition:transform .2s ease;order:1}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;order:2;flex:1;text-align:right;margin-right:8px}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]   .results-count[_ngcontent-%COMP%]{font-size:12px;font-weight:400;order:3;margin-left:auto}.filter-buttons-wrapper[_ngcontent-%COMP%]{padding:12px;animation:slideDown .2s ease-out}.filter-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-start;direction:rtl}.filter-button[_ngcontent-%COMP%]{--border-radius: 20px;--padding-start: 12px;--padding-end: 12px;--padding-top: 6px;--padding-bottom: 6px;height:32px;font-size:13px;font-weight:500;margin:0;text-transform:none}.filter-button[fill=outline][_ngcontent-%COMP%]{--border-color: var(--ion-color-primary);--border-width: 1.5px;--color: var(--ion-color-primary);--background: transparent}.filter-button[fill=outline][_ngcontent-%COMP%]:hover{--background: rgba(var(--ion-color-primary-rgb), .1)}.filter-button[fill=outline][_ngcontent-%COMP%]:active{--background: rgba(var(--ion-color-primary-rgb), .2)}.filter-button[fill=solid][_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: white}.filter-button[fill=solid][_ngcontent-%COMP%]:hover, .filter-button[fill=solid][_ngcontent-%COMP%]:active{--background: var(--ion-color-primary-shade)}@keyframes slideDown{0%{opacity:0;transform:translateY(-10px);max-height:0}to{opacity:1;transform:translateY(0);max-height:200px}}.dropdown-container[_ngcontent-%COMP%]   .dropdown-filter-container[_ngcontent-%COMP%] + .item-dropdown[_ngcontent-%COMP%]{border-top:none}.item-selector-wrapper[_ngcontent-%COMP%]{width:100%;margin:5px 0}.item-selector-wrapper[_ngcontent-%COMP%]   .input-container-wrapper[_ngcontent-%COMP%]{position:relative;width:100%}.item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]{--background: transparent;--color: var(--ion-color-dark);--placeholder-color: var(--ion-color-medium);width:100%;direction:rtl;text-align:right;--padding-start: 12px;--padding-end: 45px}.item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]   .native-input[_ngcontent-%COMP%], .item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;max-width:calc(100% - 80px)!important;display:block!important}.item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[disabled][_ngcontent-%COMP%]{--background: var(--ion-color-light);--color: var(--ion-color-medium);cursor:not-allowed}.item-selector-wrapper[_ngcontent-%COMP%]   .item-refresh-btn[_ngcontent-%COMP%]{--color: var(--ion-color-success);--padding-start: 3px;--padding-end: 3px;height:30px;width:30px;margin:0;position:absolute;right:40px;top:50%;transform:translateY(-50%);z-index:1000}.item-selector-wrapper[_ngcontent-%COMP%]   .item-refresh-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;transition:transform .3s ease}.item-selector-wrapper[_ngcontent-%COMP%]   .item-refresh-btn[_ngcontent-%COMP%]   ion-icon.spin[_ngcontent-%COMP%]{animation:spin 1s linear infinite}.item-selector-wrapper[_ngcontent-%COMP%]   .item-refresh-btn[_ngcontent-%COMP%]:hover{--color: var(--ion-color-success-shade);--background: rgba(var(--ion-color-success-rgb), .1)}.item-selector-wrapper[_ngcontent-%COMP%]   .item-refresh-btn[disabled][_ngcontent-%COMP%]{--color: var(--ion-color-medium);opacity:.5}.item-selector-wrapper[_ngcontent-%COMP%]   .item-loading-spinner[_ngcontent-%COMP%]{position:absolute;right:45px;top:50%;transform:translateY(-50%);width:16px;height:16px;z-index:999}.dropdown-container[_ngcontent-%COMP%]{position:fixed;z-index:10000;background:white;border:1px solid var(--ion-color-light);border-radius:8px;box-shadow:0 8px 24px #0003;max-height:300px;overflow-y:auto;margin-top:4px;min-width:250px}.dropdown-container[_ngcontent-%COMP%]   .dropdown-header[_ngcontent-%COMP%]{background:var(--ion-color-light-tint);border-bottom:1px solid var(--ion-color-light-shade);padding:8px}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]{margin:0;padding:0;background:transparent}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]{--background: transparent;--border-color: transparent;--color: var(--ion-color-dark);--padding-start: 12px;--padding-end: 12px;--min-height: 60px;direction:rtl;text-align:right}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]:hover{--background: var(--ion-color-light)}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]:active{--background: rgba(var(--ion-color-primary-rgb), .1)}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item.highlighted[_ngcontent-%COMP%]{--background: rgba(var(--ion-color-primary-rgb), .1);border-left:3px solid var(--ion-color-primary)}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--ion-color-dark);margin:0 0 4px}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-desc[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);margin:2px 0}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-prices-compact[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:11px;margin-top:4px}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-prices-compact[_ngcontent-%COMP%]   .price-sale[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:600}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-prices-compact[_ngcontent-%COMP%]   .price-purchase[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-weight:600}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-prices-compact[_ngcontent-%COMP%]   .stock-qty[_ngcontent-%COMP%]{color:var(--ion-color-dark);font-weight:500}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .no-results[_ngcontent-%COMP%]{--color: var(--ion-color-medium);--padding-start: 12px;--padding-end: 12px;text-align:center;font-style:italic}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .no-results[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.label-with-buttons-container[_ngcontent-%COMP%]   .action-buttons-left[_ngcontent-%COMP%]{gap:2px}.label-with-buttons-container[_ngcontent-%COMP%]   .item-refresh-btn-left[_ngcontent-%COMP%], .label-with-buttons-container[_ngcontent-%COMP%]   .add-item-btn-left[_ngcontent-%COMP%]{height:28px;width:28px;--padding-start: 2px;--padding-end: 2px}.label-with-buttons-container[_ngcontent-%COMP%]   .item-refresh-btn-left[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .label-with-buttons-container[_ngcontent-%COMP%]   .add-item-btn-left[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.label-with-buttons-container[_ngcontent-%COMP%]   .item-loading-spinner-left[_ngcontent-%COMP%]{width:16px;height:16px}.label-with-buttons-container[_ngcontent-%COMP%]   .item-label-center[_ngcontent-%COMP%]{font-size:14px}.filter-buttons[_ngcontent-%COMP%]{gap:6px}.filter-button[_ngcontent-%COMP%]{--padding-start: 10px;--padding-end: 10px;--padding-top: 4px;--padding-bottom: 4px;height:28px;font-size:12px}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px;margin-left:4px}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:13px}.filter-toggle-header[_ngcontent-%COMP%]   .filter-toggle-btn[_ngcontent-%COMP%]   .results-count[_ngcontent-%COMP%]{font-size:11px}.item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]{font-size:13px;--padding-start: 10px;--padding-end: 40px}.item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]   .native-input[_ngcontent-%COMP%], .item-selector-wrapper[_ngcontent-%COMP%]   .item-selector-input[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:calc(100% - 45px)!important;font-size:13px!important}.item-selector-wrapper[_ngcontent-%COMP%]   .item-refresh-btn[_ngcontent-%COMP%]{right:36px;height:26px;width:26px;--padding-start: 2px;--padding-end: 2px}.item-selector-wrapper[_ngcontent-%COMP%]   .item-refresh-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.item-selector-wrapper[_ngcontent-%COMP%]   .item-loading-spinner[_ngcontent-%COMP%]{right:41px;width:14px;height:14px}.dropdown-container[_ngcontent-%COMP%]{max-height:200px}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]{--min-height: 50px}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:13px}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-desc[_ngcontent-%COMP%]{font-size:11px}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .item-prices-compact[_ngcontent-%COMP%]{font-size:10px}}.item-selector-wrapper[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]   .native-input[_ngcontent-%COMP%], .item-selector-wrapper[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;width:100%!important}.item-selector-wrapper[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]{overflow:hidden!important}.item-selector-wrapper[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important}.stock-info-container[_ngcontent-%COMP%]{display:flex;align-items:center}.stock-info-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%}.stock-info-line[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:14px;margin:0}.stock-info-line[_ngcontent-%COMP%]   .qty-value[_ngcontent-%COMP%]{font-weight:700;font-size:16px}.stock-info-line[_ngcontent-%COMP%]   .loading-text[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:12px}.stock-info-line[_ngcontent-%COMP%]   .error-text[_ngcontent-%COMP%]{font-size:12px}.stock-info-line[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]{--padding-start: 4px;--padding-end: 4px;margin:0;height:24px;width:24px}.stock-info-line[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.error-line[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-danger)!important}ion-spinner[_ngcontent-%COMP%]{width:16px;height:16px}.new-item-btn[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;margin-left:4px}.new-item-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.button-labels[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:4px;padding-right:8px}.button-labels[_ngcontent-%COMP%]   .btn-label[_ngcontent-%COMP%]{font-size:11px;color:var(--ion-color-primary);margin-left:32px}.category-selector-container[_ngcontent-%COMP%]{padding:8px 16px;background:var(--ion-color-light);border-bottom:1px solid var(--ion-color-light-shade);position:relative}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]   .category-input[_ngcontent-%COMP%]{--background: #ffffff;--border-radius: 6px;--padding-start: 12px;--padding-end: 35px;--color: var(--ion-color-dark);--placeholder-color: var(--ion-color-medium);border:1.5px solid var(--ion-color-light);border-radius:6px;height:36px;font-size:13px;direction:rtl;text-align:right}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]   .category-input[_ngcontent-%COMP%]:focus{--border-color: var(--ion-color-primary);box-shadow:0 0 0 2px rgba(var(--ion-color-primary-rgb),.2)}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]   .category-input.has-focus[_ngcontent-%COMP%]{--border-color: var(--ion-color-primary)}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]   .category-dropdown-icon[_ngcontent-%COMP%]{position:absolute;right:10px;color:var(--ion-color-medium);font-size:16px;transition:transform .2s ease;cursor:pointer;z-index:10}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]   .category-dropdown-icon.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.category-dropdown-container[_ngcontent-%COMP%]{position:fixed;z-index:10000;background:white;border:1px solid var(--ion-color-light);border-radius:6px;box-shadow:0 8px 24px #0003;max-height:160px;overflow-y:auto;margin-top:4px;min-width:200px}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]{margin:0;padding:0;background:transparent}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]{--background: transparent;--border-color: transparent;--color: var(--ion-color-dark);--padding-start: 12px;--padding-end: 12px;--min-height: 40px;direction:rtl;text-align:right}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]:hover{--background: var(--ion-color-light)}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]:active{--background: rgba(var(--ion-color-primary-rgb), .1)}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item.highlighted[_ngcontent-%COMP%]{--background: rgba(var(--ion-color-primary-rgb), .1);border-left:3px solid var(--ion-color-primary)}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--ion-color-dark);margin:0}@media (max-width: 480px){.category-selector-container[_ngcontent-%COMP%]{padding:6px 12px}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]   .category-input[_ngcontent-%COMP%]{height:32px;font-size:12px;--padding-start: 10px;--padding-end: 30px}.category-selector-container[_ngcontent-%COMP%]   .category-input-wrapper[_ngcontent-%COMP%]   .category-dropdown-icon[_ngcontent-%COMP%]{right:8px;font-size:14px}.category-dropdown-container[_ngcontent-%COMP%]{max-height:120px}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]{--min-height: 36px}.category-dropdown-container[_ngcontent-%COMP%]   .category-dropdown[_ngcontent-%COMP%]   .category-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:12px}}.popover-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:16px}.popover-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{--color: var(--ion-color-primary);transform:scale(1.2)}.popover-loading[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px;font-weight:500}.items-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;min-height:0}.item-content[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:6px!important}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:4px}.item-name[_ngcontent-%COMP%]{font-weight:700;color:var(--ion-color-dark);font-size:13px!important;line-height:1.2!important;flex:1;margin:0;letter-spacing:.2px}.stock-status[_ngcontent-%COMP%]{flex-shrink:0}.stock-status[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:12px;font-weight:600;padding:4px 8px;border-radius:12px;text-transform:uppercase;letter-spacing:.5px}.stock-status[_ngcontent-%COMP%]   ion-badge[color=danger][_ngcontent-%COMP%]{--background: var(--ion-color-danger);--color: white}.stock-status[_ngcontent-%COMP%]   ion-badge[color=warning][_ngcontent-%COMP%]{--background: var(--ion-color-warning);--color: var(--ion-color-warning-contrast)}.stock-status[_ngcontent-%COMP%]   ion-badge[color=success][_ngcontent-%COMP%]{--background: var(--ion-color-success);--color: white}.item-prices[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.price-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:20px}.price-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;flex:1;padding:6px 8px;border-radius:6px;background:rgba(0,0,0,.02);padding:2px 5px!important}.price-item.sale-price[_ngcontent-%COMP%]{background:rgba(var(--ion-color-success-rgb),.1)}.price-item.sale-price[_ngcontent-%COMP%]   .price-icon[_ngcontent-%COMP%]{color:var(--ion-color-success);font-size:14px}.price-item.sale-price[_ngcontent-%COMP%]   .price-value[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:700}.price-item.sale-price[_ngcontent-%COMP%]   .price-label[_ngcontent-%COMP%]{color:var(--ion-color-success-shade)}.price-item.purchase-price[_ngcontent-%COMP%]{background:rgba(var(--ion-color-danger-rgb),.1)}.price-item.purchase-price[_ngcontent-%COMP%]   .price-icon[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:14px}.price-item.purchase-price[_ngcontent-%COMP%]   .price-value[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-weight:300}.price-item.purchase-price[_ngcontent-%COMP%]   .price-label[_ngcontent-%COMP%]{color:var(--ion-color-danger-shade)}.price-icon[_ngcontent-%COMP%]{font-size:10px;min-width:10px}.price-label[_ngcontent-%COMP%]{font-size:8px;font-weight:700;min-width:25px;text-transform:uppercase;letter-spacing:.3px}.price-value[_ngcontent-%COMP%]{font-size:10px;font-weight:700;white-space:nowrap}.stock-info[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:6px;padding:2px 5px!important;background:rgba(var(--ion-color-medium-rgb),.1);border-radius:6px}.stock-label[_ngcontent-%COMP%]{font-size:11px;color:var(--ion-color-medium);font-weight:700;text-transform:uppercase;letter-spacing:.3px}.stock-value[_ngcontent-%COMP%]{font-size:13px;font-weight:700;color:var(--ion-color-dark)}.selection-icon[_ngcontent-%COMP%]{font-size:20px;animation:checkmark-bounce .3s ease}@keyframes checkmark-bounce{0%{transform:scale(0)}50%{transform:scale(1.2)}to{transform:scale(1)}}.no-results[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;gap:12px;text-align:center}.no-results[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;opacity:.5}.no-results[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:14px;line-height:1.5}.navigation-hint[_ngcontent-%COMP%]{padding:12px 16px;background:var(--ion-color-light-tint);border-top:1px solid var(--ion-color-light-shade);text-align:center}.navigation-hint[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:11px;color:var(--ion-color-medium);line-height:1.4}.popover-item[_ngcontent-%COMP%]{--inner-margin-top: 8px !important;--inner-padding-top: 8px !important;--inner-padding-bottom: 8px !important}.popover-item.keyboard-selected[_ngcontent-%COMP%]{--background: #514e4e !important;--color: white !important;transform:translate(-4px);box-shadow:4px 0 12px #4a4a4a4d;border-left:4px solid #333333}.popover-item.keyboard-selected[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{color:#fff!important;font-weight:700!important}.popover-item.keyboard-selected[_ngcontent-%COMP%]   .price-value[_ngcontent-%COMP%]{color:#fffffff2!important;font-weight:600!important}.popover-item.keyboard-selected[_ngcontent-%COMP%]   .price-label[_ngcontent-%COMP%], .popover-item.keyboard-selected[_ngcontent-%COMP%]   .stock-label[_ngcontent-%COMP%]{color:#ffffffd9!important}.popover-item.keyboard-selected[_ngcontent-%COMP%]   .price-icon[_ngcontent-%COMP%]{color:#ffffffe6!important}.popover-item.keyboard-selected[_ngcontent-%COMP%]   .stock-value[_ngcontent-%COMP%]{color:#fffffff2!important;font-weight:600!important}.popover-item.keyboard-selected[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{--background: rgba(255, 255, 255, .25) !important;--color: white !important;font-weight:600!important}.popover-item.keyboard-selected[_ngcontent-%COMP%]   .price-item.sale-price[_ngcontent-%COMP%], .popover-item.keyboard-selected[_ngcontent-%COMP%]   .price-item.purchase-price[_ngcontent-%COMP%], .popover-item.keyboard-selected[_ngcontent-%COMP%]   .stock-info[_ngcontent-%COMP%]{background:rgba(255,255,255,.15)!important}.popover-content[_ngcontent-%COMP%]{scroll-behavior:smooth}.popover-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.popover-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.popover-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--ion-color-medium-tint);border-radius:2px}.popover-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--ion-color-medium)}[_nghost-%COMP%]     .item-selector-popover{width:min(280px,75vw)!important;height:min(320px,45vh)!important;max-width:75vw!important;max-height:45vh!important}[_nghost-%COMP%]     .item-selector-popover .popover-content{max-height:calc(min(320px,45vh) - 45px)!important}[_nghost-%COMP%]     .item-selector-popover ion-toolbar{min-height:45px!important}@supports (padding: 0px){[_nghost-%COMP%]     .item-selector-popover .popover-content{padding-left:max(8px,env(safe-area-inset-left));padding-right:max(8px,env(safe-area-inset-right));padding-bottom:max(8px,env(safe-area-inset-bottom))}}[_nghost-%COMP%]     .item-selector-popover{position:absolute!important}[_nghost-%COMP%]     .item-selector-popover.popover-desktop{position:absolute!important;top:auto!important;left:auto!important;transform:none!important}@media (max-width: 768px){[_nghost-%COMP%]     .item-selector-popover{position:fixed!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important}}.stock-display-container[_ngcontent-%COMP%]{margin-top:5px}.stock-info-single-line[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;flex-wrap:nowrap;gap:4px;width:100%;overflow-x:auto}.stock-info-single-line[_ngcontent-%COMP%]   .stock-section[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .price-info-section[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .action-button-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;flex-shrink:0;white-space:nowrap}.stock-info-single-line[_ngcontent-%COMP%]   .stock-section[_ngcontent-%COMP%]   .qty-value[_ngcontent-%COMP%]{font-weight:700;font-size:16px}.stock-info-single-line[_ngcontent-%COMP%]   .stock-section[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]{--padding-start: 4px;--padding-end: 4px;margin:0;height:24px;width:24px}.stock-info-single-line[_ngcontent-%COMP%]   .stock-section[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.stock-info-single-line[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .action-button-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 6px;--padding-end: 6px;--padding-top: 4px;--padding-bottom: 4px;margin:0;min-height:28px}.stock-info-single-line[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .action-button-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.stock-info-single-line[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:14px;margin:0}.stock-info-single-line[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0;font-size:14px}@media (max-width: 768px){.stock-info-single-line[_ngcontent-%COMP%]{gap:2px;font-size:12px}.stock-info-single-line[_ngcontent-%COMP%]   .stock-section[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .price-info-section[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .action-button-section[_ngcontent-%COMP%]{gap:2px}.stock-info-single-line[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:12px}.stock-info-single-line[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:12px}.stock-info-single-line[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .action-button-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 4px;--padding-end: 4px;--padding-top: 2px;--padding-bottom: 2px;min-height:24px}.stock-info-single-line[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .stock-info-single-line[_ngcontent-%COMP%]   .action-button-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}}[_nghost-%COMP%]     .qty-warning-border{border:2px solid #ff4444!important;border-radius:4px!important;box-shadow:0 0 8px #ff44444d!important;animation:warningPulse .5s ease-in-out}@keyframes warningPulse{0%{box-shadow:0 0 8px #ff44444d}50%{box-shadow:0 0 16px #f449}to{box-shadow:0 0 8px #ff44444d}}[_nghost-%COMP%]     ion-item.qty-warning{--border-color: #ff4444 !important;--border-width: 2px !important;--border-style: solid !important}[_nghost-%COMP%]     ion-item.qty-warning ion-input{--border-color: #ff4444 !important;--border-width: 2px !important}.stock-info-line[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}.stock-info-line[_ngcontent-%COMP%]   .price-info-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;flex:1}.stock-info-line[_ngcontent-%COMP%]   .action-button-section[_ngcontent-%COMP%]{display:flex;align-items:center;flex-shrink:0}.stock-info-line[_ngcontent-%COMP%]   .details-button[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;--padding-top: 6px;--padding-bottom: 6px;margin:0;min-height:32px;cursor:pointer!important}.stock-info-line[_ngcontent-%COMP%]   .details-button[_ngcontent-%COMP%]:hover{--background: rgba(var(--ion-color-primary-rgb), .1);cursor:pointer!important}.stock-info-line[_ngcontent-%COMP%]   .details-button[_ngcontent-%COMP%]:active{--background: rgba(var(--ion-color-primary-rgb), .2)}.stock-info-line[_ngcontent-%COMP%]   .details-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;margin-right:4px}.stock-info-line[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{cursor:pointer!important}.stock-info-line[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:hover{cursor:pointer!important}.stock-info-line[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%], .stock-info-line[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{cursor:pointer!important;pointer-events:all!important}@media (prefers-color-scheme: dark){.search-input-wrapper[_ngcontent-%COMP%]   .item-input[_ngcontent-%COMP%]{--background: var(--ion-color-step-50);--color: var(--ion-color-dark-contrast);border-color:var(--ion-color-step-200)}.dropdown-container[_ngcontent-%COMP%]{background:var(--ion-color-step-50);border-color:var(--ion-color-step-200)}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]{--color: var(--ion-color-dark-contrast)}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]:hover{--background: var(--ion-color-step-100)}.dropdown-container[_ngcontent-%COMP%]   .item-dropdown[_ngcontent-%COMP%]   .item-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-dark-contrast)}}"]}),l})()},91872:(q,A,m)=>{m.d(A,{z:()=>d});var f=m(70655),e=m(29863),u=m(23349),h=m(34182),T=m(69808);const y=["adjustmentInput"];function Z(a,_){if(1&a){const r=e.EpF();e.TgZ(0,"ion-button",49),e.NdJ("click",function(){const M=e.CHM(r).$implicit;return e.oxw().setPresetValue(M)}),e._uU(1),e.qZA()}if(2&a){const r=_.$implicit,c=e.oxw();e.xp6(1),e.lnq(" ",r>0?"+":"","",r,"","percentage"===c.adjustmentType?"%":""," ")}}function O(a,_){if(1&a&&(e.TgZ(0,"div",67),e._UZ(1,"ion-icon",68),e.TgZ(2,"span"),e._uU(3),e.qZA(),e.qZA()),2&a){const r=e.oxw().$implicit,c=e.oxw(2);e.xp6(1),e.Q6J("name",c.getNewPrice(r)>c.getOriginalPrice(r)?"trending-up":"trending-down")("color",c.getNewPrice(r)>c.getOriginalPrice(r)?"success":"danger"),e.xp6(1),e.ekj("increased",c.getNewPrice(r)>c.getOriginalPrice(r))("decreased",c.getNewPrice(r)<c.getOriginalPrice(r)),e.xp6(1),e.hij(" ",c.getPriceDifference(r).toFixed(2)," ")}}function w(a,_){if(1&a&&(e.TgZ(0,"div",55),e.TgZ(1,"div",56),e.TgZ(2,"div",57),e._UZ(3,"ion-icon",58),e._uU(4),e.qZA(),e.TgZ(5,"div",59),e.TgZ(6,"span",60),e._uU(7),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",61),e.TgZ(9,"div",62),e.TgZ(10,"span",63),e._uU(11),e.qZA(),e.TgZ(12,"span",64),e._uU(13),e.qZA(),e.qZA(),e.TgZ(14,"div",62),e.TgZ(15,"span",63),e._uU(16),e.qZA(),e.TgZ(17,"span",65),e._uU(18),e.qZA(),e.qZA(),e.YNc(19,O,4,7,"div",66),e.qZA(),e.qZA()),2&a){const r=_.$implicit,c=_.index,g=e.oxw(2);e.ekj("even",c%2==0),e.xp6(4),e.hij(" ",r.item_name," "),e.xp6(3),e.hij("\u0627\u0644\u0643\u0645\u064a\u0629: ",r.qty,""),e.xp6(4),e.Oqu("sales"===g.mode?"\u0633\u0639\u0631 \u0627\u0644\u0628\u064a\u0639 \u0627\u0644\u062d\u0627\u0644\u064a:":"\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621 \u0627\u0644\u062d\u0627\u0644\u064a:"),e.xp6(2),e.Oqu(g.getOriginalPrice(r).toFixed(2)),e.xp6(3),e.Oqu("sales"===g.mode?"\u0633\u0639\u0631 \u0627\u0644\u0628\u064a\u0639 \u0627\u0644\u062c\u062f\u064a\u062f:":"\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621 \u0627\u0644\u062c\u062f\u064a\u062f:"),e.xp6(1),e.ekj("increased",g.getNewPrice(r)>g.getOriginalPrice(r))("decreased",g.getNewPrice(r)<g.getOriginalPrice(r)),e.xp6(1),e.hij(" ",g.getNewPrice(r).toFixed(2)," "),e.xp6(1),e.Q6J("ngIf",g.getNewPrice(r)!==g.getOriginalPrice(r))}}function C(a,_){if(1&a&&(e.TgZ(0,"div",50),e.TgZ(1,"ion-card",51),e.TgZ(2,"ion-card-header"),e.TgZ(3,"ion-card-title",11),e._UZ(4,"ion-icon",52),e._uU(5),e.qZA(),e.qZA(),e.TgZ(6,"ion-card-content"),e.TgZ(7,"div",53),e.YNc(8,w,20,13,"div",54),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&a){const r=e.oxw();e.xp6(5),e.hij(" \u0645\u0639\u0627\u064a\u0646\u0629 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 (",r.previewItems.length,") "),e.xp6(3),e.Q6J("ngForOf",r.previewItems)}}const b=function(a,_,r,c,g){return[2,5,7,10,15,a,_,r,c,g]},s=function(a,_,r){return[100,200,300,a,_,r]};let d=(()=>{class a{constructor(r){this.modalController=r,this.itemsList=[],this.mode="purchase",this.adjustmentValue=0,this.adjustmentType="percentage",this.previewItems=[]}get priceField(){return"sales"===this.mode?"pay_price":"perch_price"}get originalPriceField(){return"sales"===this.mode?"original_pay_price":"original_perch_price"}get newPriceField(){return"sales"===this.mode?"new_pay_price":"new_perch_price"}ngOnInit(){(!this.itemsList||!Array.isArray(this.itemsList))&&(this.itemsList=[]),this.previewItems=this.itemsList.map(r=>{const c=parseFloat(r[this.priceField])||0;return Object.assign(Object.assign({},r),{[this.originalPriceField]:c,[this.newPriceField]:c})}),this.updatePreview()}onAdjustmentTypeChange(){this.adjustmentValue=0,this.updatePreview()}updatePreview(){this.previewItems=this.previewItems.map(r=>{const c=parseFloat(r[this.originalPriceField])||0;let g=c;return g="percentage"===this.adjustmentType?c*(1+this.adjustmentValue/100):c+this.adjustmentValue,g=Math.max(0,g),Object.assign(Object.assign({},r),{[this.newPriceField]:Math.round(100*g)/100})})}applyChanges(){return(0,f.mG)(this,void 0,void 0,function*(){const r=this.previewItems.map(c=>Object.assign(Object.assign({},c),{[this.priceField]:c[this.newPriceField]}));yield this.modalController.dismiss(r)})}cancel(){return(0,f.mG)(this,void 0,void 0,function*(){yield this.modalController.dismiss()})}getTotalOriginal(){return this.previewItems.reduce((r,c)=>r+(parseFloat(c[this.originalPriceField])||0)*(parseFloat(c.qty)||0),0)}getTotalNew(){return this.previewItems.reduce((r,c)=>r+(parseFloat(c[this.newPriceField])||0)*(parseFloat(c.qty)||0),0)}getTotalDifference(){return this.getTotalNew()-this.getTotalOriginal()}setPresetValue(r){this.adjustmentValue=r,this.updatePreview()}getOriginalPrice(r){return parseFloat(r[this.originalPriceField])||0}getNewPrice(r){return parseFloat(r[this.newPriceField])||0}getPriceDifference(r){return this.getNewPrice(r)-this.getOriginalPrice(r)}ngOnDestroy(){}}return a.\u0275fac=function(r){return new(r||a)(e.Y36(u.IN))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-price-adjustment-dialog"]],viewQuery:function(r,c){if(1&r&&e.Gf(y,5),2&r){let g;e.iGM(g=e.CRH())&&(c.adjustmentInput=g.first)}},inputs:{itemsList:"itemsList",mode:"mode"},decls:79,vars:28,consts:[["dir","rtl",1,"modern-header"],["color","primary"],[1,"header-title"],["name","pricetag",1,"title-icon"],["slot","end"],["fill","clear",1,"close-btn",3,"click"],["name","close","slot","icon-only"],["dir","rtl",1,"modern-content"],[1,"adjustment-section"],[1,"control-card"],[1,"card-header"],[1,"section-title"],["name","settings","color","primary"],[1,"card-content"],[1,"adjustment-type-container"],[1,"modern-segment",3,"ngModel","ngModelChange","ionChange"],["value","percentage",1,"segment-btn"],["name","percent"],["value","amount",1,"segment-btn"],["name","cash"],[1,"value-input-container"],["fill","outline",1,"modern-input"],["position","stacked"],["type","number",1,"adjustment-input",3,"ngModel","placeholder","ngModelChange"],["adjustmentInput",""],["slot","end","color","primary",3,"name"],[1,"quick-actions"],["size","small","fill","outline","color","primary","class","quick-btn",3,"click",4,"ngFor","ngForOf"],[1,"summary-section"],[1,"summary-card"],["name","calculator","color","success"],[1,"summary-grid"],["size","4"],[1,"summary-item"],[1,"summary-label"],[1,"summary-value","primary"],[1,"summary-value"],[1,"summary-value","success"],["size","12"],[1,"difference-item"],[1,"difference-label"],[1,"difference-value"],["class","preview-section",4,"ngIf"],[1,"modern-footer"],[1,"action-buttons"],["expand","block","color","medium","fill","outline",1,"cancel-btn",3,"click"],["name","close-circle","slot","start"],["expand","block","color","primary",1,"apply-btn",3,"disabled","click"],["name","checkmark-circle","slot","start"],["size","small","fill","outline","color","primary",1,"quick-btn",3,"click"],[1,"preview-section"],[1,"items-card"],["name","eye","color","tertiary"],[1,"items-container"],["class","item-preview",3,"even",4,"ngFor","ngForOf"],[1,"item-preview"],[1,"item-info"],[1,"item-name"],["name","cube","color","primary"],[1,"item-details"],[1,"quantity"],[1,"price-comparison"],[1,"price-row"],[1,"price-label"],[1,"original-price"],[1,"new-price"],["class","price-difference",4,"ngIf"],[1,"price-difference"],[3,"name","color"]],template:function(r,c){1&r&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-title",2),e._UZ(3,"ion-icon",3),e._uU(4),e.qZA(),e.TgZ(5,"ion-buttons",4),e.TgZ(6,"ion-button",5),e.NdJ("click",function(){return c.cancel()}),e._UZ(7,"ion-icon",6),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"ion-content",7),e.TgZ(9,"div",8),e.TgZ(10,"div",9),e.TgZ(11,"div",10),e.TgZ(12,"h3",11),e._UZ(13,"ion-icon",12),e._uU(14," \u0625\u0639\u062f\u0627\u062f\u0627\u062a \u0627\u0644\u062a\u0639\u062f\u064a\u0644 "),e.qZA(),e.qZA(),e.TgZ(15,"div",13),e.TgZ(16,"div",14),e.TgZ(17,"ion-segment",15),e.NdJ("ngModelChange",function(M){return c.adjustmentType=M})("ionChange",function(){return c.onAdjustmentTypeChange()}),e.TgZ(18,"ion-segment-button",16),e._UZ(19,"ion-icon",17),e.TgZ(20,"ion-label"),e._uU(21,"\u0646\u0633\u0628\u0629 \u0645\u0626\u0648\u064a\u0629"),e.qZA(),e.qZA(),e.TgZ(22,"ion-segment-button",18),e._UZ(23,"ion-icon",19),e.TgZ(24,"ion-label"),e._uU(25,"\u0642\u064a\u0645\u0629 \u062b\u0627\u0628\u062a\u0629"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"div",20),e.TgZ(27,"ion-item",21),e.TgZ(28,"ion-label",22),e._uU(29),e.qZA(),e.TgZ(30,"ion-input",23,24),e.NdJ("ngModelChange",function(M){return c.adjustmentValue=M})("ngModelChange",function(){return c.updatePreview()}),e.qZA(),e._UZ(32,"ion-icon",25),e.qZA(),e.qZA(),e.TgZ(33,"div",26),e.YNc(34,Z,2,3,"ion-button",27),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(35,"div",28),e.TgZ(36,"ion-card",29),e.TgZ(37,"ion-card-header"),e.TgZ(38,"ion-card-title",11),e._UZ(39,"ion-icon",30),e._uU(40," \u0645\u0644\u062e\u0635 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 "),e.qZA(),e.qZA(),e.TgZ(41,"ion-card-content"),e.TgZ(42,"ion-grid",31),e.TgZ(43,"ion-row"),e.TgZ(44,"ion-col",32),e.TgZ(45,"div",33),e.TgZ(46,"div",34),e._uU(47,"\u0639\u062f\u062f \u0627\u0644\u0623\u0635\u0646\u0627\u0641"),e.qZA(),e.TgZ(48,"div",35),e._uU(49),e.qZA(),e.qZA(),e.qZA(),e.TgZ(50,"ion-col",32),e.TgZ(51,"div",33),e.TgZ(52,"div",34),e._uU(53,"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062d\u0627\u0644\u064a"),e.qZA(),e.TgZ(54,"div",36),e._uU(55),e.qZA(),e.qZA(),e.qZA(),e.TgZ(56,"ion-col",32),e.TgZ(57,"div",33),e.TgZ(58,"div",34),e._uU(59,"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062c\u062f\u064a\u062f"),e.qZA(),e.TgZ(60,"div",37),e._uU(61),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(62,"ion-row"),e.TgZ(63,"ion-col",38),e.TgZ(64,"div",39),e.TgZ(65,"div",40),e._uU(66,"\u0627\u0644\u0641\u0631\u0642"),e.qZA(),e.TgZ(67,"div",41),e._uU(68),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(69,C,9,2,"div",42),e.qZA(),e.TgZ(70,"ion-footer",43),e.TgZ(71,"ion-toolbar"),e.TgZ(72,"div",44),e.TgZ(73,"ion-button",45),e.NdJ("click",function(){return c.cancel()}),e._UZ(74,"ion-icon",46),e._uU(75," \u0625\u0644\u063a\u0627\u0621 "),e.qZA(),e.TgZ(76,"ion-button",47),e.NdJ("click",function(){return c.applyChanges()}),e._UZ(77,"ion-icon",48),e._uU(78," \u062a\u0637\u0628\u064a\u0642 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 "),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&r&&(e.xp6(4),e.hij(" ","sales"===c.mode?"\u062a\u0639\u062f\u064a\u0644 \u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0628\u064a\u0639":"\u062a\u0639\u062f\u064a\u0644 \u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0634\u0631\u0627\u0621"," "),e.xp6(13),e.Q6J("ngModel",c.adjustmentType),e.xp6(12),e.hij(" ","percentage"===c.adjustmentType?"\u0646\u0633\u0628\u0629 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 (%)":"\u0642\u064a\u0645\u0629 \u0627\u0644\u062a\u0639\u062f\u064a\u0644"," "),e.xp6(1),e.s9C("placeholder","percentage"===c.adjustmentType?"\u0645\u062b\u0627\u0644: 10 \u0644\u0644\u0632\u064a\u0627\u062f\u0629\u060c -10 \u0644\u0644\u0646\u0642\u0635\u0627\u0646":"\u0645\u062b\u0627\u0644: 5.50 \u0644\u0644\u0632\u064a\u0627\u062f\u0629\u060c -2.25 \u0644\u0644\u0646\u0642\u0635\u0627\u0646"),e.Q6J("ngModel",c.adjustmentValue),e.xp6(2),e.s9C("name","percentage"===c.adjustmentType?"percent":"cash"),e.xp6(2),e.Q6J("ngForOf","percentage"===c.adjustmentType?e.qbA(18,b,-2,-5,-7,-10,-15):e.kEZ(24,s,-100,-200,-300)),e.xp6(15),e.Oqu(c.previewItems.length),e.xp6(6),e.Oqu((c.getTotalOriginal()||0).toFixed(2)),e.xp6(6),e.Oqu((c.getTotalNew()||0).toFixed(2)),e.xp6(6),e.ekj("positive",c.getTotalDifference()>0)("negative",c.getTotalDifference()<0),e.xp6(1),e.AsE(" ",c.getTotalDifference()>0?"+":"","",(c.getTotalDifference()||0).toFixed(2)," "),e.xp6(1),e.Q6J("ngIf",c.previewItems&&c.previewItems.length>0),e.xp6(7),e.Q6J("disabled",0===c.adjustmentValue))},directives:[u.Gu,u.sr,u.wd,u.gu,u.Sm,u.YG,u.W2,u.cJ,u.QI,h.JJ,h.On,u.GO,u.Q$,u.Ie,u.pK,u.as,T.sg,u.PM,u.Zi,u.Dq,u.FN,u.jY,u.Nd,u.wI,T.O5,u.fr],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.modern-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(45deg, var(--ion-color-primary), var(--ion-color-primary-shade));--color: white;box-shadow:0 2px 10px #0000001a}.modern-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;display:flex;align-items:center;gap:8px}.modern-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   .title-icon[_ngcontent-%COMP%]{font-size:1.4rem}.modern-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{--color: white;--color-hover: rgba(255, 255, 255, .8)}.modern-content[_ngcontent-%COMP%]{--background: #f8f9fa;padding:16px 16px 80px;flex:1}.modern-content[_ngcontent-%COMP%]   .adjustment-section[_ngcontent-%COMP%], .modern-content[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%], .modern-content[_ngcontent-%COMP%]   .preview-section[_ngcontent-%COMP%]{margin-bottom:16px;display:block;visibility:visible}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]{background:white;border-radius:8px;border:1px solid #ddd;margin-bottom:16px;padding:16px}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{margin-bottom:16px}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{display:block}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:8px;margin-bottom:8px}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.3rem}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .adjustment-type-container[_ngcontent-%COMP%]{margin-bottom:20px;display:block}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .adjustment-type-container[_ngcontent-%COMP%]   .modern-segment[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:8px;padding:4px;display:flex;width:100%}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .adjustment-type-container[_ngcontent-%COMP%]   .modern-segment.segment[_ngcontent-%COMP%]{display:flex!important;flex-direction:row!important}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .adjustment-type-container[_ngcontent-%COMP%]   .modern-segment[_ngcontent-%COMP%]   .segment-btn[_ngcontent-%COMP%]{--background-checked: var(--ion-color-primary);--color-checked: white;--border-radius: 6px;font-weight:500;transition:all .3s ease;flex:1;display:flex;align-items:center;justify-content:center}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .adjustment-type-container[_ngcontent-%COMP%]   .modern-segment[_ngcontent-%COMP%]   .segment-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:4px}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .adjustment-type-container[_ngcontent-%COMP%]   .modern-segment[_ngcontent-%COMP%]   .segment-btn[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{white-space:nowrap}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .value-input-container[_ngcontent-%COMP%]{margin-bottom:20px;display:block}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .value-input-container[_ngcontent-%COMP%]   .modern-input[_ngcontent-%COMP%]{background:white;border:1px solid #dee2e6;border-radius:8px;margin-bottom:0}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .value-input-container[_ngcontent-%COMP%]   .modern-input[_ngcontent-%COMP%]   .adjustment-input[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .quick-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .quick-actions[_ngcontent-%COMP%]   .quick-btn[_ngcontent-%COMP%]{--border-radius: 20px;height:36px;min-width:60px;font-weight:500;transition:all .3s ease}.modern-content[_ngcontent-%COMP%]   .control-card[_ngcontent-%COMP%]   .quick-actions[_ngcontent-%COMP%]   .quick-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]{--background: white;box-shadow:0 4px 12px #0000000d;border-radius:12px;border:1px solid #e9ecef}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]{padding:0}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{text-align:center;padding:12px;border-radius:8px;background:#f8f9fa;margin:4px}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]{font-size:.9rem;color:#6c757d;margin-bottom:8px;font-weight:500}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#495057}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .summary-value.primary[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .summary-value.success[_ngcontent-%COMP%]{color:var(--ion-color-success)}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .difference-item[_ngcontent-%COMP%]{text-align:center;padding:16px;border-radius:8px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);margin:8px 4px 4px;border:2px solid transparent}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .difference-item[_ngcontent-%COMP%]   .difference-label[_ngcontent-%COMP%]{font-size:1rem;color:#495057;margin-bottom:8px;font-weight:600}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .difference-item[_ngcontent-%COMP%]   .difference-value[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:800}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .difference-item[_ngcontent-%COMP%]   .difference-value.positive[_ngcontent-%COMP%]{color:var(--ion-color-success)}.modern-content[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   .difference-item[_ngcontent-%COMP%]   .difference-value.negative[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]{--background: white;box-shadow:0 4px 12px #0000000d;border-radius:12px;border:1px solid #e9ecef}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;margin-bottom:10px}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-radius:8px;margin-bottom:8px;transition:all .3s ease;border:1px solid #e9ecef}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview.even[_ngcontent-%COMP%]{background:#f8f9fa}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0000001a}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]{flex:1}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#495057;margin-bottom:4px;display:flex;align-items:center;gap:8px}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{font-size:.9rem;color:#6c757d}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{background:var(--ion-color-primary-tint);color:var(--ion-color-primary);padding:2px 8px;border-radius:12px;font-weight:500}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]{text-align:right;min-width:140px}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .price-label[_ngcontent-%COMP%]{font-size:.9rem;color:#6c757d;margin-left:8px}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .original-price[_ngcontent-%COMP%]{font-weight:500;color:#495057;text-decoration:line-through;opacity:.7}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .new-price[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .new-price.increased[_ngcontent-%COMP%]{color:var(--ion-color-success)}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .new-price.decreased[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-difference[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:4px;font-size:.9rem;font-weight:600}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-difference[_ngcontent-%COMP%]   span.increased[_ngcontent-%COMP%]{color:var(--ion-color-success)}.modern-content[_ngcontent-%COMP%]   .items-card[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]   .price-difference[_ngcontent-%COMP%]   span.decreased[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.modern-footer[_ngcontent-%COMP%]{position:relative;margin-top:auto}.modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{background:white;padding:8px 16px;box-shadow:0 -2px 8px #0000001a}.modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;gap:12px}.modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .apply-btn[_ngcontent-%COMP%]{flex:1;height:48px;font-weight:600;--border-radius: 12px;transition:all .3s ease}.modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover, .modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .apply-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .apply-btn[_ngcontent-%COMP%]{--background: linear-gradient(45deg, var(--ion-color-primary), var(--ion-color-primary-shade));box-shadow:0 4px 12px rgba(var(--ion-color-primary-rgb),.3)}.modern-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .apply-btn[_ngcontent-%COMP%]:disabled{--background: #e9ecef;--color: #6c757d;box-shadow:none;transform:none}@media (max-width: 768px){.modern-content[_ngcontent-%COMP%]{padding:12px}.modern-content[_ngcontent-%COMP%]   .summary-grid[_ngcontent-%COMP%]   ion-col[size="4"][_ngcontent-%COMP%]{size:12;margin-bottom:8px}.modern-content[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.modern-content[_ngcontent-%COMP%]   .item-preview[_ngcontent-%COMP%]   .price-comparison[_ngcontent-%COMP%]{text-align:left;width:100%}.modern-content[_ngcontent-%COMP%]   .quick-actions[_ngcontent-%COMP%]   .quick-btn[_ngcontent-%COMP%]{min-width:50px;height:32px;font-size:.9rem}.modern-footer[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.modern-footer[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .modern-footer[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .apply-btn[_ngcontent-%COMP%]{height:44px}}@keyframes slideInUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.adjustment-section[_ngcontent-%COMP%], .summary-section[_ngcontent-%COMP%], .preview-section[_ngcontent-%COMP%]{animation:slideInUp .5s ease-out}.adjustment-section[_ngcontent-%COMP%]{animation-delay:.1s}.summary-section[_ngcontent-%COMP%]{animation-delay:.2s}.preview-section[_ngcontent-%COMP%]{animation-delay:.3s}ion-segment[_ngcontent-%COMP%]{display:flex!important;flex-direction:row!important;width:100%}ion-segment-button[_ngcontent-%COMP%]{flex:1!important;display:flex!important;align-items:center!important;justify-content:center!important}']}),a})()},12317:(q,A,m)=>{m.d(A,{d:()=>w});var f=m(42654),e=m(29863),u=m(6612),h=m(69808),T=m(23349);const y=["selectTrigger"];function Z(C,b){if(1&C&&(e.TgZ(0,"div",5),e.TgZ(1,"span",6),e._uU(2),e.qZA(),e.qZA()),2&C){const s=e.oxw();let d;e.xp6(2),e.Oqu(null==(d=s.getSelectedCurrency())?null:d.currency_symbol)}}function O(C,b){1&C&&(e.TgZ(0,"div",7),e._UZ(1,"ion-icon",8),e.TgZ(2,"span"),e._uU(3,"\u0627\u062e\u062a\u0631 \u0627\u0644\u0639\u0645\u0644\u0629"),e.qZA(),e.qZA())}let w=(()=>{class C{constructor(s,d,a){this.currencyService=s,this.renderer=d,this.el=a,this.selectedCurrency="SDG",this.supportedCurrencies=[],this.isDropdownOpen=!1,this.subscription=new f.w,this.dropdownElement=null}ngOnInit(){this.loadSupportedCurrencies(),this.subscription.add(this.currencyService.getCurrentCurrency().subscribe(s=>{this.selectedCurrency=s},s=>{console.error("Error subscribing to currency changes:",s),this.selectedCurrency="SDG"}))}ngOnDestroy(){this.subscription.unsubscribe(),this.destroyDropdown()}loadSupportedCurrencies(){this.subscription.add(this.currencyService.getActiveCurrencies().subscribe(s=>{s&&s.data&&(this.supportedCurrencies=s.data)},s=>{console.error("Error loading currencies:",s),this.supportedCurrencies=[{currency_code:"SDG",currency_name_ar:"\u062c\u0646\u064a\u0647 \u0633\u0648\u062f\u0627\u0646\u064a",currency_symbol:"\u062c.\u0633"},{currency_code:"USD",currency_name_ar:"\u062f\u0648\u0644\u0627\u0631 \u0623\u0645\u0631\u064a\u0643\u064a",currency_symbol:"$"},{currency_code:"AED",currency_name_ar:"\u062f\u0631\u0647\u0645 \u0625\u0645\u0627\u0631\u0627\u062a\u064a",currency_symbol:"\u062f.\u0625"},{currency_code:"SAR",currency_name_ar:"\u0631\u064a\u0627\u0644 \u0633\u0639\u0648\u062f\u064a",currency_symbol:"\u0631.\u0633"}]}))}toggleDropdown(s){s.stopPropagation(),this.isDropdownOpen?this.closeDropdown():this.openDropdown()}openDropdown(){!this.selectTrigger||(this.isDropdownOpen=!0,this.createBodyLevelDropdown())}closeDropdown(){this.isDropdownOpen=!1,this.destroyDropdown()}createBodyLevelDropdown(){this.dropdownElement&&this.destroyDropdown();const d=this.selectTrigger.nativeElement.getBoundingClientRect();this.dropdownElement=this.renderer.createElement("div"),this.renderer.addClass(this.dropdownElement,"currency-dropdown-portal"),this.renderer.setStyle(this.dropdownElement,"position","fixed"),this.renderer.setStyle(this.dropdownElement,"z-index","10000"),this.renderer.setStyle(this.dropdownElement,"background","#ffffff"),this.renderer.setStyle(this.dropdownElement,"border","1px solid #e5e7eb"),this.renderer.setStyle(this.dropdownElement,"border-radius","12px"),this.renderer.setStyle(this.dropdownElement,"box-shadow","0 15px 35px rgba(0, 0, 0, 0.15)"),this.renderer.setStyle(this.dropdownElement,"max-height","300px"),this.renderer.setStyle(this.dropdownElement,"overflow-y","auto"),this.renderer.setStyle(this.dropdownElement,"min-width","200px"),this.positionDropdown(d),this.createCurrencyOptions(),this.renderer.appendChild(document.body,this.dropdownElement),setTimeout(()=>{this.dropdownElement&&(this.renderer.setStyle(this.dropdownElement,"opacity","1"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(0)"))},10)}positionDropdown(s){if(!this.dropdownElement)return;const d=window.innerHeight,_=d-s.bottom,r=s.top;this.renderer.setStyle(this.dropdownElement,"opacity","0"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(-10px)"),this.renderer.setStyle(this.dropdownElement,"transition","all 0.3s ease"),this.renderer.setStyle(this.dropdownElement,"left",s.left+"px"),this.renderer.setStyle(this.dropdownElement,"width",Math.max(s.width,200)+"px"),_>=300||_>=r?this.renderer.setStyle(this.dropdownElement,"top",s.bottom+4+"px"):this.renderer.setStyle(this.dropdownElement,"bottom",d-s.top+4+"px")}createCurrencyOptions(){!this.dropdownElement||this.supportedCurrencies.forEach(s=>{const d=this.renderer.createElement("div");this.renderer.addClass(d,"currency-option-portal"),this.renderer.setStyle(d,"display","flex"),this.renderer.setStyle(d,"align-items","center"),this.renderer.setStyle(d,"gap","12px"),this.renderer.setStyle(d,"padding","12px 16px"),this.renderer.setStyle(d,"cursor","pointer"),this.renderer.setStyle(d,"transition","background-color 0.2s ease"),this.renderer.setStyle(d,"border-bottom","1px solid #f3f4f6"),s.currency_code===this.selectedCurrency&&this.renderer.setStyle(d,"background","linear-gradient(135deg, #eff6ff, #dbeafe)");const a=this.renderer.createElement("div");this.renderer.setStyle(a,"width","36px"),this.renderer.setStyle(a,"height","36px"),this.renderer.setStyle(a,"border-radius","50%"),this.renderer.setStyle(a,"display","flex"),this.renderer.setStyle(a,"align-items","center"),this.renderer.setStyle(a,"justify-content","center"),this.renderer.setStyle(a,"font-weight","bold"),this.renderer.setStyle(a,"font-size","13px"),s.currency_code===this.selectedCurrency?(this.renderer.setStyle(a,"background","var(--ion-color-primary, #3880ff)"),this.renderer.setStyle(a,"color","white")):(this.renderer.setStyle(a,"background","#f1f5f9"),this.renderer.setStyle(a,"color","#475569"));const _=this.renderer.createText(s.currency_symbol);this.renderer.appendChild(a,_);const r=this.renderer.createElement("div");this.renderer.setStyle(r,"flex","1"),this.renderer.setStyle(r,"text-align","right");const c=this.renderer.createElement("div");this.renderer.setStyle(c,"font-size","14px"),this.renderer.setStyle(c,"font-weight","500"),this.renderer.setStyle(c,"color",s.currency_code===this.selectedCurrency?"var(--ion-color-primary, #3880ff)":"#374151"),this.renderer.setStyle(c,"line-height","1.3");const g=this.renderer.createText(s.currency_name_ar);this.renderer.appendChild(c,g);const M=this.renderer.createElement("div");this.renderer.setStyle(M,"font-size","12px"),this.renderer.setStyle(M,"color","#6b7280"),this.renderer.setStyle(M,"font-weight","500");const k=this.renderer.createText(s.currency_code);if(this.renderer.appendChild(M,k),this.renderer.appendChild(r,c),this.renderer.appendChild(r,M),s.currency_code===this.selectedCurrency){const I=this.renderer.createElement("div");this.renderer.setStyle(I,"color","#10b981"),this.renderer.setStyle(I,"font-size","18px");const E=this.renderer.createText("\u2713");this.renderer.appendChild(I,E),this.renderer.appendChild(d,I)}this.renderer.listen(d,"mouseenter",()=>{s.currency_code!==this.selectedCurrency&&this.renderer.setStyle(d,"background","#f8fafc")}),this.renderer.listen(d,"mouseleave",()=>{s.currency_code!==this.selectedCurrency&&this.renderer.setStyle(d,"background","transparent")}),this.renderer.listen(d,"click",I=>{I.stopPropagation(),this.selectCurrency(s,I)}),this.renderer.appendChild(d,a),this.renderer.appendChild(d,r),this.renderer.appendChild(this.dropdownElement,d)})}destroyDropdown(){this.dropdownElement&&(this.renderer.removeChild(document.body,this.dropdownElement),this.dropdownElement=null)}selectCurrency(s,d){d.stopPropagation(),this.selectedCurrency=s.currency_code,this.currencyService.setCurrency(this.selectedCurrency),this.closeDropdown()}getSelectedCurrency(){return this.supportedCurrencies.find(s=>s.currency_code===this.selectedCurrency)}onDocumentClick(s){(!s.target||!s.target.closest(".custom-select-container"))&&this.closeDropdown()}onWindowResize(){if(this.isDropdownOpen&&this.selectTrigger){const s=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(s)}}onWindowScroll(){if(this.isDropdownOpen&&this.selectTrigger){const s=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(s)}}getCurrencyDisplayText(s){return`${s.currency_name_ar} (${s.currency_code})`}}return C.\u0275fac=function(s){return new(s||C)(e.Y36(u.i),e.Y36(e.Qsj),e.Y36(e.SBq))},C.\u0275cmp=e.Xpm({type:C,selectors:[["app-currency-switcher"]],viewQuery:function(s,d){if(1&s&&e.Gf(y,5),2&s){let a;e.iGM(a=e.CRH())&&(d.selectTrigger=a.first)}},hostBindings:function(s,d){1&s&&e.NdJ("click",function(_){return d.onDocumentClick(_)},!1,e.evT)("resize",function(){return d.onWindowResize()},!1,e.Jf7)("scroll",function(){return d.onWindowScroll()},!1,e.Jf7)},decls:6,vars:2,consts:[[1,"currency-switcher-wrapper"],[1,"currency-trigger",3,"click"],["selectTrigger",""],["class","selected-display",4,"ngIf","ngIfElse"],["placeholder",""],[1,"selected-display"],[1,"currency-symbol"],[1,"placeholder-display"],["name","cash-outline"]],template:function(s,d){if(1&s&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1,2),e.NdJ("click",function(_){return d.toggleDropdown(_)}),e.YNc(3,Z,3,1,"div",3),e.YNc(4,O,4,0,"ng-template",null,4,e.W1O),e.qZA(),e.qZA()),2&s){const a=e.MAs(5);e.xp6(3),e.Q6J("ngIf",d.getSelectedCurrency())("ngIfElse",a)}},directives:[h.O5,T.gu],styles:[".currency-switcher-wrapper[_ngcontent-%COMP%]{display:inline-block;min-width:auto}.currency-trigger[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:8px;background:transparent;border:2px solid transparent;border-radius:8px;cursor:pointer;transition:all .3s ease;min-height:auto;width:-moz-fit-content;width:fit-content}.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary);background:rgba(var(--ion-color-primary-rgb),.05);box-shadow:0 2px 8px rgba(var(--ion-color-primary-rgb),.15)}.currency-trigger[_ngcontent-%COMP%]:active{transform:scale(.98)}.selected-display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;background:linear-gradient(135deg,var(--ion-color-primary),var(--ion-color-primary-shade));color:#fff;border-radius:50%;font-size:14px;font-weight:700;box-shadow:0 2px 6px rgba(var(--ion-color-primary-rgb),.25);transition:all .3s ease}.placeholder-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#9ca3af;font-size:14px;padding:8px}.placeholder-display[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.currency-trigger[_ngcontent-%COMP%]:hover   .selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{transform:scale(1.05);box-shadow:0 4px 12px rgba(var(--ion-color-primary-rgb),.35)}@media (max-width: 768px){.currency-trigger[_ngcontent-%COMP%]{padding:6px}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{width:32px;height:32px;font-size:13px}.placeholder-display[_ngcontent-%COMP%]{padding:6px}}@media (prefers-color-scheme: dark){.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary-tint);background:rgba(var(--ion-color-primary-rgb),.1)}.placeholder-display[_ngcontent-%COMP%]{color:#9ca3af}}[dir=rtl][_ngcontent-%COMP%]   .placeholder-display[_ngcontent-%COMP%]{text-align:left}"]}),C})()},1212:(q,A,m)=>{m.d(A,{v:()=>u});var f=m(29863),e=m(6612);let u=(()=>{class h{constructor(y){this.currencyService=y}transform(y,Z="SDG",O=!0){if(!y&&0!==y||isNaN(y))return"0.00";try{const w=this.currencyService.getCurrentCurrencyValue();let C=y;return Z!==w&&(C=this.currencyService.convertToCurrentCurrency(y,Z)),O?this.currencyService.formatCurrency(C,w):C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch(w){console.error("Currency display pipe error:",w);const C=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(y);return O?C+" \u062c.\u0633":C}}}return h.\u0275fac=function(y){return new(y||h)(f.Y36(e.i,16))},h.\u0275pipe=f.Yjl({name:"currencyDisplay",type:h,pure:!1}),h})()}}]);