"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7158],{17158:(S,d,n)=>{n.d(d,{h:()=>y});var h=n(70655),f=n(591),u=n(40520),c=n(15439),g=n(29863),_=n(90849);let y=(()=>{class p{constructor(s,e){this.storage=s,this.http=e,this.api="https://erp.hosamdev.com/myapi/api/",this.LogHistoryArr=[],this.LogHistoryLocalTempArr=[],this.LogHistoryLocalArr=[],this.purchase=[],this.sales=[],this.sub_accountSales=[],this.sub_accountPurch=[],this.itemsLocal=[],this.tswia_details=[],this.items=[],this.itemsResources=new f.X([]),this.notiftemp=new f.X([]),this.currentItem=this.itemsResources.asObservable(),this.currentNotif=this.notiftemp.asObservable()}changeItems(s){this.itemsResources.next(s)}changeNotif(s){this.notiftemp.next(s)}setConfig(){return(0,h.mG)(this,void 0,void 0,function*(){yield this.storage.create(),this.storage.get("LogHistoryLocal").then(s=>{s?(this.LogHistoryLocalArr=s,this.LogHistoryLocalArr=this.LogHistoryLocalArr.sort((e,t)=>+e.id>+t.id?-1:1)):this.storage.set("LogHistoryLocal",this.LogHistoryLocalArr).then(e=>{})}),this.storage.get("year").then(s=>{s&&(this.year=s)}),this.storage.get("lastSync").then(s=>{s?this.lastSync=s:(this.lastSync="2023-01-01 00:00:00",this.storage.set("lastSync",this.lastSync).then(e=>{}))}),this.storage.get("USER_INFO").then(s=>{s&&(this.user_info=s)}),this.storage.get("STORE_INFO").then(s=>{s&&(this.store_info=s)}),this.storage.get("sub_accountPurch").then(s=>{s&&(this.sub_accountPurch=s)}),this.storage.get("sub_accountSales").then(s=>{s&&(this.sub_accountSales=s)}),this.syncFunctNew()})}getLogHistory(s,e,t){let a=new u.LE;return a=a.append("store_id",+s),a=a.append("yearId",+e),a=a.append("from",t),this.http.get(this.api+"logHistory/readByStore.php",{params:a})}stockItems(s,e){let t=new u.LE;return t=t.append("store_id",s),t=t.append("yearId",e),this.http.get(this.api+"items/readStock.php",{params:t})}getSalesAccounts(s,e){let a=new u.LE;return a=a.append("store_id",s),a=a.append("ac_id",1),a=a.append("yearId",e),this.http.get(this.api+"sub_accounts/readByStore.php",{params:a})}syncFunct(){setInterval(()=>{this.storage.get("lastSync").then(s=>{s&&(this.lastSync=s,this.getLogHistory(this.store_info.id,this.year.id,c(this.lastSync).locale("en").format("YYYY-MM-DD HH:mm:ss")).subscribe(e=>{"No record Found"!=e.message&&(this.LogHistoryArr=e.data,this.LogHistoryLocalTempArr=this.LogHistoryArr)},e=>{},()=>{}))})},6e4)}prepareStep1(){for(let s=0;s<this.LogHistoryLocalTempArr.length;s++){const e=this.LogHistoryLocalTempArr[s];if(1==e.typee.includes("customer")){let t=[];this.storage.get("sub_accountSales").then(a=>{if(a){if(t=a,"insert customer"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064a\u0644 \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).sub_name,t.push(JSON.parse(e.logToken));else if("update customer"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0634\u062e\u0635\u064a\u0629 \u0644\u0644\u0639\u0645\u064a\u0644  "+JSON.parse(e.logToken).sub_name;for(let o=0;o<t.length;o++)t[o].id==JSON.parse(e.logToken).id&&(t[o]=JSON.parse(e.logToken))}else"delete customer"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0639\u0645\u064a\u0644 "+JSON.parse(e.logToken).sub_name,t=t.filter(o=>o.id!=JSON.parse(e.logToken).id));e.logStatus=1,this.storage.set("sub_accountSales",t).then(o=>{})}})}if(1==e.typee.includes("supplier")){let t=[];this.storage.get("sub_accountPurch").then(a=>{if(a){if(t=a,"insert supplier"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0645\u0648\u0631\u062f \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).sub_name,t.push(JSON.parse(e.logToken));else if("update supplier"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0634\u062e\u0635\u064a\u0629 \u0644\u0644\u0645\u0648\u0631\u062f  "+JSON.parse(e.logToken).sub_name;for(let o=0;o<t.length;o++)t[o].id==JSON.parse(e.logToken).id&&(t[o]=JSON.parse(e.logToken))}else"delete supplier"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0645\u0648\u0631\u062f "+JSON.parse(e.logToken).sub_name,t=t.filter(o=>o.id!=JSON.parse(e.logToken).id));e.logStatus=1,this.storage.set("sub_accountPurch",t).then(o=>{})}})}if(1==e.typee.includes("firstq")){let t=[];this.storage.get("firstq").then(a=>{if(a){if(t=a,"insert firstq"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0643\u0645\u064a\u0629 \u0627\u0641\u062a\u062a\u0627\u062d\u064a\u0629 \u0644\u0635\u0646\u0641 \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).item_name,t.push(JSON.parse(e.logToken));else if("update firstq"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0641\u062a\u062a\u0627\u062d\u064a\u0629 \u0627\u0644\u0635\u0646\u0641  "+JSON.parse(e.logToken).item_name;for(let o=0;o<t.length;o++)t[o].item_id==JSON.parse(e.logToken).item_id&&(t[o]=JSON.parse(e.logToken))}else"delete firstq"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0641\u062a\u062a\u0627\u062d\u064a\u0629 \u0627\u0644\u0635\u0646\u0641 "+JSON.parse(e.logToken).item_name,t=t.filter(o=>o.item_id!=JSON.parse(e.logToken).item_id));e.logStatus=1,this.storage.set("firstq",t).then(o=>{})}})}if(1==e.typee.includes("item")){let t=[];this.storage.get("itemsLocal").then(a=>{if(a){if(t=a,"insert item"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0635\u0646\u0641 \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).item_name,t.push(JSON.parse(e.logToken));else if("update item"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0635\u0646\u0641  "+JSON.parse(e.logToken).item_name;for(let o=0;o<t.length;o++)t[o].id==JSON.parse(e.logToken).id&&(t[o]=JSON.parse(e.logToken))}else"delete item"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0635\u0646\u0641 "+JSON.parse(e.logToken).item_name,t=t.filter(o=>o.id!=JSON.parse(e.logToken).id));e.logStatus=1,this.storage.set("itemsLocal",t).then(o=>{})}})}if(1==e.typee.includes("sales")){let t=[];this.storage.get("sales").then(a=>{if(a){t=a;let r=JSON.parse(e.logToken)[0].payInvo.cust_id,i=this.sub_accountSales.filter(l=>+l.id==+r);if("insert sales"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a"+i[0].sub_name+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).tot_pr,t.push(JSON.parse(e.logToken));else if("update sales"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644  \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a  "+i[0].sub_name+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).tot_pr;for(let l=0;l<t.length;l++)t[l].pay_ref==JSON.parse(e.logToken).pay_ref&&(t[l]=JSON.parse(e.logToken))}else"delete sales"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" -\u0628\u062d\u0630\u0641 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a  "+i[0].sub_name+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).tot_pr,t=t.filter(l=>l.pay_ref!=JSON.parse(e.logToken).pay_ref));e.logStatus=1,this.storage.set("sales",t).then(l=>{})}})}if(1==e.typee.includes("purchase")){let t=[];this.storage.get("purchase").then(a=>{if(a){t=a;let o=this.sub_accountPurch.filter(r=>r.id==JSON.parse(e.logToken).cust_id);if("insert purchase"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0634\u062a\u0631\u064a\u0627\u062a"+o[0].sub_name+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).tot_pr,t.push(JSON.parse(e.logToken));else if("update purchase"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644  \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0634\u062a\u0631\u064a\u0627\u062a  "+o[0].sub_name+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).tot_pr;for(let r=0;r<t.length;r++)t[r].pay_ref==JSON.parse(e.logToken).pay_ref&&(t[r]=JSON.parse(e.logToken))}else"delete purchase"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" -\u0628\u062d\u0630\u0641 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0634\u062a\u0631\u064a\u0627\u062a  "+o[0].sub_name+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).tot_pr,t=t.filter(r=>r.pay_ref!=JSON.parse(e.logToken).pay_ref));e.logStatus=1,this.storage.set("purchase",t).then(r=>{})}})}if(1==e.typee.includes("journal")){let t=[];this.storage.get("journal").then(a=>{if(a){if(t=a,this.sub_accountPurch.filter(r=>r.id==JSON.parse(e.logToken).cust_id),"insert journal"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u0625\u0636\u0627\u0641\u0629  "+JSON.parse(e.logToken).j_type+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).j_date+" - \u0628\u0642\u064a\u0645\u0629: "+JSON.parse(e.logToken).j_pay+" "+JSON.parse(e.logToken).standard_details,t.push(JSON.parse(e.logToken));else if("update journal"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062a\u0639\u062f\u064a\u0644  "+JSON.parse(e.logToken).j_type+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).j_date+" - \u0628\u0642\u064a\u0645\u0629: "+JSON.parse(e.logToken).j_pay+" "+JSON.parse(e.logToken).standard_details;for(let r=0;r<t.length;r++)t[r].j_ref==JSON.parse(e.logToken).j_ref&&(t[r]=JSON.parse(e.logToken))}else"delete purchase"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062d\u0630\u0641  "+JSON.parse(e.logToken).j_type+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).j_date+" - \u0628\u0642\u064a\u0645\u0629: "+JSON.parse(e.logToken).j_pay+" "+JSON.parse(e.logToken).standard_details,t=t.filter(r=>r.j_ref!=JSON.parse(e.logToken).j_ref));e.logStatus=1,this.storage.set("journal",t).then(r=>{})}})}if(1==e.typee.includes("tswia")){let t=[];this.storage.get("tswia").then(a=>{if(a){if(t=a,"insert tswia"==e.typee)e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u0625\u0636\u0627\u0641\u0629 \u0633\u062c\u0644 \u062a\u0633\u0648\u064a\u0629 \u062c\u0631\u062f\u064a\u0629   \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062a\u0633\u0648\u064a\u0629 : "+JSON.parse(e.logToken).tot_pr,t.push(JSON.parse(e.logToken));else if("update tswia"==e.typee){e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062a\u0639\u062f\u064a\u0644 \u0633\u062c\u0644 \u062a\u0633\u0648\u064a\u0629 \u062c\u0631\u062f\u064a\u0629   \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062a\u0633\u0648\u064a\u0629 : "+JSON.parse(e.logToken).tot_pr;for(let o=0;o<t.length;o++)t[o].pay_ref==JSON.parse(e.logToken).pay_ref&&(t[o]=JSON.parse(e.logToken))}else"delete tswia"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062d\u0630\u0641   \u0628\u062a\u0639\u062f\u064a\u0644 \u0633\u062c\u0644 \u062a\u0633\u0648\u064a\u0629 \u062c\u0631\u062f\u064a\u0629   \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062a\u0633\u0648\u064a\u0629 : "+JSON.parse(e.logToken).tot_pr);e.logStatus=1,this.storage.set("tswia",t).then(o=>{})}})}}}syncFunctNew(){this.LogHistoryLocalTempArr=[],this.intrev=setInterval(()=>{this.storage.get("lastSync").then(s=>{s&&(this.lastSync=s,this.getLogHistory(this.store_info.id,this.year.id,c(this.lastSync).locale("en").format("YYYY-MM-DD HH:mm:ss")).subscribe(e=>{"No record Found"!=e.message&&(this.LogHistoryLocalTempArr=e.data);let a=[];for(let o=0;o<this.LogHistoryLocalTempArr.length;o++){const r=this.LogHistoryLocalTempArr[o];0==this.LogHistoryLocalArr.some(i=>+i.id==+r.id)&&a.push(r)}this.LogHistoryLocalTempArr=a,this.LogHistoryLocalTempArr.length>0&&this.prepareStep1New()},e=>{},()=>{}))})},6e4)}prepareStep1New(){for(let s=0;s<this.LogHistoryLocalTempArr.length;s++){const e=this.LogHistoryLocalTempArr[s];if(1==e.typee.includes("customer")&&("insert customer"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u064a\u0644 \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).sub_name:"update customer"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0634\u062e\u0635\u064a\u0629 \u0644\u0644\u0639\u0645\u064a\u0644  "+JSON.parse(e.logToken).sub_name:"delete customer"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0639\u0645\u064a\u0644 "+JSON.parse(e.logToken).sub_name)),1==e.typee.includes("supplier")&&("insert supplier"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0645\u0648\u0631\u062f \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).sub_name:"update supplier"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0634\u062e\u0635\u064a\u0629 \u0644\u0644\u0645\u0648\u0631\u062f  "+JSON.parse(e.logToken).sub_name:"delete supplier"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0645\u0648\u0631\u062f "+JSON.parse(e.logToken).sub_name)),1==e.typee.includes("firstq")&&("insert firstq"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0643\u0645\u064a\u0629 \u0627\u0641\u062a\u062a\u0627\u062d\u064a\u0629 \u0644\u0635\u0646\u0641 \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).item_name:"update firstq"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0641\u062a\u062a\u0627\u062d\u064a\u0629 \u0627\u0644\u0635\u0646\u0641  "+JSON.parse(e.logToken).item_name:"delete firstq"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0641\u062a\u062a\u0627\u062d\u064a\u0629 \u0627\u0644\u0635\u0646\u0641 "+JSON.parse(e.logToken).item_name)),1==e.typee.includes("item")&&("insert item"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0635\u0646\u0641 \u062c\u062f\u064a\u062f"+JSON.parse(e.logToken).item_name:"update item"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0635\u0646\u0641  "+JSON.parse(e.logToken).item_name:"delete item"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062d\u0630\u0641 \u0627\u0644\u0635\u0646\u0641 "+JSON.parse(e.logToken).item_name)),1==e.typee.includes("sales")){let r,a=JSON.parse(e.logToken).payInvo.cust_id,o=this.sub_accountSales.filter(i=>+i.id==+a);r=0==o.length?"undefined":o[0].sub_name,"insert sales"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a "+r+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr:"update sales"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644  \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a  "+r+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr:"delete sales"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" -\u0628\u062d\u0630\u0641 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a  "+r+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr)}if(1==e.typee.includes("purchase")){let r,a=JSON.parse(e.logToken).payInvo.cust_id,o=this.sub_accountPurch.filter(i=>+i.id==+a);r=0==o.length?"undefined":o[0].sub_name,"insert purchase"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u0625\u0636\u0627\u0641\u0629 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0634\u062a\u0631\u064a\u0627\u062a"+r+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr:"update purchase"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" - \u0628\u062a\u0639\u062f\u064a\u0644  \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0634\u062a\u0631\u064a\u0627\u062a  "+r+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr:"delete purchase"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" -\u0628\u062d\u0630\u0641 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0634\u062a\u0631\u064a\u0627\u062a  "+r+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr)}1==e.typee.includes("journal")&&("insert journal"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u0625\u0636\u0627\u0641\u0629  "+JSON.parse(e.logToken).j_type+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).j_date+" - \u0628\u0642\u064a\u0645\u0629: "+JSON.parse(e.logToken).j_pay+" "+JSON.parse(e.logToken).standard_details:"update journal"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062a\u0639\u062f\u064a\u0644  "+JSON.parse(e.logToken).j_type+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).j_date+" - \u0628\u0642\u064a\u0645\u0629: "+JSON.parse(e.logToken).j_pay+" "+JSON.parse(e.logToken).standard_details:"delete purchase"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062d\u0630\u0641  "+JSON.parse(e.logToken).j_type+" \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).j_date+" - \u0628\u0642\u064a\u0645\u0629: "+JSON.parse(e.logToken).j_pay+" "+JSON.parse(e.logToken).standard_details)),1==e.typee.includes("tswia")&&("insert tswia"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u0625\u0636\u0627\u0641\u0629 \u0633\u062c\u0644 \u062a\u0633\u0648\u064a\u0629 \u062c\u0631\u062f\u064a\u0629   \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062a\u0633\u0648\u064a\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr:"update tswia"==e.typee?e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062a\u0639\u062f\u064a\u0644 \u0633\u062c\u0644 \u062a\u0633\u0648\u064a\u0629 \u062c\u0631\u062f\u064a\u0629   \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062a\u0633\u0648\u064a\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr:"delete tswia"==e.typee&&(e.desc="\u0642\u0627\u0645 "+e.full_name+" \u0628\u062d\u0630\u0641   \u0628\u062a\u0639\u062f\u064a\u0644 \u0633\u062c\u0644 \u062a\u0633\u0648\u064a\u0629 \u062c\u0631\u062f\u064a\u0629   \u0628\u062a\u0627\u0631\u064a\u062e : "+JSON.parse(e.logToken).payInvo.pay_date+" - \u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062a\u0633\u0648\u064a\u0629 : "+JSON.parse(e.logToken).payInvo.tot_pr))}if(this.LogHistoryLocalTempArr.length>0){let s=0,e=0;for(let t=0;t<this.LogHistoryLocalTempArr.length;t++){const a=this.LogHistoryLocalTempArr[t];1==a.typee.includes("sales")||1==a.typee.includes("journal")?e+=1:0==a.typee.includes("sales")&&0==a.typee.includes("journal")&&(s+=1)}s>0?this.getStockItems("sync item"):e>0&&this.bothItemAndAccount("sync both")}}getStockItems(s){this.stockItems(this.store_info.id,this.year.id).subscribe(e=>{this.items=e.data,this.items.forEach(a=>{+a.tswiaQuantity>0?a.salesQuantity=+a.salesQuantity+ +a.tswiaQuantity:+a.tswiaQuantity<0&&(a.perchQuantity=+a.perchQuantity+Math.abs(+a.tswiaQuantity)),a.quantity=+a.perchQuantity+ +a.firstQuantity-+a.salesQuantity}),this.storage.set("itemsLocal",this.items).then(a=>{}),"sync item"==s&&this.afterSync()},e=>{},()=>{})}getSubBalance(){this.sub_accountSales.forEach(s=>{s.sub_balance=0;let e=+s.changeeTot+ +s.fromDebitTot,t=+s.purchChangeeTot+ +s.toCreditTot;e==t?s.sub_balance=0:e>t?s.sub_balance=(+e-+t).toFixed(2):t>e&&(s.sub_balance=(+t-+e).toFixed(2))})}getSalesAccount(s){this.getSalesAccounts(this.store_info.id,this.year.id).subscribe(e=>{this.sub_accountSales=e.data,this.getSubBalance(),"sync both"==s&&this.storage.set("sub_accountSales",this.sub_accountSales).then(a=>{})},e=>{})}bothItemAndAccount(s){return(0,h.mG)(this,void 0,void 0,function*(){yield this.getStockItems(),yield this.getSalesAccount(s),yield this.afterSync()})}afterSync(){this.storage.get("itemsLocal").then(e=>{this.items=e});for(let e=0;e<this.LogHistoryLocalTempArr.length;e++)this.LogHistoryLocalArr.push(this.LogHistoryLocalTempArr[e]);let s=new Date;this.lastSync=c(s).locale("en").format("YYYY-MM-DD HH:mm:ss"),this.storage.set("lastSync",this.lastSync).then(e=>{}),this.LogHistoryLocalArr=this.LogHistoryLocalArr.sort((e,t)=>+e.id>+t.id?-1:1),this.storage.set("LogHistoryLocal",this.LogHistoryLocalArr).then(e=>{this.changeNotif([this.LogHistoryLocalTempArr,this.items,this.sub_accountSales])})}}return p.\u0275fac=function(s){return new(s||p)(g.LFG(_.K),g.LFG(u.eN))},p.\u0275prov=g.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()}}]);