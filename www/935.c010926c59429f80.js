(self.webpackChunkapp=self.webpackChunkapp||[]).push([[935],{20935:(N,c,l)=>{"use strict";l.r(c),l.d(c,{PosSalesPageModule:()=>it});var r=l(69808),a=l(34182),s=l(23349),n=l(94030),o=l(70655),h=l(4441),g=l(79208),d=l(36387),p=l(5022),A=l(15439),t=l(29863),I=l(22313),y=l(17158),P=l(65465),B=l(90849),F=l(91472),w=l(3259);const q=["qrcElement"];let E=(()=>{class f{constructor(e){this.renderer=e,this.allowEmptyString=!1,this.colorDark="#000000ff",this.colorLight="#ffffffff",this.cssClass="qrcode",this.elementType="canvas",this.errorCorrectionLevel="M",this.margin=4,this.qrdata="",this.scale=4,this.width=10}ngOnChanges(){this.createQRCode()}isValidQrCodeText(e){return!1===this.allowEmptyString?!(void 0===e||""===e||"null"===e||null===e):void 0!==e}toDataURL(){return new Promise((e,i)=>{w.hz(this.qrdata,{color:{dark:this.colorDark,light:this.colorLight},errorCorrectionLevel:this.errorCorrectionLevel,margin:this.margin,scale:this.scale,version:this.version,width:this.width},(u,_)=>{u?i(u):e(_)})})}toCanvas(e){return new Promise((i,u)=>{w.rT(e,this.qrdata,{color:{dark:this.colorDark,light:this.colorLight},errorCorrectionLevel:this.errorCorrectionLevel,margin:this.margin,scale:this.scale,version:this.version,width:this.width},_=>{_?u(_):i("success")})})}toSVG(){return new Promise((e,i)=>{w.toString(this.qrdata,{color:{dark:this.colorDark,light:this.colorLight},errorCorrectionLevel:this.errorCorrectionLevel,margin:this.margin,scale:this.scale,type:"svg",version:this.version,width:this.width},(u,_)=>{u?i(u):e(_)})})}renderElement(e){for(const i of this.qrcElement.nativeElement.childNodes)this.renderer.removeChild(this.qrcElement.nativeElement,i);this.renderer.appendChild(this.qrcElement.nativeElement,e)}createQRCode(){this.version&&this.version>40?(console.warn("[angularx-qrcode] max value for `version` is 40"),this.version=40):this.version&&this.version<1?(console.warn("[angularx-qrcode]`min value for `version` is 1"),this.version=1):void 0!==this.version&&isNaN(this.version)&&(console.warn("[angularx-qrcode] version should be a number, defaulting to auto."),this.version=void 0);try{if(!this.isValidQrCodeText(this.qrdata))throw new Error('[angularx-qrcode] Field `qrdata` is empty, set `allowEmptyString="true"` to overwrite this behaviour.');let e;switch(this.isValidQrCodeText(this.qrdata)&&""===this.qrdata&&(this.qrdata=" "),this.elementType){case"canvas":e=this.renderer.createElement("canvas"),this.toCanvas(e).then(()=>{this.renderElement(e)}).catch(i=>{console.error("[angularx-qrcode] canvas error:",i)});break;case"svg":e=this.renderer.createElement("div"),this.toSVG().then(i=>{this.renderer.setProperty(e,"innerHTML",i);const u=e.firstChild;this.renderer.setAttribute(u,"height",`${this.width}`),this.renderer.setAttribute(u,"width",`${this.width}`),this.renderElement(u)}).catch(i=>{console.error("[angularx-qrcode] svg error:",i)});break;default:e=this.renderer.createElement("img"),this.toDataURL().then(i=>{e.setAttribute("src",i),this.renderElement(e)}).catch(i=>{console.error("[angularx-qrcode] img/url error:",i)})}}catch(e){console.error("[angularx-qrcode] Error generating QR Code:",e.message)}}}return f.\u0275fac=function(e){return new(e||f)(t.Y36(t.Qsj))},f.\u0275cmp=t.Xpm({type:f,selectors:[["qrcode"]],viewQuery:function(e,i){if(1&e&&t.Gf(q,7),2&e){let u;t.iGM(u=t.CRH())&&(i.qrcElement=u.first)}},inputs:{allowEmptyString:"allowEmptyString",colorDark:"colorDark",colorLight:"colorLight",cssClass:"cssClass",elementType:"elementType",errorCorrectionLevel:"errorCorrectionLevel",margin:"margin",qrdata:"qrdata",scale:"scale",version:"version",width:"width"},features:[t.TTD],decls:2,vars:2,consts:[["qrcElement",""]],template:function(e,i){1&e&&t._UZ(0,"div",null,0),2&e&&t.Tol(i.cssClass)},encapsulation:2,changeDetection:0}),f})(),S=(()=>{class f{}return f.\u0275fac=function(e){return new(e||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({providers:[]}),f})();const b=["dst"],L=["dstPop"],C=["qtyId"],m=["popInput"],M=["popover"],T=["popoverNotif"];function v(f,R){if(1&f&&(t.TgZ(0,"ion-text"),t._uU(1),t.qZA()),2&f){const e=t.oxw();t.xp6(1),t.Oqu(e.notifArr.length)}}function Z(f,R){1&f&&(t.TgZ(0,"ion-text",9),t._uU(1,"\u0645\u062a\u0635\u0644"),t.qZA())}function x(f,R){1&f&&(t.TgZ(0,"ion-text",9),t._uU(1,"\u063a\u064a\u0631 \u0645\u062a\u0635\u0644"),t.qZA())}function O(f,R){if(1&f&&(t.TgZ(0,"ion-segment-button",25),t._uU(1),t.qZA()),2&f){const e=R.$implicit;t.Q6J("value",e.brand),t.xp6(1),t.hij(" ",e.brand," ")}}function J(f,R){if(1&f){const e=t.EpF();t.TgZ(0,"ion-col",13),t.TgZ(1,"ion-card",27),t.NdJ("click",function(){const _=t.CHM(e).$implicit;return t.oxw(4).addTolistClick(_)}),t._UZ(2,"img",28),t.qZA(),t.TgZ(3,"div",29),t.TgZ(4,"p",30),t._uU(5),t.qZA(),t.qZA(),t.qZA()}if(2&f){const e=R.$implicit;t.xp6(2),t.Q6J("src",e.imgUrl,t.LSH),t.xp6(3),t.hij(" ",e.item_name," ")}}function at(f,R){if(1&f&&(t.TgZ(0,"ion-row"),t.YNc(1,J,6,2,"ion-col",26),t.qZA()),2&f){const e=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",e.filteredItems)}}function X(f,R){if(1&f){const e=t.EpF();t.TgZ(0,"ion-row"),t.TgZ(1,"ion-card"),t.TgZ(2,"ion-segment",22),t.NdJ("ionChange",function(u){return t.CHM(e),t.oxw(2).segmentChanged(u)}),t.YNc(3,O,2,2,"ion-segment-button",23),t.qZA(),t.TgZ(4,"ion-grid",24),t.YNc(5,at,2,1,"ion-row",4),t.qZA(),t.qZA(),t.qZA()}if(2&f){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",e.brandList),t.xp6(2),t.Q6J("ngIf",e.filteredItems.length>0)}}function ct(f,R){if(1&f){const e=t.EpF();t.TgZ(0,"tr",31),t.NdJ("dblclick",function(){const _=t.CHM(e).index;return t.oxw(2).qtyClick(_)}),t.TgZ(1,"td"),t.TgZ(2,"ion-button",32),t.NdJ("click",function(){const _=t.CHM(e).index;return t.oxw(2).deleteItem(_)}),t._UZ(3,"ion-icon",33),t.qZA(),t.qZA(),t.TgZ(4,"td",34),t._uU(5),t.qZA(),t.TgZ(6,"td"),t.TgZ(7,"ion-text"),t._uU(8),t.qZA(),t.qZA(),t.TgZ(9,"td"),t.TgZ(10,"ion-text"),t._uU(11),t.qZA(),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.qZA()}if(2&f){const e=R.$implicit;t.xp6(5),t.hij(" ",e.item_name," "),t.xp6(3),t.Oqu(e.quantity),t.xp6(3),t.Oqu(e.pay_price+ +e.tax/100*+e.pay_price),t.xp6(2),t.Oqu(+e.tot)}}function K(f,R){if(1&f&&(t.TgZ(0,"div"),t._UZ(1,"qrcode",42),t.qZA()),2&f){const e=t.oxw(3);t.xp6(1),t.Q6J("qrdata",e.printArr[0].qrcodedata)}}function G(f,R){if(1&f){const e=t.EpF();t.TgZ(0,"ion-row",35),t.TgZ(1,"ion-col",36),t.TgZ(2,"ion-card"),t.TgZ(3,"ion-grid"),t.TgZ(4,"ion-row",35),t.TgZ(5,"ion-col",37),t.TgZ(6,"ion-label",20),t.TgZ(7,"strong"),t._uU(8," \u0627\u0644\u062e\u0635\u0640\u0640\u0645:"),t.qZA(),t.qZA(),t.TgZ(9,"ion-item",38),t.TgZ(10,"ion-input",39),t.NdJ("ngModelChange",function(u){return t.CHM(e),t.oxw(2).payInvo.discount=u})("ionChange",function(u){return t.CHM(e),t.oxw(2).discountChange(u)}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"ion-col",37),t.TgZ(12,"ion-label",20),t.TgZ(13,"strong"),t._uU(14," \u0627\u0644\u0645\u0633\u062a\u0644\u0645 \u0646\u0642\u062f\u0627 "),t.qZA(),t.qZA(),t.TgZ(15,"ion-item",38),t.TgZ(16,"ion-input",39),t.NdJ("ngModelChange",function(u){return t.CHM(e),t.oxw(2).payInvo.pay=u})("ionChange",function(u){return t.CHM(e),t.oxw(2).payChange(u)}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"ion-col",37),t.TgZ(18,"ion-label",20),t.TgZ(19,"strong"),t._uU(20,"\u0627\u0644\u0645\u062a\u0628\u0642\u064a "),t.qZA(),t.qZA(),t.TgZ(21,"ion-item",38),t.TgZ(22,"ion-input",40),t.NdJ("ngModelChange",function(u){return t.CHM(e),t.oxw(2).payInvo.changee=u}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(23,"ion-row",35),t.TgZ(24,"ion-col",14),t.TgZ(25,"ion-button",41),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).save()}),t.TgZ(26,"ion-label",30),t._uU(27," \u062d\u0641\u0640\u0640\u0638"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(28,"ion-col",14),t.YNc(29,K,2,1,"div",4),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&f){const e=t.oxw(2);t.xp6(10),t.Q6J("ngModel",e.payInvo.discount),t.xp6(6),t.Q6J("ngModel",e.payInvo.pay),t.xp6(6),t.Q6J("ngModel",e.payInvo.changee)("readonly",!0),t.xp6(7),t.Q6J("ngIf",e.printArr)}}function tt(f,R){if(1&f&&(t.TgZ(0,"ion-grid",10),t.TgZ(1,"ion-row",11),t.TgZ(2,"ion-col",12),t.TgZ(3,"ion-grid"),t.TgZ(4,"ion-row"),t.TgZ(5,"ion-col",13),t.YNc(6,X,6,2,"ion-row",4),t.qZA(),t.TgZ(7,"ion-col",14),t.TgZ(8,"ion-card",15),t.TgZ(9,"table",16),t.TgZ(10,"tr"),t._UZ(11,"th"),t.TgZ(12,"th"),t._uU(13,"\u0627\u0644\u0635\u0646\u0641"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"\u0627\u0644\u0643\u0645\u064a\u0629"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"\u0633\u0639\u0631 "),t.qZA(),t.TgZ(18,"th"),t._uU(19,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639"),t.qZA(),t.qZA(),t.YNc(20,ct,14,4,"tr",17),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"ion-col",18),t.TgZ(22,"ion-card",15),t.TgZ(23,"ion-grid"),t.TgZ(24,"ion-row"),t.TgZ(25,"ion-col",19),t.TgZ(26,"ion-label",20),t.TgZ(27,"strong"),t._uU(28,"\u0635\u0627\u0641\u064a \u0627\u0644\u0645\u0628\u0644\u063a :"),t.qZA(),t.TgZ(29,"ion-text"),t._uU(30),t.qZA(),t.qZA(),t.qZA(),t.TgZ(31,"ion-col",19),t.TgZ(32,"ion-label",20),t.TgZ(33,"strong"),t._uU(34,"\u0627\u0644\u062e\u0635\u0640\u0640\u0645 :"),t.qZA(),t.TgZ(35,"ion-text"),t._uU(36),t.qZA(),t.qZA(),t.qZA(),t.TgZ(37,"ion-col",19),t.TgZ(38,"ion-label",20),t.TgZ(39,"strong"),t._uU(40,"\u0627\u0644\u0636\u0631\u064a\u0628\u0629 : "),t.qZA(),t.TgZ(41,"ion-text"),t._uU(42),t.qZA(),t.qZA(),t.qZA(),t.TgZ(43,"ion-col",19),t.TgZ(44,"ion-label",20),t.TgZ(45,"strong"),t._uU(46," \u0635\u0627\u0641\u064a \u0627\u0644\u0645\u0628\u0644\u063a \u0645\u0639 \u0627\u0644\u0636\u0631\u064a\u0628\u0629 :"),t.qZA(),t.TgZ(47,"ion-text"),t._uU(48),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(49,G,30,5,"ion-row",21),t.qZA()),2&f){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",e.brandList.length>0),t.xp6(14),t.Q6J("ngForOf",e.itemList),t.xp6(10),t.hij("",e.payInvo.tot_pr," "),t.xp6(6),t.hij("",e.payInvo.discount," "),t.xp6(6),t.hij("",e.payInvo.taxTot," "),t.xp6(6),t.hij("",e.taxAll," "),t.xp6(1),t.Q6J("ngIf",e.payInvo)}}const lt=[{path:"",component:(()=>{class f{constructor(e,i,u,_,D,k,Y,st,ht,V,nt,ot,ut,z,rt){this.sanitizer=e,this.rout=i,this.platform=u,this.behavApi=_,this._location=D,this.route=k,this.renderer=Y,this.modalController=st,this.alertController=ht,this.authenticationService=V,this.storage=nt,this.loadingController=ot,this.datePipe=ut,this.api=z,this.toast=rt,this.isOpen=!1,this.isOpenNotif=!1,this.newNotif=!1,this.sub_account=[],this.sub_accountLocalSales=[],this.sub_accountSales=[],this.initialInvoices=[],this.items=[],this.itemsLocal=[],this.itemList=[],this.salesLocal=[],this.sales=[],this.notifArr=[],this.LogHistoryLocalArr=[],this.purchLocal=[],this.purchase=[],this.randomsNumber=[],this.sub_nameNew="",this.discountPerc=0,this.radioVal=0,this.radioVal2=0,this.printMode=!1,this.printArr=[],this.offline=!1,this.color="dark",this.showMe=null,this.status="new",this.searchLang=0,this.searchTerm="",this.aliasTerm="",this.searchResult=[],this.aliasResult=[],this.finalResult=[],this.loadingItems=!1,this.logHistoryArr=[],this.showNotif=!1,this.device="",this.currenQty=0,this.firstQty=0,this.perchTotQty=0,this.payTotQty=0,this.perchTot=0,this.qtyReal=0,this.availQty=0,this.brandList=[],this.filteredItems=[],this.taxAll=0,this.netTot=0,this.discTot=0,this.qrcodedata=null,this.selectedAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:"",cat_name:"",cat_id:"",phone:"",address:"",currentCustumerStatus:0},this.route.queryParams.subscribe(U=>{U&&U.payInvo&&(this.status="initial",this.payInvo=JSON.parse(U.payInvo),null==this.payInvo.cust_id?(this.radioVal=1,this.sub_nameNew=JSON.parse(U.sub_name)):this.selectedAccount.sub_name=JSON.parse(U.sub_name),this.user_info=JSON.parse(U.user_info),this.store_info=JSON.parse(U.store_info),this.itemList=JSON.parse(U.itemList),this.discountPerc=(+this.payInvo.discount/+this.payInvo.tot_pr*100).toFixed(2),this.prepareOffline(),this.getAppInfoCase2())}),this.printArr.push({payInvo:"",itemList:"",selectedAccount:"",sub_nameNew:"",userInfo:"",sub_balanse:0,balanceStatus:"",company:"",qrcodedata:""}),this.selectedItem={id:void 0,dateCreated:"",pay_ref:"",item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:"",tax:0,disc:0}}checkPlatform(){this.platform.is("desktop")?this.device="desktop":this.platform.is("mobile")&&(this.device="mobile")}changeMode(){1==this.offline?(this.offline=!1,this.color="primary"):0==this.offline&&(this.offline=!0,this.color="dark"),this.storage.set("offline",this.offline).then(e=>{})}segmentChanged(e){this.filteredItems=this.items.filter(i=>i.brand===e.detail.value)}ionViewDidLeave(){}ionViewDidEnter(){setTimeout(()=>{},1e4)}ngOnInit(){this.checkPlatform(),"mobile"==this.device&&this.rout.navigate(["folder/sales-mob"]),this.prepareOffline(),"new"==this.status?this.getAppInfo():"initial"==this.status&&(this.getAppInfoCase2(),this.radioVal2=0)}presentPopover(e){this.popover.event=e,this.isOpen=!0,this.clear(),this.searchResult=this.items,setTimeout(()=>{this.setFocusOnInput("popInput")},2e3)}presentPopoverNotif(e){this.notifArr=[],this.showNotif=!1,this.popoverNotif.event=e,this.isOpenNotif=!0}didDissmis(){this.isOpen=!1,this.getItemPaysByItemId(),this.setFocusOnInput("qtyId")}didDissmisNotif(){this.isOpenNotif=!1}bothItemAndAccount(e,i){return(0,o.mG)(this,void 0,void 0,function*(){yield this.getAllStockItemsWithouteCounts(),yield this.getSalesAccount(e,i)})}searchItem(e){this.searchResult=[],this.aliasTerm=e.target.value;const i=new g.g,u=new d.V,_=new p.C;let D;D=0==this.searchLang?i.transform(this.items,e.target.value):_.transform(this.items,e.target.value);const k=u.transform(this.items,this.aliasTerm);D.length>0&&D.forEach(Y=>{this.searchResult.push(Y)}),k.length>0&&k.forEach(Y=>{this.searchResult.push(Y)})}clear(e){e?this.selectedItem={id:void 0,dateCreated:"",pay_ref:this.payInvo.pay_ref,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:"",tax:0,disc:0}:this.searchTerm=""}getStockItems(){this.storage.get("year").then(e=>{e&&(this.year=e,0==this.offline?(this.loadingItems=!0,this.api.stockItems(1,this.year.id).subscribe(i=>{console.log(i),this.items=i.data,this.items.forEach(_=>{+_.tswiaQuantity>0?_.salesQuantity=+_.salesQuantity+ +_.tswiaQuantity:+_.tswiaQuantity<0&&(_.perchQuantity=+_.perchQuantity+Math.abs(+_.tswiaQuantity)),_.quantity=+_.perchQuantity+ +_.firstQuantity-+_.salesQuantity}),this.searchResult=this.items,this.loadingItems=!1,this.storage.set("itemsLocal",this.items).then(_=>{})},i=>{this.loadingItems=!1},()=>{this.loadingItems=!1})):(this.items=this.itemsLocal,this.items.forEach(i=>{+i.tswiaQuantity>0?i.salesQuantity=+i.salesQuantity+ +i.tswiaQuantity:+i.tswiaQuantity<0&&(i.perchQuantity=+i.perchQuantity+Math.abs(+i.tswiaQuantity)),i.quantity=+i.perchQuantity+ +i.firstQuantity-+i.salesQuantity}),this.searchResult=this.items))})}getBrands(){this.api.getBrands().subscribe(e=>{this.brandList=e.data,console.log(this.brandList),this.filteredItems=this.items.filter(u=>u.brand===this.brandList[0].brand)},e=>{},()=>{})}getAllStockItemsWithouteCounts(){this.storage.get("year").then(e=>{e&&(this.year=e,0==this.offline?(this.loadingItems=!0,this.api.getAllStockItemsWithouteCounts(1,this.year.id).subscribe(i=>{this.items=i.data,this.loadingItems=!1,this.storage.set("itemsLocal",this.items).then(_=>{})},i=>{this.loadingItems=!1},()=>{this.loadingItems=!1})):(this.items=this.itemsLocal,this.searchResult=this.items))})}afterSync(e){e.forEach(i=>{if(0==this.LogHistoryLocalArr.some(u=>u.logRef===i.logRef))this.LogHistoryLocalArr.push(i);else{let u=this.LogHistoryLocalArr.findIndex(_=>_.logRef===i.logRef);-1!=u&&(this.LogHistoryLocalArr[u]=i)}}),this.storage.set("LogHistoryLocal",this.LogHistoryLocalArr).then(i=>{})}presentAlertConfirm(e){return(0,o.mG)(this,void 0,void 0,function*(){let i="\u0647\u0644 \u062a\u0631\u064a\u062f \u0637\u0628\u0627\u0639\u0629 \u0641\u0627\u062a\u0648\u0631\u0629 \u061f ";e&&(i="\u0647\u0644 \u062a\u0631\u064a\u062f \u062d\u0630\u0641 \u0627\u0644\u0633\u062c\u0644 \u061f "),yield(yield this.alertController.create({cssClass:"my-custom-class",header:"\u062a\u0623\u0643\u064a\u062f!",mode:"ios",message:i,buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel",cssClass:"secondary",id:"cancel-button",handler:_=>{this.prepareInvo()}},{text:"\u0645\u0648\u0627\u0641\u0642",id:"confirm-button",handler:()=>{e?this.deleteSalesInvoInit():this.presentModal(this.printArr,"sales")}}]})).present()})}Print(e){this.printMode=!0;var i=window.open("","PRINT","height=400,width=600");return i.document.write("<html><head>"),i.document.write('<style type="text/css">'),i.document.write(".sumsDiv{border-style: solid;border-color: gray;border-width: .5px;} .flr{ display: block; float: right; } .show{ } .hide{width:0px;height:0px} .w45 {width:45%} .w50 {width:50%} .w100 {width:100%} td, th {border: 1px solid #dddddd;text-align: center;padding: 8px;} tr:nth-child(even) {background-color: #dddddd;} .table{text-align: center;width: 100%; margin: 12px;}.ion-margin{ margin: 10px; } .ion-margin-top{ margin-top: 10px; } .rtl {  direction: rtl; } .ion-text-center{ text-align: center; } .ion-text-end{ text-align: left; } .ion-text-start{ text-align: right; }"),i.document.write("</style></head><body>"),i.document.write(document.getElementById(e).innerHTML),i.document.write("</body></html>"),i.document.close(),i.focus(),i.print(),i.close(),this.printMode=!1,!0}getOffliemode(){this.storage.get("offline").then(e=>{this.offline=e,1==this.offline?this.color="dark":0==this.offline?this.color="primary":this.SetOffliemode()})}SetOffliemode(){this.storage.set("offline",!1).then(e=>{this.offline=e,this.color="primary"})}getAppInfo(){this.getOffliemode(),this.storage.get("USER_INFO").then(e=>{e&&(this.user_info=e)}),this.storage.get("year").then(e=>{e&&(this.year=e)}),this.storage.get("company").then(e=>{this.company=e[0],console.log(this.company)}),this.storage.get("STORE_INFO").then(e=>{e&&(this.store_info=e,this.getItems(),this.prepareInvo())}),this.storage.get("LogHistoryLocal").then(e=>{e&&(this.LogHistoryLocalArr=e)}),this.storage.get("initialInvoices").then(e=>{e&&(this.initialInvoices=e)}),this.storage.get("LogHistoryLocal").then(e=>{e&&(this.LogHistoryLocalArr=e)}),this.storage.get("searchLang").then(e=>{e&&(this.searchLang=e)}),this.getBrands()}getAppInfoCase2(){this.getOffliemode(),this.storage.get("USER_INFO").then(e=>{e&&(this.user_info=e)}),this.storage.get("year").then(e=>{e&&(this.year=e)}),this.storage.get("STORE_INFO").then(e=>{e&&(this.store_info=e)}),this.storage.get("LogHistoryLocal").then(e=>{e&&(this.LogHistoryLocalArr=e)}),this.storage.get("searchLang").then(e=>{e&&(this.searchLang=e)})}prepareOffline(){this.storage.get("salesLocal").then(e=>{e&&(this.salesLocal=e)}),this.storage.get("sales").then(e=>{e&&(this.sales=e)}),this.storage.get("itemsLocal").then(e=>{e&&(this.itemsLocal=e,this.items=this.itemsLocal)}),this.storage.get("sub_accountLocalSales").then(e=>{e&&(this.sub_accountLocalSales=e)}),this.storage.get("sub_accountSales").then(e=>{e&&(this.sub_accountSales=e,this.getSubBalance())})}newLogic(){return(0,o.mG)(this,void 0,void 0,function*(){yield this.getAppInfo(),yield this.prepareInvo()})}getItemLocalOff(){this.storage.get("itemsLocal").then(e=>{e&&(this.itemsLocal=e,this.items=this.itemsLocal,this.searchResult=this.items)})}getAccountOffline(){this.storage.get("sub_accountSales").then(e=>{e&&(this.sub_account=e,this.getSubBalance(),this.addSubaccountLocal())})}radioChange(e){}recalSubBalance(){this.sub_account.forEach(e=>{e.sub_balance=0;let i=+e.changeeTot+ +e.fromDebitTot,u=+e.purchChangeeTot+ +e.toCreditTot;0==this.radioVal&&this.selectedAccount.id==e.id&&(i=+i+ +this.payInvo.changee),i==u?(e.sub_balance=0,e.currentCustumerStatus=""):i>u?(e.sub_balance=(+i-+u).toFixed(2),e.currentCustumerStatus="debit",+this.selectedAccount.id==+e.id&&(this.selectedAccount.sub_balance=e.sub_balance,this.selectedAccount.currentCustumerStatus=e.currentCustumerStatus)):u>i&&(e.sub_balance=(+u-+i).toFixed(2),e.currentCustumerStatus="credit",+this.selectedAccount.id==+e.id&&(this.selectedAccount.sub_balance=e.sub_balance,this.selectedAccount.currentCustumerStatus=e.currentCustumerStatus))})}getSubBalance(){this.sub_account.forEach(e=>{e.sub_balance=0;let i=+e.changeeTot+ +e.fromDebitTot,u=+e.purchChangeeTot+ +e.toCreditTot;i==u?(e.sub_balance=0,this.currentCustumerStatus=""):i>u?(e.sub_balance=(+i-+u).toFixed(2),this.currentCustumerStatus="debit"):u>i&&(e.sub_balance=(+u-+i).toFixed(2),this.currentCustumerStatus="credit")})}radioChange2(e,i){"from"==i&&(1==e.target.value&&"initial"==this.status?(this.status="toFinal",this.payInvo.yearId=this.year.id,this.itemList.length>0&&this.itemList.forEach(u=>{u.yearId=this.year.id})):0==e.target.value&&"toFinal"==this.status&&(this.status="initial"))}prepareInvo(){this.selectedAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:"",cat_id:"",cat_name:"",phone:"",address:"",currentCustumerStatus:0},this.sub_nameNew="",this.radioVal=0,this.radioVal2=0,this.payInvo={pay_id:void 0,pay_ref:0,store_id:"",tot_pr:0,pay:0,pay_date:"",pay_time:"",user_id:"",cust_id:null,pay_method:"",discount:0,changee:0,sub_name:"",payComment:"",nextPay:null,yearId:this.year.id,companyId:this.company.id,recived:0,taxTot:0,backed:0},this.discountPerc=0;let e=new Date;this.payInvo.pay_date=this.datePipe.transform(e,"yyyy-MM-dd"),this.payInvo.pay_time=this.datePipe.transform(e,"HH:mm:ss"),this.generateRandom(),this.payInvo.store_id=this.store_info.id,this.payInvo.user_id=this.user_info.id,this.payInvo.yearId=this.year.id,this.itemList=[],this.getAccountOffline()}setFocusOnInput(e){"dst"==e?this.nameField.nativeElement.focus():"dstPop"==e?(this.dstPop.setFocus(),this.isOpen=!0,this.clear(),this.searchResult=this.items,setTimeout(()=>{this.popInput.setFocus()},1500)):"qtyId"==e?this.qtyId.setFocus():"popInput"==e&&this.popInput.setFocus()}isFocused(e){}getItems(){0==this.offline?this.api.getItems().subscribe(e=>{this.items=e.data,this.items.forEach(u=>{this.sanitizer.bypassSecurityTrustResourceUrl(u.imgUrl)}),console.log(this.items)},e=>{}):this.items=this.itemsLocal}getSalesAccount(e,i){0==this.offline?this.api.getSalesAccounts(this.store_info.id,this.year.id).subscribe(u=>{this.sub_account=u.data,this.getSubBalance(),this.addSubaccountLocal(),"sync both"==e&&(this.storage.set("sub_accountSales",this.sub_account).then(D=>{}),this.afterSync(i))},u=>{}):this.MixSubaccountSalesOffline()}addSubaccountLocal(){if(this.sub_account){if(this.sub_accountLocalSales)for(let e=0;e<this.sub_accountLocalSales.length;e++)this.sub_account.push(this.sub_accountLocalSales[e])}else this.sub_accountLocalSales&&(this.sub_account=this.sub_accountLocalSales)}MixSubaccountSalesOffline(){if(this.sub_account=[],this.sub_accountLocalSales)for(let e=0;e<this.sub_accountLocalSales.length;e++)this.sub_account.push(this.sub_accountLocalSales[e]);if(this.sub_accountSales)for(let e=0;e<this.sub_accountSales.length;e++)this.sub_account.push(this.sub_accountSales[e])}generateRandom(){let e=new Date,i=e.getMonth().toString()+e.getDay().toString()+e.getHours().toString()+e.getMinutes().toString()+e.getSeconds().toString()+e.getMilliseconds().toString();this.payInvo.pay_ref=this.store_info.store_ref+i}pickAccount(e){let i=this.sub_account.filter(u=>u.sub_name==e.target.value);i.length>0?(this.selectedAccount={id:i[0].id,ac_id:i[0].ac_id,sub_name:i[0].sub_name,sub_type:i[0].sub_type,sub_code:i[0].sub_code,store_id:i[0].store_id,sub_balance:i[0].sub_balance,cat_id:i[0].cat_id,cat_name:i[0].cat_name,phone:i[0].phone,address:i[0].address,currentCustumerStatus:i[0].currentCustumerStatus},this.payInvo.cust_id=this.selectedAccount.id,this.payInvo.sub_name=this.selectedAccount.sub_name):(this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u0645 \u0627\u0644\u062d\u0633\u0627\u0628 ","danger"),this.selectedItem.item_name="")}selectFromPop(e){this.selectedItem={id:e.id,dateCreated:e.dateCreated,pay_ref:this.payInvo.pay_ref,item_desc:e.item_desc,item_name:e.item_name,item_unit:e.item_unit,parcode:e.parcode,pay_price:e.pay_price,perch_price:e.perch_price,qty:"",tot:e.pay_price,availQty:e.quantity,aliasEn:e.aliasEn,tax:e.tax,disc:0},this.searchTerm=e.item_name,this.didDissmis()}getItemPaysByItemId(){this.api.getItemQtyPaysByItemId(this.store_info.id,this.selectedItem.id,this.year.id).subscribe(e=>{console.log("getItemPaysByItemId",e),"No record Found"!=e.message&&(this.payTotQty=e.data[0].salesQuantity),this.getQtyPurchByItemId()},e=>{this.presentToast("1\u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{})}getQtyPurchByItemId(){this.api.getQtyPurchByItemId(this.store_info.id,this.selectedItem.id,this.year.id).subscribe(e=>{let i=e;"No record Found"!=i.message&&(this.perchTotQty=i.data[0].perchQuantity,this.firstQty=i.data[0].firstQuantity),this.getQtyTswiaByItemId()},e=>{this.presentToast("  \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{})}getQtyTswiaByItemId(){this.api.getQtyTswiaByItemId(this.store_info.id,this.selectedItem.id,this.year.id).subscribe(e=>{console.log("getQtyTswiaByItemId",e);let i=e;"No record Found"!=i.message&&(this.availQty=i.data[0].availQty,this.qtyReal=i.data[0].qtyReal),this.getQtyTotalItemId()},e=>{this.presentToast("  \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{})}getQtyTotalItemId(){+this.availQty-+this.qtyReal<0?this.perchTotQty=+this.perchTotQty+Math.abs(+this.availQty-+this.qtyReal):+this.availQty-+this.qtyReal>0&&(this.payTotQty=+this.availQty-+this.qtyReal+ +this.payTotQty),this.availQty=+this.perchTotQty-+this.payTotQty,console.log(this.payTotQty,this.payTotQty)}pickDetail(e){let i=[];i=this.items.filter(1==this.searchLang?u=>u.item_desc==e.target.value:u=>u.item_name==e.target.value),i.length>0?(this.selectedItem={id:i[0].id,dateCreated:i[0].dateCreated,pay_ref:this.payInvo.pay_ref,item_desc:i[0].item_desc,item_name:i[0].item_name,item_unit:i[0].item_unit,parcode:i[0].parcode,pay_price:i[0].pay_price,perch_price:i[0].perch_price,qty:"",tot:i[0].pay_price,availQty:i[0].quantity,aliasEn:i[0].aliasEn,tax:i[0].tax,disc:i[0].disc},this.setFocusOnInput("qtyId")):(this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641 ","danger"),this.selectedItem.item_name="",this.selectedItem.item_desc="")}qtyhange(e){this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2);let i=[];this.itemList.length>0?(i=this.itemList.filter(u=>u.item_name==this.selectedItem.item_name),i.length>0?+this.selectedItem.qty+ +i[0].quantity>+this.selectedItem.availQty&&this.presentToast("\u0627\u0644\u0635\u0646\u0641 \u0645\u0648\u062c\u0648\u062f \u0628\u0627\u0644\u0642\u0627\u0626\u0645\u0629 , \u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0644\u062c\u062f\u064a\u062f \u0627\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0645\u062a\u0648\u0641\u0631 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646","warning"):+this.selectedItem.qty>+this.selectedItem.availQty&&this.presentToast("\u0627\u0644\u0643\u0645\u064a\u0629 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646 \u063a\u064a\u0631 \u0643\u0627\u0641\u064a\u0629","warning")):+this.selectedItem.qty>+this.selectedItem.availQty&&this.presentToast("\u0627\u0644\u0643\u0645\u064a\u0629 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646 \u063a\u064a\u0631 \u0643\u0627\u0641\u064a\u0629","warning")}pricehange(e){this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2)}getTotal(){let e=this.itemList.reduce((i,u)=>i+ +u.quantity*+u.pay_price,0);this.payInvo.taxTot=this.itemList.reduce((i,u)=>i+ +u.tax/100*+u.pay_price,0),console.log("sum",e),this.payInvo.tot_pr=+e-+this.payInvo.discount,this.taxAll=this.payInvo.tot_pr+ +this.payInvo.taxTot,this.payInvo.changee=+this.taxAll-+this.payInvo.pay,this.payInvo.tot_pr=this.payInvo.tot_pr.toFixed(2),this.payInvo.changee=this.payInvo.changee.toFixed(2)}payChange(e){this.payInvo.recived=e.target.value,this.payInvo.backed=+this.taxAll-e.target.value,this.payInvo.changee=+this.taxAll-e.target.value}discountChange(e){this.getTotal()}discountPerChange(e){this.payInvo.discount=(+this.payInvo.tot_pr*+this.discountPerc/100).toFixed(2),this.payInvo.changee=+(this.payInvo.tot_pr-this.payInvo.discount)-this.payInvo.pay}deleteItem(e){this.itemList.splice(e,1),this.payInvo.pay=0,this.discountPerc=0,this.payInvo.discount=0,this.netTot=0,this.taxAll=0,this.getTotal()}presentToast(e,i){return(0,o.mG)(this,void 0,void 0,function*(){(yield this.toast.create({message:e,duration:2e3,color:i,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})}refresh(e){"account"==e?this.getSalesAccount():this.getAllStockItemsWithouteCounts()}addTolist(){if(""==this.selectedItem.item_name||""==this.selectedItem.id||0==+this.selectedItem.qty)this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u0635\u0646\u0641 \u0648\u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0643\u0645\u064a\u0629","danger");else{let e=[];if(this.itemList.length>0&&(e=this.itemList.filter(i=>i.item_name==this.selectedItem.item_name&&i.pay_price==this.selectedItem.pay_price)),0==e.length){let i=new Date,u=this.datePipe.transform(i,"dd-MM-YYYY");this.itemList.push({id:"NULL",pay_ref:this.selectedItem.pay_ref,item_name:this.selectedItem.item_name,pay_price:this.selectedItem.pay_price,quantity:+this.selectedItem.qty,tot:this.selectedItem.tot,store_id:+this.store_info.id,yearId:+this.year.id,item_id:+this.selectedItem.id,dateCreated:u,perch_price:this.selectedItem.perch_price,tax:this.selectedItem.tax,disc:this.selectedItem.disc})}else{this.selectedItem.qty=+e[0].quantity+ +this.selectedItem.qty;let i=this.itemList.map(u=>u.item_name).indexOf(this.selectedItem.item_name);this.itemList[i].quantity=+this.selectedItem.qty,this.itemList[i].tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2)}this.selectedItem={id:void 0,dateCreated:"",pay_ref:this.payInvo.pay_ref,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:"",tax:0,disc:0},this.discountPerc=0,this.payInvo.discount=0,this.getTotal(),this.setFocusOnInput("dstPop")}}addTolistClick(e){this.selectedItem=e,console.log(e),this.selectedItem={id:e.id,dateCreated:"",pay_ref:this.payInvo.pay_ref,item_desc:e.item_desc,item_name:e.item_name,item_unit:e.item_unit,parcode:e.parcode,pay_price:e.pay_price,perch_price:e.item_name,qty:1,tot:+e.pay_price+ +e.tax/100*+e.pay_price,availQty:0,aliasEn:+e.aliasEn,tax:e.tax,disc:e.disc};let i=[];if(this.itemList.length>0&&(i=this.itemList.filter(u=>u.item_name==this.selectedItem.item_name&&u.pay_price==this.selectedItem.pay_price)),0==i.length){let u=new Date,_=this.datePipe.transform(u,"dd-MM-YYYY");this.selectedItem.qty=1,this.itemList.push({id:"NULL",pay_ref:this.selectedItem.pay_ref,item_name:this.selectedItem.item_name,pay_price:this.selectedItem.pay_price,quantity:+this.selectedItem.qty,tot:this.selectedItem.tot,store_id:+this.store_info.id,yearId:+this.year.id,item_id:+this.selectedItem.id,dateCreated:_,perch_price:this.selectedItem.perch_price,tax:this.selectedItem.tax,disc:this.selectedItem.disc})}else{this.selectedItem.qty=1,this.selectedItem.qty=+i[0].quantity+ +this.selectedItem.qty;let u=this.itemList.map(_=>_.item_name).indexOf(this.selectedItem.item_name);this.itemList[u].quantity=+this.selectedItem.qty,this.itemList[u].tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2)}this.selectedItem={id:void 0,dateCreated:"",pay_ref:this.payInvo.pay_ref,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:"",tax:i[0].tax,disc:i[0].disc},this.discountPerc=0,this.payInvo.discount=0,this.getTotal()}qtyClick(e){this.showMe=e}hideMe(e){this.showMe=null}editCell(e){+this.itemList[e].quantity>0&&+this.itemList[e].pay_price>0?(this.itemList[e].tot=+this.itemList[e].quantity*+this.itemList[e].pay_price,this.discountPerc=0,this.payInvo.discount=0,this.hideMe(e),this.getTotal()):this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u062f\u062e\u0627\u0644 ","danger")}validate(){return this.sub_account&&this.sub_account.filter(i=>i.sub_name==this.sub_nameNew),0==this.itemList.length||""==this.payInvo.pay_ref?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062f\u062e\u0627\u0644 \u0627\u0635\u0646\u0627\u0641 \u0627\u0644\u064a \u0627\u0644\u0642\u0627\u0626\u0645\u0629","danger"),!1):""==this.payInvo.pay_date||null==this.payInvo.pay_date?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u062a\u0627\u0631\u064a\u062e ","danger"),!1):!(this.payInvo.changee<0&&(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0645\u0631\u0627\u062c\u0639\u0629 \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u0633\u062a\u0644\u0645 \u0648\u0627\u0644\u062e\u0635\u0645  ","danger"),1))}saveIntial(){1==this.radioVal&&(this.payInvo.sub_name=this.sub_nameNew,this.payInvo.cust_id=null),this.initialInvoices.length>0&&(this.initialInvoices=this.initialInvoices.filter(e=>e.payInvo.pay_ref!=this.payInvo.pay_ref)),this.initialInvoices.push({payInvo:this.payInvo,itemList:this.itemList}),this.storage.set("initialInvoices",this.initialInvoices).then(e=>{this.printArr=[],this.recalSubBalance(),this.printArr.push({payInvo:this.payInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus,company:this.company,qrcodedata:this.qrcodedata}),this.presentAlertConfirm(),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success"),this.prepareInvo(),this.status="new"})}saveInvoInit(){this.api.saveSalesInvoInit(this.payInvo).subscribe(e=>{this.saveitemListinit()},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}deleteInitial(){this.initialInvoices.length>0&&(this.initialInvoices=this.initialInvoices.filter(e=>e.payInvo.pay_ref!=this.payInvo.pay_ref)),this.storage.set("initialInvoices",this.initialInvoices).then(e=>{this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0630\u0641 \u0628\u0646\u062c\u0627\u062d","success"),this.status="new",this.prepareInvo()})}deleteSalesInvoInit(){"toFinal"!=this.status&&this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),this.api.deleteSalesInvoInit(this.payInvo.pay_id).subscribe(e=>{"Post Not Deleted"!=e.message?this.deleteSalesitemListInit():this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}deleteSalesitemListInit(){this.api.deleteSalesitemListInit(this.payInvo.pay_ref).subscribe(e=>{"Post Not Deleted"!=e.message?"toFinal"!=this.status&&(this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0630\u0641 \u0628\u0646\u062c\u0627\u062d","success"),this.prepareInvo()):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}save(){let e=this.payInvo.pay_date;this.payInvo.sub_name=this.selectedAccount.sub_name,this.payInvo.pay_date=this.datePipe.transform(e,"yyyy-MM-dd"),1==this.validate()&&(this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),0==this.radioVal2&&0==this.radioVal&&"new"==this.status?this.saveInvoInit():0==this.radioVal2&&1==this.radioVal&&"new"==this.status?this.saveSubAccountInit():0==this.radioVal2&&"initial"==this.status?this.updateInitInvo():0==this.radioVal&&null!=this.selectedAccount.id?1==this.offline?this.saveInvoLocal():this.saveInvo():0==this.radioVal&&null==this.selectedAccount.id&&""!=this.selectedAccount.sub_name?1==this.offline?this.saveInvoLocal():this.saveSubAccount():1==this.radioVal&&(1==this.offline?this.saveSubAccountlocal():this.saveSubAccount()))}saveLogHistory(){let e,i,u;this.logHistoryArr.length>1?(u=this.logHistoryArr[1],i=this.logHistoryArr[0],e="new account"):(u=this.logHistoryArr[0],e=void 0),this.api.saveLogHistoryMultiSales(u,i,e).subscribe(_=>{"Post Not Created"!=_.message?(this.logHistoryArr=[],this.presentAlertConfirm(),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success")):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},_=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}performSync(){return(0,o.mG)(this,void 0,void 0,function*(){yield this.saveLogHistory(),yield this.getAllStockItemsWithouteCounts()})}back(){this._location.back()}updateInitInvo(){this.api.updateInitSalesInvo(this.payInvo).subscribe(e=>{this.deleteSalesitemListInit4update()},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger").then(()=>{this.loadingController.dismiss()})})}deleteSalesitemListInit4update(){this.api.deleteSalesitemListInit(this.payInvo.pay_ref).subscribe(e=>{"Post Not Deleted"!=e.message?this.saveitemListinit():this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger").then(()=>{this.loadingController.dismiss()})},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger").then(()=>{this.loadingController.dismiss()})})}preparenewaccount(){this.selectedAccount.sub_name.length>0&&null==this.selectedAccount.id||(this.selectedAccount.sub_name=this.sub_nameNew,this.payInvo.sub_name=this.selectedAccount.sub_name),this.selectedAccount.id=null,this.selectedAccount.ac_id=1,this.selectedAccount.sub_type="debit",this.selectedAccount.sub_code=null,this.selectedAccount.sub_balance="0",this.selectedAccount.cat_id=1,this.selectedAccount.cat_name="\u0627\u0644\u0639\u0645\u0644\u0627\u0621",this.selectedAccount.store_id=this.store_info.id}saveSubAccount(){this.preparenewaccount(),this.api.saveSubAccount(this.selectedAccount).subscribe(e=>{"Post Not Created"!=e.message?(this.payInvo.cust_id=e.message,0==this.radioVal&&null==this.selectedAccount.id&&0==this.offline&&(this.sub_accountLocalSales=this.sub_accountLocalSales.filter(i=>i.sub_name!=this.selectedAccount.sub_name),this.storage.set("sub_accountLocalSales",this.sub_accountLocalSales).then(i=>{this.selectedAccount.id=this.payInvo.cust_id,this.sub_accountSales.push(this.selectedAccount),this.storage.set("sub_accountSales",this.sub_accountSales).then(u=>{})})),this.selectedAccount.id=e.message,this.logHistoryArr.push({id:null,logRef:this.generateRandom2("insert customer"),userId:this.user_info.id,typee:"insert customer",datee:A(new Date).locale("en").format("YYYY-MM-DD HH:mm:ss"),logStatus:0,logToken:JSON.stringify(this.selectedAccount),yearId:this.year.id,store_id:this.store_info.id}),this.saveInvo()):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveSubAccountInit(){this.preparenewaccount(),this.api.saveSubAccount(this.selectedAccount).subscribe(e=>{"Post Not Created"!=e.message?(this.payInvo.cust_id=e.message,this.saveInvoInit()):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveSubAccountlocal(){this.preparenewaccount(),this.sub_account||(this.sub_account=[]),this.sub_account.push(this.selectedAccount),this.sub_accountLocalSales.push(this.selectedAccount),this.storage.set("sub_accountLocalSales",this.sub_accountLocalSales).then(e=>{this.saveInvoLocal()})}saveInvo(){this.api.saveSalesInvo(this.payInvo).subscribe(e=>{this.saveitemList()},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}saveInvoLocal(){this.salesLocal.push({payInvo:this.payInvo,itemList:this.itemList}),this.storage.set("salesLocal",this.salesLocal).then(e=>{this.printArr=[],this.recalSubBalance(),this.printArr.push({payInvo:this.payInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus,company:this.company,qrcodedata:this.qrcodedata}),this.presentAlertConfirm(),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success"),this.initialInvoices.length>0&&(this.initialInvoices=this.initialInvoices.filter(i=>i.payInvo.pay_ref!=this.payInvo.pay_ref),this.storage.set("initialInvoices",this.initialInvoices).then(i=>{}))})}saveitemListinit(){this.api.saveSalesitemListInit(this.itemList).subscribe(e=>{this.recalSubBalance(),this.printArr=[],this.recalSubBalance(),this.printArr.push({payInvo:this.payInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus,company:this.company,qrcodedata:this.qrcodedata}),this.presentAlertConfirm(),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success"),this.prepareInvo(),this.status="new"},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveitemList(){return(0,o.mG)(this,void 0,void 0,function*(){this.api.saveSalesitemList(this.itemList).subscribe(e=>{this.recalSubBalance(),this.printArr=[],this.printArr.push({payInvo:this.payInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus,company:this.company,qrcodedata:this.qrcodedata}),this.sales=this.sales.filter(u=>u.payInvo.pay_ref!=this.payInvo.pay_ref),this.sales.push({payInvo:this.payInvo,itemList:this.itemList});let i=[];i.push({payInvo:this.payInvo,itemList:this.itemList}),this.logHistoryArr.push({id:null,logRef:this.generateRandom2("insert sales"),userId:this.user_info.id,typee:"insert sales",datee:A(new Date).locale("en").format("YYYY-MM-DD HH:mm:ss"),logStatus:0,logToken:JSON.stringify(i[0]),yearId:this.year.id,store_id:this.store_info.id}),"toFinal"==this.status&&this.deleteSalesInvoInit(),this.performSync()},e=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})})}generateRandom2(e){let i=new Date,u=i.getMonth().toString()+i.getDay().toString()+i.getHours().toString()+i.getMinutes().toString()+i.getSeconds().toString()+i.getMilliseconds().toString()+e;return this.store_info.store_ref+u}deleteInitInvo(){}prepareQrcode(){const u=(0,r.p6)(this.payInvo.pay_date,"yyyy-MM-dd","en-US")+"T"+this.payInvo.pay_time+"Z";console.log(u);const _=this.stringToHex(this.company.engName);let k=this.toHex(this.company.engName.length.toFixed(0));1==k.length&&(k="0"+k);const Y="01"+k+_;console.log("company",_,k,Y);const st=this.stringToHex(this.company.vatNo.toString());let V=this.toHex(this.company.vatNo.toString().length.toFixed(0));1==V.length&&(V="0"+V);const nt="02"+V+st;console.log("companyVat",st,V,nt);const ot=this.stringToHex(u.toString());let z=this.toHex(u.toString().length.toFixed(0));1==z.length&&(z="0"+z);const rt="03"+z+ot;console.log("dateTime",ot,z,rt);const U=this.stringToHex(this.taxAll.toFixed(2).toString());let W=this.toHex(this.taxAll.toFixed(2).toString().length.toFixed(0));1==W.length&&(W="0"+W);const dt="04"+W+U;console.log("total",U,W,dt);const gt=this.stringToHex(this.payInvo.taxTot.toFixed(2).toString());let $=this.toHex(this.payInvo.taxTot.toFixed(2).toString().length.toFixed(0));1==$.length&&($="0"+$);const ft="05"+$+gt;console.log("tax",gt,$,ft);const yt=btoa(Y+nt+rt+dt+ft);this.qrcodedata=yt,this.printArr[0].qrcodedata=this.qrcodedata,console.log(this.qrcodedata)}stringToHex(e){let i="";for(let u=0;u<e.length;u++)i+=this.toHex(e.charCodeAt(u));return i}toHex(e){return parseInt(e,10).toString(16)}presentModal(e,i){return(0,o.mG)(this,void 0,void 0,function*(){this.recalSubBalance(),this.prepareQrcode();const u=yield this.modalController.create({component:h.n,componentProps:{printArr:this.printArr,page:i}});return u.onDidDismiss().then(_=>{null!==_&&this.prepareInvo()}),yield u.present()})}presentLoadingWithOptions(e){return(0,o.mG)(this,void 0,void 0,function*(){const i=yield this.loadingController.create({spinner:"bubbles",mode:"ios",duration:5e3,message:e,translucent:!0,backdropDismiss:!1});yield i.present(),yield i.onDidDismiss()})}}return f.\u0275fac=function(e){return new(e||f)(t.Y36(I.H7),t.Y36(n.F0),t.Y36(s.t4),t.Y36(y.h),t.Y36(r.Ye),t.Y36(n.gz),t.Y36(t.Qsj),t.Y36(s.IN),t.Y36(s.Br),t.Y36(P.u),t.Y36(B.K),t.Y36(s.HT),t.Y36(r.uU),t.Y36(F.r),t.Y36(s.yF))},f.\u0275cmp=t.Xpm({type:f,selectors:[["app-pos-sales"]],viewQuery:function(e,i){if(1&e&&(t.Gf(b,5),t.Gf(L,5),t.Gf(C,5),t.Gf(m,5),t.Gf(M,5),t.Gf(T,5)),2&e){let u;t.iGM(u=t.CRH())&&(i.nameField=u.first),t.iGM(u=t.CRH())&&(i.dstPop=u.first),t.iGM(u=t.CRH())&&(i.qtyId=u.first),t.iGM(u=t.CRH())&&(i.popInput=u.first),t.iGM(u=t.CRH())&&(i.popover=u.first),t.iGM(u=t.CRH())&&(i.popoverNotif=u.first)}},decls:20,vars:5,consts:[["slot","start"],["slot","end"],[1,"poRel"],[1,"posAb","noti"],[4,"ngIf"],["fill","clear",1,"ion-margin",3,"click"],["name","wifi-outline",2,"font-size","20px",3,"color"],["color","dark",4,"ngIf"],["class","ion-margin-top",4,"ngIf"],["color","dark"],[1,"ion-margin-top"],["dir","rtl"],["size","12",1,"ion-no-padding"],["size","4"],["size","5"],[1,"items-container2"],[1,"table"],[3,"dblclick",4,"ngFor","ngForOf"],["size","3",1,"ion-no-padding"],["size","12",1,"ion-margin-top"],[1,"ion-padding"],["class","ion-justify-content-center",4,"ngIf"],["scrollable","true",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"items-container"],[3,"value"],["size","4",4,"ngFor","ngForOf"],[3,"click"],["alt","",3,"src"],[1,"item-title"],[1,"ion-text-center"],[3,"dblclick"],["fill","clear","size","small",3,"click"],["name","trash","color","danger"],[2,"max-width","100px","height","2.5em","overflow","hidden","text-overflow","ellipsis","display","-webkit-box","-webkit-line-clamp","2","-webkit-box-orient","vertical"],[1,"ion-justify-content-center"],["size","9",1,"ion-no-padding"],["size","2"],[1,"custInput"],[3,"ngModel","ngModelChange","ionChange"],[3,"ngModel","readonly","ngModelChange"],["expand","block","routerDirection","root","color","success",3,"click"],["size","256","level","'M'",3,"qrdata"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header"),t.TgZ(1,"ion-toolbar"),t.TgZ(2,"ion-buttons",0),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"\u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a"),t.qZA(),t.TgZ(6,"ion-buttons",1),t.TgZ(7,"div",2),t.TgZ(8,"div",3),t.TgZ(9,"ion-label"),t.YNc(10,v,2,1,"ion-text",4),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"ion-button",5),t.NdJ("click",function(){return i.changeMode()}),t.TgZ(12,"ion-label"),t._UZ(13,"ion-icon",6),t.qZA(),t.TgZ(14,"ion-label"),t.YNc(15,Z,2,0,"ion-text",7),t.qZA(),t.TgZ(16,"ion-label"),t.YNc(17,x,2,0,"ion-text",7),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"ion-content"),t.YNc(19,tt,50,7,"ion-grid",8),t.qZA()),2&e&&(t.xp6(10),t.Q6J("ngIf",1==i.showNotif&&i.notifArr.length>0),t.xp6(3),t.Q6J("color",i.color),t.xp6(2),t.Q6J("ngIf","primary"==i.color),t.xp6(2),t.Q6J("ngIf","dark"==i.color),t.xp6(2),t.Q6J("ngIf",i.user_info&&i.store_info))},directives:[s.Gu,s.sr,s.Sm,s.fG,s.wd,s.Q$,r.O5,s.YG,s.gu,s.W2,s.yW,s.jY,s.Nd,s.wI,s.PM,r.sg,s.cJ,s.QI,s.GO,s.Ie,s.pK,s.j9,a.JJ,a.On,E],styles:[".custInput[_ngcontent-%COMP%]{border-style:solid;border-color:var(--ion-color-light);border-radius:5px}.cust-card[_ngcontent-%COMP%]{border-radius:5px}.show[_ngcontent-%COMP%]{visibility:visible}.hide[_ngcontent-%COMP%]{visibility:hidden}.custRow[_ngcontent-%COMP%]{margin-top:5rem}.bnone[_ngcontent-%COMP%]{border:none}.items-container[_ngcontent-%COMP%]{overflow:auto;white-space:nowrap;min-height:300px;max-height:300px}.items-container2[_ngcontent-%COMP%]{overflow:auto;white-space:nowrap;min-height:385px;max-height:385px}.item-title[_ngcontent-%COMP%]{height:2em;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}ion-segment[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:hidden;white-space:nowrap}ion-segment-button[_ngcontent-%COMP%]{display:inline-block}.red[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.darko[_ngcontent-%COMP%]{color:var(--ion-color-dark)}ion-popover[_ngcontent-%COMP%]{--offset-y: -30px }.custInp[_ngcontent-%COMP%]{border-right-style:solid;border-right-width:.5px;text-align:center}.table[_ngcontent-%COMP%]{text-align:center;width:100%;margin:12px}tr[_ngcontent-%COMP%]:nth-child(even){background-color:#ddd}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:center;padding:8px;font-size:14px;font-weight:700;color:#000}"]}),f})()}];let j=(()=>{class f{}return f.\u0275fac=function(e){return new(e||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({imports:[[n.Bz.forChild(lt)],n.Bz]}),f})(),it=(()=>{class f{}return f.\u0275fac=function(e){return new(e||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({imports:[[r.ez,a.u5,s.Pc,S,j]]}),f})()},74901:N=>{"use strict";var c={single_source_shortest_paths:function(l,r,a){var s={},n={};n[r]=0;var h,g,d,p,A,I,o=c.PriorityQueue.make();for(o.push(r,0);!o.empty();)for(d in p=(h=o.pop()).cost,A=l[g=h.value]||{})A.hasOwnProperty(d)&&(I=p+A[d],(void 0===n[d]||n[d]>I)&&(n[d]=I,o.push(d,I),s[d]=g));if(void 0!==a&&void 0===n[a]){var B=["Could not find a path from ",r," to ",a,"."].join("");throw new Error(B)}return s},extract_shortest_path_from_predecessor_list:function(l,r){for(var a=[],s=r;s;)a.push(s),s=l[s];return a.reverse(),a},find_path:function(l,r,a){var s=c.single_source_shortest_paths(l,r,a);return c.extract_shortest_path_from_predecessor_list(s,a)},PriorityQueue:{make:function(l){var s,r=c.PriorityQueue,a={};for(s in l=l||{},r)r.hasOwnProperty(s)&&(a[s]=r[s]);return a.queue=[],a.sorter=l.sorter||r.default_sorter,a},default_sorter:function(l,r){return l.cost-r.cost},push:function(l,r){this.queue.push({value:l,cost:r}),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};N.exports=c},38419:N=>{"use strict";N.exports=function(l){for(var r=[],a=l.length,s=0;s<a;s++){var n=l.charCodeAt(s);if(n>=55296&&n<=56319&&a>s+1){var o=l.charCodeAt(s+1);o>=56320&&o<=57343&&(n=1024*(n-55296)+o-56320+65536,s+=1)}n<128?r.push(n):n<2048?(r.push(n>>6|192),r.push(63&n|128)):n<55296||n>=57344&&n<65536?(r.push(n>>12|224),r.push(n>>6&63|128),r.push(63&n|128)):n>=65536&&n<=1114111?(r.push(n>>18|240),r.push(n>>12&63|128),r.push(n>>6&63|128),r.push(63&n|128)):r.push(239,191,189)}return new Uint8Array(r).buffer}},3259:(N,c,l)=>{const a=l(88695),s=l(71465),n=l(23210),o=l(22334);function h(g,d,p,A,t){const I=[].slice.call(arguments,1),y=I.length,P="function"==typeof I[y-1];if(!P&&!a())throw new Error("Callback required as last argument");if(!P){if(y<1)throw new Error("Too few arguments provided");return 1===y?(p=d,d=A=void 0):2===y&&!d.getContext&&(A=p,p=d,d=void 0),new Promise(function(B,F){try{const w=s.create(p,A);B(g(w,d,A))}catch(w){F(w)}})}if(y<2)throw new Error("Too few arguments provided");2===y?(t=p,p=d,d=A=void 0):3===y&&(d.getContext&&void 0===t?(t=A,A=void 0):(t=A,A=p,p=d,d=void 0));try{const B=s.create(p,A);t(null,g(B,d,A))}catch(B){t(B)}}c.rT=h.bind(null,n.render),c.hz=h.bind(null,n.renderToDataURL),c.toString=h.bind(null,function(g,d,p){return o.render(g,p)})},88695:N=>{N.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},46221:(N,c,l)=>{const r=l(34792).getSymbolSize;c.getRowColCoords=function(s){if(1===s)return[];const n=Math.floor(s/7)+2,o=r(s),h=145===o?26:2*Math.ceil((o-13)/(2*n-2)),g=[o-7];for(let d=1;d<n-1;d++)g[d]=g[d-1]-h;return g.push(6),g.reverse()},c.getPositions=function(s){const n=[],o=c.getRowColCoords(s),h=o.length;for(let g=0;g<h;g++)for(let d=0;d<h;d++)0===g&&0===d||0===g&&d===h-1||g===h-1&&0===d||n.push([o[g],o[d]]);return n}},32424:(N,c,l)=>{const r=l(64016),a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(n){this.mode=r.ALPHANUMERIC,this.data=n}s.getBitsLength=function(o){return 11*Math.floor(o/2)+o%2*6},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(o){let h;for(h=0;h+2<=this.data.length;h+=2){let g=45*a.indexOf(this.data[h]);g+=a.indexOf(this.data[h+1]),o.put(g,11)}this.data.length%2&&o.put(a.indexOf(this.data[h]),6)},N.exports=s},52118:N=>{function c(){this.buffer=[],this.length=0}c.prototype={get:function(l){const r=Math.floor(l/8);return 1==(this.buffer[r]>>>7-l%8&1)},put:function(l,r){for(let a=0;a<r;a++)this.putBit(1==(l>>>r-a-1&1))},getLengthInBits:function(){return this.length},putBit:function(l){const r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),l&&(this.buffer[r]|=128>>>this.length%8),this.length++}},N.exports=c},34425:N=>{function c(l){if(!l||l<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=l,this.data=new Uint8Array(l*l),this.reservedBit=new Uint8Array(l*l)}c.prototype.set=function(l,r,a,s){const n=l*this.size+r;this.data[n]=a,s&&(this.reservedBit[n]=!0)},c.prototype.get=function(l,r){return this.data[l*this.size+r]},c.prototype.xor=function(l,r,a){this.data[l*this.size+r]^=a},c.prototype.isReserved=function(l,r){return this.reservedBit[l*this.size+r]},N.exports=c},85663:(N,c,l)=>{const r=l(38419),a=l(64016);function s(n){this.mode=a.BYTE,this.data=new Uint8Array(r(n))}s.getBitsLength=function(o){return 8*o},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(n){for(let o=0,h=this.data.length;o<h;o++)n.put(this.data[o],8)},N.exports=s},14655:(N,c,l)=>{const r=l(82259),a=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];c.getBlocksCount=function(o,h){switch(h){case r.L:return a[4*(o-1)+0];case r.M:return a[4*(o-1)+1];case r.Q:return a[4*(o-1)+2];case r.H:return a[4*(o-1)+3];default:return}},c.getTotalCodewordsCount=function(o,h){switch(h){case r.L:return s[4*(o-1)+0];case r.M:return s[4*(o-1)+1];case r.Q:return s[4*(o-1)+2];case r.H:return s[4*(o-1)+3];default:return}}},82259:(N,c)=>{c.L={bit:1},c.M={bit:0},c.Q={bit:3},c.H={bit:2},c.isValid=function(a){return a&&void 0!==a.bit&&a.bit>=0&&a.bit<4},c.from=function(a,s){if(c.isValid(a))return a;try{return function l(r){if("string"!=typeof r)throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return c.L;case"m":case"medium":return c.M;case"q":case"quartile":return c.Q;case"h":case"high":return c.H;default:throw new Error("Unknown EC Level: "+r)}}(a)}catch(n){return s}}},43114:(N,c,l)=>{const r=l(34792).getSymbolSize;c.getPositions=function(n){const o=r(n);return[[0,0],[o-7,0],[0,o-7]]}},17078:(N,c,l)=>{const r=l(34792),n=r.getBCHDigit(1335);c.getEncodedBits=function(h,g){const d=h.bit<<3|g;let p=d<<10;for(;r.getBCHDigit(p)-n>=0;)p^=1335<<r.getBCHDigit(p)-n;return 21522^(d<<10|p)}},45339:(N,c)=>{const l=new Uint8Array(512),r=new Uint8Array(256);(function(){let s=1;for(let n=0;n<255;n++)l[n]=s,r[s]=n,s<<=1,256&s&&(s^=285);for(let n=255;n<512;n++)l[n]=l[n-255]})(),c.log=function(s){if(s<1)throw new Error("log("+s+")");return r[s]},c.exp=function(s){return l[s]},c.mul=function(s,n){return 0===s||0===n?0:l[r[s]+r[n]]}},80449:(N,c,l)=>{const r=l(64016),a=l(34792);function s(n){this.mode=r.KANJI,this.data=n}s.getBitsLength=function(o){return 13*o},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(n){let o;for(o=0;o<this.data.length;o++){let h=a.toSJIS(this.data[o]);if(h>=33088&&h<=40956)h-=33088;else{if(!(h>=57408&&h<=60351))throw new Error("Invalid SJIS character: "+this.data[o]+"\nMake sure your charset is UTF-8");h-=49472}h=192*(h>>>8&255)+(255&h),n.put(h,13)}},N.exports=s},33667:(N,c)=>{c.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};function r(a,s,n){switch(a){case c.Patterns.PATTERN000:return(s+n)%2==0;case c.Patterns.PATTERN001:return s%2==0;case c.Patterns.PATTERN010:return n%3==0;case c.Patterns.PATTERN011:return(s+n)%3==0;case c.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(n/3))%2==0;case c.Patterns.PATTERN101:return s*n%2+s*n%3==0;case c.Patterns.PATTERN110:return(s*n%2+s*n%3)%2==0;case c.Patterns.PATTERN111:return(s*n%3+(s+n)%2)%2==0;default:throw new Error("bad maskPattern:"+a)}}c.isValid=function(s){return null!=s&&""!==s&&!isNaN(s)&&s>=0&&s<=7},c.from=function(s){return c.isValid(s)?parseInt(s,10):void 0},c.getPenaltyN1=function(s){const n=s.size;let o=0,h=0,g=0,d=null,p=null;for(let A=0;A<n;A++){h=g=0,d=p=null;for(let t=0;t<n;t++){let I=s.get(A,t);I===d?h++:(h>=5&&(o+=h-5+3),d=I,h=1),I=s.get(t,A),I===p?g++:(g>=5&&(o+=g-5+3),p=I,g=1)}h>=5&&(o+=h-5+3),g>=5&&(o+=g-5+3)}return o},c.getPenaltyN2=function(s){const n=s.size;let o=0;for(let h=0;h<n-1;h++)for(let g=0;g<n-1;g++){const d=s.get(h,g)+s.get(h,g+1)+s.get(h+1,g)+s.get(h+1,g+1);(4===d||0===d)&&o++}return 3*o},c.getPenaltyN3=function(s){const n=s.size;let o=0,h=0,g=0;for(let d=0;d<n;d++){h=g=0;for(let p=0;p<n;p++)h=h<<1&2047|s.get(d,p),p>=10&&(1488===h||93===h)&&o++,g=g<<1&2047|s.get(p,d),p>=10&&(1488===g||93===g)&&o++}return 40*o},c.getPenaltyN4=function(s){let n=0;const o=s.data.length;for(let g=0;g<o;g++)n+=s.data[g];return 10*Math.abs(Math.ceil(100*n/o/5)-10)},c.applyMask=function(s,n){const o=n.size;for(let h=0;h<o;h++)for(let g=0;g<o;g++)n.isReserved(g,h)||n.xor(g,h,r(s,g,h))},c.getBestMask=function(s,n){const o=Object.keys(c.Patterns).length;let h=0,g=1/0;for(let d=0;d<o;d++){n(d),c.applyMask(d,s);const p=c.getPenaltyN1(s)+c.getPenaltyN2(s)+c.getPenaltyN3(s)+c.getPenaltyN4(s);c.applyMask(d,s),p<g&&(g=p,h=d)}return h}},64016:(N,c,l)=>{const r=l(94406),a=l(2699);c.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},c.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},c.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},c.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},c.MIXED={bit:-1},c.getCharCountIndicator=function(o,h){if(!o.ccBits)throw new Error("Invalid mode: "+o);if(!r.isValid(h))throw new Error("Invalid version: "+h);return h>=1&&h<10?o.ccBits[0]:h<27?o.ccBits[1]:o.ccBits[2]},c.getBestModeForData=function(o){return a.testNumeric(o)?c.NUMERIC:a.testAlphanumeric(o)?c.ALPHANUMERIC:a.testKanji(o)?c.KANJI:c.BYTE},c.toString=function(o){if(o&&o.id)return o.id;throw new Error("Invalid mode")},c.isValid=function(o){return o&&o.bit&&o.ccBits},c.from=function(o,h){if(c.isValid(o))return o;try{return function s(n){if("string"!=typeof n)throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return c.NUMERIC;case"alphanumeric":return c.ALPHANUMERIC;case"kanji":return c.KANJI;case"byte":return c.BYTE;default:throw new Error("Unknown mode: "+n)}}(o)}catch(g){return h}}},97783:(N,c,l)=>{const r=l(64016);function a(s){this.mode=r.NUMERIC,this.data=s.toString()}a.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(n){let o,h,g;for(o=0;o+3<=this.data.length;o+=3)h=this.data.substr(o,3),g=parseInt(h,10),n.put(g,10);const d=this.data.length-o;d>0&&(h=this.data.substr(o),g=parseInt(h,10),n.put(g,3*d+1))},N.exports=a},61106:(N,c,l)=>{const r=l(45339);c.mul=function(s,n){const o=new Uint8Array(s.length+n.length-1);for(let h=0;h<s.length;h++)for(let g=0;g<n.length;g++)o[h+g]^=r.mul(s[h],n[g]);return o},c.mod=function(s,n){let o=new Uint8Array(s);for(;o.length-n.length>=0;){const h=o[0];for(let d=0;d<n.length;d++)o[d]^=r.mul(n[d],h);let g=0;for(;g<o.length&&0===o[g];)g++;o=o.slice(g)}return o},c.generateECPolynomial=function(s){let n=new Uint8Array([1]);for(let o=0;o<s;o++)n=c.mul(n,new Uint8Array([1,r.exp(o)]));return n}},71465:(N,c,l)=>{const r=l(34792),a=l(82259),s=l(52118),n=l(34425),o=l(46221),h=l(43114),g=l(33667),d=l(14655),p=l(12636),A=l(42088),t=l(17078),I=l(64016),y=l(62033);function q(b,L,C){const m=b.size,M=t.getEncodedBits(L,C);let T,v;for(T=0;T<15;T++)v=1==(M>>T&1),b.set(T<6?T:T<8?T+1:m-15+T,8,v,!0),b.set(8,T<8?m-T-1:T<9?15-T-1+1:15-T-1,v,!0);b.set(m-8,8,1,!0)}function H(b,L,C,m){let M;if(Array.isArray(b))M=y.fromArray(b);else{if("string"!=typeof b)throw new Error("Invalid data");{let O=L;if(!O){const J=y.rawSplit(b);O=A.getBestVersionForData(J,C)}M=y.fromString(b,O||40)}}const T=A.getBestVersionForData(M,C);if(!T)throw new Error("The amount of data is too big to be stored in a QR Code");if(L){if(L<T)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+T+".\n")}else L=T;const v=function S(b,L,C){const m=new s;C.forEach(function(x){m.put(x.mode.bit,4),m.put(x.getLength(),I.getCharCountIndicator(x.mode,b)),x.write(m)});const v=8*(r.getSymbolTotalCodewords(b)-d.getTotalCodewordsCount(b,L));for(m.getLengthInBits()+4<=v&&m.put(0,4);m.getLengthInBits()%8!=0;)m.putBit(0);const Z=(v-m.getLengthInBits())/8;for(let x=0;x<Z;x++)m.put(x%2?17:236,8);return function Q(b,L,C){const m=r.getSymbolTotalCodewords(L),T=m-d.getTotalCodewordsCount(L,C),v=d.getBlocksCount(L,C),x=v-m%v,O=Math.floor(m/v),J=Math.floor(T/v),at=J+1,X=O-J,ct=new p(X);let K=0;const G=new Array(v),tt=new Array(v);let et=0;const lt=new Uint8Array(b.buffer);for(let e=0;e<v;e++){const i=e<x?J:at;G[e]=lt.slice(K,K+i),tt[e]=ct.encode(G[e]),K+=i,et=Math.max(et,i)}const j=new Uint8Array(m);let f,R,it=0;for(f=0;f<et;f++)for(R=0;R<v;R++)f<G[R].length&&(j[it++]=G[R][f]);for(f=0;f<X;f++)for(R=0;R<v;R++)j[it++]=tt[R][f];return j}(m,b,L)}(L,C,M),Z=r.getSymbolSize(L),x=new n(Z);return function P(b,L){const C=b.size,m=h.getPositions(L);for(let M=0;M<m.length;M++){const T=m[M][0],v=m[M][1];for(let Z=-1;Z<=7;Z++)if(!(T+Z<=-1||C<=T+Z))for(let x=-1;x<=7;x++)v+x<=-1||C<=v+x||b.set(T+Z,v+x,Z>=0&&Z<=6&&(0===x||6===x)||x>=0&&x<=6&&(0===Z||6===Z)||Z>=2&&Z<=4&&x>=2&&x<=4,!0)}}(x,L),function B(b){const L=b.size;for(let C=8;C<L-8;C++){const m=C%2==0;b.set(C,6,m,!0),b.set(6,C,m,!0)}}(x),function F(b,L){const C=o.getPositions(L);for(let m=0;m<C.length;m++){const M=C[m][0],T=C[m][1];for(let v=-2;v<=2;v++)for(let Z=-2;Z<=2;Z++)b.set(M+v,T+Z,-2===v||2===v||-2===Z||2===Z||0===v&&0===Z,!0)}}(x,L),q(x,C,0),L>=7&&function w(b,L){const C=b.size,m=A.getEncodedBits(L);let M,T,v;for(let Z=0;Z<18;Z++)M=Math.floor(Z/3),T=Z%3+C-8-3,v=1==(m>>Z&1),b.set(M,T,v,!0),b.set(T,M,v,!0)}(x,L),function E(b,L){const C=b.size;let m=-1,M=C-1,T=7,v=0;for(let Z=C-1;Z>0;Z-=2)for(6===Z&&Z--;;){for(let x=0;x<2;x++)if(!b.isReserved(M,Z-x)){let O=!1;v<L.length&&(O=1==(L[v]>>>T&1)),b.set(M,Z-x,O),T--,-1===T&&(v++,T=7)}if(M+=m,M<0||C<=M){M-=m,m=-m;break}}}(x,v),isNaN(m)&&(m=g.getBestMask(x,q.bind(null,x,C))),g.applyMask(m,x),q(x,C,m),{modules:x,version:L,errorCorrectionLevel:C,maskPattern:m,segments:M}}c.create=function(L,C){if(void 0===L||""===L)throw new Error("No input text");let M,T,m=a.M;return void 0!==C&&(m=a.from(C.errorCorrectionLevel,a.M),M=A.from(C.version),T=g.from(C.maskPattern),C.toSJISFunc&&r.setToSJISFunction(C.toSJISFunc)),H(L,M,m,T)}},12636:(N,c,l)=>{const r=l(61106);function a(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}a.prototype.initialize=function(n){this.degree=n,this.genPoly=r.generateECPolynomial(this.degree)},a.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const o=new Uint8Array(n.length+this.degree);o.set(n);const h=r.mod(o,this.genPoly),g=this.degree-h.length;if(g>0){const d=new Uint8Array(this.degree);return d.set(h,g),d}return h},N.exports=a},2699:(N,c)=>{const l="[0-9]+";let a="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";a=a.replace(/u/g,"\\u");const s="(?:(?![A-Z0-9 $%*+\\-./:]|"+a+")(?:.|[\r\n]))+";c.KANJI=new RegExp(a,"g"),c.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),c.BYTE=new RegExp(s,"g"),c.NUMERIC=new RegExp(l,"g"),c.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const n=new RegExp("^"+a+"$"),o=new RegExp("^"+l+"$"),h=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");c.testKanji=function(d){return n.test(d)},c.testNumeric=function(d){return o.test(d)},c.testAlphanumeric=function(d){return h.test(d)}},62033:(N,c,l)=>{const r=l(64016),a=l(97783),s=l(32424),n=l(85663),o=l(80449),h=l(2699),g=l(34792),d=l(74901);function p(w){return unescape(encodeURIComponent(w)).length}function A(w,q,E){const S=[];let Q;for(;null!==(Q=w.exec(E));)S.push({data:Q[0],index:Q.index,mode:q,length:Q[0].length});return S}function t(w){const q=A(h.NUMERIC,r.NUMERIC,w),E=A(h.ALPHANUMERIC,r.ALPHANUMERIC,w);let S,Q;return g.isKanjiModeEnabled()?(S=A(h.BYTE,r.BYTE,w),Q=A(h.KANJI,r.KANJI,w)):(S=A(h.BYTE_KANJI,r.BYTE,w),Q=[]),q.concat(E,S,Q).sort(function(b,L){return b.index-L.index}).map(function(b){return{data:b.data,mode:b.mode,length:b.length}})}function I(w,q){switch(q){case r.NUMERIC:return a.getBitsLength(w);case r.ALPHANUMERIC:return s.getBitsLength(w);case r.KANJI:return o.getBitsLength(w);case r.BYTE:return n.getBitsLength(w)}}function F(w,q){let E;const S=r.getBestModeForData(w);if(E=r.from(q,S),E!==r.BYTE&&E.bit<S.bit)throw new Error('"'+w+'" cannot be encoded with mode '+r.toString(E)+".\n Suggested mode is: "+r.toString(S));switch(E===r.KANJI&&!g.isKanjiModeEnabled()&&(E=r.BYTE),E){case r.NUMERIC:return new a(w);case r.ALPHANUMERIC:return new s(w);case r.KANJI:return new o(w);case r.BYTE:return new n(w)}}c.fromArray=function(q){return q.reduce(function(E,S){return"string"==typeof S?E.push(F(S,null)):S.data&&E.push(F(S.data,S.mode)),E},[])},c.fromString=function(q,E){const Q=function P(w){const q=[];for(let E=0;E<w.length;E++){const S=w[E];switch(S.mode){case r.NUMERIC:q.push([S,{data:S.data,mode:r.ALPHANUMERIC,length:S.length},{data:S.data,mode:r.BYTE,length:S.length}]);break;case r.ALPHANUMERIC:q.push([S,{data:S.data,mode:r.BYTE,length:S.length}]);break;case r.KANJI:q.push([S,{data:S.data,mode:r.BYTE,length:p(S.data)}]);break;case r.BYTE:q.push([{data:S.data,mode:r.BYTE,length:p(S.data)}])}}return q}(t(q,g.isKanjiModeEnabled())),H=function B(w,q){const E={},S={start:{}};let Q=["start"];for(let H=0;H<w.length;H++){const b=w[H],L=[];for(let C=0;C<b.length;C++){const m=b[C],M=""+H+C;L.push(M),E[M]={node:m,lastCount:0},S[M]={};for(let T=0;T<Q.length;T++){const v=Q[T];E[v]&&E[v].node.mode===m.mode?(S[v][M]=I(E[v].lastCount+m.length,m.mode)-I(E[v].lastCount,m.mode),E[v].lastCount+=m.length):(E[v]&&(E[v].lastCount=m.length),S[v][M]=I(m.length,m.mode)+4+r.getCharCountIndicator(m.mode,q))}}Q=L}for(let H=0;H<Q.length;H++)S[Q[H]].end=0;return{map:S,table:E}}(Q,E),b=d.find_path(H.map,"start","end"),L=[];for(let C=1;C<b.length-1;C++)L.push(H.table[b[C]].node);return c.fromArray(function y(w){return w.reduce(function(q,E){const S=q.length-1>=0?q[q.length-1]:null;return S&&S.mode===E.mode?(q[q.length-1].data+=E.data,q):(q.push(E),q)},[])}(L))},c.rawSplit=function(q){return c.fromArray(t(q,g.isKanjiModeEnabled()))}},34792:(N,c)=>{let l;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];c.getSymbolSize=function(s){if(!s)throw new Error('"version" cannot be null or undefined');if(s<1||s>40)throw new Error('"version" should be in range from 1 to 40');return 4*s+17},c.getSymbolTotalCodewords=function(s){return r[s]},c.getBCHDigit=function(a){let s=0;for(;0!==a;)s++,a>>>=1;return s},c.setToSJISFunction=function(s){if("function"!=typeof s)throw new Error('"toSJISFunc" is not a valid function.');l=s},c.isKanjiModeEnabled=function(){return void 0!==l},c.toSJIS=function(s){return l(s)}},94406:(N,c)=>{c.isValid=function(r){return!isNaN(r)&&r>=1&&r<=40}},42088:(N,c,l)=>{const r=l(34792),a=l(14655),s=l(82259),n=l(64016),o=l(94406),g=r.getBCHDigit(7973);function p(I,y){return n.getCharCountIndicator(I,y)+4}function A(I,y){let P=0;return I.forEach(function(B){P+=p(B.mode,y)+B.getBitsLength()}),P}c.from=function(y,P){return o.isValid(y)?parseInt(y,10):P},c.getCapacity=function(y,P,B){if(!o.isValid(y))throw new Error("Invalid QR Code version");void 0===B&&(B=n.BYTE);const q=8*(r.getSymbolTotalCodewords(y)-a.getTotalCodewordsCount(y,P));if(B===n.MIXED)return q;const E=q-p(B,y);switch(B){case n.NUMERIC:return Math.floor(E/10*3);case n.ALPHANUMERIC:return Math.floor(E/11*2);case n.KANJI:return Math.floor(E/13);default:return Math.floor(E/8)}},c.getBestVersionForData=function(y,P){let B;const F=s.from(P,s.M);if(Array.isArray(y)){if(y.length>1)return function t(I,y){for(let P=1;P<=40;P++)if(A(I,P)<=c.getCapacity(P,y,n.MIXED))return P}(y,F);if(0===y.length)return 1;B=y[0]}else B=y;return function d(I,y,P){for(let B=1;B<=40;B++)if(y<=c.getCapacity(B,P,I))return B}(B.mode,B.getLength(),F)},c.getEncodedBits=function(y){if(!o.isValid(y)||y<7)throw new Error("Invalid QR Code version");let P=y<<12;for(;r.getBCHDigit(P)-g>=0;)P^=7973<<r.getBCHDigit(P)-g;return y<<12|P}},23210:(N,c,l)=>{const r=l(36355);c.render=function(o,h,g){let d=g,p=h;void 0===d&&(!h||!h.getContext)&&(d=h,h=void 0),h||(p=function s(){try{return document.createElement("canvas")}catch(n){throw new Error("You need to specify a canvas element")}}()),d=r.getOptions(d);const A=r.getImageWidth(o.modules.size,d),t=p.getContext("2d"),I=t.createImageData(A,A);return r.qrToImageData(I.data,o,d),function a(n,o,h){n.clearRect(0,0,o.width,o.height),o.style||(o.style={}),o.height=h,o.width=h,o.style.height=h+"px",o.style.width=h+"px"}(t,p,A),t.putImageData(I,0,0),p},c.renderToDataURL=function(o,h,g){let d=g;return void 0===d&&(!h||!h.getContext)&&(d=h,h=void 0),d||(d={}),c.render(o,h,d).toDataURL(d.type||"image/png",(d.rendererOpts||{}).quality)}},22334:(N,c,l)=>{const r=l(36355);function a(o,h){const g=o.a/255,d=h+'="'+o.hex+'"';return g<1?d+" "+h+'-opacity="'+g.toFixed(2).slice(1)+'"':d}function s(o,h,g){let d=o+h;return void 0!==g&&(d+=" "+g),d}c.render=function(h,g,d){const p=r.getOptions(g),A=h.modules.size,t=h.modules.data,I=A+2*p.margin,y=p.color.light.a?"<path "+a(p.color.light,"fill")+' d="M0 0h'+I+"v"+I+'H0z"/>':"",P="<path "+a(p.color.dark,"stroke")+' d="'+function n(o,h,g){let d="",p=0,A=!1,t=0;for(let I=0;I<o.length;I++){const y=Math.floor(I%h),P=Math.floor(I/h);!y&&!A&&(A=!0),o[I]?(t++,I>0&&y>0&&o[I-1]||(d+=A?s("M",y+g,.5+P+g):s("m",p,0),p=0,A=!1),y+1<h&&o[I+1]||(d+=s("h",t),t=0)):p++}return d}(t,A,p.margin)+'"/>',w='<svg xmlns="http://www.w3.org/2000/svg" '+(p.width?'width="'+p.width+'" height="'+p.width+'" ':"")+'viewBox="0 0 '+I+" "+I+'" shape-rendering="crispEdges">'+y+P+"</svg>\n";return"function"==typeof d&&d(null,w),w}},36355:(N,c)=>{function l(r){if("number"==typeof r&&(r=r.toString()),"string"!=typeof r)throw new Error("Color should be defined as hex string");let a=r.slice().replace("#","").split("");if(a.length<3||5===a.length||a.length>8)throw new Error("Invalid hex color: "+r);(3===a.length||4===a.length)&&(a=Array.prototype.concat.apply([],a.map(function(n){return[n,n]}))),6===a.length&&a.push("F","F");const s=parseInt(a.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:255&s,hex:"#"+a.slice(0,6).join("")}}c.getOptions=function(a){a||(a={}),a.color||(a.color={});const n=a.width&&a.width>=21?a.width:void 0;return{width:n,scale:n?4:a.scale||4,margin:null==a.margin||a.margin<0?4:a.margin,color:{dark:l(a.color.dark||"#000000ff"),light:l(a.color.light||"#ffffffff")},type:a.type,rendererOpts:a.rendererOpts||{}}},c.getScale=function(a,s){return s.width&&s.width>=a+2*s.margin?s.width/(a+2*s.margin):s.scale},c.getImageWidth=function(a,s){const n=c.getScale(a,s);return Math.floor((a+2*s.margin)*n)},c.qrToImageData=function(a,s,n){const o=s.modules.size,h=s.modules.data,g=c.getScale(o,n),d=Math.floor((o+2*n.margin)*g),p=n.margin*g,A=[n.color.light,n.color.dark];for(let t=0;t<d;t++)for(let I=0;I<d;I++){let y=4*(t*d+I),P=n.color.light;t>=p&&I>=p&&t<d-p&&I<d-p&&(P=A[h[Math.floor((t-p)/g)*o+Math.floor((I-p)/g)]?1:0]),a[y++]=P.r,a[y++]=P.g,a[y++]=P.b,a[y]=P.a}}}}]);