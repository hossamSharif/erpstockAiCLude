"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3650],{90733:(q,J,f)=>{f.d(J,{a:()=>Y});var m=f(29863),K=f(23349);let Y=(()=>{class H{constructor(){this.hasData=!1,this.isLoading=!1,this.disabled=!1,this.exportPDF=new m.vpe,this.exportExcel=new m.vpe}onExportPDF(){this.hasData&&!this.isLoading&&!this.disabled&&this.exportPDF.emit()}onExportExcel(){this.hasData&&!this.isLoading&&!this.disabled&&this.exportExcel.emit()}}return H.\u0275fac=function(L){return new(L||H)},H.\u0275cmp=m.Xpm({type:H,selectors:[["app-export-buttons"]],inputs:{hasData:"hasData",isLoading:"isLoading",disabled:"disabled"},outputs:{exportPDF:"exportPDF",exportExcel:"exportExcel"},decls:9,vars:2,consts:[[1,"export-buttons"],["fill","outline","color","danger","size","small",1,"export-btn",3,"disabled","click"],["name","document-text-outline","slot","start"],[1,"export-text"],["fill","outline","color","success","size","small",1,"export-btn",3,"disabled","click"],["name","grid-outline","slot","start"]],template:function(L,I){1&L&&(m.TgZ(0,"div",0),m.TgZ(1,"ion-button",1),m.NdJ("click",function(){return I.onExportPDF()}),m._UZ(2,"ion-icon",2),m.TgZ(3,"span",3),m._uU(4,"PDF"),m.qZA(),m.qZA(),m.TgZ(5,"ion-button",4),m.NdJ("click",function(){return I.onExportExcel()}),m._UZ(6,"ion-icon",5),m.TgZ(7,"span",3),m._uU(8,"Excel"),m.qZA(),m.qZA(),m.qZA()),2&L&&(m.xp6(1),m.Q6J("disabled",!I.hasData||I.isLoading||I.disabled),m.xp6(4),m.Q6J("disabled",!I.hasData||I.isLoading||I.disabled))},directives:[K.YG,K.gu],styles:[".export-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.export-btn[_ngcontent-%COMP%]{--border-width: 1px;--border-radius: 6px;--padding-start: 12px;--padding-end: 12px;height:32px;font-size:12px}.export-btn[disabled][_ngcontent-%COMP%]{opacity:.4;pointer-events:none}.export-text[_ngcontent-%COMP%]{margin-left:4px;font-weight:500}@media (max-width: 768px){.export-buttons[_ngcontent-%COMP%]{gap:6px}.export-btn[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;height:28px;font-size:11px}.export-text[_ngcontent-%COMP%]{display:none}}"]}),H})()},62279:(q,J,f)=>{f.d(J,{m:()=>Q});var m=f(69808),K=f(34182),Y=f(23349),H=f(29863);let Q=(()=>{class L{}return L.\u0275fac=function(t){return new(t||L)},L.\u0275mod=H.oAB({type:L}),L.\u0275inj=H.cJS({imports:[[m.ez,K.u5,Y.Pc]]}),L})()},79002:(q,J,f)=>{f.d(J,{T:()=>Q});var m=f(70655),K=f(80574),Y=f(23349),H=f(29863);let Q=(()=>{class L{constructor(t){this.injector=t,this.MAX_ROWS_WARNING=1e3,this.MAX_ROWS_LIMIT=5e3}getToastController(){return this.toastController||(this.toastController=this.injector.get(Y.yF)),this.toastController}getLoadingController(){return this.loadingController||(this.loadingController=this.injector.get(Y.HT)),this.loadingController}getAlertController(){return this.alertController||(this.alertController=this.injector.get(Y.Br)),this.alertController}formatDate(t,o="yyyy-MM-dd HH:mm"){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return"yyyy-MM-dd HH:mm"===o?`${e}-${a}-${r} ${n}:${i}`:`${e}-${a}-${r}`}exportToPDF(t){return(0,m.mG)(this,void 0,void 0,function*(){if(!(yield this.checkDataSize(t.data.length)))return;const o=yield this.getLoadingController().create({message:"\u062c\u0627\u0631\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 PDF...",spinner:"crescent"});yield o.present();try{yield this.exportToPDFWithDirectArabicSupport(t),yield this.showSuccessToast("\u062a\u0645 \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 PDF \u0628\u0646\u062c\u0627\u062d \u0645\u0639 \u0627\u0644\u0646\u0635 \u0627\u0644\u0639\u0631\u0628\u064a \u0627\u0644\u0623\u0635\u0644\u064a")}catch(e){console.error("Direct Arabic PDF Export Error:",e),yield this.showErrorToast("\u0641\u0634\u0644 \u0641\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 PDF - \u064a\u0631\u062c\u0649 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649")}finally{yield o.dismiss()}})}exportToPDFWithDirectArabicSupport(t){return(0,m.mG)(this,void 0,void 0,function*(){try{console.log("\u{1f504} Starting direct Arabic-preserving PDF export...");const{PDFDocument:o,rgb:e,StandardFonts:a}=yield f.e(7479).then(f.bind(f,47479)),r=yield o.create();let n=r.addPage([842,595]);const{width:i,height:c}=n.getSize(),l=40,D=i-2*l;let s,w,A=!1;try{console.log("Attempting to load external Arabic font...");const $=yield fetch("https://fonts.gstatic.com/s/cairo/v28/SLXGc1nY6HkvalIkTp2mxdt0UX8gfO8_19co.woff2");if(!$.ok)throw new Error("External font loading failed");{const k=yield $.arrayBuffer();s=yield r.embedFont(k),w=s,A=!0,console.log("\u2705 Successfully loaded external Arabic font")}}catch($){console.warn("External Arabic font failed, trying TimesRoman:",$);try{s=yield r.embedFont(a.TimesRoman),w=yield r.embedFont(a.TimesRomanBold),console.log("\u2705 Using TimesRoman font")}catch(k){s=yield r.embedFont(a.Helvetica),w=yield r.embedFont(a.HelveticaBold),console.log("\u26a0\ufe0f Using Helvetica font as final fallback")}}const z=20;let p=c-l-30;try{n.drawText(t.title,{x:(i-s.widthOfTextAtSize(t.title,z))/2,y:p,size:z,font:w,color:e(.2,.3,.5)}),console.log("\u2705 Title drawn with original Arabic text")}catch($){console.warn("Title drawing failed, trying safer approach:",$),n.drawText("Stock Report",{x:(i-s.widthOfTextAtSize("Stock Report",z))/2,y:p,size:z,font:w,color:e(.2,.3,.5)})}if(p-=40,t.subtitle){try{n.drawText(t.subtitle,{x:(i-s.widthOfTextAtSize(t.subtitle,14))/2,y:p,size:14,font:s,color:e(.4,.4,.4)}),console.log("\u2705 Subtitle drawn with original Arabic text")}catch($){console.warn("Subtitle drawing failed:",$)}p-=25}const h=t.currentDate||this.formatDate(new Date,"yyyy-MM-dd");n.drawText(h,{x:(i-s.widthOfTextAtSize(h,12))/2,y:p,size:12,font:s,color:e(.5,.5,.5)}),p-=40;const v=t.columns.length,M=D/v,O=25,F=30;n.drawRectangle({x:l,y:p-F,width:D,height:F,color:e(.2,.4,.7)});let d=l;t.columns.forEach(($,k)=>{const P=$.title;console.log(`\u{1f4dd} Drawing header: "${P}" (Font: ${A?"Arabic":"Standard"})`);let b=!1;if(!b)try{const u=this.safeCalculateTextWidth(s,P,11);n.drawText(P,{x:Math.max(d+5,d+M-u-10),y:p-18,size:11,font:w,color:e(1,1,1)}),b=!0,console.log(`\u2705 Header "${P}" rendered successfully`)}catch(u){console.warn(`Strategy 1 failed for "${P}":`,u)}if(!b&&A)try{const u=this.cleanArabicForRendering(P),T=this.safeCalculateTextWidth(s,u,11);n.drawText(u,{x:Math.max(d+5,d+M-T-10),y:p-18,size:11,font:w,color:e(1,1,1)}),b=!0,console.log(`\u2705 Header "${u}" rendered with cleaned text`)}catch(u){console.warn(`Strategy 2 failed for "${P}":`,u)}if(!b)try{n.drawText(P,{x:d+10,y:p-18,size:11,font:w,color:e(1,1,1)}),b=!0,console.log(`\u26a0\ufe0f Header "${P}" rendered with standard approach`)}catch(u){console.error(`All strategies failed for "${P}":`,u);try{n.drawText(P,{x:d+5,y:p-18,size:9,font:s,color:e(1,1,1)}),b=!0,console.log("\u26a0\ufe0f Header rendered with minimal approach")}catch(T){console.error(`Final attempt failed for "${P}":`,T)}}k<v-1&&n.drawLine({start:{x:d+M,y:p},end:{x:d+M,y:p-F},thickness:1,color:e(.8,.8,.8)}),d+=M}),p-=F;const S=Math.floor((p-l-50)/O);let x=0,W=1;for(let $=0;$<t.data.length;$++){const k=t.data[$];x>=S&&(yield this.drawSimpleFooter(n,t,W,Math.ceil(t.data.length/S),s,i,l),n=r.addPage([842,595]),p=c-l-40,x=0,W++,n.drawRectangle({x:l,y:p-F,width:D,height:F,color:e(.2,.4,.7)}),d=l,t.columns.forEach((P,E)=>{const b=P.title;let u=!1;if(!u)try{const T=this.safeCalculateTextWidth(s,b,11);n.drawText(b,{x:Math.max(d+5,d+M-T-10),y:p-18,size:11,font:w,color:e(1,1,1)}),u=!0}catch(T){}if(!u)try{const T=this.cleanArabicForRendering(b);n.drawText(T,{x:d+10,y:p-18,size:11,font:w,color:e(1,1,1)}),u=!0}catch(T){}if(!u)try{n.drawText(b,{x:d+5,y:p-18,size:10,font:s,color:e(1,1,1)}),u=!0}catch(T){}E<v-1&&n.drawLine({start:{x:d+M,y:p},end:{x:d+M,y:p-F},thickness:1,color:e(.8,.8,.8)}),d+=M}),p-=F),$%2==0&&n.drawRectangle({x:l,y:p-O,width:D,height:O,color:e(.95,.95,.95)}),d=l,t.columns.forEach((P,E)=>{const b=this.getCellValue(k,P,$+1).toString(),u=10,T=M-10;let y=b,R=this.safeCalculateTextWidth(s,y,u);for(;R>T&&y.length>1;)y=y.slice(0,-1),R=this.safeCalculateTextWidth(s,y+"...",u);y!==b&&y.length>0&&(y+="...",R=this.safeCalculateTextWidth(s,y,u));let C=!1;if(!C)try{n.drawText(y,{x:Math.max(d+5,d+M-R-5),y:p-15,size:u,font:s,color:e(0,0,0)}),C=!0}catch(g){console.warn(`Cell text strategy 1 failed for "${y}":`,g)}if(!C&&this.detectArabicText(y))try{const g=this.cleanArabicForRendering(y),U=this.safeCalculateTextWidth(s,g,u);n.drawText(g,{x:Math.max(d+5,d+M-U-5),y:p-15,size:u,font:s,color:e(0,0,0)}),C=!0}catch(g){console.warn(`Cell text strategy 2 failed for "${y}":`,g)}if(!C)try{n.drawText(y,{x:d+5,y:p-15,size:u,font:s,color:e(0,0,0)}),C=!0}catch(g){console.warn(`Cell text strategy 3 failed for "${y}":`,g)}n.drawRectangle({x:d,y:p-O,width:M,height:O,borderColor:e(.8,.8,.8),borderWidth:.5}),d+=M}),p-=O,x++}const j=Math.ceil(t.data.length/S)||1;yield this.drawSimpleFooter(n,t,W,j,s,i,l);const B=yield r.save(),G=new Blob([B],{type:"application/pdf"}),V=URL.createObjectURL(G),X=document.createElement("a");X.href=V,X.download=`${t.fileName}.pdf`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(V),console.log("\u2705 PDF exported successfully with PRESERVED Arabic text!")}catch(o){throw console.error("\u274c Direct Arabic PDF export failed:",o),o}})}drawSimpleFooter(t,o,e,a,r,n,i){return(0,m.mG)(this,void 0,void 0,function*(){try{const{rgb:c}=yield f.e(7479).then(f.bind(f,47479)),l=i;try{t.drawText(`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`,{x:i,y:l,size:8,font:r,color:c(.4,.4,.4)})}catch(z){t.drawText(`User: ${o.userName}`,{x:i,y:l,size:8,font:r,color:c(.4,.4,.4)})}const D=`Page ${e} of ${a}`,s=r.widthOfTextAtSize(D,8);t.drawText(D,{x:(n-s)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const w=this.formatDate(new Date,"yyyy-MM-dd HH:mm"),A=r.widthOfTextAtSize(w,8);t.drawText(w,{x:n-i-A,y:l,size:8,font:r,color:c(.4,.4,.4)})}catch(c){console.warn("Footer drawing failed:",c)}})}safeCalculateTextWidth(t,o,e){try{return t.widthOfTextAtSize(o,e)}catch(a){return o.length*e*.6}}cleanArabicForRendering(t){return t&&t.replace(/[\u064B-\u0652]/g,"").replace(/[\u0653-\u0655]/g,"").replace(/[\u0670\u0640]/g,"").replace(/\u200C/g,"").replace(/\u200D/g,"").normalize("NFKC").trim()}detectArabicText(t){return!!t&&/[\u0600-\u06FF]/.test(t)}processTextForPDF(t){return this.detectArabicText(t)?{text:t,alignment:"right"}:{text:t,alignment:"left"}}exportToPDFWithModernLib(t){return(0,m.mG)(this,void 0,void 0,function*(){try{console.log("Using modern pdf-lib with native Arabic text support...");const{PDFDocument:o,rgb:e}=yield f.e(7479).then(f.bind(f,47479)),a=yield o.create();let r=a.addPage([842,595]);const{width:n,height:i}=r.getSize(),c=40,l=n-2*c;let s,w,A=!1;try{const b=yield this.loadArabicFont();s=yield a.embedFont(b),w=s,A=!0,console.log("\u2705 Arabic-compatible font embedded successfully")}catch(b){console.warn("\u274c Arabic font embedding failed, trying advanced built-in fonts:",b);try{const{StandardFonts:u}=yield f.e(7479).then(f.bind(f,47479));s=yield a.embedFont(u.TimesRoman),w=yield a.embedFont(u.TimesRomanBold),A=!0,console.log("\u26a0\ufe0f Using TimesRoman font with Unicode support")}catch(u){console.warn("\u274c TimesRoman failed, trying Helvetica");try{const{StandardFonts:T}=yield f.e(7479).then(f.bind(f,47479));s=yield a.embedFont(T.Helvetica),w=yield a.embedFont(T.HelveticaBold),A=!0,console.log("\u26a0\ufe0f Using Helvetica font - attempting Arabic support")}catch(T){console.warn("\u274c All font strategies failed, using enhanced Arabic text processing");const{StandardFonts:y}=yield f.e(7479).then(f.bind(f,47479));s=yield a.embedFont(y.Courier),w=s,A=!0,console.log("\u26a0\ufe0f Using Courier font with enhanced Arabic text processing")}}}const z=20,p=t.title,h=this.safeGetTextWidth(s,p,z);this.safeDrawText(r,p,{x:(n-h)/2,y:i-c-30,size:z,font:w,color:e(.2,.3,.5)});let v=i-c-60;if(t.subtitle){const b=t.subtitle,u=this.safeGetTextWidth(s,b,14);this.safeDrawText(r,b,{x:(n-u)/2,y:v,size:14,font:s,color:e(.4,.4,.4)}),v-=25}const M=t.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),O=this.safeGetTextWidth(s,M,12);this.safeDrawText(r,M,{x:(n-O)/2,y:v,size:12,font:s,color:e(.5,.5,.5)}),v-=40;const F=t.columns.length,d=l/F,S=25,x=30;r.drawRectangle({x:c,y:v-x,width:l,height:x,color:e(.2,.4,.7)});let W=c;t.columns.forEach((b,u)=>{const T=b.title,R=this.safeGetTextWidth(s,T,11);this.safeDrawText(r,T,{x:Math.max(W+5,W+d-10-R),y:v-18,size:11,font:w,color:e(1,1,1)}),u<F-1&&r.drawLine({start:{x:W+d,y:v},end:{x:W+d,y:v-x},thickness:1,color:e(.8,.8,.8)}),W+=d}),v-=x;const B=Math.floor((v-c-50)/S);let G=0,V=1;for(let b=0;b<t.data.length;b++){const u=t.data[b];if(G>=B){yield this.addModernPDFFooter(r,t,V,Math.ceil(t.data.length/B),s,n,c);const T=a.addPage([842,595]);r=T,v=i-c-40,G=0,V++,T.drawRectangle({x:c,y:v-x,width:l,height:x,color:e(.2,.4,.7)}),W=c,t.columns.forEach((y,R)=>{const C=y.title,U=this.safeGetTextWidth(s,C,11);this.safeDrawText(r,C,{x:Math.max(W+5,W+d-10-U),y:v-18,size:11,font:w,color:e(1,1,1)}),R<F-1&&T.drawLine({start:{x:W+d,y:v},end:{x:W+d,y:v-x},thickness:1,color:e(.8,.8,.8)}),W+=d}),v-=x}b%2==0&&r.drawRectangle({x:c,y:v-S,width:l,height:S,color:e(.95,.95,.95)}),W=c,t.columns.forEach((T,y)=>{const C=this.getCellValue(u,T,b+1).toString();let U=C;const N=d-10;let Z=this.safeGetTextWidth(s,U,10);for(;Z>N&&U.length>1;)U=U.slice(0,-1),Z=this.safeGetTextWidth(s,U+"...",10);U!==C&&(U+="..."),Z=this.safeGetTextWidth(s,U,10),this.safeDrawText(r,U,{x:Math.max(W+5,W+d-5-Z),y:v-15,size:10,font:s,color:e(0,0,0)}),r.drawRectangle({x:W,y:v-S,width:d,height:S,borderColor:e(.8,.8,.8),borderWidth:.5}),W+=d}),v-=S,G++}const X=Math.ceil(t.data.length/B)||1;this.addModernPDFFooter(r,t,V,X,s,n,c);const $=yield a.save(),k=new Blob([$],{type:"application/pdf"}),P=URL.createObjectURL(k),E=document.createElement("a");E.href=P,E.download=`${t.fileName}.pdf`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(P),console.log("PDF exported successfully with pdf-lib!")}catch(o){throw console.error("Modern PDF Export Error:",o),o}})}exportToPDFWithAlternativeMethod(t){return(0,m.mG)(this,void 0,void 0,function*(){try{console.log("Using alternative PDF export method with enhanced Arabic support...");const{PDFDocument:o,rgb:e,StandardFonts:a}=yield f.e(7479).then(f.bind(f,47479)),r=yield o.create();let n=r.addPage([842,595]);const{width:i,height:c}=n.getSize(),l=40,D=i-2*l,s=yield r.embedFont(a.Helvetica),w=yield r.embedFont(a.HelveticaBold);console.log("\u2705 Using Helvetica with enhanced Arabic text processing");const A=20,z=this.enhancedArabicTextProcessing(t.title),p=this.safeGetTextWidth(s,z,A);this.safeDrawText(n,z,{x:(i-p)/2,y:c-l-30,size:A,font:w,color:e(.2,.3,.5)});let h=c-l-60;if(t.subtitle){const E=this.enhancedArabicTextProcessing(t.subtitle),b=this.safeGetTextWidth(s,E,14);this.safeDrawText(n,E,{x:(i-b)/2,y:h,size:14,font:s,color:e(.4,.4,.4)}),h-=25}const v=t.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),M=this.safeGetTextWidth(s,v,12);this.safeDrawText(n,v,{x:(i-M)/2,y:h,size:12,font:s,color:e(.5,.5,.5)}),h-=40;const O=t.columns.length,F=D/O,d=25,S=30;n.drawRectangle({x:l,y:h-S,width:D,height:S,color:e(.2,.4,.7)});let x=l;t.columns.forEach((E,b)=>{const u=this.enhancedArabicTextProcessing(E.title),y=this.safeGetTextWidth(s,u,11);this.safeDrawText(n,u,{x:Math.max(x+5,x+F-10-y),y:h-18,size:11,font:w,color:e(1,1,1)}),b<O-1&&n.drawLine({start:{x:x+F,y:h},end:{x:x+F,y:h-S},thickness:1,color:e(.8,.8,.8)}),x+=F}),h-=S;const j=Math.floor((h-l-50)/d);let B=0,G=1;for(let E=0;E<t.data.length;E++){const b=t.data[E];B>=j&&(yield this.addEnhancedPDFFooter(n,t,G,Math.ceil(t.data.length/j),s,i,l),n=r.addPage([842,595]),h=c-l-40,B=0,G++,n.drawRectangle({x:l,y:h-S,width:D,height:S,color:e(.2,.4,.7)}),x=l,t.columns.forEach((u,T)=>{const y=this.enhancedArabicTextProcessing(u.title),C=this.safeGetTextWidth(s,y,11);this.safeDrawText(n,y,{x:Math.max(x+5,x+F-10-C),y:h-18,size:11,font:w,color:e(1,1,1)}),T<O-1&&n.drawLine({start:{x:x+F,y:h},end:{x:x+F,y:h-S},thickness:1,color:e(.8,.8,.8)}),x+=F}),h-=S),E%2==0&&n.drawRectangle({x:l,y:h-d,width:D,height:d,color:e(.95,.95,.95)}),x=l,t.columns.forEach((u,T)=>{const y=this.getCellValue(b,u,E+1).toString(),R=this.enhancedArabicTextProcessing(y);let g=R;const U=F-10;let N=this.safeGetTextWidth(s,g,10);for(;N>U&&g.length>1;)g=g.slice(0,-1),N=this.safeGetTextWidth(s,g+"...",10);g!==R&&(g+="..."),N=this.safeGetTextWidth(s,g,10),this.safeDrawText(n,g,{x:Math.max(x+5,x+F-5-N),y:h-15,size:10,font:s,color:e(0,0,0)}),n.drawRectangle({x,y:h-d,width:F,height:d,borderColor:e(.8,.8,.8),borderWidth:.5}),x+=F}),h-=d,B++}const V=Math.ceil(t.data.length/j)||1;yield this.addEnhancedPDFFooter(n,t,G,V,s,i,l);const X=yield r.save(),$=new Blob([X],{type:"application/pdf"}),k=URL.createObjectURL($),P=document.createElement("a");P.href=k,P.download=`${t.fileName}.pdf`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(k),console.log("PDF exported successfully with enhanced Arabic method!")}catch(o){throw console.error("Alternative PDF Export Error:",o),o}})}generateHTMLTable(t){let n=`\n      <div style="direction: rtl; text-align: right;">\n        <div style="text-align: center; color: #1F4E79; font-size: 18px; font-weight: bold; margin: 10px 0;">${t.title}</div>\n        ${t.subtitle?`<div style="text-align: center; margin: 5px 0; color: #666;">${t.subtitle}</div>`:""}\n        <div style="text-align: center; margin: 5px 0; color: #888; font-size: 12px;">${t.currentDate||(new Date).toLocaleDateString()}</div>\n        \n        <table style="width: 100%; border-collapse: collapse; margin: 10px 0; font-family: Arial, "Noto Sans Arabic", serif;">\n          <thead>\n            <tr>\n              ${t.columns.map(i=>`<th style="background-color: #4472C4; color: white; padding: 8px; text-align: center; font-weight: bold;">${i.title}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n    `;return t.data.forEach((i,c)=>{const l=c%2==0?"#f8f9fa":"#ffffff";n+="<tr>",t.columns.forEach(D=>{const s=this.getCellValue(i,D,c+1);n+=`<td style="padding: 6px; border: 1px solid #ddd; text-align: center; background-color: ${l};">${s}</td>`}),n+="</tr>"}),n+=`\n          </tbody>\n        </table>\n        \n        <div style="margin-top: 20px; font-size: 10px; color: #666;">\n          <div>\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${t.userName}</div>\n          <div>\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${(new Date).toLocaleString("ar-SA")}</div>\n        </div>\n      </div>\n    `,n}enhancedArabicTextProcessing(t){if(!t)return"";try{let o=this.cleanArabicTextForPDF(t);return/[\u0600-\u06FF]/.test(o)?(o=o.normalize("NFKC").replace(/[\u200C\u200D]/g,"").replace(/\s+/g," ").trim(),console.log("\u2705 Preserved Arabic text with basic cleaning"),o):(console.log("\u26a0\ufe0f Arabic text lost during cleaning, using smart transliteration"),this.smartArabicTransliteration(t))}catch(o){return console.warn("Enhanced Arabic processing failed, using fallback:",o),this.smartArabicTransliteration(t)}}addEnhancedPDFFooter(t,o,e,a,r,n,i){return(0,m.mG)(this,void 0,void 0,function*(){const{rgb:c}=yield f.e(7479).then(f.bind(f,47479)),l=i,D=this.enhancedArabicTextProcessing(`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`);this.safeDrawText(t,D,{x:i,y:l,size:8,font:r,color:c(.4,.4,.4)});const s=this.enhancedArabicTextProcessing(`\u0635\u0641\u062d\u0629 ${e} \u0645\u0646 ${a}`),w=this.safeGetTextWidth(r,s,8);this.safeDrawText(t,s,{x:(n-w)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const A=this.enhancedArabicTextProcessing(`\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`),z=this.safeGetTextWidth(r,A,8);this.safeDrawText(t,A,{x:n-i-z,y:l,size:8,font:r,color:c(.4,.4,.4)})})}exportToPDFWithTextConversion(t){return(0,m.mG)(this,void 0,void 0,function*(){try{console.log("Using PDF export with Arabic text conversion...");const{PDFDocument:o,rgb:e,StandardFonts:a}=yield f.e(7479).then(f.bind(f,47479)),r=yield o.create();let n=r.addPage([842,595]);const{width:i,height:c}=n.getSize(),l=40,D=i-2*l,s=yield r.embedFont(a.Helvetica),w=yield r.embedFont(a.HelveticaBold),A=20,z=this.convertArabicToProfessionalEnglish(t.title),p=s.widthOfTextAtSize(z,A);n.drawText(z,{x:(i-p)/2,y:c-l-30,size:A,font:w,color:e(.2,.3,.5)});let h=c-l-60;if(t.subtitle){const E=this.convertArabicToProfessionalEnglish(t.subtitle),b=s.widthOfTextAtSize(E,14);n.drawText(E,{x:(i-b)/2,y:h,size:14,font:s,color:e(.4,.4,.4)}),h-=25}const v=t.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),M=s.widthOfTextAtSize(v,12);n.drawText(v,{x:(i-M)/2,y:h,size:12,font:s,color:e(.5,.5,.5)}),h-=40;const O=t.columns.length,F=D/O,d=25,S=30;n.drawRectangle({x:l,y:h-S,width:D,height:S,color:e(.2,.4,.7)});let x=l;t.columns.forEach((E,b)=>{const u=this.convertArabicToProfessionalEnglish(E.title),y=s.widthOfTextAtSize(u,11);n.drawText(u,{x:Math.max(x+5,x+(F-y)/2),y:h-18,size:11,font:w,color:e(1,1,1)}),b<O-1&&n.drawLine({start:{x:x+F,y:h},end:{x:x+F,y:h-S},thickness:1,color:e(.8,.8,.8)}),x+=F}),h-=S;const j=Math.floor((h-l-50)/d);let B=0,G=1;for(let E=0;E<t.data.length;E++){const b=t.data[E];B>=j&&(yield this.addConvertedPDFFooter(n,t,G,Math.ceil(t.data.length/j),s,i,l),n=r.addPage([842,595]),h=c-l-40,B=0,G++,n.drawRectangle({x:l,y:h-S,width:D,height:S,color:e(.2,.4,.7)}),x=l,t.columns.forEach((u,T)=>{const y=this.convertArabicToProfessionalEnglish(u.title),C=s.widthOfTextAtSize(y,11);n.drawText(y,{x:Math.max(x+5,x+(F-C)/2),y:h-18,size:11,font:w,color:e(1,1,1)}),T<O-1&&n.drawLine({start:{x:x+F,y:h},end:{x:x+F,y:h-S},thickness:1,color:e(.8,.8,.8)}),x+=F}),h-=S),E%2==0&&n.drawRectangle({x:l,y:h-d,width:D,height:d,color:e(.95,.95,.95)}),x=l,t.columns.forEach((u,T)=>{const y=this.getCellValue(b,u,E+1).toString(),R=this.convertArabicToProfessionalEnglish(y);let g=R;const U=F-10;let N=s.widthOfTextAtSize(g,10);for(;N>U&&g.length>1;)g=g.slice(0,-1),N=s.widthOfTextAtSize(g+"...",10);g!==R&&(g+="..."),N=s.widthOfTextAtSize(g,10),n.drawText(g,{x:Math.max(x+5,x+(F-N)/2),y:h-15,size:10,font:s,color:e(0,0,0)}),n.drawRectangle({x,y:h-d,width:F,height:d,borderColor:e(.8,.8,.8),borderWidth:.5}),x+=F}),h-=d,B++}const V=Math.ceil(t.data.length/j)||1;yield this.addConvertedPDFFooter(n,t,G,V,s,i,l);const X=yield r.save(),$=new Blob([X],{type:"application/pdf"}),k=URL.createObjectURL($),P=document.createElement("a");P.href=k,P.download=`${t.fileName}.pdf`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(k),console.log("PDF exported successfully with text conversion!")}catch(o){throw console.error("Fallback PDF Export Error:",o),o}})}addConvertedPDFFooter(t,o,e,a,r,n,i){return(0,m.mG)(this,void 0,void 0,function*(){const{rgb:c}=yield f.e(7479).then(f.bind(f,47479)),l=i,D=this.convertArabicToProfessionalEnglish(`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`);t.drawText(D,{x:i,y:l,size:8,font:r,color:c(.4,.4,.4)});const s=`Page ${e} of ${a}`,w=r.widthOfTextAtSize(s,8);t.drawText(s,{x:(n-w)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const A=`Export Date: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`,z=r.widthOfTextAtSize(A,8);t.drawText(A,{x:n-i-z,y:l,size:8,font:r,color:c(.4,.4,.4)})})}addModernPDFFooter(t,o,e,a,r,n,i){return(0,m.mG)(this,void 0,void 0,function*(){const{rgb:c}=yield f.e(7479).then(f.bind(f,47479)),l=i;this.safeDrawText(t,`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`,{x:i,y:l,size:8,font:r,color:c(.4,.4,.4)});const s=`\u0635\u0641\u062d\u0629 ${e} \u0645\u0646 ${a}`,w=this.safeGetTextWidth(r,s,8);this.safeDrawText(t,s,{x:(n-w)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const A=`\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`,z=this.safeGetTextWidth(r,A,8);this.safeDrawText(t,A,{x:n-i-z,y:l,size:8,font:r,color:c(.4,.4,.4)})})}reverseArabicText(t){try{return this.segmentText(t).map(a=>a.isArabic?a.text.split("").reverse().join(""):a.text).join("")}catch(o){return console.warn("Arabic text processing failed:",o),t}}segmentText(t){const o=[];let e="",a=!1;for(let r=0;r<t.length;r++){const n=t[r],i=/[\u0600-\u06FF]/.test(n);0===r?(e=n,a=i):i===a?e+=n:(o.push({text:e,isArabic:a}),e=n,a=i)}return e&&o.push({text:e,isArabic:a}),o}exportToExcel(t){return(0,m.mG)(this,void 0,void 0,function*(){if(!(yield this.checkDataSize(t.data.length)))return;const o=yield this.getLoadingController().create({message:"\u062c\u0627\u0631\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 Excel...",spinner:"crescent"});yield o.present();try{const e=K.P6.book_new(),a=this.prepareExcelData(t),r=K.P6.aoa_to_sheet(a);this.applyModernExcelStyling(r,t);const n=t.columns.map(i=>({wch:i.width||15}));r["!cols"]=n,K.P6.book_append_sheet(e,r,"\u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a"),K.NC(e,`${t.fileName}.xlsx`),yield this.showSuccessToast("\u062a\u0645 \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 Excel \u0628\u0646\u062c\u0627\u062d")}catch(e){console.error("Excel Export Error:",e),yield this.showErrorToast("\u0641\u0634\u0644 \u0641\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 Excel")}finally{yield o.dismiss()}})}checkDataSize(t){return(0,m.mG)(this,void 0,void 0,function*(){return 0===t?(yield this.showErrorToast("\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0644\u062a\u0635\u062f\u064a\u0631"),!1):t>this.MAX_ROWS_LIMIT?(yield this.showErrorToast(`\u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0643\u062b\u064a\u0631\u0629 \u062c\u062f\u0627\u064b (${t} \u0635\u0641). \u0627\u0644\u062d\u062f \u0627\u0644\u0623\u0642\u0635\u0649 \u0647\u0648 ${this.MAX_ROWS_LIMIT} \u0635\u0641`),!1):!(t>this.MAX_ROWS_WARNING)||(yield this.showConfirmationAlert("\u062a\u062d\u0630\u064a\u0631",`\u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0643\u062b\u064a\u0631\u0629 (${t} \u0635\u0641). \u0642\u062f \u064a\u0633\u062a\u063a\u0631\u0642 \u0627\u0644\u062a\u0635\u062f\u064a\u0631 \u0648\u0642\u062a\u0627\u064b \u0637\u0648\u064a\u0644\u0627\u064b. \u0647\u0644 \u062a\u0631\u064a\u062f \u0627\u0644\u0645\u062a\u0627\u0628\u0639\u0629\u061f`))})}processArabicText(t){if(!t)return"";try{return/[\u0600-\u06FF\u0750-\u077F]/.test(t)?this.convertArabicToProfessionalEnglish(t):t}catch(o){return console.warn("Arabic text processing failed:",o),t}}convertArabicToProfessionalEnglish(t){try{if(!t||!this.detectArabicText(t))return t;const o={"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u062e\u0632\u0648\u0646":"Inventory Report",\u062a\u0642\u0631\u064a\u0631:"Report","\u0627\u0644\u0645\u062e\u0632\u0648\u0646 \u0627\u0644\u0625\u0641\u062a\u062a\u0627\u062d\u064a":"Opening Stock","\u0627\u0644\u0645\u062e\u0632\u0648\u0646 (in stock)":"Stock Qty",\u0627\u0644\u0645\u062e\u0632\u0648\u0646:"Inventory",\u0627\u0644\u062a\u0633\u0644\u0633\u0644:"Serial No.","\u0645\u0639\u0631\u0641 \u0627\u0644\u0635\u0646\u0641":"Item ID","\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641 (English)":"Item Name (English)","\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641":"Item Name",\u0627\u0644\u0635\u0646\u0641:"Item","\u0627\u0633\u0645 \u0645\u0633\u062a\u0639\u0627\u0631 (Alias)":"Alias Name","\u0627\u0633\u0645 \u0645\u0633\u062a\u0639\u0627\u0631":"Alias","\u0627\u0644\u0645\u0648\u062f\u064a\u0644 (model)":"Model",\u0627\u0644\u0645\u0648\u062f\u064a\u0644:"Model","\u0627\u0644\u0643\u0648\u062f (part no)":"Part Number",\u0627\u0644\u0643\u0648\u062f:"Code","\u0631\u0642\u0645 \u0627\u0644\u0642\u0637\u0639\u0629":"Part Number","\u0627\u0644\u0645\u0627\u0631\u0643\u0629 (brand)":"Brand",\u0627\u0644\u0645\u0627\u0631\u0643\u0629:"Brand","\u0627\u0642\u0644 \u0643\u0645\u064a\u0629 (MSQ)":"Min. Stock Qty","\u0627\u0642\u0644 \u0643\u0645\u064a\u0629":"Min. Qty","\u0627\u0644\u062d\u062f \u0627\u0644\u0623\u062f\u0646\u0649":"Minimum","\u0627\u0644\u0648\u062d\u062f\u0647 (unit)":"Unit",\u0627\u0644\u0648\u062d\u062f\u0647:"Unit",\u0627\u0644\u0648\u062d\u062f\u0629:"Unit","\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621 (purch price)":"Purchase Price","\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621":"Purchase Price","\u0633\u0639\u0631 \u0627\u0644\u0648\u062d\u062f\u0647 (selling price)":"Selling Price","\u0633\u0639\u0631 \u0627\u0644\u0648\u062d\u062f\u0647":"Unit Price","\u0633\u0639\u0631 \u0627\u0644\u0628\u064a\u0639":"Selling Price","\u0646\u0633\u0628\u0629 \u0627\u0644\u0641\u0627\u0626\u062f\u0629 (profit perc)":"Profit %","\u0646\u0633\u0628\u0629 \u0627\u0644\u0641\u0627\u0626\u062f\u0629":"Profit %","\u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0644\u0645\u062a\u0627\u062d\u0629":"Available Qty",\u0627\u0644\u0643\u0645\u064a\u0629:"Quantity",\u0627\u0644\u0645\u062c\u0645\u0648\u0639:"Total","\u0627\u062e\u0631 \u0639\u0645\u0644\u064a\u0629 \u0628\u064a\u0639":"Last Sale Date",\u0627\u0644\u0625\u0641\u062a\u062a\u0627\u062d\u064a:"Opening",\u0627\u0644\u0625\u062c\u0631\u0627\u0621\u0627\u062a:"Actions",\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645:"User","\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Date",\u0635\u0641\u062d\u0629:"Page",\u0645\u0646:"of",\u0625\u0644\u0649:"to",\u0641\u064a:"on",\u0627\u0644\u062a\u0627\u0631\u064a\u062e:"Date",\u0627\u0644\u0648\u0642\u062a:"Time",\u0645\u062a\u0648\u0641\u0631:"Available","\u063a\u064a\u0631 \u0645\u062a\u0648\u0641\u0631":"Out of Stock",\u0646\u0634\u0637:"Active","\u063a\u064a\u0631 \u0646\u0634\u0637":"Inactive",\u062c\u062f\u064a\u062f:"New",\u0645\u0633\u062a\u0639\u0645\u0644:"Used",\u0642\u0637\u0639\u0629:"Piece",\u0642\u0637\u0639:"Pieces",\u0643\u064a\u0644\u0648:"Kg",\u062c\u0631\u0627\u0645:"Gram",\u0645\u062a\u0631:"Meter",\u0644\u062a\u0631:"Liter"};let e=t.trim();const a=Object.keys(o).sort((r,n)=>n.length-r.length);for(const r of a)e.includes(r)&&(e=e.replace(new RegExp(r,"g"),o[r]));return e===t&&(e=t.split(/\s+/).map(i=>{const c=i.trim();return o[c]||this.transliterateArabicWord(c)}).join(" ")),this.detectArabicText(e)&&(console.warn("Arabic characters still present after conversion, applying full transliteration"),e=this.safeArabicToEnglishTransliteration(e)),e}catch(o){return console.warn("Professional Arabic conversion failed:",o),this.transliterateArabicWord(t)}}transliterateArabicWord(t){const o={\u0627:"a",\u0623:"a",\u0625:"i",\u0622:"aa",\u0628:"b",\u062a:"t",\u062b:"th",\u062c:"j",\u062d:"h",\u062e:"kh",\u062f:"d",\u0630:"dh",\u0631:"r",\u0632:"z",\u0633:"s",\u0634:"sh",\u0635:"s",\u0636:"d",\u0637:"t",\u0638:"dh",\u0639:"a",\u063a:"gh",\u0641:"f",\u0642:"q",\u0643:"k",\u0644:"l",\u0645:"m",\u0646:"n",\u0647:"h",\u0629:"h",\u0648:"w",\u064a:"y",\u0649:"a",\u0621:""};let e="";for(const a of t)e+=o[a]||a;return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}safeArabicToEnglishTransliteration(t){const o={\u0621:"",\u0622:"aa",\u0623:"a",\u0624:"u",\u0625:"i",\u0626:"i",\u0627:"a",\u0628:"b",\u0629:"h",\u062a:"t",\u062b:"th",\u062c:"j",\u062d:"h",\u062e:"kh",\u062f:"d",\u0630:"dh",\u0631:"r",\u0632:"z",\u0633:"s",\u0634:"sh",\u0635:"s",\u0636:"d",\u0637:"t",\u0638:"dh",\u0639:"a",\u063a:"gh",\u0640:"",\u0641:"f",\u0642:"q",\u0643:"k",\u0644:"l",\u0645:"m",\u0646:"n",\u0647:"h",\u0648:"w",\u0649:"a",\u064a:"y","\u064b":"","\u064c":"","\u064d":"","\u064e":"","\u064f":"","\u0650":"","\u0651":"","\u0652":"","\u0653":"","\u0654":"","\u0655":"","\u0656":"","\u0657":"","\u0658":"","\u0659":"","\u065a":"","\u065b":"","\u065c":"","\u065d":"","\u065e":"","\u065f":"","\u0660":"0","\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9",\u06a9:"k",\u06af:"g",\u067e:"p",\u0686:"ch",\u0698:"zh",\u06a4:"v",\u06a5:"f",\u06a6:"f",\u06a7:"q",\u06a8:"q",\u06aa:"k",\u06ab:"g",\u06ac:"g",\u06ad:"ng",\u06ae:"ng",\ufefb:"la",\ufef7:"laa",\ufef9:"laa",\ufef5:"laa",\ufe70:"",\ufe71:"",\ufe72:"",\ufe73:"",\ufe74:"",\ufe76:"",\ufe77:"",\ufe78:"",\ufe79:"",\ufe7a:"",\ufe7b:"",\ufe7c:"",\ufe7d:"",\ufe7e:"",\ufe7f:"",\ufe80:"",\ufe81:"aa",\ufe82:"aa",\ufe83:"a",\ufe84:"a",\ufe85:"u",\ufe86:"u",\ufe87:"i",\ufe88:"i",\ufe89:"i",\ufe8a:"i",\ufe8b:"i",\ufe8c:"i",\ufe8d:"a",\ufe8e:"a",\ufe8f:"b",\ufe90:"b",\ufe91:"b",\ufe92:"b",\ufe93:"h",\ufe94:"h",\ufe95:"t",\ufe96:"t",\ufe97:"t",\ufe98:"t",\ufe99:"th",\ufe9a:"th",\ufe9b:"th",\ufe9c:"th",\ufe9d:"j",\ufe9e:"j",\ufe9f:"j",\ufea0:"j",\ufea1:"h",\ufea2:"h",\ufea3:"h",\ufea4:"h",\ufea5:"kh",\ufea6:"kh",\ufea7:"kh",\ufea8:"kh",\ufea9:"d",\ufeaa:"d",\ufeab:"dh",\ufeac:"dh",\ufead:"r",\ufeae:"r",\ufeaf:"z",\ufeb0:"z",\ufeb1:"s",\ufeb2:"s",\ufeb3:"s",\ufeb4:"s",\ufeb5:"sh",\ufeb6:"sh",\ufeb7:"sh",\ufeb8:"sh",\ufeb9:"s",\ufeba:"s",\ufebb:"s",\ufebc:"s",\ufebd:"d",\ufebe:"d",\ufebf:"d",\ufec0:"d",\ufec1:"t",\ufec2:"t",\ufec3:"t",\ufec4:"t",\ufec5:"dh",\ufec6:"dh",\ufec7:"dh",\ufec8:"dh",\ufec9:"a",\ufeca:"a",\ufecb:"a",\ufecc:"a",\ufecd:"gh",\ufece:"gh",\ufecf:"gh",\ufed0:"gh",\ufed1:"f",\ufed2:"f",\ufed3:"f",\ufed4:"f",\ufed5:"q",\ufed6:"q",\ufed7:"q",\ufed8:"q",\ufed9:"k",\ufeda:"k",\ufedb:"k",\ufedc:"k",\ufedd:"l",\ufede:"l",\ufedf:"l",\ufee0:"l",\ufee1:"m",\ufee2:"m",\ufee3:"m",\ufee4:"m",\ufee5:"n",\ufee6:"n",\ufee7:"n",\ufee8:"n",\ufee9:"h",\ufeea:"h",\ufeeb:"h",\ufeec:"h",\ufeed:"w",\ufeee:"w",\ufeef:"a",\ufef0:"a",\ufef1:"y",\ufef2:"y",\ufef3:"y",\ufef4:"y"};let e="";for(const a of t)o[a]?e+=o[a]:/[\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]/.test(a)?e+="x":e+=a;return e=e.replace(/\s+/g," ").trim(),e.length>0&&(e=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()),e||"Text"}loadArabicFont(){return(0,m.mG)(this,void 0,void 0,function*(){try{const t=["https://fonts.gstatic.com/s/cairo/v28/SLXGc1nY6HkvalIkTp2mxdt0UX8gfO8_19co.woff2","https://fonts.gstatic.com/s/nototc/v35/m8JVjfNVeKWVnh3QMuKkFcZlbkGG1dKFzQ.woff2","https://fonts.gstatic.com/s/scheherazadnew/v16/4UaZrEhTvBiF3i89P6gvLJ2lfjz_-ruOvKsv.woff2","https://cdn.jsdelivr.net/gh/googlefonts/noto-fonts@main/hinted/ttf/NotoSansArabic/NotoSansArabic-Regular.ttf"];for(const o of t)try{console.log(`Attempting to load Arabic font from: ${o}`);const e=yield fetch(o,{method:"GET",mode:"cors",cache:"default",headers:{Accept:"font/woff2,font/woff,font/ttf,*/*"}});if(e.ok&&200===e.status){const a=yield e.arrayBuffer();if(a.byteLength>1e3)return console.log(`\u2705 Arabic font loaded successfully from CDN: ${a.byteLength} bytes`),a}}catch(e){console.warn(`\u274c Failed to load font from ${o}:`,e);continue}try{console.log("Attempting to load Arabic font from local assets...");const o=yield fetch("./assets/fonts/NotoSansArabic-Regular.ttf");if(o.ok){const e=yield o.arrayBuffer();return console.log("\u2705 Arabic font loaded from local assets"),e}}catch(o){console.warn("\u274c No local Arabic font found")}try{console.log("Attempting to create Arabic font using CSS Font Loading API..."),yield new FontFace("ArabicFont","url(https://fonts.gstatic.com/s/cairo/v28/SLXGc1nY6HkvalIkTp2mxdt0UX8gfO8_19co.woff2)").load(),console.log("\u2705 Arabic font created using Font Loading API");const a=document.createElement("canvas").getContext("2d");throw a&&(a.font="16px ArabicFont",a.fillText("\u062a\u062c\u0631\u0628\u0629",10,30)),new Error("FontFace to ArrayBuffer conversion needed")}catch(o){console.warn("\u274c Font Loading API failed")}throw new Error("All Arabic font loading strategies failed")}catch(t){throw console.warn("All Arabic font loading attempts failed:",t),t}})}safeGetTextWidth(t,o,e){try{return t.widthOfTextAtSize(o,e)}catch(a){return console.warn("Error calculating text width, using fallback:",a),o.length*e*.6}}safeDrawText(t,o,e){try{let a=o;return/[\u0600-\u06FF]/.test(o)&&(console.log("Processing Arabic text for PDF:",o.substring(0,20)+"..."),a=this.fixArabicTextForPDF(o),a=this.processArabicTextForPDF(a),console.log("Arabic text processed successfully")),t.drawText(a,e),!0}catch(a){console.warn("Failed to draw processed Arabic text:",a),console.warn("Original text:",o);const r=[()=>{const n=this.cleanArabicTextForPDF(o);t.drawText(n,e),console.log("\u2705 Successfully drawn with cleaned Arabic text")},()=>{const n=this.simplifyArabicText(o);t.drawText(n,e),console.log("\u2705 Successfully drawn with simplified Arabic text")},()=>{const n=this.smartArabicTransliteration(o);t.drawText(n,e),console.log("\u26a0\ufe0f Drawn with smart transliteration")}];for(let n=0;n<r.length;n++)try{return r[n](),!0}catch(i){if(console.warn(`Fallback strategy ${n+1} failed:`,i),n===r.length-1)return console.error("All fallback strategies failed"),!1}return!1}}fixArabicTextForPDF(t){let o=t;return Object.entries({\ufedf:"\u0644\u0627",\ufee0:"\u0644\u0627",\ufee1:"\u0644\u0625",\ufee2:"\u0644\u0625",\ufee3:"\u0644\u0622",\ufee4:"\u0644\u0622","\u064b":"","\u064c":"","\u064d":"","\u064e":"","\u064f":"","\u0650":"","\u0651":"","\u0652":""}).forEach(([a,r])=>{o=o.replace(new RegExp(a,"g"),r)}),o}cleanArabicTextForPDF(t){return t?t.replace(/[\u064B-\u0652]/g,"").replace(/[\u0653-\u0655]/g,"").replace(/[\u0670\u0640]/g,"").replace(/\u200C/g,"").replace(/\u200D/g,"").trim():""}simplifyArabicText(t){if(!t)return"";const e=t.match(/[\u0621-\u063A\u0641-\u064A\u0660-\u0669\u0020-\u007E]/g);return e?e.join(""):t}smartArabicTransliteration(t){if(!t)return"";if(!/[\u0600-\u06FF]/.test(t))return t;const e={"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u062e\u0632\u0648\u0646":"Stock Report","\u0627\u0644\u0645\u062e\u0632\u0648\u0646 \u0627\u0644\u0625\u0641\u062a\u062a\u0627\u062d\u064a":"Opening Inventory","\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641":"Item Name",\u0627\u0644\u0643\u0645\u064a\u0629:"Quantity",\u0627\u0644\u0633\u0639\u0631:"Price",\u0627\u0644\u0645\u062c\u0645\u0648\u0639:"Total",\u0627\u0644\u062a\u0627\u0631\u064a\u062e:"Date",\u0627:"a",\u0628:"b",\u062a:"t",\u062b:"th",\u062c:"j",\u062d:"h",\u062e:"kh",\u062f:"d",\u0630:"dh",\u0631:"r",\u0632:"z",\u0633:"s",\u0634:"sh",\u0635:"s",\u0636:"d",\u0637:"t",\u0638:"dh",\u0639:"a",\u063a:"gh",\u0641:"f",\u0642:"q",\u0643:"k",\u0644:"l",\u0645:"m",\u0646:"n",\u0647:"h",\u0648:"w",\u064a:"y"};let a=t;return Object.keys(e).forEach(r=>{a.includes(r)&&(a=a.replace(new RegExp(r,"g"),e[r]))}),a}processArabicTextForPDF(t){if(!t)return"";try{let o=this.cleanArabicTextForPDF(t);return/[\u0600-\u06FF]/.test(o)&&(o=o.normalize("NFKC")),o}catch(o){return console.warn("Arabic text processing failed, returning original:",o),t}}prepareExcelData(t){const o=[],e=new Array(t.columns.length).fill("");if(e[0]=t.title,o.push(e),t.subtitle){const i=new Array(t.columns.length).fill("");i[0]=t.subtitle,o.push(i)}const a=new Array(t.columns.length).fill("");a[0]=t.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),o.push(a),o.push(new Array(t.columns.length).fill("")),o.push(t.columns.map(i=>i.title)),t.data.forEach((i,c)=>{const l=t.columns.map(D=>this.getCellValue(i,D,c+1));o.push(l)}),o.push(new Array(t.columns.length).fill(""));const r=new Array(t.columns.length).fill("");r[0]=`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${t.userName}`,o.push(r);const n=new Array(t.columns.length).fill("");return n[0]=`\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`,o.push(n),o}applyModernExcelStyling(t,o){const e=o.columns.length,a=this.numberToExcelColumn(e-1);t["!merges"]||(t["!merges"]=[]);let r=0;const n=`A${r+1}`,i=`A${r+1}:${a}${r+1}`;if(t[n]&&(t[n].s={font:{bold:!0,sz:18,color:{rgb:"1F4E79"}},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:"E7F3FF"}},border:{top:{style:"thin",color:{rgb:"1F4E79"}},bottom:{style:"thin",color:{rgb:"1F4E79"}},left:{style:"thin",color:{rgb:"1F4E79"}},right:{style:"thin",color:{rgb:"1F4E79"}}}}),t["!merges"].push(this.decodeRange(i)),r++,o.subtitle){const A=`A${r+1}`,z=`A${r+1}:${a}${r+1}`;t[A]&&(t[A].s={font:{bold:!0,sz:14,color:{rgb:"2F75B5"}},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:"F2F8FF"}}}),t["!merges"].push(this.decodeRange(z)),r++}const c=`A${r+1}`,l=`A${r+1}:${a}${r+1}`;t[c]&&(t[c].s={font:{sz:11,color:{rgb:"666666"}},alignment:{horizontal:"center",vertical:"center"}}),t["!merges"].push(this.decodeRange(l)),r+=2;const D=r+1;for(let A=0;A<e;A++){const p=`${this.numberToExcelColumn(A)}${D}`;t[p]&&(t[p].s={font:{bold:!0,sz:12,color:{rgb:"FFFFFF"}},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:"4472C4"}},border:{top:{style:"thin",color:{rgb:"FFFFFF"}},bottom:{style:"thin",color:{rgb:"FFFFFF"}},left:{style:"thin",color:{rgb:"FFFFFF"}},right:{style:"thin",color:{rgb:"FFFFFF"}}}})}const s=D+1,w=s+o.data.length-1;for(let A=s;A<=w;A++){const p=(A-s)%2==0?"FFFFFF":"F8F9FA";for(let h=0;h<e;h++){const M=`${this.numberToExcelColumn(h)}${A}`;if(t[M]){t[M].s={font:{sz:10},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:p}},border:{top:{style:"thin",color:{rgb:"E1E5E9"}},bottom:{style:"thin",color:{rgb:"E1E5E9"}},left:{style:"thin",color:{rgb:"E1E5E9"}},right:{style:"thin",color:{rgb:"E1E5E9"}}}};const O=o.columns[h];O&&"currency"===O.type&&(t[M].s.alignment.horizontal="right"),O&&"serialNumber"===O.key&&(t[M].s.font.bold=!0,t[M].s.fill={fgColor:{rgb:"E7F3FF"}})}}}}numberToExcelColumn(t){let o="";for(;t>=0;)o=String.fromCharCode(65+t%26)+o,t=Math.floor(t/26)-1;return o}decodeRange(t){const o=t.split(":"),e=this.cellRefToCoords(o[0]),a=this.cellRefToCoords(o[1]);return{s:{c:e.c,r:e.r},e:{c:a.c,r:a.r}}}cellRefToCoords(t){const o=t.match(/([A-Z]+)(\d+)/);if(!o)return{c:0,r:0};const e=o[1],a=parseInt(o[2])-1;let r=0;for(let n=0;n<e.length;n++)r=26*r+(e.charCodeAt(n)-64);return r-=1,{c:r,r:a}}getCellValue(t,o,e){let a;if("serialNumber"===o.key)a=e||1;else if("finalAmount"===o.key)a=(parseFloat(t.tot_pr)||0)-(parseFloat(t.discount)||0);else if("stockValue"===o.key)a=(parseFloat(t.quantity)||0)*(parseFloat(t.pay_price)||0);else if("profitPercentage"===o.key){const r=parseFloat(t.pay_price)||0,n=parseFloat(t.perch_price)||0;a=r&&n&&0!==n?(r-n)/n*100:0}else a=this.getNestedValue(t,o.key);if(null==a)return"";switch(o.type){case"currency":return this.formatCurrency(a);case"date":return this.formatDate(a,"yyyy-MM-dd");case"number":if("profitPercentage"===o.key){const r=parseFloat(a);return isNaN(r)?"0.00%":`${r.toFixed(2)}%`}return this.formatNumber(a);default:return a.toString()}}getNestedValue(t,o){return o.split(".").reduce((e,a)=>e&&e[a],t)}formatCurrency(t){const o=parseFloat(t);return isNaN(o)?"0.00":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o)}formatNumber(t){const o=parseFloat(t);return isNaN(o)?"0":new Intl.NumberFormat("en-US").format(o)}generateDynamicTitle(t){return{"sales-record":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a","purchase-record":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u0634\u062a\u0631\u064a\u0627\u062a","item-stock":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u062e\u0632\u0648\u0646",cash2:"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u062e\u0632\u064a\u0646\u0629",statement2:"\u0643\u0634\u0641 \u0627\u0644\u062d\u0633\u0627\u0628","spend-record2":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a","balance-sheet2":"\u0627\u0644\u0645\u064a\u0632\u0627\u0646\u064a\u0629 \u0627\u0644\u0639\u0645\u0648\u0645\u064a\u0629","sub-account2":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0641\u0631\u0639\u064a\u0629"}[t]||"\u062a\u0642\u0631\u064a\u0631"}generateDynamicSubtitle(t,o){let e="";return o.selectedAccount&&o.selectedAccount.sub_name&&(e+="sales-record"===t?`\u0627\u0644\u0639\u0645\u064a\u0644: ${o.selectedAccount.sub_name}`:"purchase-record"===t?`\u0627\u0644\u0645\u0648\u0631\u062f: ${o.selectedAccount.sub_name}`:`\u0627\u0644\u062d\u0633\u0627\u0628: ${o.selectedAccount.sub_name}`),o.dateFilter&&(e&&(e+=" - "),"single"===o.dateFilter.type&&o.dateFilter.date?e+=`\u0641\u064a \u062a\u0627\u0631\u064a\u062e ${this.formatDateArabic(o.dateFilter.date)}`:"range"===o.dateFilter.type&&o.dateFilter.startDate&&o.dateFilter.endDate&&(e+=`\u0641\u064a \u0627\u0644\u0641\u062a\u0631\u0629 \u0645\u0646 ${this.formatDateArabic(o.dateFilter.startDate)} \u0625\u0644\u0649 ${this.formatDateArabic(o.dateFilter.endDate)}`)),o.searchTerm&&(e&&(e+=" - "),e+=`\u0627\u0644\u0628\u062d\u062b: ${o.searchTerm}`),e}formatDateArabic(t){if(!t)return"";const e=new Date(t);return`${e.getDate()} ${["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"][e.getMonth()]}`}showSuccessToast(t){return(0,m.mG)(this,void 0,void 0,function*(){yield(yield this.getToastController().create({message:t,duration:3e3,color:"success",position:"top",mode:"ios"})).present()})}showErrorToast(t){return(0,m.mG)(this,void 0,void 0,function*(){yield(yield this.getToastController().create({message:t,duration:3e3,color:"danger",position:"top",mode:"ios"})).present()})}showConfirmationAlert(t,o){return(0,m.mG)(this,void 0,void 0,function*(){return new Promise(e=>(0,m.mG)(this,void 0,void 0,function*(){yield(yield this.getAlertController().create({header:t,message:o,buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel",handler:()=>e(!1)},{text:"\u0645\u062a\u0627\u0628\u0639\u0629",handler:()=>e(!0)}]})).present()}))})}}return L.\u0275fac=function(t){return new(t||L)(H.LFG(H.zs3))},L.\u0275prov=H.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),L})()}}]);