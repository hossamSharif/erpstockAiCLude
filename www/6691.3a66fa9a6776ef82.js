"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6691],{36691:(B,d,h)=>{h.r(d),h.d(d,{NotificationsPageModule:()=>V});var l=h(69808),_=h(34182),u=h(23349),f=h(94030),A=h(70655),g=h(40520),y=h(15439),t=h(29863),m=h(91472),T=h(90849),b=h(742);function N(s,e){if(1&s){const o=t.EpF();t.TgZ(0,"ion-item"),t.TgZ(1,"ion-avatar"),t._UZ(2,"ion-icon",14),t.qZA(),t.TgZ(3,"ion-label"),t.TgZ(4,"ion-text"),t._uU(5),t.qZA(),t.qZA(),t._UZ(6,"br"),t.TgZ(7,"ion-label",15),t.TgZ(8,"ion-text",16),t.TgZ(9,"strong"),t._uU(10),t.ALo(11,"dateAgo"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"ion-button",17),t.NdJ("click",function(){const a=t.CHM(o).$implicit;return t.oxw(2).getPayInvoDetail(a,a.sub_name,"edit")}),t._uU(13,"\u0639\u0631\u0636"),t.qZA(),t.qZA()}if(2&s){const o=e.$implicit;t.xp6(5),t.hij("",o.title," \xa0"),t.xp6(5),t.Oqu(t.lcZ(11,2,o.nextMoPay))}}function q(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"h4",20),t._UZ(3,"ion-spinner",21),t.qZA(),t.qZA(),t.qZA())}function x(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"ion-label"),t._UZ(3,"ion-icon",22),t.qZA(),t.TgZ(4,"h4"),t._uU(5," \u0644\u0627 \u062a\u0648\u062c\u062f \u0633\u062c\u0644\u0627\u062a "),t.qZA(),t.qZA(),t.qZA())}function P(s,e){if(1&s&&(t.TgZ(0,"div"),t.TgZ(1,"ion-list",11),t.YNc(2,N,14,4,"ion-item",12),t.qZA(),t.YNc(3,q,4,0,"ion-row",13),t.YNc(4,x,6,0,"ion-row",13),t.qZA()),2&s){const o=t.oxw();t.xp6(2),t.Q6J("ngForOf",o.payNotifArr),t.xp6(1),t.Q6J("ngIf",1==o.showSpinner),t.xp6(1),t.Q6J("ngIf",1==o.showEmptyPay)}}function v(s,e){if(1&s){const o=t.EpF();t.TgZ(0,"ion-item"),t.TgZ(1,"ion-avatar"),t._UZ(2,"ion-icon",14),t.qZA(),t.TgZ(3,"ion-label"),t.TgZ(4,"ion-text"),t._uU(5),t.qZA(),t.qZA(),t.TgZ(6,"ion-label",15),t.TgZ(7,"ion-text",16),t.TgZ(8,"strong"),t._uU(9),t.ALo(10,"dateAgo"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"ion-button",17),t.NdJ("click",function(){const a=t.CHM(o).$implicit;return t.oxw(2).getPayInvoDetail(a,a.sub_name,"edit")}),t._uU(12,"\u0639\u0631\u0636"),t.qZA(),t.qZA()}if(2&s){const o=e.$implicit;t.xp6(5),t.hij("",o.title," \xa0"),t.xp6(4),t.Oqu(t.lcZ(10,2,o.nextMoPay))}}function w(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"ion-label"),t._UZ(3,"ion-icon",22),t.qZA(),t.TgZ(4,"h4"),t._uU(5," \u0644\u0627 \u062a\u0648\u062c\u062f \u0633\u062c\u0644\u0627\u062a "),t.qZA(),t.qZA(),t.qZA())}function C(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"h4",20),t._UZ(3,"ion-spinner",21),t.qZA(),t.qZA(),t.qZA())}function Q(s,e){if(1&s&&(t.TgZ(0,"div"),t.TgZ(1,"ion-list",11),t.YNc(2,v,13,4,"ion-item",12),t.qZA(),t.YNc(3,w,6,0,"ion-row",13),t.YNc(4,C,4,0,"ion-row",13),t.qZA()),2&s){const o=t.oxw();t.xp6(2),t.Q6J("ngForOf",o.purchNotifArr),t.xp6(1),t.Q6J("ngIf",1==o.showEmptyPurch),t.xp6(1),t.Q6J("ngIf",1==o.showSpinner)}}function S(s,e){if(1&s&&(t.TgZ(0,"ion-item"),t.TgZ(1,"ion-avatar"),t._UZ(2,"ion-icon",14),t.qZA(),t.TgZ(3,"ion-label"),t.TgZ(4,"ion-text"),t._uU(5),t.qZA(),t.qZA(),t._UZ(6,"br"),t.qZA()),2&s){const o=e.$implicit;t.xp6(5),t.hij(" ",o.item_name," \xa0")}}function U(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"ion-label"),t._UZ(3,"ion-icon",22),t.qZA(),t.TgZ(4,"h4"),t._uU(5," \u0644\u0627 \u062a\u0648\u062c\u062f \u0633\u062c\u0644\u0627\u062a "),t.qZA(),t.qZA(),t.qZA())}function I(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"h4",20),t._UZ(3,"ion-spinner",21),t.qZA(),t.qZA(),t.qZA())}function F(s,e){if(1&s&&(t.TgZ(0,"div"),t.TgZ(1,"ion-list",11),t.YNc(2,S,7,1,"ion-item",12),t.qZA(),t.YNc(3,U,6,0,"ion-row",13),t.YNc(4,I,4,0,"ion-row",13),t.qZA()),2&s){const o=t.oxw();t.xp6(2),t.Q6J("ngForOf",o.itemNotifArr),t.xp6(1),t.Q6J("ngIf",1==o.showEmptyitems),t.xp6(1),t.Q6J("ngIf",1==o.showSpinner)}}function J(s,e){if(1&s&&(t.TgZ(0,"ion-item"),t.TgZ(1,"ion-avatar"),t._UZ(2,"ion-icon",14),t.qZA(),t.TgZ(3,"ion-label"),t.TgZ(4,"ion-text"),t._uU(5),t.qZA(),t._uU(6," \u0627\u0644\u0643\u0645\u064a\u0629:"),t.TgZ(7,"ion-text"),t.TgZ(8,"strong"),t._uU(9),t.qZA(),t._uU(10," \xa0"),t.qZA(),t.qZA(),t._UZ(11,"br"),t.qZA()),2&s){const o=e.$implicit,i=e.index;t.xp6(5),t.AsE("",i+1," - ",o.item_name," \xa0"),t.xp6(4),t.Oqu(o.quantity)}}function E(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"ion-label"),t._UZ(3,"ion-icon",22),t.qZA(),t.TgZ(4,"h4"),t._uU(5," \u0644\u0627 \u062a\u0648\u062c\u062f \u0633\u062c\u0644\u0627\u062a "),t.qZA(),t.qZA(),t.qZA())}function O(s,e){1&s&&(t.TgZ(0,"ion-row",18),t.TgZ(1,"ion-col",19),t.TgZ(2,"h4",20),t._UZ(3,"ion-spinner",21),t.qZA(),t.qZA(),t.qZA())}function Y(s,e){if(1&s&&(t.TgZ(0,"div"),t.TgZ(1,"ion-list",11),t.YNc(2,J,12,3,"ion-item",12),t.qZA(),t.YNc(3,E,6,0,"ion-row",13),t.YNc(4,O,4,0,"ion-row",13),t.qZA()),2&s){const o=t.oxw();t.xp6(2),t.Q6J("ngForOf",o.itemMinusNotifArr),t.xp6(1),t.Q6J("ngIf",1==o.showEmptyitems),t.xp6(1),t.Q6J("ngIf",1==o.showSpinner)}}const M=[{path:"",component:(()=>{class s{constructor(o,i,n,a,p,c,r){this.loadingController=o,this.toast=i,this.rout=n,this.http=a,this.api2=p,this.storage=c,this.router=r,this.showEmptyitems=!1,this.showEmptyPay=!1,this.showEmptyPurch=!1,this.segmVal="items",this.sub_accountSalse=[],this.sub_accountPurch=[],this.payNotifArr=[],this.purchNotifArr=[],this.itemNotifArr=[],this.itemMinusNotifArr=[],this.showSpinner=!1,this.api="http://localhost/myaperpi/myapi/api/",this.getAppInfo()}ngOnInit(){}stockItems(o,i){this.showSpinner=!0;let n=new g.LE;n=n.append("store_id",o),n=n.append("yearId",i),this.http.get("http://localhost/myaperpi/myapi/api/",{params:n}).subscribe(a=>{let c=a.data;c.forEach(r=>{+r.tswiaQuantity>0?r.salesQuantity=+r.salesQuantity+ +r.tswiaQuantity:+r.tswiaQuantity<0&&(r.perchQuantity=+r.perchQuantity+Math.abs(+r.tswiaQuantity)),r.quantity=+r.perchQuantity+ +r.firstQuantity-+r.salesQuantity}),this.itemMinusNotifArr=c.filter(r=>+r.quantity<0),this.itemNotifArr=c.filter(r=>0==+r.quantity),0==this.itemNotifArr.length&&(this.showEmptyitems=!0),this.showSpinner=!1},a=>{this.showSpinner=!1})}sumCount(o){let i=new g.LE;i=i.append("store_id",1),this.http.get("http://localhost/myaperpi/myapi/api/",{params:i}).subscribe(n=>{let p=n.data;for(let c=0;c<o.length;c++){const r=o[c];let Z=p.filter(D=>D.id==r.id);Z.length>0&&(r.perchQuantity=+r.perchQuantity+ +Z[0].perchQuantity,r.salesQuantity=+r.salesQuantity+ +Z[0].salesQuantity)}o.forEach(c=>{c.quantity=+c.perchQuantity+ +c.firstQuantity-+c.salesQuantity}),this.itemMinusNotifArr=o.filter(c=>+c.quantity<0),this.itemNotifArr=o.filter(c=>0==+c.quantity),0==this.itemNotifArr.length&&(this.showEmptyitems=!0),this.showSpinner=!1},n=>{this.showSpinner=!1})}segmChange(o,i){"items"==this.segmVal?this.stockItems(1,this.year.id):"customer"==this.segmVal?this.getPayNotif(1):"supplier"==this.segmVal&&this.getPerchNotif(1,this.year.id)}getTot(){return this.totalObj.items=this.itemNotifArr.length,this.totalObj.perch=this.purchNotifArr.length,this.totalObj.pay=this.payNotifArr.length,this.totalObj.items+this.totalObj.perch+this.totalObj.pay}getPayNotif(o){let i=new g.LE;i=i.append("store_id",o),this.showSpinner=!0,this.http.get(this.api+"pay/paynotif.php",{params:i}).subscribe(n=>{this.payArr=n,this.getAccounts(1,1)},n=>{})}getPerchNotif(o,i){let n=new g.LE;n=n.append("store_id",o),n=n.append("yearI",i),this.showSpinner=!0,this.http.get(this.api+"perch/paynotif.php",{params:n}).subscribe(a=>{this.perchArr=a,this.getAccounts(1,2)},a=>{})}getAccounts(o,i){let n=new g.LE;n=n.append("store_id",o),n=n.append("ac_id",i),this.http.get(this.api+"sub_accounts/readByStore.php",{params:n}).subscribe(a=>{let p=a;1==i?this.sub_accountSalse=p.data:this.sub_accountPurch=p.data,this.showSpinner=!1,this.recalSubBalance(i)},a=>{this.showSpinner=!1})}recalSubBalance(o){1==o?(this.sub_accountSalse.forEach(i=>{i.sub_balance=0;let n=+i.changeeTot+ +i.fromDebitTot,a=+i.purchChangeeTot+ +i.toCreditTot;n==a?(i.sub_balance=0,i.currentCustumerStatus=""):n>a?(i.sub_balance=(+n-+a).toFixed(2),i.currentCustumerStatus="debit"):a>n&&(i.sub_balance=(+a-+n).toFixed(2),i.currentCustumerStatus="credit")}),this.sub_accountSalse=this.sub_accountSalse.filter(i=>+i.sub_balance>0),this.preparePayNotifArr(this.payArr)):(this.sub_accountPurch.forEach(i=>{i.sub_balance=0;let n=+i.changeeTot+ +i.fromDebitTot,a=+i.purchChangeeTot+ +i.toCreditTot;n==a?(i.sub_balance=0,i.currentCustumerStatus=""):n>a?(i.sub_balance=(+n-+a).toFixed(2),i.currentCustumerStatus="debit"):a>n&&(i.sub_balance=(+a-+n).toFixed(2),i.currentCustumerStatus="credit")}),this.sub_accountPurch=this.sub_accountPurch.filter(i=>+i.sub_balance>0),this.preparePurchNotifArr(this.perchArr))}preparePayNotifArr(o){this.payNotifArr=[],o&&((o=o.filter(i=>null!=i.nextPay&&"0000-00-00"!=i.nextPay)).forEach(i=>{let n=[];n=this.sub_accountSalse.filter(a=>+a.id==+i.cust_id),n.length>0&&+n[0].sub_balance>0&&this.payNotifArr.push({title:"\u0645\u0648\u0627\u0639\u064a\u062f \u0633\u062f\u0627\u062f \u0641\u0627\u062a\u0648\u0631\u0629  "+n[0].sub_name+"  \u0628\u062a\u0627\u0631\u064a\u062e  "+i.pay_date,pay_ref:i.pay_ref,tot_pr:i.tot_pr,pay_date:i.pay_date,pay_time:i.pay_time,cust_id:i.cust_id,discount:i.discount,changee:i.changee,user_id:i.user_id,pay:i.pay,store_id:i.store_id,pay_method:i.pay_method,payComment:i.payComment,nextPay:i.nextPay,nextMoPay:y(i.nextPay),sub_name:n[0].sub_name})}),0==this.payNotifArr.length&&(this.showEmptyPay=!0))}preparePurchNotifArr(o){this.purchNotifArr=[],o&&((o=o.filter(i=>null!=i.nextPay&&"0000-00-00"!=i.nextPay)).forEach(i=>{let n=[];n=this.sub_accountPurch.filter(a=>+a.id==+i.cust_id),n.length>0&&+n[0].sub_balance>0&&this.payNotifArr.push({title:"\u0645\u0648\u0627\u0639\u064a\u062f \u0633\u062f\u0627\u062f \u0641\u0627\u062a\u0648\u0631\u0629  "+n[0].sub_name+"\u0628\u062a\u0627\u0631\u064a\u062e "+i.pay_date,pay_ref:i.pay_ref,tot_pr:i.tot_pr,pay_date:i.pay_date,pay_time:i.pay_time,cust_id:i.cust_id,discount:i.discount,changee:i.changee,user_id:i.user_id,pay:i.pay,store_id:i.store_id,pay_method:i.pay_method,payComment:i.payComment,nextPay:i.nextPay,nextMoPay:y(i.nextPay),sub_name:n[0].sub_name})}),0==this.purchNotifArr.length&&(this.showEmptyPurch=!0))}getAppInfo(){this.storage.get("USER_INFO").then(o=>{o&&(this.user_info=o)}),this.storage.get("year").then(o=>{o&&(this.year=o)}),this.storage.get("STORE_INFO").then(o=>{o&&(this.store_info=o,this.stockItems(1,this.year.id))})}getPayInvoDetail(o,i,n){console.log(o,i,n),this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062c\u0644\u0628 \u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644 ..."),this.api2.getPayInvoDetail(1,o.pay_ref,this.year.id).subscribe(a=>{let p=a,c={queryParams:{payInvo:JSON.stringify(o),sub_name:JSON.stringify(i),user_info:JSON.stringify(this.user_info),store_info:JSON.stringify(this.store_info),itemList:JSON.stringify(p.data)}};this.rout.navigate(["folder/edit-sales"],c)},a=>{this.presentToast("\u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}presentLoadingWithOptions(o){return(0,A.mG)(this,void 0,void 0,function*(){const i=yield this.loadingController.create({spinner:"bubbles",mode:"ios",duration:3e3,message:o,translucent:!0,backdropDismiss:!1});yield i.present(),yield i.onDidDismiss()})}presentToast(o,i){return(0,A.mG)(this,void 0,void 0,function*(){(yield this.toast.create({message:o,duration:2e3,color:i,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})}subiscribeInterval(){this.getPayNotif(1),this.getPerchNotif(1,this.year.id),this.stockItems(1,this.year.id)}}return s.\u0275fac=function(o){return new(o||s)(t.Y36(u.HT),t.Y36(u.yF),t.Y36(f.F0),t.Y36(g.eN),t.Y36(m.r),t.Y36(T.K),t.Y36(f.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-notifications"]],decls:32,vars:5,consts:[["slot","start"],["dir","rtl"],["size","12"],[1,"ion-no-padding","ion-no-margin"],["scrollable","true","mode","ios",3,"ngModel","ngModelChange","ionChange"],["value","items"],["color","dark"],["value","itemsminus"],["value","customer"],["value","supplier"],[4,"ngIf"],[1,"ion-margin-top"],[4,"ngFor","ngForOf"],["class","ion-justify-content-center ion-margin-top",4,"ngIf"],["name","notifications-outline"],["slot","end"],["color","primary"],["slot","end",3,"click"],[1,"ion-justify-content-center","ion-margin-top"],["size","4",1,"ion-text-center"],[1,"ion-text-center"],["name","lines-sharp","slot","end"],["name","archive-outline",2,"font-size","30px"]],template:function(o,i){1&o&&(t.TgZ(0,"ion-header"),t.TgZ(1,"ion-toolbar"),t.TgZ(2,"ion-buttons",0),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"\u0627\u0644\u062a\u0646\u0628\u064a\u0647\u0627\u062a "),t.qZA(),t.qZA(),t.qZA(),t.TgZ(6,"ion-content"),t.TgZ(7,"ion-grid"),t.TgZ(8,"ion-row",1),t.TgZ(9,"ion-col",2),t.TgZ(10,"ion-card",3),t.TgZ(11,"ion-segment",4),t.NdJ("ngModelChange",function(a){return i.segmVal=a})("ionChange",function(a){return i.segmChange(a)}),t.TgZ(12,"ion-segment-button",5),t.TgZ(13,"h4"),t.TgZ(14,"ion-text",6),t._uU(15," \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0645\u0646\u062a\u0647\u064a\u0629"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"ion-segment-button",7),t.TgZ(17,"h4"),t.TgZ(18,"ion-text",6),t._uU(19," \u0627\u0635\u0646\u0627\u0641 \u0628\u0643\u0645\u064a\u0627\u062a \u0633\u0627\u0644\u0628\u0629"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"ion-segment-button",8),t.TgZ(21,"h4"),t.TgZ(22,"ion-text",6),t._uU(23," \u0645\u0648\u0627\u0639\u064a\u062f \u0633\u062f\u0627\u062f \u0627\u0644\u0639\u0645\u0644\u0627\u0621 "),t.qZA(),t.qZA(),t.qZA(),t.TgZ(24,"ion-segment-button",9),t.TgZ(25,"h4"),t.TgZ(26,"ion-text",6),t._uU(27," \u0645\u0648\u0627\u0639\u064a\u062f \u0633\u062f\u0627\u062f \u0627\u0644\u0645\u0648\u0631\u062f\u064a\u0646"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(28,P,5,3,"div",10),t.YNc(29,Q,5,3,"div",10),t.YNc(30,F,5,3,"div",10),t.YNc(31,Y,5,3,"div",10),t.qZA()),2&o&&(t.xp6(11),t.Q6J("ngModel",i.segmVal),t.xp6(17),t.Q6J("ngIf","customer"==i.segmVal),t.xp6(1),t.Q6J("ngIf","supplier"==i.segmVal),t.xp6(1),t.Q6J("ngIf","items"==i.segmVal),t.xp6(1),t.Q6J("ngIf","itemsminus"==i.segmVal))},directives:[u.Gu,u.sr,u.Sm,u.fG,u.wd,u.W2,u.jY,u.Nd,u.wI,u.PM,u.cJ,u.QI,_.JJ,_.On,u.GO,u.yW,l.O5,u.q_,l.sg,u.Ie,u.BJ,u.gu,u.Q$,u.YG,u.PQ],pipes:[b.R],styles:[""]}),s})()}];let j=(()=>{class s{}return s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[f.Bz.forChild(M)],f.Bz]}),s})();var L=h(78565);let V=(()=>{class s{}return s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[l.ez,_.u5,u.Pc,L.G,j]]}),s})()}}]);