<ion-header class="transparent-header">
  <ion-toolbar class="transparent-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button class="glass-menu-button"></ion-menu-button>
    </ion-buttons>
    <ion-title class="glass-title">سجل سندات القبض والدفع</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="modern-content">
  <!-- Loading State -->
  <div *ngIf="!user_info || !store_info" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p class="loading-text">جاري التحميل...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="user_info && store_info" class="main-container">
    <div class="form-container">
      <!-- Filter Card -->
      <ion-card class="filter-card">
        <ion-card-content class="compact-content">
          <!-- Filter Type Segment -->
          <div class="field-row">
            <ion-label class="field-label-right">نوع البحث</ion-label>
            <ion-segment [(ngModel)]="radioVal" (ionChange)="radioChange($event)" class="filter-segment">
              <ion-segment-button value="0">
                <div class="segment-content">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>حديثة</span>
                </div>
              </ion-segment-button>
              <ion-segment-button value="1">
                <div class="segment-content">
                  <ion-icon name="calendar-outline"></ion-icon>
                  <span>بحث في تاريخ</span>
                </div>
              </ion-segment-button>
              <ion-segment-button value="2">
                <div class="segment-content">
                  <ion-icon name="calendar-number-outline"></ion-icon>
                  <span>بحث في فترة</span>
                </div>
              </ion-segment-button>
            </ion-segment>
          </div>
          
          <!-- Date Filter Row for Recent Records -->
          <div class="date-filter-row" *ngIf="radioVal == '0'">
            <div class="spacer"></div>
            <ion-button 
              (click)="search()"
              fill="outline"
              class="mini-btn search-btn">
              <ion-icon name="search-outline" slot="start"></ion-icon>
              بحث
            </ion-button>
          </div>
          
          <!-- Date Filter Row for Single Date -->
          <div class="date-filter-row" *ngIf="radioVal == '1'">
            <ion-input 
              type="date" 
              [(ngModel)]="startingDate"
              class="mini-input date-input">
            </ion-input>
            <ion-button 
              (click)="search()"
              fill="outline"
              class="mini-btn search-btn">
              <ion-icon name="search-outline" slot="start"></ion-icon>
              بحث
            </ion-button>
          </div>
          
          <!-- Date Filter Row for Date Range -->
          <div class="date-filter-row" *ngIf="radioVal == '2'">
            <ion-input 
              type="date" 
              [(ngModel)]="startingDate"
              class="mini-input date-input">
            </ion-input>
            <ion-input 
              type="date" 
              [(ngModel)]="endDate"
              class="mini-input date-input">
            </ion-input>
            <ion-button 
              (click)="search()"
              fill="outline"
              class="mini-btn search-btn">
              <ion-icon name="search-outline" slot="start"></ion-icon>
              بحث
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
      
      
      <!-- Records Table Card -->
      <ion-card class="table-card" *ngIf="searchMode == false" color="primary">
        <ion-card-header class="card-header ion-no-padding">
          <div class="card-header-with-export">
            <div class="header-left">
              <ion-card-title class="card-title">سجل السندات</ion-card-title>
              <ion-input 
                [(ngModel)]="searchTerm" 
                (ionChange)="searchItem($event)" 
                placeholder="بحث في البيانات..."
                class="header-search-input">
                <ion-icon name="search-outline" slot="start"></ion-icon>
              </ion-input>
            </div>
            <app-export-buttons 
              [hasData]="payArray && payArray.length > 0"
              [isLoading]="loading"
              (exportPDF)="exportToPDF()"
              (exportExcel)="exportToExcel()">
            </app-export-buttons>
          </div>
        </ion-card-header>
        <ion-card-content class="table-content">
          <!-- Glass Table -->
          <div class="glass-table-container">
            <table class="glass-table">
              <thead>
                <tr>
                  <th>التسلسل</th>
                  <th class="sortable-header" (click)="sortBy('j_date')">
                    <ion-icon [name]="getSortIcon('j_date')" class="sort-icon"></ion-icon>
                    التاريخ
                  </th>
                  <th class="sortable-header" (click)="sortBy('j_type')">
                    <ion-icon [name]="getSortIcon('j_type')" class="sort-icon"></ion-icon>
                    نوع السند
                  </th>
                  <th class="sortable-header" (click)="sortBy('j_details')">
                    <ion-icon [name]="getSortIcon('j_details')" class="sort-icon"></ion-icon>
                    البيان
                  </th>
                  <th class="sortable-header" (click)="sortBy('j_pay')">
                    <ion-icon [name]="getSortIcon('j_pay')" class="sort-icon"></ion-icon>
                    المبلغ
                  </th>
                  <th class="sortable-header" (click)="sortBy('to1')">
                    <ion-icon [name]="getSortIcon('to1')" class="sort-icon"></ion-icon>
                    من <ion-icon name="arrow-up-outline" color="danger"></ion-icon>
                  </th>  
                  <th class="sortable-header" (click)="sortBy('from1')">
                    <ion-icon [name]="getSortIcon('from1')" class="sort-icon"></ion-icon>
                    إلى <ion-icon name="arrow-down-outline" color="success"></ion-icon>
                  </th>
                  <th>العمليات</th>
                </tr>
              </thead>
              <tbody>
                <!-- Loading Rows -->
                <tr *ngIf="loading" class="loading-row">
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                </tr>
                <tr *ngIf="loading" class="loading-row">
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                </tr>
                <tr *ngIf="loading" class="loading-row">
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                </tr>
                
                <!-- Data Rows -->
                <tr *ngFor="let pay of sortedPayArray; let i = index" class="data-row">
                  <td>{{i+1}}</td>
                  <td>{{pay.j_date}}</td>
                  <td><span class="type-badge" [class.type-receipt]="pay.j_type == 'سند قبض'" [class.type-payment]="pay.j_type == 'سند دفع'">{{pay.j_type}}</span></td>
                  <td class="details-cell">{{pay.j_details}}</td>
                  <td class="amount-cell">{{pay.j_pay}}</td>
                  <td class="account-cell from-account">{{pay.to1}}</td>
                  <td class="account-cell to-account">{{pay.from1}}</td>
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <ion-button fill="clear" size="small" class="edit-btn" (click)="editJournal(pay.j_id)">
                        <ion-icon name="create-outline"></ion-icon>
                      </ion-button>
                      <ion-button fill="clear" size="small" class="delete-btn" (click)="delete(pay.j_ref)">
                        <ion-icon name="trash-outline"></ion-icon>
                      </ion-button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <!-- Empty State -->
            <div class="empty-state" *ngIf="showEmpty && !loading">
              <ion-icon name="archive-outline" class="empty-icon"></ion-icon>
              <h3>لا توجد سجلات</h3>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
      
      <!-- Search Results Table Card -->
      <ion-card class="table-card" *ngIf="searchMode == true" color="primary">
        <ion-card-header class="card-header">
          <div class="header-content">
            <ion-card-title class="card-title">نتائج البحث</ion-card-title>
            <ion-input 
              [(ngModel)]="searchTerm" 
              (ionChange)="searchItem($event)" 
              placeholder="بحث في البيانات..."
              class="header-search-input">
              <ion-icon name="search-outline" slot="start"></ion-icon>
            </ion-input>
          </div>
        </ion-card-header>
        <ion-card-content class="table-content">
          <!-- Glass Table -->
          <div class="glass-table-container">
            <table class="glass-table">
              <thead>
                <tr>
                  <th>التسلسل</th>
                  <th class="sortable-header" (click)="sortBy('j_date')">
                    <ion-icon [name]="getSortIcon('j_date')" class="sort-icon"></ion-icon>
                    التاريخ
                  </th>
                  <th class="sortable-header" (click)="sortBy('j_type')">
                    <ion-icon [name]="getSortIcon('j_type')" class="sort-icon"></ion-icon>
                    نوع السند
                  </th>
                  <th class="sortable-header" (click)="sortBy('j_details')">
                    <ion-icon [name]="getSortIcon('j_details')" class="sort-icon"></ion-icon>
                    البيان
                  </th>
                  <th class="sortable-header" (click)="sortBy('j_pay')">
                    <ion-icon [name]="getSortIcon('j_pay')" class="sort-icon"></ion-icon>
                    المبلغ
                  </th>
                  <th class="sortable-header" (click)="sortBy('to1')">
                    <ion-icon [name]="getSortIcon('to1')" class="sort-icon"></ion-icon>
                    من <ion-icon name="arrow-up-outline" color="danger"></ion-icon>
                  </th>  
                  <th class="sortable-header" (click)="sortBy('from1')">
                    <ion-icon [name]="getSortIcon('from1')" class="sort-icon"></ion-icon>
                    إلى <ion-icon name="arrow-down-outline" color="success"></ion-icon>
                  </th>
                  <th>العمليات</th>
                </tr>
              </thead>
              <tbody>
                <!-- Loading Rows -->
                <tr *ngIf="loading" class="loading-row">
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                  <td><ion-skeleton-text animated style="width: 100%"></ion-skeleton-text></td>
                </tr>
                
                <!-- Search Results Data Rows -->
                <tr *ngFor="let pay of searchResult; let i = index" class="data-row">
                  <td>{{i+1}}</td>
                  <td>{{pay.j_date}}</td>
                  <td><span class="type-badge" [class.type-receipt]="pay.j_type == 'سند قبض'" [class.type-payment]="pay.j_type == 'سند دفع'">{{pay.j_type}}</span></td>
                  <td class="details-cell">{{pay.j_details}}</td>
                  <td class="amount-cell">{{pay.j_pay}}</td>
                  <td class="account-cell from-account">{{pay.to1}}</td>
                  <td class="account-cell to-account">{{pay.from1}}</td>
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <ion-button fill="clear" size="small" class="delete-btn" (click)="delete(pay.j_ref)">
                        <ion-icon name="trash-outline"></ion-icon>
                      </ion-button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <!-- Empty State -->
            <div class="empty-state" *ngIf="showEmpty && !loading">
              <ion-icon name="archive-outline" class="empty-icon"></ion-icon>
              <h3>لا توجد نتائج</h3>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>