{"version":3,"file":"default-src_app_print-modal_print-modal_page_ts.js","mappings":"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","sources":["./src/app/print-modal/print-modal.page.ts"],"sourcesContent":["import { Component, OnInit,Input } from '@angular/core';\nimport { ModalController, ToastController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-print-modal',\n  templateUrl: './print-modal.page.html',\n  styleUrls: ['./print-modal.page.scss'],\n})\nexport class PrintModalPage implements OnInit {\n  @Input() printArr: any;\n  @Input() page: any;\n   //mode = 'pos' \n   mode = 'enhanced' \n   logoBase64: string = '';\n   vehicleBase64: string = '';\n   itemImagesBase64: { [key: string]: string } = {};\n  \n  constructor(private modalController: ModalController,private toast :ToastController) {\n    this.mode = 'enhanced' \n   }\n\n  async ngOnInit() {\n    console.log(this.printArr[0]);\n    this.sortItemListAlphabetically()\n    await this.loadImages();\n  }\n\n  sortItemListAlphabetically() {\n    if (!this.printArr[0].itemList || this.printArr[0].itemList.length === 0) {\n      return;\n    }\n    \n    this.printArr[0].itemList= [...this.printArr[0].itemList].sort((a, b) => {\n      const nameA = a.item_name ? a.item_name.toString().toLowerCase() : '';\n      const nameB = b.item_name ? b.item_name.toString().toLowerCase() : '';\n      return nameA.localeCompare(nameB, 'ar', { numeric: true });\n    });\n  }\n\n\n\n  async loadImages() {\n    try {\n      this.logoBase64 = await this.convertImageToBase64('assets/imgs/logo.png');\n    } catch (error) {\n      console.log('Failed to load logo image:', error);\n    }\n    \n    try {\n      this.vehicleBase64 = await this.convertImageToBase64('assets/imgs/tuk.jpg');\n    } catch (error) {\n      console.log('Failed to load vehicle image:', error);\n    }\n    \n    // Load item images from itemList\n    await this.loadItemImages();\n  }\n\n  async loadItemImages() {\n    if (!this.printArr || !this.printArr[0] || !this.printArr[0].itemList) {\n      return;\n    }\n    \n    const itemList = this.printArr[0].itemList;\n    const imagePromises = [];\n    \n    for (const item of itemList) {\n      if (item.imageUrl && !this.itemImagesBase64[item.imageUrl]) {\n        imagePromises.push(\n          this.convertImageToBase64(item.imageUrl)\n            .then((base64) => {\n              this.itemImagesBase64[item.imageUrl] = base64;\n            })\n            .catch((error) => {\n              console.log(`Failed to load item image ${item.imageUrl}:`, error);\n            })\n        );\n      }\n    }\n    \n    await Promise.all(imagePromises);\n    console.log('Loaded item images:', Object.keys(this.itemImagesBase64));\n  }\n\n  convertImageToBase64(imagePath: string): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.crossOrigin = 'anonymous'; // Handle CORS issues\n      img.onload = () => {\n        try {\n          const canvas = document.createElement('canvas');\n          const ctx = canvas.getContext('2d');\n          canvas.width = img.width;\n          canvas.height = img.height;\n          ctx.drawImage(img, 0, 0);\n          const dataURL = canvas.toDataURL('image/png');\n          resolve(dataURL);\n        } catch (error) {\n          console.error('Error converting image to base64:', error);\n          reject(error);\n        }\n      };\n      img.onerror = (error) => {\n        console.error('Failed to load image:', imagePath, error);\n        reject('Failed to load image: ' + imagePath);\n      };\n      img.src = imagePath;\n    });\n  }\n\n\n  async ionViewDidEnter(){\n  //console.log('printing process')\n    await this.Print('printarea1')\n  }\n\n\n async Print(elem){  \n    //console.log('here we are')\n    \n    // Get the content and replace asset paths with base64 images for print\n    let printContent = document.getElementById(elem).innerHTML;\n    \n    // Replace asset image paths with base64 encoded images\n    if (this.logoBase64) {\n      printContent = printContent.replace(/src=\"assets\\/imgs\\/logo\\.png\"/g, `src=\"${this.logoBase64}\"`);\n      printContent = printContent.replace(/\\[src\\]=\"logoBase64 \\|\\| 'assets\\/imgs\\/logo\\.png'\"/g, `src=\"${this.logoBase64}\"`);\n    }\n    \n    if (this.vehicleBase64) {\n      printContent = printContent.replace(/src=\"assets\\/imgs\\/tuk\\.jpg\"/g, `src=\"${this.vehicleBase64}\"`);\n      printContent = printContent.replace(/\\[src\\]=\"vehicleBase64 \\|\\| 'assets\\/imgs\\/tuk\\.jpg'\"/g, `src=\"${this.vehicleBase64}\"`);\n    }\n    \n    // Replace item images with base64 encoded versions\n    for (const [originalUrl, base64] of Object.entries(this.itemImagesBase64)) {\n      // Escape special regex characters in the URL\n      const escapedUrl = originalUrl.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n      // Replace all occurrences of this image URL with base64\n      const regex = new RegExp(`src=\"${escapedUrl}\"`, 'g');\n      printContent = printContent.replace(regex, `src=\"${base64}\"`);\n      \n      // Also handle Angular property binding format [src]\n      const angularRegex = new RegExp(`\\\\[src\\\\]=\"[^\"]*${escapedUrl}[^\"]*\"`, 'g');\n      printContent = printContent.replace(angularRegex, `src=\"${base64}\"`);\n    }\n    \n    // Replace any remaining asset paths with base64 if company logo exists\n    if (this.printArr && this.printArr[0] && this.printArr[0].company && this.printArr[0].company.logoUrl) {\n      // Convert company logo to base64 if it's an asset path\n      if (this.printArr[0].company.logoUrl.includes('assets/')) {\n        try {\n          const base64 = await this.convertImageToBase64(this.printArr[0].company.logoUrl);\n          printContent = printContent.replace(new RegExp(this.printArr[0].company.logoUrl.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'g'), base64);\n        } catch (error) {\n          console.log('Failed to convert company logo to base64:', error);\n        }\n      }\n    }\n    \n    var mywindow = window.open('', 'PRINT', 'height=400,width=600'); \n    mywindow.document.write('<html><head>'); \n    mywindow.document.write('<style type=\"text/css\">')\n    mywindow.document.write('.flr{ display: block; float: right; } .show{ } .hide{width:0px;height:0px} .w45 {width:45%} .w35 {width:35%} .w50 {width:50%} .w100 {width:100%} .bnone {border: 1px solid #000000;} .td,.th  {border: 1px solid #000000;text-align: center;padding: 8px;} .hd {background-color: #b9b8b8;} .table{text-align: center;width: 100%; margin: 12px;} .ion-margin{ margin: 10px; } .ion-margin-top{ margin-top: 10px; } .rtl {  direction: rtl; } .ion-text-center{ text-align: center; } .ion-text-end{ text-align: left; } .ion-text-start{ text-align: right; }')\n    mywindow.document.write('</style></head><body>'); \n    mywindow.document.write(printContent);\n    mywindow.document.write('</body></html>');\n    mywindow.document.close(); // necessary for IE >= 10\n    mywindow.focus(); // necessary for IE >= 10*/ \n   // mywindow.print();\n    mywindow.window.print();\n    mywindow.window.close();\n    this.modalController.dismiss()    \n}\n\n// Format balance display with number separators\nformatBalance(balance: number): string {\n  if (!balance && balance !== 0) return '0.00';\n  return new Intl.NumberFormat('en-US', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  }).format(Math.abs(balance));\n}\n\n}\n"],"names":[],"sourceRoot":"webpack:///"}