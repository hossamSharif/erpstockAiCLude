"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5169,1212],{95169:(k,M,g)=>{g.r(M),g.d(M,{Cash2PageModule:()=>W});var f=g(69808),d=g(34182),u=g(23349),_=g(94030),x=g(70655),e=g(29863),y=g(17158),b=g(65465),C=g(90849),i=g(91472),c=g(6612),r=g(12317),s=g(1212),p=g(742);const P=["popoverNotif22"];function O(a,m){1&a&&(e.TgZ(0,"div",7),e._UZ(1,"ion-spinner",8),e.TgZ(2,"p",9),e._uU(3,"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."),e.qZA(),e.qZA())}function w(a,m){if(1&a&&(e.TgZ(0,"ion-select-option",41),e._uU(1),e.qZA()),2&a){const t=m.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.sub_name," ")}}function S(a,m){if(1&a&&(e.TgZ(0,"div",47),e._uU(1),e.ALo(2,"currencyDisplay"),e.qZA()),2&a){const t=e.oxw(3);e.Udp("color","success"===t.getBalanceColor(t.sourceAccountBalance)?"#10dc60":"#f04141"),e.xp6(1),e.hij(" ",e.lcZ(2,3,t.sourceAccountBalance.current_balance)," ")}}function T(a,m){1&a&&(e.TgZ(0,"div",48),e._UZ(1,"ion-spinner",49),e.TgZ(2,"span"),e._uU(3,"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."),e.qZA(),e.qZA())}function Z(a,m){1&a&&(e.TgZ(0,"div",50),e._uU(1," \u0644\u0627 \u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0631\u0635\u064a\u062f "),e.qZA())}function A(a,m){if(1&a&&(e.TgZ(0,"div",42),e.TgZ(1,"div",43),e._uU(2,"\u0627\u0644\u0631\u0635\u064a\u062f:"),e.qZA(),e.YNc(3,S,3,5,"div",44),e.YNc(4,T,4,0,"div",45),e.YNc(5,Z,2,0,"div",46),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.Q6J("ngIf",!t.loadingSourceBalance&&t.sourceAccountBalance),e.xp6(1),e.Q6J("ngIf",t.loadingSourceBalance),e.xp6(1),e.Q6J("ngIf",!t.loadingSourceBalance&&!t.sourceAccountBalance&&t.selectedBankAccount.sub_name)}}function D(a,m){if(1&a&&(e.TgZ(0,"div",47),e._uU(1),e.ALo(2,"currencyDisplay"),e.qZA()),2&a){const t=e.oxw(3);e.Udp("color","success"===t.getBalanceColor(t.selectedAccountBalance)?"#10dc60":"#f04141"),e.xp6(1),e.hij(" ",e.lcZ(2,3,t.selectedAccountBalance.current_balance)," ")}}function E(a,m){1&a&&(e.TgZ(0,"div",48),e._UZ(1,"ion-spinner",49),e.TgZ(2,"span"),e._uU(3,"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."),e.qZA(),e.qZA())}function q(a,m){1&a&&(e.TgZ(0,"div",50),e._uU(1," \u0644\u0627 \u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0631\u0635\u064a\u062f "),e.qZA())}function B(a,m){if(1&a&&(e.TgZ(0,"div",42),e.TgZ(1,"div",43),e._uU(2,"\u0627\u0644\u0631\u0635\u064a\u062f:"),e.qZA(),e.YNc(3,D,3,5,"div",44),e.YNc(4,E,4,0,"div",45),e.YNc(5,q,2,0,"div",46),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.Q6J("ngIf",!t.loadingAccountBalance&&t.selectedAccountBalance),e.xp6(1),e.Q6J("ngIf",t.loadingAccountBalance),e.xp6(1),e.Q6J("ngIf",!t.loadingAccountBalance&&!t.selectedAccountBalance&&t.selectedFromAccount.sub_name)}}function z(a,m){if(1&a){const t=e.EpF();e.TgZ(0,"div",10),e.TgZ(1,"div",11),e.TgZ(2,"ion-card",12),e.TgZ(3,"ion-card-header",13),e.TgZ(4,"div",14),e.TgZ(5,"ion-card-title",15),e._uU(6,"\u0633\u0646\u062f\u0627\u062a \u0627\u0644\u0642\u0628\u0636 \u0648\u0627\u0644\u062f\u0641\u0639"),e.qZA(),e.TgZ(7,"div",16),e._UZ(8,"app-currency-switcher"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"ion-card-content",17),e.TgZ(10,"div",18),e.TgZ(11,"ion-label",19),e._uU(12,"\u0646\u0648\u0639 \u0627\u0644\u0633\u0646\u062f"),e.qZA(),e.TgZ(13,"ion-segment",20),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().jType=o})("ionChange",function(o){return e.CHM(t),e.oxw().radioChange(o)}),e.TgZ(14,"ion-segment-button",21),e.TgZ(15,"div",22),e._UZ(16,"ion-icon",23),e.TgZ(17,"span"),e._uU(18,"\u0633\u0646\u062f \u062f\u0641\u0639"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"ion-segment-button",24),e.TgZ(20,"div",22),e._UZ(21,"ion-icon",25),e.TgZ(22,"span"),e._uU(23,"\u0633\u0646\u062f \u0642\u0628\u0636"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(24,"div",18),e.TgZ(25,"ion-label",19),e._uU(26,"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"),e.qZA(),e.TgZ(27,"ion-input",26),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().journal.j_date=o}),e.qZA(),e.qZA(),e.TgZ(28,"div",18),e.TgZ(29,"ion-label",19),e._uU(30,"\u0627\u0644\u0645\u0635\u062f\u0631"),e.qZA(),e.TgZ(31,"div",27),e.TgZ(32,"ion-select",28),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().radioVal=o})("ionChange",function(o){return e.CHM(t),e.oxw().pickAccountBank(o)}),e.TgZ(33,"ion-select-option",21),e._uU(34,"\u0627\u0644\u062e\u0632\u064a\u0646\u0629"),e.qZA(),e.YNc(35,w,2,2,"ion-select-option",29),e.qZA(),e.YNc(36,A,6,3,"div",30),e.qZA(),e.qZA(),e.TgZ(37,"div",18),e.TgZ(38,"ion-label",19),e._uU(39,"\u0627\u0644\u062d\u0633\u0627\u0628"),e.qZA(),e.TgZ(40,"div",27),e.TgZ(41,"div",31),e.NdJ("click",function(o){return e.CHM(t),e.oxw().presentAccountPopover(o)}),e.TgZ(42,"ion-input",32),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().selectedFromAccount.sub_name=o}),e.qZA(),e._UZ(43,"ion-icon",33),e.qZA(),e.YNc(44,B,6,3,"div",30),e.qZA(),e.qZA(),e.TgZ(45,"div",18),e.TgZ(46,"ion-label",19),e._uU(47,"\u0627\u0644\u0645\u0628\u0644\u063a"),e.qZA(),e.TgZ(48,"ion-input",34),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().pay=o}),e.qZA(),e.qZA(),e.TgZ(49,"div",18),e.TgZ(50,"ion-label",19),e._uU(51,"\u0627\u0644\u0628\u064a\u0627\u0646"),e.qZA(),e.TgZ(52,"ion-textarea",35),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().journal.j_details=o}),e.qZA(),e.qZA(),e.TgZ(53,"div",36),e.TgZ(54,"ion-button",37),e.NdJ("click",function(){return e.CHM(t),e.oxw().save()}),e._UZ(55,"ion-icon",38),e._uU(56," \u062d\u0641\u0640\u0638 "),e.qZA(),e.TgZ(57,"ion-button",39),e.NdJ("click",function(){return e.CHM(t),e.oxw().clearForm()}),e._UZ(58,"ion-icon",40),e._uU(59," \u0645\u0633\u062d "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(13),e.Q6J("ngModel",t.jType),e.xp6(14),e.Q6J("ngModel",t.journal.j_date),e.xp6(5),e.Q6J("ngModel",t.radioVal),e.xp6(3),e.Q6J("ngForOf",t.banksAccountArray),e.xp6(1),e.Q6J("ngIf",t.selectedBankAccount&&t.selectedBankAccount.sub_name),e.xp6(6),e.Q6J("ngModel",t.selectedFromAccount.sub_name),e.xp6(2),e.Q6J("ngIf",t.selectedFromAccount&&t.selectedFromAccount.sub_name),e.xp6(4),e.Q6J("ngModel",t.pay),e.xp6(4),e.Q6J("ngModel",t.journal.j_details),e.xp6(2),e.Q6J("disabled",!t.isFormValid())}}function I(a,m){if(1&a){const t=e.EpF();e.TgZ(0,"ion-item",54),e.NdJ("click",function(){const h=e.CHM(t).$implicit;return e.oxw(2).selectAccount(h)}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.qZA()}if(2&a){const t=m.$implicit;e.xp6(2),e.Oqu(t.sub_name)}}function L(a,m){if(1&a){const t=e.EpF();e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar",51),e.TgZ(2,"ion-searchbar",52),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().searchTerm=o})("ionInput",function(o){return e.CHM(t),e.oxw().searchAccount(o)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(3,"ion-content",51),e.TgZ(4,"ion-list"),e.YNc(5,I,3,1,"ion-item",53),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.searchTerm),e.xp6(3),e.Q6J("ngForOf",t.searchedAccounts)}}function N(a,m){if(1&a&&(e.TgZ(0,"ion-item"),e.TgZ(1,"ion-grid"),e.TgZ(2,"ion-row"),e.TgZ(3,"ion-col",60),e.TgZ(4,"ion-label"),e._uU(5),e.qZA(),e.qZA(),e.TgZ(6,"ion-col",61),e.TgZ(7,"ion-text",62),e._uU(8),e.ALo(9,"dateAgo"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&a){const t=m.$implicit;e.xp6(5),e.Oqu(t.desc),e.xp6(3),e.Oqu(e.lcZ(9,2,t.datee))}}function U(a,m){if(1&a&&(e.TgZ(0,"ion-list",58),e.YNc(1,N,10,4,"ion-item",59),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.LogHistoryLocalArr)}}function J(a,m){1&a&&(e.TgZ(0,"div",63),e.TgZ(1,"ion-label"),e._uU(2,"\u0644\u0627 \u062a\u0648\u062c\u062f \u0625\u0634\u0639\u0627\u0631\u0627\u062a \u062c\u062f\u064a\u062f\u0629"),e.qZA(),e.qZA())}function Y(a,m){if(1&a&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar",55),e.TgZ(2,"ion-title"),e._uU(3,"\u0627\u0644\u0625\u0634\u0639\u0627\u0631\u0627\u062a"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"ion-content",51),e.YNc(5,U,2,1,"ion-list",56),e.YNc(6,J,3,0,"div",57),e.qZA()),2&a){const t=e.oxw();e.xp6(5),e.Q6J("ngIf",t.LogHistoryLocalArr.length>0),e.xp6(1),e.Q6J("ngIf",0===t.LogHistoryLocalArr.length)}}const R=[{path:"",component:(()=>{class a{constructor(t,n,o,h,l,v,j,F,V,K,$,X){this.platform=t,this.behavApi=n,this.modalController=o,this.alertController=h,this.authenticationService=l,this.storage=v,this.loadingController=j,this.datePipe=F,this.api=V,this.toast=K,this.currencyService=$,this.cdr=X,this.notifArr=[],this.showNotif=!1,this.LogHistoryLocalArr=[],this.logHistoryArr=[],this.isOpenNotif=!1,this.newNotif=!1,this.sub_accountFrom=[],this.itemList=[],this.sub_accountTo=[],this.randomsNumber=[],this.jdetail_fromArr=[],this.journalType=[],this.journalTypeDetails=[],this.jType="1",this.pay=0,this.radioVal="1",this.jdetail_toArr=[],this.selectedFromAccountArr=[],this.selectedToAccountArr=[],this.banksAccountArray=[],this.showMe=null,this.showFrom=!1,this.showTo=!1,this.showFrom3=!1,this.showTo3=!1,this.coloredMsgFrom=!1,this.coloredMsgFrom3=!1,this.coloredMsgTo=!1,this.coloredMsgTo3=!1,this.isAccountPopoverOpen=!1,this.searchTerm="",this.searchedAccounts=[],this.selectedAccountBalance=null,this.sourceAccountBalance=null,this.loadingAccountBalance=!1,this.loadingSourceBalance=!1,this.selectedBankAccount={id:null,ac_id:null,sub_name:null,sub_type:null,sub_code:null,sub_balance:null,store_id:null,debit:null,credit:null,currentType:null},this.getAppInfo()}ngOnInit(){this.initializeCurrency()}ngOnDestroy(){this.currencySubscription&&this.currencySubscription.unsubscribe()}initializeCurrency(){return(0,x.mG)(this,void 0,void 0,function*(){yield this.currencyService.initializeCurrency(),yield this.currencyService.loadSupportedCurrencies(),this.store_info&&this.year&&(yield this.currencyService.loadRatesByYear(this.store_info.id,this.year.id)),this.currencySubscription=this.currencyService.getCurrentCurrency().subscribe(t=>{this.cdr.detectChanges()})})}presentAccountPopover(t){this.searchedAccounts=this.sub_accountFrom,this.isAccountPopoverOpen=!0}searchAccount(t){const n=t.target.value.toLowerCase();this.searchedAccounts=n&&""!==n.trim()?this.sub_accountFrom.filter(o=>o.sub_name.toLowerCase().indexOf(n)>-1):this.sub_accountFrom}selectAccount(t){this.pickAccount(t),this.isAccountPopoverOpen=!1,this.loadAccountBalance(t.id)}ionViewDidLeave(){this.subiscribtionNotif&&this.subiscribtionNotif.unsubscribe()}ionViewDidEnter(){}getAppInfo(){this.storage.get("USER_INFO").then(t=>{t&&(this.user_info=t)}),this.storage.get("year").then(t=>{t&&(this.year=t)}),this.storage.get("STORE_INFO").then(t=>{t&&(this.store_info=t,this.getAllAccounts(),this.getJournalType(),this.prepareInvo())})}coleredMsgFromFunc(){1==this.showFrom&&""==this.selectedFromAccount2.sub_name?this.coloredMsgFrom=!0:1==this.showFrom3&&""==this.selectedFromAccount3.sub_name&&(this.coloredMsgFrom3=!0),1==this.showTo&&""==this.selectedToAccount2.sub_name?this.coloredMsgTo=!0:1==this.showTo3&&""==this.selectedToAccount3.sub_name&&(this.coloredMsgTo3=!0),setTimeout(()=>{this.coloredMsgFrom=!1,this.coloredMsgFrom3=!1,this.coloredMsgTo=!1,this.coloredMsgTo3=!1},1e4)}radioChange(t){}pickAccount(t){let o,n=[t];n[0].debit>0?o="debit":n[0].credit>0&&(o="credit"),this.selectedFromAccount={id:n[0].id,ac_id:n[0].ac_id,sub_name:n[0].sub_name,sub_type:n[0].sub_type,sub_code:n[0].sub_code,store_id:n[0].store_id,sub_balance:n[0].sub_balance,currentType:o,debit:+n[0].debit,credit:+n[0].credit},this.selectedItem={id:"NULL",ac_id:this.selectedFromAccount.id,sub_name:this.selectedFromAccount.sub_name,sub_type:this.selectedFromAccount.sub_type,sub_code:this.selectedFromAccount.sub_code,store_id:this.selectedFromAccount.store_id,sub_balance:this.selectedFromAccount.sub_balance,currentType:this.selectedFromAccount.currentType,debit:this.selectedFromAccount.debit,credit:this.selectedFromAccount.credit}}pickAccountBank(t){if(console.log("ev",t.target.value),1==t.target.value)this.selectedBankAccount={id:46,ac_id:7,sub_name:"\u0627\u0644\u062e\u0632\u064a\u0646\u0629",sub_type:"",sub_code:"",store_id:this.store_info.id,sub_balance:"",currentType:"",debit:"",credit:""},this.loadSourceBalance(46);else{let n=this.banksAccountArray.filter(o=>o.id==t.target.value);console.log(this.banksAccountArray),console.log(n),this.selectedBankAccount={id:n[0].id,ac_id:n[0].ac_id,sub_name:n[0].sub_name,sub_type:n[0].sub_type,sub_code:n[0].sub_code,store_id:n[0].store_id,sub_balance:n[0].sub_balance,currentType:"",debit:+n[0].debit,credit:+n[0].credit},this.loadSourceBalance(n[0].id)}}prepare4save(){this.payInvo.rec_date=this.journal.j_date,this.payInvo.rec_date=this.datePipe.transform(this.payInvo.rec_date,"yyyy-MM-dd");let n=0,o=0;1==+this.jType?(n=+this.pay,this.journal.j_type="\u0633\u0646\u062f \u062f\u0641\u0639"):2==+this.jType&&(o=+this.pay,this.journal.j_type="\u0633\u0646\u062f \u0642\u0628\u0636"),this.itemList=[],this.itemList.push({id:"NULL",j_id:this.journal.j_id,j_ref:this.journal.j_ref,ac_id:this.selectedFromAccount.id,j_desc:this.selectedFromAccount.sub_type,j_type:"",credit:o,debit:n,store_id:this.store_info.id,sub_code:this.selectedFromAccount.sub_code,sub_name:this.selectedFromAccount.sub_name,yearId:this.year.id}),this.journal.j_pay=+this.pay;let l="",v="";1==+this.jType?(1==+this.radioVal?(this.jdetail_to={id:"NULL",j_id:this.journal.j_id,j_ref:this.journal.j_ref,ac_id:46,j_desc:"",j_type:"\u0633\u0646\u062f \u062f\u0641\u0639",credit:this.pay,debit:0,store_id:this.store_info.id,yearId:this.year.id},v="\u0627\u0644\u062e\u0632\u064a\u0646\u0629",l=this.selectedFromAccount.sub_name):1!=+this.radioVal&&(this.jdetail_to={id:"NULL",j_id:this.journal.j_id,j_ref:this.journal.j_ref,ac_id:this.selectedBankAccount.id,j_desc:"",j_type:"\u0633\u0646\u062f \u062f\u0641\u0639",credit:this.pay,debit:0,store_id:this.store_info.id,yearId:this.year.id},v=this.selectedBankAccount.sub_name,l=this.selectedFromAccount.sub_name),this.itemList[0].j_type="\u0633\u0646\u062f \u0642\u0628\u0636",this.jdetail_toArr.push(this.jdetail_to),this.jdetail_fromArr.push(this.itemList[0]),this.journal.standard_details="\u0645\u0646 \u062d\u0633\u0627\u0628 "+l+" \u0627\u0644\u064a \u062d\u0633\u0627\u0628 "+v):2==+this.jType&&(1==+this.radioVal?(this.jdetail_from={id:"NULL",j_id:this.journal.j_id,j_ref:this.journal.j_ref,ac_id:46,j_desc:"",j_type:"\u0633\u0646\u062f \u0642\u0628\u0636",credit:0,debit:this.pay,store_id:this.store_info.id,yearId:this.year.id},l="\u0627\u0644\u062e\u0632\u064a\u0646\u0629",v=this.selectedFromAccount.sub_name):1!=+this.radioVal&&(this.jdetail_from={id:"NULL",j_id:this.journal.j_id,j_ref:this.journal.j_ref,ac_id:this.selectedBankAccount.id,j_desc:"",j_type:"\u0633\u0646\u062f \u0642\u0628\u0636",credit:0,debit:+this.pay,store_id:this.store_info.id,yearId:this.year.id},l=this.selectedBankAccount.sub_name,v=this.selectedFromAccount.sub_name),this.itemList[0].j_type="\u0633\u0646\u062f \u062f\u0641\u0639",this.jdetail_toArr.push(this.itemList[0]),this.jdetail_fromArr.push(this.jdetail_from),this.journal.standard_details="\u0645\u0646 \u062d\u0633\u0627\u0628 "+l+" \u0627\u0644\u064a \u062d\u0633\u0627\u0628 "+v)}addTolist(){if(""==this.selectedItem.sub_name||""==this.selectedItem.id)this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u062d\u0633\u0627\u0628 ","danger");else if(0==+this.pay)this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062f\u062e\u0627\u0644 \u0627\u0644\u0645\u0628\u0644\u063a ","danger");else{let t=[];if(this.itemList.length>0&&(t=this.itemList.filter(n=>n.ac_id==this.selectedItem.ac_id)),0==t.length){let n=0,o=0;1==+this.jType?n=+this.pay:2==+this.jType&&(o=+this.pay),this.itemList.push({id:"NULL",j_id:this.journal.j_id,ac_id:this.selectedItem.id,j_ref:this.journal.j_ref,j_desc:this.selectedItem.sub_type,j_type:"",credit:o,debit:n,store_id:this.store_info.id,sub_code:this.selectedItem.sub_code,sub_name:this.selectedItem.sub_name,yearId:this.year.id})}this.getTotal(),this.pay=0,this.selectedItem={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:this.store_info.id,credit:"",debit:"",currentType:""},this.selectedFromAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:this.store_info.id,credit:"",debit:"",currentType:""}}}deleteItem(t){this.itemList.splice(t,1),this.pay=0,this.getTotal()}generateRandom(t){let n=new Date,o=n.getMonth().toString()+n.getDay().toString()+n.getHours().toString()+n.getMinutes().toString()+n.getSeconds().toString()+n.getMilliseconds().toString();"invo"==t?(this.payInvo.rec_ref=this.store_info.store_ref+"INV"+o,this.journal.invo_ref=this.payInvo.rec_ref):(this.journal.j_ref=this.store_info.store_ref+"JO"+o,this.jdetail_from.j_ref=this.journal.j_ref,this.jdetail_to.j_ref=this.journal.j_ref)}hideMe(t){this.showMe=null}editCell(t){1==+this.jType?+this.itemList[t].debit>0?(this.hideMe(t),this.getTotal()):this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u062f\u062e\u0627\u0644 ","danger"):2==+this.jType&&(+this.itemList[t].credit>0?(this.hideMe(t),this.getTotal()):this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u062f\u062e\u0627\u0644 ","danger"))}getTotal(){if(1==+this.jType){let t=this.itemList.reduce((n,o)=>n+ +o.debit,0);this.journal.j_pay=t}else if(2==+this.jType){let t=this.itemList.reduce((n,o)=>n+ +o.credit,0);this.journal.j_pay=t}}qtyClick(t){this.showMe=t}pickAccountTo(t,n,o){let h;h=o||t.target.value;let v,j,l=this.sub_accountTo.filter(F=>F.sub_name==h);l[0].debit>0?j="debit":l[0].credit>0&&(j="credit"),1==n?this.selectedToAccount={id:l[0].id,ac_id:l[0].ac_id,sub_name:l[0].sub_name,sub_type:l[0].sub_type,sub_code:l[0].sub_code,store_id:l[0].store_id,sub_balance:l[0].sub_balance,currentType:j,debit:+l[0].debit,credit:+l[0].credit}:2==n?this.selectedToAccount2={id:l[0].id,ac_id:l[0].ac_id,sub_name:l[0].sub_name,sub_type:l[0].sub_type,sub_code:l[0].sub_code,store_id:l[0].store_id,sub_balance:v,currentType:j,debit:+l[0].debit,credit:+l[0].credit}:3==n&&(this.selectedToAccount3={id:l[0].id,ac_id:l[0].ac_id,sub_name:l[0].sub_name,sub_type:l[0].sub_type,sub_code:l[0].sub_code,store_id:l[0].store_id,sub_balance:v,currentType:j,debit:+l[0].debit,credit:+l[0].credit})}prepareInvo(t){this.selectedItem={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:this.store_info.id,credit:"",debit:"",currentType:""},this.selectedFromAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:this.store_info.id,credit:"",debit:"",currentType:""},this.jdetail_from={id:"",j_id:"",j_ref:"",ac_id:"",credit:"",debit:"",j_desc:"",j_type:"",store_id:"",yearId:""},this.jdetail_to={id:"",j_id:"",j_ref:"",ac_id:"",credit:"",debit:"",j_desc:"",j_type:"",store_id:"",yearId:""},this.payInvo={rec_id:void 0,rec_ref:0,store_id:this.store_info.id,rec_date:"",user_id:"",ac_id:0,rec_detailes:"",rec_pay:0,rec_type:"",yearId:""},this.journal={j_id:void 0,j_ref:"",j_details:"",j_type:"",invo_ref:"",j_desc:"",j_date:"",store_id:this.store_info.id,user_id:"",j_pay:"",standard_details:"",yearId:""},this.jdetail_fromArr=[],this.jdetail_toArr=[],this.pay=0;let n=new Date;this.payInvo.rec_date=this.datePipe.transform(n,"yyyy-MM-dd"),this.journal.j_date=this.datePipe.transform(n,"yyyy-MM-dd"),this.generateRandom("invo"),this.generateRandom("journal"),this.payInvo.store_id=this.store_info.id,this.payInvo.yearId=this.year.id,this.payInvo.user_id=this.user_info.id,this.journal.invo_ref=this.payInvo.rec_ref,this.journal.store_id=this.store_info.id,this.journal.user_id=this.user_info.id,this.journal.yearId=this.year.id,this.journal.store_id=this.store_info.id,this.journal.user_id=this.user_info.id,this.jdetail_from.store_id=this.store_info.id,this.jdetail_from.j_ref=this.journal.j_ref,this.jdetail_from.yearId=this.year.id,this.jdetail_to.j_ref=this.journal.j_ref,this.jdetail_to.store_id=this.store_info.id,this.jdetail_to.yearId=this.year.id,this.radioVal="1",this.jType="1",t&&this.loadingController.dismiss(),this.getAllAccounts()}getAllAccounts(){console.log("getAllAccounts",this.store_info.id,this.year.id),this.api.getAllAccounts(this.store_info.id,this.year.id).subscribe(t=>{let n=t;console.log("res",n),this.sub_accountFrom=n.data,this.sub_accountTo=n.data,this.sub_accountFrom=this.sub_accountFrom.filter(o=>8!=o.ac_id&&9!=o.ac_id),this.getBanksAccount(),this.prepareCurrentBalnces()},t=>{})}getBanksAccount(){this.banksAccountArray=this.sub_accountFrom.filter(t=>7==t.ac_id),console.log("banksAccountArray",this.banksAccountArray)}prepareCurrentBalnces(){for(let t=0;t<this.sub_accountFrom.length;t++){const n=this.sub_accountFrom[t];let o=+n.fromDebitTot+ +n.toDebitTot,h=+n.fromCreditTot+ +n.toCreditTot;if("debit"==n.sub_type){let l=+n.sub_balance+ +o-+h;l>0?(n.debit=l,n.credit=0):l<0?(l*=-1,n.debit=0,n.credit=l):0==l&&(n.debit=l,n.credit=0)}else if("credit"==n.sub_type){let l=+n.sub_balance+ +h-+o;l>0?(n.debit=0,n.credit=l):l<0?(l*=-1,n.debit=l,n.credit=0):0==l&&(n.debit=0,n.credit=l)}}this.sub_accountTo=this.sub_accountFrom}getJournalType(){this.api.getJournalType(this.store_info.id).subscribe(t=>{this.journalType=t.data,this.getJournalTypeDetails()},t=>{})}getJournalTypeDetails(){this.api.getJournalTypeDetails(this.store_info.id).subscribe(t=>{this.journalTypeDetails=t.data},t=>{})}payChange(t){this.jdetail_from.debit=t.target.value,this.jdetail_to.credit=t.target.value}validate(){return 0==+this.radioVal||0==+this.jType?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631  \u0646\u0648\u0639 \u0627\u0644\u0633\u0646\u062f ","danger"),!1):0==+this.journal.j_pay?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062f\u062e\u0627\u0644 \u0645\u0639\u0627\u0645\u0644\u0627\u062a ","danger"),!1):0!=+this.jdetail_fromArr[0].ac_id&&0!=+this.jdetail_toArr[0].ac_id||void this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u062d\u0633\u0627\u0628 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a  ","danger")}setStandard(){let t="",n="",o="",h="";1==this.showFrom&&null!=this.selectedFromAccount2.sub_name?t=" , "+this.selectedFromAccount2.sub_name:1==this.showFrom3&&null!=this.selectedFromAccount3.sub_name&&(n=" , "+this.selectedFromAccount3.sub_name),1==this.showTo&&null!=this.selectedToAccount2.sub_name?o=" , "+this.selectedToAccount2.sub_name:1==this.showTo3&&null!=this.selectedToAccount3.sub_name&&(h=" , "+this.selectedToAccount3.sub_name),this.journal.standard_details="\u0645\u0646 \u062d\u0633\u0627\u0628 "+this.selectedFromAccount.sub_name+t+n+" \u0627\u0644\u064a \u062d\u0633\u0627\u0628 "+this.selectedToAccount.sub_name+o+h}save(){this.prepare4save(),1==this.validate()&&(this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),this.saveJournal())}presentModalSales(t,n,o){return(0,x.mG)(this,void 0,void 0,function*(){8==this.selectedToAccount.ac_id&&(t="sales",""==this.selectedFromAccount2.sub_name&&1==this.showFrom?this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644","warning"):""!=this.selectedFromAccount2.sub_name&&1==this.showFrom&&(n=this.selectedFromAccount2.sub_name,o=this.selectedFromAccount2.id)),9==this.selectedFromAccount.ac_id&&(t="purch",""==this.selectedToAccount2.sub_name&&1==this.showTo?this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0645\u0648\u0631\u062f","warning"):""!=this.selectedToAccount2.sub_name&&1==this.showTo&&(n=this.selectedToAccount2.sub_name,o=this.selectedToAccount2.id));const h=yield this.modalController.create({component:"AccountModalPage",componentProps:{type:t,sub_name:n,cust_id:o}});return h.onDidDismiss().then(l=>{null!==l&&this.doAfterDissmiss(l)}),yield h.present()})}doAfterDissmiss(t){("sales"==t.role||"purch"==t.role)&&(this.journal.j_details=this.journal.j_details+", "+t.data[1]+" , \u0631\u0642\u0645 :  "+t.data[0].pay_id+" \u0628\u062a\u0627\u0631\u064a\u062e "+t.data[0].pay_date+", \u0625\u062c\u0645\u0627\u0644\u064a : "+(+t.data[0].tot_pr-+t.data[0].discount))}saveJournal(){this.api.saveJournal(this.journal).subscribe(t=>{if("Post Not Created"!=t.message){for(let n=0;n<this.jdetail_fromArr.length;n++)this.jdetail_fromArr[n].j_id=t.message;for(let n=0;n<this.jdetail_toArr.length;n++)this.jdetail_toArr[n].j_id=t.message;this.saveJournalFrom()}else this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss()},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss()})}generateRandom2(t){let n=new Date,o=n.getMonth().toString()+n.getDay().toString()+n.getHours().toString()+n.getMinutes().toString()+n.getSeconds().toString()+n.getMilliseconds().toString()+t;return this.store_info.store_ref+o}saveJournalFrom(){this.api.saveJournalFrom(this.jdetail_fromArr).subscribe(t=>{"Post Not Created"!=t.message?this.saveJournalTo():(this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss())},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss()})}saveJournalTo(){this.api.saveJournalTo(this.jdetail_toArr).subscribe(t=>{"Post Not Created"!=t.message?(this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success"),this.loadingController.dismiss(),this.prepareInvo("saved")):(this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss())},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger"),this.loadingController.dismiss()})}performSync(){return(0,x.mG)(this,void 0,void 0,function*(){yield this.saveLogHistory()})}presentLoadingWithOptions(t){return(0,x.mG)(this,void 0,void 0,function*(){const n=yield this.loadingController.create({spinner:"bubbles",mode:"ios",message:t,translucent:!0,backdropDismiss:!1});yield n.present(),yield n.onDidDismiss()})}saveLogHistory(){let t,n,o;this.logHistoryArr.length>1?(o=this.logHistoryArr[1],n=this.logHistoryArr[0],t="new account"):(o=this.logHistoryArr[0],t=void 0),this.api.saveLogHistoryMultiSales(o,n,t).subscribe(h=>{"Post Not Created"!=h.message?this.logHistoryArr=[]:this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},h=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}presentPopoverNotif(t){this.notifArr=[],this.showNotif=!1,this.popoverNotif22.event=t,this.isOpenNotif=!0}didDissmisNotif(){this.isOpenNotif=!1}presentToast(t,n){return(0,x.mG)(this,void 0,void 0,function*(){(yield this.toast.create({message:t,duration:2e3,color:n,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})}isFormValid(){return!!(this.jType&&0!=+this.jType&&this.radioVal&&0!=+this.radioVal&&this.pay&&!(+this.pay<=0)&&this.selectedFromAccount&&this.selectedFromAccount.sub_name&&""!==this.selectedFromAccount.sub_name&&(1==+this.radioVal||this.selectedBankAccount&&this.selectedBankAccount.sub_name&&""!==this.selectedBankAccount.sub_name)&&this.journal.j_details&&""!==this.journal.j_details.trim()&&this.journal.j_date&&""!==this.journal.j_date)}clearForm(){var t,n;this.pay=0,this.jType="1",this.radioVal="1",this.selectedFromAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:(null===(t=this.store_info)||void 0===t?void 0:t.id)||"",debit:"",credit:"",currentType:""},this.selectedItem={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:(null===(n=this.store_info)||void 0===n?void 0:n.id)||"",debit:"",credit:"",currentType:""},this.selectedBankAccount={id:null,ac_id:null,sub_name:null,sub_type:null,sub_code:null,sub_balance:null,store_id:null,debit:null,credit:null,currentType:null},this.itemList=[],this.jdetail_fromArr=[],this.jdetail_toArr=[],this.showFrom=!1,this.showTo=!1,this.showFrom3=!1,this.showTo3=!1,this.showMe=null,this.coloredMsgFrom=!1,this.coloredMsgFrom3=!1,this.coloredMsgTo=!1,this.coloredMsgTo3=!1,this.searchTerm="",this.isAccountPopoverOpen=!1,this.searchedAccounts=[],this.prepareInvo(),this.selectedAccountBalance=null,this.sourceAccountBalance=null}loadAccountBalance(t){!t||!this.store_info||!this.year||(this.loadingAccountBalance=!0,this.selectedAccountBalance=null,this.api.getAccountBalance(t,this.store_info.id,this.year.id).subscribe(n=>{this.loadingAccountBalance=!1,n.success?(this.selectedAccountBalance=n.data,console.log("Account balance loaded:",this.selectedAccountBalance),console.log("INVOICE AMOUNT:",this.selectedAccountBalance.invoice_amount),console.log("CURRENT BALANCE:",this.selectedAccountBalance.current_balance),console.log("CUSTOMER TOTALS:",this.selectedAccountBalance.customer_totals),console.log("TOTAL DEBITS:",this.selectedAccountBalance.journal_transactions.total_debits),console.log("Debug info:",this.selectedAccountBalance.debug_info)):(console.error("Failed to load account balance:",n.message),this.selectedAccountBalance=null)},n=>{this.loadingAccountBalance=!1,console.error("Error loading account balance:",n),this.selectedAccountBalance=null}))}loadSourceBalance(t){!t||!this.store_info||!this.year||(this.loadingSourceBalance=!0,this.sourceAccountBalance=null,this.api.getAccountBalance(t,this.store_info.id,this.year.id).subscribe(n=>{this.loadingSourceBalance=!1,n.success?(this.sourceAccountBalance=n.data,console.log("Source balance loaded:",this.sourceAccountBalance),console.log("Source debug info:",this.sourceAccountBalance.debug_info)):(console.error("Failed to load source balance:",n.message),this.sourceAccountBalance=null)},n=>{this.loadingSourceBalance=!1,console.error("Error loading source balance:",n),this.sourceAccountBalance=null}))}formatBalance(t){return t?`${parseFloat(t.current_balance||0).toFixed(2)} ${"debit"===t.balance_type?"\u0645\u062f\u064a\u0646":"\u062f\u0627\u0626\u0646"}`:"0.00"}getBalanceColor(t){return t?"debit"===t.balance_type?"success":"danger":"medium"}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(u.t4),e.Y36(y.h),e.Y36(u.IN),e.Y36(u.Br),e.Y36(b.u),e.Y36(C.K),e.Y36(u.HT),e.Y36(f.uU),e.Y36(i.r),e.Y36(u.yF),e.Y36(c.i),e.Y36(e.sBO))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-cash2"]],viewQuery:function(t,n){if(1&t&&e.Gf(P,5),2&t){let o;e.iGM(o=e.CRH())&&(n.popoverNotif22=o.first)}},decls:9,vars:4,consts:[[1,"modern-content"],["class","loading-container",4,"ngIf"],["class","main-container",4,"ngIf"],["side","bottom","alignment","start",3,"isOpen","didDismiss"],["accountPopover",""],[3,"isOpen","didDismiss"],["popoverNotif22",""],[1,"loading-container"],["name","crescent"],[1,"loading-text"],[1,"main-container"],[1,"form-container"],[1,"form-card"],[1,"card-header"],[1,"header-row"],[1,"card-title"],[1,"currency-switcher-container"],[1,"compact-content"],[1,"field-row"],[1,"field-label-right"],[1,"mini-segment",3,"ngModel","ngModelChange","ionChange"],["value","1"],[1,"segment-content"],["name","arrow-up-outline"],["value","2"],["name","arrow-down-outline"],["type","date",1,"mini-input",3,"ngModel","ngModelChange"],[1,"field-with-balance"],["placeholder","\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0635\u062f\u0631","interface","action-sheet",1,"mini-select",3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["class","balance-display",4,"ngIf"],[1,"input-with-icon",3,"click"],["readonly","true","placeholder","\u0627\u062e\u062a\u0631 \u0627\u0644\u062d\u0633\u0627\u0628",1,"mini-input","readonly-input",3,"ngModel","ngModelChange"],["name","chevron-down-outline",1,"dropdown-icon"],["type","number","placeholder","0.00",1,"mini-input","amount-input",3,"ngModel","ngModelChange"],["rows","1","placeholder","\u0648\u0635\u0641 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629...",1,"mini-textarea",3,"ngModel","ngModelChange"],[1,"button-row"],[1,"mini-btn","save-btn",3,"disabled","click"],["name","checkmark-outline","slot","start"],["fill","outline",1,"mini-btn","clear-btn",3,"click"],["name","refresh-outline","slot","start"],[3,"value"],[1,"balance-display"],[1,"balance-label"],["class","balance-amount",3,"color",4,"ngIf"],["class","balance-loading",4,"ngIf"],["class","balance-error",4,"ngIf"],[1,"balance-amount"],[1,"balance-loading"],["name","dots","color","primary"],[1,"balance-error"],["dir","rtl"],["placeholder","\u0628\u062d\u062b \u0639\u0646 \u062d\u0633\u0627\u0628","dir","rtl",3,"ngModel","ngModelChange","ionInput"],["button","","dir","rtl",3,"click",4,"ngFor","ngForOf"],["button","","dir","rtl",3,"click"],["dir","rtl",1,"ion-text-center"],["class","ion-text-center",4,"ngIf"],["class","ion-text-center ion-padding",4,"ngIf"],[1,"ion-text-center"],[4,"ngFor","ngForOf"],["size","9"],["size","3"],["color","primary"],[1,"ion-text-center","ion-padding"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-content",0),e.YNc(1,O,4,0,"div",1),e.YNc(2,z,60,10,"div",2),e.qZA(),e.TgZ(3,"ion-popover",3,4),e.NdJ("didDismiss",function(){return n.isAccountPopoverOpen=!1}),e.YNc(5,L,6,2,"ng-template"),e.qZA(),e.TgZ(6,"ion-popover",5,6),e.NdJ("didDismiss",function(){return n.didDissmisNotif()}),e.YNc(8,Y,7,2,"ng-template"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",!n.user_info||!n.store_info||!n.journal),e.xp6(1),e.Q6J("ngIf",n.user_info&&n.store_info&&n.journal),e.xp6(1),e.Q6J("isOpen",n.isAccountPopoverOpen),e.xp6(3),e.Q6J("isOpen",n.isOpenNotif))},directives:[u.W2,f.O5,u.d8,u.PQ,u.PM,u.Zi,u.Dq,r.d,u.FN,u.Q$,u.cJ,u.QI,d.JJ,d.On,u.GO,u.gu,u.pK,u.j9,u.t9,u.n0,f.sg,u.as,u.g2,u.YG,u.Gu,u.sr,u.VI,u.q_,u.Ie,u.wd,u.jY,u.Nd,u.wI,u.yW],pipes:[s.v,p.R],styles:['[_ngcontent-%COMP%]:root{--liquid-glass-bg: rgba(255, 255, 255, .15);--liquid-glass-bg-light: rgba(255, 255, 255, .25);--liquid-glass-bg-dark: rgba(0, 0, 0, .15);--liquid-glass-border: rgba(255, 255, 255, .2);--liquid-glass-shadow: 0 8px 32px rgba(0, 0, 0, .15);--liquid-glass-highlight: rgba(255, 255, 255, .4);--glass-blur: 20px;--glass-blur-strong: 40px;--glass-border-radius: 20px;--glass-border-radius-small: 12px;--glass-accent-primary: rgba(0, 122, 255, .8);--glass-accent-success: rgba(52, 199, 89, .8);--glass-accent-danger: rgba(255, 59, 48, .8);--glass-transition: all .3s cubic-bezier(.4, 0, .2, 1);--glass-transition-fast: all .15s cubic-bezier(.4, 0, .2, 1);--glass-scale-hover: 1.02;--glass-scale-active: .98}@media (prefers-color-scheme: dark){[_ngcontent-%COMP%]:root{--liquid-glass-bg: rgba(0, 0, 0, .25);--liquid-glass-bg-light: rgba(255, 255, 255, .1);--liquid-glass-bg-dark: rgba(0, 0, 0, .4);--liquid-glass-border: rgba(255, 255, 255, .1);--liquid-glass-shadow: 0 8px 32px rgba(0, 0, 0, .3);--liquid-glass-highlight: rgba(255, 255, 255, .2)}}.transparent-header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:1000;background:transparent;box-shadow:none;border:none}.transparent-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--border-width: 0;--border-color: transparent;--color: rgba(0, 0, 0, .8);--min-height: 60px;backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);background:linear-gradient(180deg,rgba(255,255,255,.25) 0%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.05) 100%);border-bottom:1px solid rgba(255,255,255,.1)}.transparent-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,rgba(255,255,255,.3) 0%,transparent 100%);opacity:.6;pointer-events:none}.transparent-toolbar[_ngcontent-%COMP%]{--background: transparent;--border-width: 0;--border-color: transparent;--color: rgba(0, 0, 0, .8);--min-height: 60px}.glass-menu-button[_ngcontent-%COMP%]{--background: rgba(255, 255, 255, .15);--background-hover: rgba(255, 255, 255, .25);--background-activated: rgba(255, 255, 255, .35);--color: rgba(0, 0, 0, .8);--border-radius: 12px;--padding-start: 12px;--padding-end: 12px;--padding-top: 8px;--padding-bottom: 8px;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);box-shadow:0 4px 12px #0000001a,0 1px 3px #0000000d;transition:var(--glass-transition)}.glass-menu-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px) scale(1.05);box-shadow:0 8px 20px #00000026,0 2px 6px #0000001a}.glass-menu-button[_ngcontent-%COMP%]:active{transform:translateY(0) scale(.95);box-shadow:0 2px 8px #0000001a,0 1px 3px #0000000d}.glass-menu-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.4rem;color:#000c;filter:drop-shadow(0 1px 2px rgba(255,255,255,.5))}.modern-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, rgba(120, 119, 198, .1) 0%, rgba(255, 255, 255, .05) 50%, rgba(74, 144, 226, .1) 100%);--padding-start: 4px;--padding-end: 4px;--padding-top: 4px;--padding-bottom: 4px;position:relative;overflow:visible}.modern-content[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 20% 50%,rgba(120,119,198,.1) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgba(74,144,226,.1) 0%,transparent 50%),radial-gradient(circle at 40% 80%,rgba(255,255,255,.05) 0%,transparent 50%);animation:glassShimmer 8s ease-in-out infinite;pointer-events:none;z-index:0}@keyframes glassShimmer{0%,to{opacity:.3;transform:scale(1)}50%{opacity:.6;transform:scale(1.05)}}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:50vh;gap:2rem;position:relative}.loading-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:50%;width:200px;height:200px;transform:translate(-50%,-50%);background:var(--liquid-glass-bg);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));border-radius:50%;border:1px solid var(--liquid-glass-border);animation:loadingPulse 2s ease-in-out infinite;z-index:0}@keyframes loadingPulse{0%,to{transform:translate(-50%,-50%) scale(1);opacity:.3}50%{transform:translate(-50%,-50%) scale(1.1);opacity:.6}}.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{position:relative;z-index:2;filter:drop-shadow(0 0 15px rgba(0,122,255,.4))}.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-10px;left:-10px;right:-10px;bottom:-10px;background:var(--liquid-glass-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-radius:50%;border:1px solid var(--liquid-glass-border);animation:spinnerGlow 1.5s ease-in-out infinite;z-index:-1}@keyframes spinnerGlow{0%,to{box-shadow:0 0 #007aff00}50%{box-shadow:0 0 20px #007aff4d}}.loading-text[_ngcontent-%COMP%]{color:#000c;font-size:1.1rem;font-weight:600;margin:0;position:relative;z-index:2;text-shadow:0 1px 2px rgba(255,255,255,.5);background:linear-gradient(90deg,rgba(0,0,0,.8) 0%,rgba(0,122,255,.8) 50%,rgba(0,0,0,.8) 100%);background-size:200% 100%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:textShimmer 2s ease-in-out infinite}@keyframes textShimmer{0%{background-position:-200% 0}to{background-position:200% 0}}.main-container[_ngcontent-%COMP%]{padding:.8rem;padding-top:65px;padding-bottom:15px;max-width:100%;margin:0 auto;height:100vh;overflow:hidden;display:flex;justify-content:center;align-items:flex-start;position:relative;z-index:1}.form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:60%;max-width:700px;min-width:400px;position:relative;z-index:2;margin-top:.5rem;animation:none}@keyframes glassFloat{0%,to{transform:translateY(0) rotateX(0)}50%{transform:translateY(-8px) rotateX(1deg)}}.form-card[_ngcontent-%COMP%]{margin:0;border-radius:var(--glass-border-radius);background:var(--liquid-glass-bg);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));border:.5px solid rgba(128,128,128,.3);box-shadow:0 10px 30px #00000026,0 4px 8px #0000001a,var(--liquid-glass-shadow),0 0 0 1px var(--liquid-glass-highlight) inset,0 1px 0 var(--liquid-glass-highlight) inset;display:flex;flex-direction:column;overflow:visible;max-height:none;position:relative;transition:var(--glass-transition);transform-style:preserve-3d;perspective:1000px}.form-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:40%;background:linear-gradient(180deg,var(--liquid-glass-highlight) 0%,transparent 100%);opacity:.3;pointer-events:none;border-radius:var(--glass-border-radius) var(--glass-border-radius) 0 0;z-index:1}.form-card[_ngcontent-%COMP%]:after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at center,var(--liquid-glass-highlight) 0%,transparent 50%);opacity:0;pointer-events:none;transition:var(--glass-transition);z-index:2;animation:glassSpecular 4s ease-in-out infinite}@keyframes glassSpecular{0%,to{opacity:0;transform:scale(.8) rotate(0)}50%{opacity:.1;transform:scale(1.2) rotate(180deg)}}.form-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px) scale(var(--glass-scale-hover));box-shadow:0 15px 40px #0003,0 8px 15px #00000026,0 20px 40px #0003,0 0 0 1px var(--liquid-glass-highlight) inset,0 1px 0 var(--liquid-glass-highlight) inset;border-color:#80808066}.form-card[_ngcontent-%COMP%]:hover:after{opacity:.15}.card-header[_ngcontent-%COMP%]{background:var(--ion-color-primary)!important;backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));border:none;border-bottom:1px solid var(--liquid-glass-border);padding:.6rem 1rem;flex-shrink:0;position:relative;z-index:3}.card-header[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,var(--liquid-glass-highlight) 0%,transparent 100%);opacity:.4;pointer-events:none}.header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;position:relative;z-index:1}.currency-switcher-container[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;align-items:center}.card-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:800;margin:0;text-align:right;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.3);position:relative;z-index:1;flex:1;background:linear-gradient(135deg,white 0%,rgba(255,255,255,.8) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.compact-header[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: white;padding:.4rem .8rem;border-bottom:none;flex-shrink:0}.form-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;margin:0;text-align:center}.compact-content[_ngcontent-%COMP%]{padding:.8rem;flex:1;display:flex;flex-direction:column;overflow-y:visible;max-height:none}.field-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.8rem;min-height:auto}.field-label-right[_ngcontent-%COMP%]{flex:0 0 100px;text-align:right;direction:rtl;font-size:1rem!important;font-weight:700;color:#000;margin:0;padding-right:.5rem;padding-top:.4rem;align-self:flex-start}.mini-segment[_ngcontent-%COMP%]{flex:1;background:var(--liquid-glass-bg);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));border:1px solid var(--liquid-glass-border);border-radius:var(--glass-border-radius-small);padding:.2rem;height:2.8rem;min-height:2.8rem;position:relative;overflow:hidden}.mini-segment[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,var(--liquid-glass-highlight) 0%,transparent 100%);opacity:.2;pointer-events:none;border-radius:var(--glass-border-radius-small) var(--glass-border-radius-small) 0 0}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--indicator-color: transparent;--indicator-color-checked: transparent;--color: rgba(0, 0, 0, .7);--color-checked: white;--background: transparent;--background-checked: var(--glass-accent-primary);border-radius:var(--glass-border-radius-small);margin:.1rem;min-height:2rem;font-size:.85rem;font-weight:600;transition:var(--glass-transition);position:relative;overflow:hidden}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:var(--liquid-glass-bg-light);border-radius:var(--glass-border-radius-small);opacity:0;transition:var(--glass-transition);pointer-events:none}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]:hover:before{opacity:1}.mini-segment[_ngcontent-%COMP%]   ion-segment-button.segment-button-checked[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--ion-color-primary) 0%,var(--ion-color-primary-shade) 100%);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);box-shadow:0 4px 15px rgba(var(--ion-color-primary-rgb),.3),0 0 0 1px var(--liquid-glass-highlight) inset;transform:translateY(-1px)}.mini-segment[_ngcontent-%COMP%]   ion-segment-button.segment-button-checked[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,var(--liquid-glass-highlight) 0%,transparent 100%);opacity:.6;pointer-events:none;border-radius:var(--glass-border-radius-small) var(--glass-border-radius-small) 0 0}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;position:relative;z-index:1}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem;filter:drop-shadow(0 1px 2px rgba(0,0,0,.2))}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,.1)}.mini-input[_ngcontent-%COMP%]{flex:1;background:var(--liquid-glass-bg-light);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);--color: rgba(0, 0, 0, .9);--placeholder-color: rgba(0, 0, 0, .5);--padding-start: .8rem;--padding-end: .8rem;--padding-top: .6rem;--padding-bottom: .6rem;border:.5px solid rgba(128,128,128,.4);border-radius:var(--glass-border-radius-small);font-size:1rem;font-weight:500;min-height:2.8rem;max-height:2.8rem;transition:var(--glass-transition);position:relative;z-index:2}.mini-input[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:100%;background:linear-gradient(135deg,var(--liquid-glass-highlight) 0%,transparent 50%);opacity:.1;pointer-events:none;border-radius:var(--glass-border-radius-small)}.mini-input[_ngcontent-%COMP%]:focus-within{transform:translateY(-2px);border-color:var(--glass-accent-primary);box-shadow:0 8px 25px #007aff26,0 0 0 3px #007aff1a;background:var(--liquid-glass-bg)}.mini-input.readonly-input[_ngcontent-%COMP%]{--color: rgba(0, 0, 0, .8);cursor:pointer;background:var(--liquid-glass-bg)}.mini-input.readonly-input[_ngcontent-%COMP%]:hover{transform:translateY(-1px);background:var(--liquid-glass-bg-light)}.mini-input.amount-input[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;--color: var(--glass-accent-primary);text-align:center}.mini-input.amount-input[_ngcontent-%COMP%]:focus-within{--color: rgba(0, 122, 255, 1);text-shadow:0 0 10px rgba(0,122,255,.3)}.mini-select[_ngcontent-%COMP%]{flex:1;background:var(--liquid-glass-bg-light);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);--color: rgba(0, 0, 0, .9);--placeholder-color: rgba(0, 0, 0, .5);--padding-start: .8rem;--padding-end: .8rem;--padding-top: .6rem;--padding-bottom: .6rem;border:.5px solid rgba(128,128,128,.4);border-radius:var(--glass-border-radius-small);font-size:1rem;font-weight:500;min-height:2.8rem;max-height:2.8rem;transition:var(--glass-transition);position:relative;z-index:2}.mini-select[_ngcontent-%COMP%]:hover{transform:translateY(-1px);background:var(--liquid-glass-bg);border-color:var(--glass-accent-primary)}.mini-select[_ngcontent-%COMP%]:focus-within{transform:translateY(-2px);border-color:var(--glass-accent-primary);box-shadow:0 8px 25px #007aff26,0 0 0 3px #007aff1a}.mini-textarea[_ngcontent-%COMP%]{flex:1;background:var(--liquid-glass-bg-light);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);--color: rgba(0, 0, 0, .9);--placeholder-color: rgba(0, 0, 0, .5);--padding-start: .8rem;--padding-end: .8rem;--padding-top: .6rem;--padding-bottom: .6rem;border:.5px solid rgba(128,128,128,.4);border-radius:var(--glass-border-radius-small);font-size:1rem;font-weight:500;min-height:2.8rem;max-height:2.8rem;resize:none;transition:var(--glass-transition)}.mini-textarea[_ngcontent-%COMP%]:focus-within{transform:translateY(-2px);border-color:var(--glass-accent-primary);box-shadow:0 8px 25px #007aff26,0 0 0 3px #007aff1a;background:var(--liquid-glass-bg)}.input-with-icon[_ngcontent-%COMP%]{flex:1;position:relative;display:flex;align-items:center;cursor:pointer;z-index:2}.field-with-balance[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.2rem;position:relative}.balance-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;padding:.2rem .6rem;background:var(--liquid-glass-bg);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:var(--glass-border-radius-small);border:1px solid var(--liquid-glass-border);min-height:1.8rem;max-height:1.8rem;font-size:.7rem;direction:rtl;text-align:right;position:relative;overflow:hidden;transition:var(--glass-transition);margin-top:.1rem;z-index:1;width:100%;clear:both;animation:none}.balance-display[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:40%;background:linear-gradient(180deg,var(--liquid-glass-highlight) 0%,transparent 100%);opacity:.2;pointer-events:none;border-radius:var(--glass-border-radius-small) var(--glass-border-radius-small) 0 0}.balance-display[_ngcontent-%COMP%]:after{content:"";position:absolute;top:-2px;left:-50%;width:200%;height:2px;background:linear-gradient(90deg,transparent 0%,var(--liquid-glass-highlight) 50%,transparent 100%);animation:balanceShimmer 2s ease-in-out infinite;opacity:.6}.balance-display[_ngcontent-%COMP%]:hover{transform:translateY(-2px) scale(1.02);background:var(--liquid-glass-bg-light);box-shadow:0 8px 25px #00000026,0 0 0 1px var(--liquid-glass-highlight) inset}@keyframes balanceFloat{0%,to{transform:translateY(0)}50%{transform:translateY(-2px)}}@keyframes balanceShimmer{0%{transform:translate(-100%);opacity:0}50%{opacity:.6}to{transform:translate(100%);opacity:0}}.balance-label[_ngcontent-%COMP%]{font-weight:700;color:#000000b3;font-size:.7rem;position:relative;z-index:1;text-shadow:0 1px 2px rgba(255,255,255,.5)}.balance-amount[_ngcontent-%COMP%]{font-weight:800;font-size:.8rem;flex:1;text-align:left;position:relative;z-index:1;filter:drop-shadow(0 1px 2px rgba(0,0,0,.1))}.balance-amount.positive[_ngcontent-%COMP%]{color:var(--glass-accent-success);text-shadow:0 0 10px rgba(52,199,89,.3)}.balance-amount.negative[_ngcontent-%COMP%]{color:var(--glass-accent-danger);text-shadow:0 0 10px rgba(255,59,48,.3)}.balance-loading[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;color:var(--glass-accent-primary);font-size:.7rem;position:relative;z-index:1}.balance-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:12px;height:12px;filter:drop-shadow(0 0 5px rgba(0,122,255,.3))}.balance-loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;text-shadow:0 1px 2px rgba(255,255,255,.5)}.balance-error[_ngcontent-%COMP%]{color:var(--glass-accent-danger);font-size:.7rem;font-style:italic;font-weight:600;position:relative;z-index:1;text-shadow:0 1px 2px rgba(255,255,255,.5);filter:drop-shadow(0 0 5px rgba(255,59,48,.2))}.dropdown-icon[_ngcontent-%COMP%]{position:absolute;right:.4rem;color:var(--ion-color-medium);font-size:.9rem;pointer-events:none}.button-row[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center;border-top:1px solid var(--liquid-glass-border);position:relative}.button-row[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:20%;right:20%;height:1px;background:linear-gradient(90deg,transparent 0%,var(--liquid-glass-highlight) 50%,transparent 100%);opacity:.5}.mini-btn[_ngcontent-%COMP%]{flex:0 0 130px;border-radius:var(--glass-border-radius-small);font-size:1rem;font-weight:700;min-height:3.2rem;max-height:3.2rem;transition:var(--glass-transition);position:relative;overflow:hidden;transform-style:preserve-3d;background:var(--liquid-glass-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid var(--liquid-glass-border);box-shadow:0 6px 15px #0000001a,0 2px 4px #0000000d,0 0 0 1px var(--liquid-glass-highlight) inset}.mini-btn[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,var(--liquid-glass-highlight) 0%,transparent 100%);opacity:.3;pointer-events:none;border-radius:var(--glass-border-radius-small) var(--glass-border-radius-small) 0 0}.mini-btn[_ngcontent-%COMP%]:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 12px 30px #00000026,0 4px 8px #0000001a,0 0 0 1px var(--liquid-glass-highlight) inset}.mini-btn[_ngcontent-%COMP%]:hover:before{opacity:.5}.mini-btn[_ngcontent-%COMP%]:active{transform:translateY(-1px) scale(.98);box-shadow:0 4px 10px #00000026,0 1px 2px #0000001a,0 0 0 1px var(--liquid-glass-highlight) inset}.mini-btn.save-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--glass-accent-success) 0%,rgba(52,199,89,.9) 100%);color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.3);border-color:#34c7594d;box-shadow:0 6px 15px #34c7594d,0 2px 4px #34c75933,0 0 0 1px var(--liquid-glass-highlight) inset}.mini-btn.save-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,rgba(52,199,89,.9) 0%,#34c759 100%);box-shadow:0 12px 30px #34c75966,0 4px 8px #34c7594d,0 0 0 1px var(--liquid-glass-highlight) inset}.mini-btn.save-btn[_ngcontent-%COMP%]:disabled{background:var(--liquid-glass-bg-dark);color:#ffffff80;text-shadow:none;transform:none;box-shadow:0 2px 6px #0000001a,0 0 0 1px var(--liquid-glass-border) inset;cursor:not-allowed}.mini-btn.save-btn[_ngcontent-%COMP%]:disabled:hover{transform:none;box-shadow:0 2px 6px #0000001a,0 0 0 1px var(--liquid-glass-border) inset}.mini-btn.clear-btn[_ngcontent-%COMP%]{background:var(--liquid-glass-bg-light);color:#000000b3;border-color:var(--liquid-glass-border)}.mini-btn.clear-btn[_ngcontent-%COMP%]:hover{background:var(--liquid-glass-bg);color:#000000e6;border-color:var(--glass-accent-primary)}ion-popover[_ngcontent-%COMP%]{--width: 320px;--max-width: 90vw;--height: 60vh;--max-height: 400px;--border-radius: 8px;--box-shadow: 0 4px 16px rgba(0, 0, 0, .2);direction:rtl}ion-searchbar[_ngcontent-%COMP%]{--background: #f8f9fa;--color: #000000;--placeholder-color: var(--ion-color-medium);--border-radius: 6px;--box-shadow: none;--icon-color: var(--ion-color-primary);padding:.4rem;--min-height: 2.5rem;direction:rtl;text-align:right}ion-list[_ngcontent-%COMP%]{--background: white}ion-item[_ngcontent-%COMP%]{--background: white;--color: #000000;--border-color: #f1f3f4;--padding-start: 1rem;--padding-end: 1rem;--min-height: 2.5rem;font-size:1rem;direction:rtl;text-align:right}ion-item[_ngcontent-%COMP%]:hover{--background: #f8f9fa}ion-item[_ngcontent-%COMP%]:active{--background: #e9ecef}ion-select[_ngcontent-%COMP%]{--placeholder-color: var(--ion-color-medium);--color: var(--ion-color-dark);font-size:.85rem}ion-select-option[_ngcontent-%COMP%]{font-size:.85rem;--color: var(--ion-color-dark)}ion-action-sheet[_ngcontent-%COMP%]{--button-color: var(--ion-color-dark);--button-background: white;--button-background-hover: #f8f9fa;--button-background-focused: #f8f9fa;--button-background-activated: #e9ecef}@media (max-width: 768px){.form-container[_ngcontent-%COMP%]{width:92%;min-width:320px;animation:none}.main-container[_ngcontent-%COMP%]{padding:.8rem;padding-bottom:20px;height:100vh;overflow-y:visible}.form-card[_ngcontent-%COMP%]{backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border-radius:16px}.form-card[_ngcontent-%COMP%]:hover{transform:none}.compact-content[_ngcontent-%COMP%]{padding:.6rem;gap:.4rem;overflow-y:visible;max-height:none}.field-row[_ngcontent-%COMP%]{min-height:auto;gap:.6rem;flex-direction:column;align-items:stretch}.field-label-right[_ngcontent-%COMP%]{flex:none;text-align:right;font-size:1rem!important;margin-bottom:.3rem}.mini-input[_ngcontent-%COMP%], .mini-select[_ngcontent-%COMP%], .mini-textarea[_ngcontent-%COMP%]{min-height:2.8rem;max-height:2.8rem;font-size:1rem;border-radius:10px}.mini-input[_ngcontent-%COMP%]:focus-within, .mini-select[_ngcontent-%COMP%]:focus-within, .mini-textarea[_ngcontent-%COMP%]:focus-within{transform:none;border-color:var(--glass-accent-primary);box-shadow:0 4px 15px #007aff33,0 0 0 2px #007aff26}.mini-segment[_ngcontent-%COMP%]{height:3.5rem;min-height:3.5rem;border-radius:10px}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{min-height:2rem;font-size:.95rem;border-radius:8px}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]:active{transform:scale(.95)}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]{gap:.4rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.1rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.95rem}.mini-btn[_ngcontent-%COMP%]{min-height:3.2rem;max-height:3.2rem;font-size:1rem;flex:0 0 120px;border-radius:10px}.mini-btn[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.mini-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}.balance-display[_ngcontent-%COMP%]{min-height:2.2rem;padding:.6rem .8rem;font-size:.85rem;border-radius:8px;animation:none}.balance-display[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.balance-label[_ngcontent-%COMP%]{font-size:.8rem}.balance-amount[_ngcontent-%COMP%]{font-size:.9rem}.button-row[_ngcontent-%COMP%]{gap:1rem;margin-top:1.2rem;flex-direction:row;justify-content:space-around}.button-row[_ngcontent-%COMP%]   .mini-btn[_ngcontent-%COMP%]{flex:1;max-width:45%}.modern-content[_ngcontent-%COMP%]:before{animation-duration:12s}}@media (max-width: 480px){.form-container[_ngcontent-%COMP%]{width:95%;margin:0 auto}.main-container[_ngcontent-%COMP%]{padding:.8rem;padding-bottom:70px}.compact-content[_ngcontent-%COMP%]{padding:1rem;gap:.8rem}.field-row[_ngcontent-%COMP%]{min-height:1rem}.field-label-right[_ngcontent-%COMP%]{font-size:.9rem!important}.mini-input[_ngcontent-%COMP%], .mini-select[_ngcontent-%COMP%], .mini-textarea[_ngcontent-%COMP%]{min-height:2.8rem;max-height:2.8rem;font-size:.9rem;border-radius:8px}.mini-segment[_ngcontent-%COMP%]{height:3rem;min-height:3rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{min-height:2.2rem;font-size:.85rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   .segment-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.85rem}.mini-btn[_ngcontent-%COMP%]{min-height:2.8rem;max-height:2.8rem;font-size:.85rem}.balance-display[_ngcontent-%COMP%]{min-height:2rem;padding:.5rem .7rem;font-size:.8rem}.balance-label[_ngcontent-%COMP%]{font-size:.75rem}.balance-amount[_ngcontent-%COMP%]{font-size:.85rem}}@media (max-width: 480px){.form-container[_ngcontent-%COMP%]{width:95%;margin-top:.5rem}.main-container[_ngcontent-%COMP%]{padding:.5rem;padding-top:60px;padding-bottom:20px;height:100vh;overflow:hidden}.field-label-right[_ngcontent-%COMP%]{flex:0 0 80px;font-size:1rem!important}.mini-input[_ngcontent-%COMP%], .mini-select[_ngcontent-%COMP%], .mini-textarea[_ngcontent-%COMP%]{min-height:3.2rem;max-height:3.2rem;font-size:1rem}.mini-segment[_ngcontent-%COMP%]{height:3.2rem;min-height:3.2rem}.mini-btn[_ngcontent-%COMP%]{min-height:3.8rem;max-height:3.8rem;font-size:1rem;flex:0 0 120px}.balance-display[_ngcontent-%COMP%]{min-height:2rem;padding:.6rem .8rem;font-size:.9rem}.balance-label[_ngcontent-%COMP%]{font-size:.8rem}.balance-amount[_ngcontent-%COMP%]{font-size:.9rem}}@media (max-height: 600px){.main-container[_ngcontent-%COMP%]{height:100vh;padding-top:50px;padding-bottom:10px;overflow:hidden}.compact-content[_ngcontent-%COMP%]{gap:.4rem;padding:.8rem;overflow-y:visible}.field-row[_ngcontent-%COMP%]{min-height:3rem}.mini-input[_ngcontent-%COMP%], .mini-select[_ngcontent-%COMP%], .mini-textarea[_ngcontent-%COMP%]{min-height:2.8rem;max-height:2.8rem}.mini-segment[_ngcontent-%COMP%]{height:2.8rem;min-height:2.8rem}.mini-btn[_ngcontent-%COMP%]{min-height:3rem;max-height:3rem}}@media (max-height: 500px){.compact-header[_ngcontent-%COMP%]{padding:.4rem .8rem}.form-title[_ngcontent-%COMP%]{font-size:.95rem}.compact-content[_ngcontent-%COMP%]{padding:.6rem;gap:.3rem;overflow-y:visible;max-height:none}.main-container[_ngcontent-%COMP%]{padding-top:45px}.field-row[_ngcontent-%COMP%]{min-height:2rem}.field-label-right[_ngcontent-%COMP%]{font-size:.95rem!important;flex:0 0 75px}.mini-input[_ngcontent-%COMP%], .mini-select[_ngcontent-%COMP%], .mini-textarea[_ngcontent-%COMP%]{min-height:2rem;max-height:2.5rem;font-size:.95rem}.mini-segment[_ngcontent-%COMP%]{height:2.5rem;min-height:2rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{min-height:2rem;font-size:.9rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem}.mini-btn[_ngcontent-%COMP%]{min-height:2.8rem;max-height:2.8rem;font-size:.95rem}}@media (prefers-color-scheme: dark){.modern-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, rgba(30, 30, 30, .95) 0%, rgba(0, 0, 0, .9) 50%, rgba(20, 20, 40, .95) 100%)}.modern-content[_ngcontent-%COMP%]:before{background:radial-gradient(circle at 20% 50%,rgba(60,60,120,.15) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgba(40,80,140,.15) 0%,transparent 50%),radial-gradient(circle at 40% 80%,rgba(255,255,255,.02) 0%,transparent 50%)}.form-card[_ngcontent-%COMP%]{background:var(--liquid-glass-bg-dark);border:.5px solid rgba(128,128,128,.2);box-shadow:0 12px 35px #00000080,0 6px 12px #0000004d,0 8px 32px #0006,0 0 0 1px #ffffff0d inset,0 1px #ffffff1a inset}.form-card[_ngcontent-%COMP%]:hover{border-color:#8080804d}.card-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(0,122,255,.6) 0%,rgba(0,100,200,.8) 100%);border-bottom-color:#ffffff14}.card-title[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(255,255,255,.95) 0%,rgba(255,255,255,.7) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.mini-input[_ngcontent-%COMP%], .mini-select[_ngcontent-%COMP%], .mini-textarea[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border:.5px solid rgba(128,128,128,.3);--color: rgba(255, 255, 255, .9);--placeholder-color: rgba(255, 255, 255, .4)}.mini-input[_ngcontent-%COMP%]:focus-within, .mini-select[_ngcontent-%COMP%]:focus-within, .mini-textarea[_ngcontent-%COMP%]:focus-within{background:rgba(0,0,0,.2);border-color:#007affcc;box-shadow:0 8px 25px #007aff33,0 0 0 3px #007aff26}.mini-input.readonly-input[_ngcontent-%COMP%]:hover, .mini-select.readonly-input[_ngcontent-%COMP%]:hover, .mini-textarea.readonly-input[_ngcontent-%COMP%]:hover{background:rgba(0,0,0,.2)}.mini-input.amount-input[_ngcontent-%COMP%], .mini-select.amount-input[_ngcontent-%COMP%], .mini-textarea.amount-input[_ngcontent-%COMP%]{--color: rgba(0, 180, 255, .9)}.mini-input.amount-input[_ngcontent-%COMP%]:focus-within, .mini-select.amount-input[_ngcontent-%COMP%]:focus-within, .mini-textarea.amount-input[_ngcontent-%COMP%]:focus-within{--color: rgba(0, 180, 255, 1);text-shadow:0 0 15px rgba(0,180,255,.4)}.mini-segment[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-color:#ffffff1a}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--color: rgba(255, 255, 255, .7);--color-checked: white}.mini-segment[_ngcontent-%COMP%]   ion-segment-button.segment-button-checked[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--ion-color-primary) 0%,var(--ion-color-primary-shade) 100%);box-shadow:0 4px 15px rgba(var(--ion-color-primary-rgb),.4),0 0 0 1px #ffffff1a inset}.mini-btn[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-color:#ffffff1a;color:#ffffffe6}.mini-btn.save-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(52,199,89,.7) 0%,rgba(40,180,70,.8) 100%);border-color:#34c7594d;color:#fff}.mini-btn.save-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,rgba(52,199,89,.8) 0%,rgba(40,180,70,.9) 100%)}.mini-btn.save-btn[_ngcontent-%COMP%]:disabled{background:rgba(0,0,0,.4);color:#ffffff4d;border-color:#ffffff0d}.mini-btn.clear-btn[_ngcontent-%COMP%]{background:rgba(0,0,0,.2);color:#ffffffb3;border-color:#ffffff1a}.mini-btn.clear-btn[_ngcontent-%COMP%]:hover{background:rgba(0,0,0,.3);color:#ffffffe6;border-color:#007aff80}.balance-display[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-color:#ffffff14}.balance-display[_ngcontent-%COMP%]:hover{background:rgba(0,0,0,.2)}.balance-label[_ngcontent-%COMP%]{color:#ffffffb3;text-shadow:0 1px 2px rgba(0,0,0,.5)}.balance-loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .balance-error[_ngcontent-%COMP%]{text-shadow:0 1px 2px rgba(0,0,0,.5)}.field-label-right[_ngcontent-%COMP%]{color:#ffffffe6;text-shadow:0 1px 2px rgba(0,0,0,.3)}.loading-text[_ngcontent-%COMP%]{background:linear-gradient(90deg,rgba(255,255,255,.8) 0%,rgba(0,180,255,.9) 50%,rgba(255,255,255,.8) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}}.mini-input[_ngcontent-%COMP%]:focus-within, .mini-select[_ngcontent-%COMP%]:focus-within, .mini-textarea[_ngcontent-%COMP%]:focus-within{border-color:var(--ion-color-primary);box-shadow:0 0 0 1px rgba(var(--ion-color-primary-rgb),.2)}@media (hover: none) and (pointer: coarse){.mini-input[_ngcontent-%COMP%], .mini-select[_ngcontent-%COMP%], .mini-textarea[_ngcontent-%COMP%], .mini-btn[_ngcontent-%COMP%]{min-height:32px}.mini-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{min-height:30px}.field-row[_ngcontent-%COMP%]{min-height:36px}}']}),a})()}];let G=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[_.Bz.forChild(R)],_.Bz]}),a})();var H=g(78565),Q=g(62279);let W=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[f.ez,d.u5,H.G,Q.m,u.Pc,G]]}),a})()},12317:(k,M,g)=>{g.d(M,{d:()=>C});var f=g(42654),d=g(29863),u=g(6612),_=g(69808),x=g(23349);const e=["selectTrigger"];function y(i,c){if(1&i&&(d.TgZ(0,"div",5),d.TgZ(1,"span",6),d._uU(2),d.qZA(),d.qZA()),2&i){const r=d.oxw();let s;d.xp6(2),d.Oqu(null==(s=r.getSelectedCurrency())?null:s.currency_symbol)}}function b(i,c){1&i&&(d.TgZ(0,"div",7),d._UZ(1,"ion-icon",8),d.TgZ(2,"span"),d._uU(3,"\u0627\u062e\u062a\u0631 \u0627\u0644\u0639\u0645\u0644\u0629"),d.qZA(),d.qZA())}let C=(()=>{class i{constructor(r,s,p){this.currencyService=r,this.renderer=s,this.el=p,this.selectedCurrency="SDG",this.supportedCurrencies=[],this.isDropdownOpen=!1,this.subscription=new f.w,this.dropdownElement=null}ngOnInit(){this.loadSupportedCurrencies(),this.subscription.add(this.currencyService.getCurrentCurrency().subscribe(r=>{this.selectedCurrency=r},r=>{console.error("Error subscribing to currency changes:",r),this.selectedCurrency="SDG"}))}ngOnDestroy(){this.subscription.unsubscribe(),this.destroyDropdown()}loadSupportedCurrencies(){this.subscription.add(this.currencyService.getActiveCurrencies().subscribe(r=>{r&&r.data&&(this.supportedCurrencies=r.data)},r=>{console.error("Error loading currencies:",r),this.supportedCurrencies=[{currency_code:"SDG",currency_name_ar:"\u062c\u0646\u064a\u0647 \u0633\u0648\u062f\u0627\u0646\u064a",currency_symbol:"\u062c.\u0633"},{currency_code:"USD",currency_name_ar:"\u062f\u0648\u0644\u0627\u0631 \u0623\u0645\u0631\u064a\u0643\u064a",currency_symbol:"$"},{currency_code:"AED",currency_name_ar:"\u062f\u0631\u0647\u0645 \u0625\u0645\u0627\u0631\u0627\u062a\u064a",currency_symbol:"\u062f.\u0625"},{currency_code:"SAR",currency_name_ar:"\u0631\u064a\u0627\u0644 \u0633\u0639\u0648\u062f\u064a",currency_symbol:"\u0631.\u0633"}]}))}toggleDropdown(r){r.stopPropagation(),this.isDropdownOpen?this.closeDropdown():this.openDropdown()}openDropdown(){!this.selectTrigger||(this.isDropdownOpen=!0,this.createBodyLevelDropdown())}closeDropdown(){this.isDropdownOpen=!1,this.destroyDropdown()}createBodyLevelDropdown(){this.dropdownElement&&this.destroyDropdown();const s=this.selectTrigger.nativeElement.getBoundingClientRect();this.dropdownElement=this.renderer.createElement("div"),this.renderer.addClass(this.dropdownElement,"currency-dropdown-portal"),this.renderer.setStyle(this.dropdownElement,"position","fixed"),this.renderer.setStyle(this.dropdownElement,"z-index","10000"),this.renderer.setStyle(this.dropdownElement,"background","#ffffff"),this.renderer.setStyle(this.dropdownElement,"border","1px solid #e5e7eb"),this.renderer.setStyle(this.dropdownElement,"border-radius","12px"),this.renderer.setStyle(this.dropdownElement,"box-shadow","0 15px 35px rgba(0, 0, 0, 0.15)"),this.renderer.setStyle(this.dropdownElement,"max-height","300px"),this.renderer.setStyle(this.dropdownElement,"overflow-y","auto"),this.renderer.setStyle(this.dropdownElement,"min-width","200px"),this.positionDropdown(s),this.createCurrencyOptions(),this.renderer.appendChild(document.body,this.dropdownElement),setTimeout(()=>{this.dropdownElement&&(this.renderer.setStyle(this.dropdownElement,"opacity","1"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(0)"))},10)}positionDropdown(r){if(!this.dropdownElement)return;const s=window.innerHeight,P=s-r.bottom,O=r.top;this.renderer.setStyle(this.dropdownElement,"opacity","0"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(-10px)"),this.renderer.setStyle(this.dropdownElement,"transition","all 0.3s ease"),this.renderer.setStyle(this.dropdownElement,"left",r.left+"px"),this.renderer.setStyle(this.dropdownElement,"width",Math.max(r.width,200)+"px"),P>=300||P>=O?this.renderer.setStyle(this.dropdownElement,"top",r.bottom+4+"px"):this.renderer.setStyle(this.dropdownElement,"bottom",s-r.top+4+"px")}createCurrencyOptions(){!this.dropdownElement||this.supportedCurrencies.forEach(r=>{const s=this.renderer.createElement("div");this.renderer.addClass(s,"currency-option-portal"),this.renderer.setStyle(s,"display","flex"),this.renderer.setStyle(s,"align-items","center"),this.renderer.setStyle(s,"gap","12px"),this.renderer.setStyle(s,"padding","12px 16px"),this.renderer.setStyle(s,"cursor","pointer"),this.renderer.setStyle(s,"transition","background-color 0.2s ease"),this.renderer.setStyle(s,"border-bottom","1px solid #f3f4f6"),r.currency_code===this.selectedCurrency&&this.renderer.setStyle(s,"background","linear-gradient(135deg, #eff6ff, #dbeafe)");const p=this.renderer.createElement("div");this.renderer.setStyle(p,"width","36px"),this.renderer.setStyle(p,"height","36px"),this.renderer.setStyle(p,"border-radius","50%"),this.renderer.setStyle(p,"display","flex"),this.renderer.setStyle(p,"align-items","center"),this.renderer.setStyle(p,"justify-content","center"),this.renderer.setStyle(p,"font-weight","bold"),this.renderer.setStyle(p,"font-size","13px"),r.currency_code===this.selectedCurrency?(this.renderer.setStyle(p,"background","var(--ion-color-primary, #3880ff)"),this.renderer.setStyle(p,"color","white")):(this.renderer.setStyle(p,"background","#f1f5f9"),this.renderer.setStyle(p,"color","#475569"));const P=this.renderer.createText(r.currency_symbol);this.renderer.appendChild(p,P);const O=this.renderer.createElement("div");this.renderer.setStyle(O,"flex","1"),this.renderer.setStyle(O,"text-align","right");const w=this.renderer.createElement("div");this.renderer.setStyle(w,"font-size","14px"),this.renderer.setStyle(w,"font-weight","500"),this.renderer.setStyle(w,"color",r.currency_code===this.selectedCurrency?"var(--ion-color-primary, #3880ff)":"#374151"),this.renderer.setStyle(w,"line-height","1.3");const S=this.renderer.createText(r.currency_name_ar);this.renderer.appendChild(w,S);const T=this.renderer.createElement("div");this.renderer.setStyle(T,"font-size","12px"),this.renderer.setStyle(T,"color","#6b7280"),this.renderer.setStyle(T,"font-weight","500");const Z=this.renderer.createText(r.currency_code);if(this.renderer.appendChild(T,Z),this.renderer.appendChild(O,w),this.renderer.appendChild(O,T),r.currency_code===this.selectedCurrency){const A=this.renderer.createElement("div");this.renderer.setStyle(A,"color","#10b981"),this.renderer.setStyle(A,"font-size","18px");const D=this.renderer.createText("\u2713");this.renderer.appendChild(A,D),this.renderer.appendChild(s,A)}this.renderer.listen(s,"mouseenter",()=>{r.currency_code!==this.selectedCurrency&&this.renderer.setStyle(s,"background","#f8fafc")}),this.renderer.listen(s,"mouseleave",()=>{r.currency_code!==this.selectedCurrency&&this.renderer.setStyle(s,"background","transparent")}),this.renderer.listen(s,"click",A=>{A.stopPropagation(),this.selectCurrency(r,A)}),this.renderer.appendChild(s,p),this.renderer.appendChild(s,O),this.renderer.appendChild(this.dropdownElement,s)})}destroyDropdown(){this.dropdownElement&&(this.renderer.removeChild(document.body,this.dropdownElement),this.dropdownElement=null)}selectCurrency(r,s){s.stopPropagation(),this.selectedCurrency=r.currency_code,this.currencyService.setCurrency(this.selectedCurrency),this.closeDropdown()}getSelectedCurrency(){return this.supportedCurrencies.find(r=>r.currency_code===this.selectedCurrency)}onDocumentClick(r){(!r.target||!r.target.closest(".custom-select-container"))&&this.closeDropdown()}onWindowResize(){if(this.isDropdownOpen&&this.selectTrigger){const r=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(r)}}onWindowScroll(){if(this.isDropdownOpen&&this.selectTrigger){const r=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(r)}}getCurrencyDisplayText(r){return`${r.currency_name_ar} (${r.currency_code})`}}return i.\u0275fac=function(r){return new(r||i)(d.Y36(u.i),d.Y36(d.Qsj),d.Y36(d.SBq))},i.\u0275cmp=d.Xpm({type:i,selectors:[["app-currency-switcher"]],viewQuery:function(r,s){if(1&r&&d.Gf(e,5),2&r){let p;d.iGM(p=d.CRH())&&(s.selectTrigger=p.first)}},hostBindings:function(r,s){1&r&&d.NdJ("click",function(P){return s.onDocumentClick(P)},!1,d.evT)("resize",function(){return s.onWindowResize()},!1,d.Jf7)("scroll",function(){return s.onWindowScroll()},!1,d.Jf7)},decls:6,vars:2,consts:[[1,"currency-switcher-wrapper"],[1,"currency-trigger",3,"click"],["selectTrigger",""],["class","selected-display",4,"ngIf","ngIfElse"],["placeholder",""],[1,"selected-display"],[1,"currency-symbol"],[1,"placeholder-display"],["name","cash-outline"]],template:function(r,s){if(1&r&&(d.TgZ(0,"div",0),d.TgZ(1,"div",1,2),d.NdJ("click",function(P){return s.toggleDropdown(P)}),d.YNc(3,y,3,1,"div",3),d.YNc(4,b,4,0,"ng-template",null,4,d.W1O),d.qZA(),d.qZA()),2&r){const p=d.MAs(5);d.xp6(3),d.Q6J("ngIf",s.getSelectedCurrency())("ngIfElse",p)}},directives:[_.O5,x.gu],styles:[".currency-switcher-wrapper[_ngcontent-%COMP%]{display:inline-block;min-width:auto}.currency-trigger[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:8px;background:transparent;border:2px solid transparent;border-radius:8px;cursor:pointer;transition:all .3s ease;min-height:auto;width:-moz-fit-content;width:fit-content}.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary);background:rgba(var(--ion-color-primary-rgb),.05);box-shadow:0 2px 8px rgba(var(--ion-color-primary-rgb),.15)}.currency-trigger[_ngcontent-%COMP%]:active{transform:scale(.98)}.selected-display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;background:linear-gradient(135deg,var(--ion-color-primary),var(--ion-color-primary-shade));color:#fff;border-radius:50%;font-size:14px;font-weight:700;box-shadow:0 2px 6px rgba(var(--ion-color-primary-rgb),.25);transition:all .3s ease}.placeholder-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#9ca3af;font-size:14px;padding:8px}.placeholder-display[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.currency-trigger[_ngcontent-%COMP%]:hover   .selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{transform:scale(1.05);box-shadow:0 4px 12px rgba(var(--ion-color-primary-rgb),.35)}@media (max-width: 768px){.currency-trigger[_ngcontent-%COMP%]{padding:6px}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{width:32px;height:32px;font-size:13px}.placeholder-display[_ngcontent-%COMP%]{padding:6px}}@media (prefers-color-scheme: dark){.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary-tint);background:rgba(var(--ion-color-primary-rgb),.1)}.placeholder-display[_ngcontent-%COMP%]{color:#9ca3af}}[dir=rtl][_ngcontent-%COMP%]   .placeholder-display[_ngcontent-%COMP%]{text-align:left}"]}),i})()},62279:(k,M,g)=>{g.d(M,{m:()=>e});var f=g(69808),d=g(34182),u=g(23349),_=g(32090),x=g(29863);let e=(()=>{class y{}return y.\u0275fac=function(C){return new(C||y)},y.\u0275mod=x.oAB({type:y}),y.\u0275inj=x.cJS({providers:[f.uU],imports:[[f.ez,d.u5,d.UX,u.Pc,_.Fw]]}),y})()},1212:(k,M,g)=>{g.d(M,{v:()=>u});var f=g(29863),d=g(6612);let u=(()=>{class _{constructor(e){this.currencyService=e}transform(e,y="SDG",b=!0){if(!e&&0!==e||isNaN(e))return"0.00";try{const C=this.currencyService.getCurrentCurrencyValue();let i=e;return y!==C&&(i=this.currencyService.convertToCurrentCurrency(e,y)),b?this.currencyService.formatCurrency(i,C):i.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch(C){console.error("Currency display pipe error:",C);const i=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e);return b?i+" \u062c.\u0633":i}}}return _.\u0275fac=function(e){return new(e||_)(f.Y36(d.i,16))},_.\u0275pipe=f.Yjl({name:"currencyDisplay",type:_,pure:!1}),_})()},6612:(k,M,g)=>{g.d(M,{i:()=>y});var f=g(70655),d=g(40520),u=g(591),_=g(29863),x=g(90849),e=g(91472);let y=(()=>{class b{constructor(i,c,r){this.http=i,this.storage=c,this.servicesService=r,this.currentCurrency=new u.X("SDG"),this.currentYear=new u.X(null),this.exchangeRates=new u.X({}),this.supportedCurrencies=new u.X([]),this.ratesCache=new Map,this.api=this.servicesService.api}getCurrentCurrency(){return this.currentCurrency.asObservable()}getCurrentCurrencyValue(){return this.currentCurrency.value}setCurrency(i){this.currentCurrency.next(i),this.storage.set("selectedCurrency",i)}setCurrentYear(i){this.currentYear.next(i)}loadRatesByYear(i,c){return(0,f.mG)(this,void 0,void 0,function*(){try{const r=(new d.LE).set("store_id",i).set("year_id",c),s=yield this.http.get(this.api+"currency_rates/latest.php",{params:r}).toPromise();return s&&s.data&&(this.cacheRates(s.data,c),this.exchangeRates.next(s.data)),s}catch(r){return console.error("Error loading currency rates:",r),null}})}getExchangeRate(i){if("SDG"===i)return 1;const c=this.exchangeRates.value;if(Array.isArray(c)){const r=c.find(s=>s.target_currency===i);return r?parseFloat(r.exchange_rate):1}return 1}createCurrencyRate(i){const c={headers:new d.WM({"Content-Type":"application/json"})};return this.http.post(this.api+"currency_rates/create.php",i,c)}getCurrencyRates(i){let c=new d.LE;return Object.keys(i).forEach(r=>{i[r]&&(c=c.set(r,i[r]))}),this.http.get(this.api+"currency_rates/read.php",{params:c})}updateCurrencyRate(i,c){const r=Object.assign({id:i},c),s={headers:new d.WM({"Content-Type":"application/json"})};return this.http.put(this.api+"currency_rates/update.php",r,s)}deleteCurrencyRate(i){const c=(new d.LE).set("id",i);return this.http.delete(this.api+"currency_rates/delete.php",{params:c})}getNearestRate(i,c,r,s){const p=(new d.LE).set("currency",i).set("date",c).set("store_id",r).set("year_id",s);return this.http.get(this.api+"currency_rates/nearestDate.php",{params:p})}convertFromSDG(i,c){return"SDG"!==c&&i?i/this.getExchangeRate(c):i}convertToSDG(i,c){return"SDG"!==c&&i?i*this.getExchangeRate(c):i}formatCurrency(i,c){return`${i.toLocaleString("en-US",{minimumFractionDigits:2})} ${{SDG:"\u062c.\u0633",USD:"$",AED:"\u062f.\u0625",SAR:"\u0631.\u0633"}[c]||c}`}getSupportedCurrencies(){return this.http.get(this.api+"currencies/read.php")}getActiveCurrencies(){const i=(new d.LE).set("active_only","true");return this.http.get(this.api+"currencies/read.php",{params:i})}addSupportedCurrency(i){return this.http.post(this.api+"currencies/create.php",i)}updateSupportedCurrency(i,c){return this.http.put(this.api+"currencies/update.php",Object.assign({id:i},c))}deleteSupportedCurrency(i){const c=(new d.LE).set("id",i);return this.http.delete(this.api+"currencies/delete.php",{params:c})}cacheKey(i,c,r){return`${i}_${c}_${r}`}cacheRates(i,c){Array.isArray(i)&&i.forEach(r=>{const s=this.cacheKey(r.target_currency,r.rate_date,c);this.ratesCache.set(s,r)})}getCachedRate(i,c,r){const s=this.cacheKey(i,c,r);return this.ratesCache.get(s)}clearCache(){this.ratesCache.clear()}initializeCurrency(){return(0,f.mG)(this,void 0,void 0,function*(){try{yield this.storage.create();const i=yield this.storage.get("selectedCurrency");i&&this.currentCurrency.next(i)}catch(i){console.error("Error initializing currency:",i)}})}getCurrentExchangeRates(){return this.exchangeRates.asObservable()}getSupportedCurrenciesObservable(){return this.supportedCurrencies.asObservable()}loadSupportedCurrencies(){return(0,f.mG)(this,void 0,void 0,function*(){try{const i=yield this.getSupportedCurrencies().toPromise();i&&i.data&&this.supportedCurrencies.next(i.data)}catch(i){console.error("Error loading supported currencies:",i)}})}formatAmount(i,c){const r=c||this.getCurrentCurrencyValue();let s=i;return"SDG"!==r&&(s=this.convertFromSDG(i,r)),this.formatCurrency(s,r)}convertToCurrentCurrency(i,c="SDG"){const r=this.getCurrentCurrencyValue();if(c===r)return i;if("SDG"===c)return this.convertFromSDG(i,r);if("SDG"===r)return this.convertToSDG(i,c);{const s=this.convertToSDG(i,c);return this.convertFromSDG(s,r)}}getCurrentCurrencySymbol(){const i=this.getCurrentCurrencyValue();return{SDG:"\u062c.\u0633",USD:"$",AED:"\u062f.\u0625",SAR:"\u0631.\u0633"}[i]||i}getCurrentCurrencySymbolForHeader(i){return`${i} (${this.getCurrentCurrencySymbol()})`}formatAmountWithoutSymbol(i,c){const r=c||this.getCurrentCurrencyValue();let s=i;return"SDG"!==r&&(s=this.convertFromSDG(i,r)),s.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}}return b.\u0275fac=function(i){return new(i||b)(_.LFG(d.eN),_.LFG(x.K),_.LFG(e.r))},b.\u0275prov=_.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()}}]);