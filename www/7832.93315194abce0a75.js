"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7832,1212],{12317:(b,A,h)=>{h.d(A,{d:()=>C});var f=h(42654),a=h(29863),d=h(6612),m=h(69808),p=h(23349);const e=["selectTrigger"];function T(i,u){if(1&i&&(a.TgZ(0,"div",5),a.TgZ(1,"span",6),a._uU(2),a.qZA(),a.qZA()),2&i){const n=a.oxw();let c;a.xp6(2),a.Oqu(null==(c=n.getSelectedCurrency())?null:c.currency_symbol)}}function y(i,u){1&i&&(a.TgZ(0,"div",7),a._UZ(1,"ion-icon",8),a.TgZ(2,"span"),a._uU(3,"\u0627\u062e\u062a\u0631 \u0627\u0644\u0639\u0645\u0644\u0629"),a.qZA(),a.qZA())}let C=(()=>{class i{constructor(n,c,g){this.currencyService=n,this.renderer=c,this.el=g,this.selectedCurrency="SDG",this.supportedCurrencies=[],this.isDropdownOpen=!1,this.subscription=new f.w,this.dropdownElement=null}ngOnInit(){this.loadSupportedCurrencies(),this.subscription.add(this.currencyService.getCurrentCurrency().subscribe(n=>{this.selectedCurrency=n},n=>{console.error("Error subscribing to currency changes:",n),this.selectedCurrency="SDG"}))}ngOnDestroy(){this.subscription.unsubscribe(),this.destroyDropdown()}loadSupportedCurrencies(){this.subscription.add(this.currencyService.getActiveCurrencies().subscribe(n=>{n&&n.data&&(this.supportedCurrencies=n.data)},n=>{console.error("Error loading currencies:",n),this.supportedCurrencies=[{currency_code:"SDG",currency_name_ar:"\u062c\u0646\u064a\u0647 \u0633\u0648\u062f\u0627\u0646\u064a",currency_symbol:"\u062c.\u0633"},{currency_code:"USD",currency_name_ar:"\u062f\u0648\u0644\u0627\u0631 \u0623\u0645\u0631\u064a\u0643\u064a",currency_symbol:"$"},{currency_code:"AED",currency_name_ar:"\u062f\u0631\u0647\u0645 \u0625\u0645\u0627\u0631\u0627\u062a\u064a",currency_symbol:"\u062f.\u0625"},{currency_code:"SAR",currency_name_ar:"\u0631\u064a\u0627\u0644 \u0633\u0639\u0648\u062f\u064a",currency_symbol:"\u0631.\u0633"}]}))}toggleDropdown(n){n.stopPropagation(),this.isDropdownOpen?this.closeDropdown():this.openDropdown()}openDropdown(){!this.selectTrigger||(this.isDropdownOpen=!0,this.createBodyLevelDropdown())}closeDropdown(){this.isDropdownOpen=!1,this.destroyDropdown()}createBodyLevelDropdown(){this.dropdownElement&&this.destroyDropdown();const c=this.selectTrigger.nativeElement.getBoundingClientRect();this.dropdownElement=this.renderer.createElement("div"),this.renderer.addClass(this.dropdownElement,"currency-dropdown-portal"),this.renderer.setStyle(this.dropdownElement,"position","fixed"),this.renderer.setStyle(this.dropdownElement,"z-index","10000"),this.renderer.setStyle(this.dropdownElement,"background","#ffffff"),this.renderer.setStyle(this.dropdownElement,"border","1px solid #e5e7eb"),this.renderer.setStyle(this.dropdownElement,"border-radius","12px"),this.renderer.setStyle(this.dropdownElement,"box-shadow","0 15px 35px rgba(0, 0, 0, 0.15)"),this.renderer.setStyle(this.dropdownElement,"max-height","300px"),this.renderer.setStyle(this.dropdownElement,"overflow-y","auto"),this.renderer.setStyle(this.dropdownElement,"min-width","200px"),this.positionDropdown(c),this.createCurrencyOptions(),this.renderer.appendChild(document.body,this.dropdownElement),setTimeout(()=>{this.dropdownElement&&(this.renderer.setStyle(this.dropdownElement,"opacity","1"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(0)"))},10)}positionDropdown(n){if(!this.dropdownElement)return;const c=window.innerHeight,v=c-n.bottom,x=n.top;this.renderer.setStyle(this.dropdownElement,"opacity","0"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(-10px)"),this.renderer.setStyle(this.dropdownElement,"transition","all 0.3s ease"),this.renderer.setStyle(this.dropdownElement,"left",n.left+"px"),this.renderer.setStyle(this.dropdownElement,"width",Math.max(n.width,200)+"px"),v>=300||v>=x?this.renderer.setStyle(this.dropdownElement,"top",n.bottom+4+"px"):this.renderer.setStyle(this.dropdownElement,"bottom",c-n.top+4+"px")}createCurrencyOptions(){!this.dropdownElement||this.supportedCurrencies.forEach(n=>{const c=this.renderer.createElement("div");this.renderer.addClass(c,"currency-option-portal"),this.renderer.setStyle(c,"display","flex"),this.renderer.setStyle(c,"align-items","center"),this.renderer.setStyle(c,"gap","12px"),this.renderer.setStyle(c,"padding","12px 16px"),this.renderer.setStyle(c,"cursor","pointer"),this.renderer.setStyle(c,"transition","background-color 0.2s ease"),this.renderer.setStyle(c,"border-bottom","1px solid #f3f4f6"),n.currency_code===this.selectedCurrency&&this.renderer.setStyle(c,"background","linear-gradient(135deg, #eff6ff, #dbeafe)");const g=this.renderer.createElement("div");this.renderer.setStyle(g,"width","36px"),this.renderer.setStyle(g,"height","36px"),this.renderer.setStyle(g,"border-radius","50%"),this.renderer.setStyle(g,"display","flex"),this.renderer.setStyle(g,"align-items","center"),this.renderer.setStyle(g,"justify-content","center"),this.renderer.setStyle(g,"font-weight","bold"),this.renderer.setStyle(g,"font-size","13px"),n.currency_code===this.selectedCurrency?(this.renderer.setStyle(g,"background","var(--ion-color-primary, #3880ff)"),this.renderer.setStyle(g,"color","white")):(this.renderer.setStyle(g,"background","#f1f5f9"),this.renderer.setStyle(g,"color","#475569"));const v=this.renderer.createText(n.currency_symbol);this.renderer.appendChild(g,v);const x=this.renderer.createElement("div");this.renderer.setStyle(x,"flex","1"),this.renderer.setStyle(x,"text-align","right");const Z=this.renderer.createElement("div");this.renderer.setStyle(Z,"font-size","14px"),this.renderer.setStyle(Z,"font-weight","500"),this.renderer.setStyle(Z,"color",n.currency_code===this.selectedCurrency?"var(--ion-color-primary, #3880ff)":"#374151"),this.renderer.setStyle(Z,"line-height","1.3");const P=this.renderer.createText(n.currency_name_ar);this.renderer.appendChild(Z,P);const S=this.renderer.createElement("div");this.renderer.setStyle(S,"font-size","12px"),this.renderer.setStyle(S,"color","#6b7280"),this.renderer.setStyle(S,"font-weight","500");const w=this.renderer.createText(n.currency_code);if(this.renderer.appendChild(S,w),this.renderer.appendChild(x,Z),this.renderer.appendChild(x,S),n.currency_code===this.selectedCurrency){const M=this.renderer.createElement("div");this.renderer.setStyle(M,"color","#10b981"),this.renderer.setStyle(M,"font-size","18px");const E=this.renderer.createText("\u2713");this.renderer.appendChild(M,E),this.renderer.appendChild(c,M)}this.renderer.listen(c,"mouseenter",()=>{n.currency_code!==this.selectedCurrency&&this.renderer.setStyle(c,"background","#f8fafc")}),this.renderer.listen(c,"mouseleave",()=>{n.currency_code!==this.selectedCurrency&&this.renderer.setStyle(c,"background","transparent")}),this.renderer.listen(c,"click",M=>{M.stopPropagation(),this.selectCurrency(n,M)}),this.renderer.appendChild(c,g),this.renderer.appendChild(c,x),this.renderer.appendChild(this.dropdownElement,c)})}destroyDropdown(){this.dropdownElement&&(this.renderer.removeChild(document.body,this.dropdownElement),this.dropdownElement=null)}selectCurrency(n,c){c.stopPropagation(),this.selectedCurrency=n.currency_code,this.currencyService.setCurrency(this.selectedCurrency),this.closeDropdown()}getSelectedCurrency(){return this.supportedCurrencies.find(n=>n.currency_code===this.selectedCurrency)}onDocumentClick(n){(!n.target||!n.target.closest(".custom-select-container"))&&this.closeDropdown()}onWindowResize(){if(this.isDropdownOpen&&this.selectTrigger){const n=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(n)}}onWindowScroll(){if(this.isDropdownOpen&&this.selectTrigger){const n=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(n)}}getCurrencyDisplayText(n){return`${n.currency_name_ar} (${n.currency_code})`}}return i.\u0275fac=function(n){return new(n||i)(a.Y36(d.i),a.Y36(a.Qsj),a.Y36(a.SBq))},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-currency-switcher"]],viewQuery:function(n,c){if(1&n&&a.Gf(e,5),2&n){let g;a.iGM(g=a.CRH())&&(c.selectTrigger=g.first)}},hostBindings:function(n,c){1&n&&a.NdJ("click",function(v){return c.onDocumentClick(v)},!1,a.evT)("resize",function(){return c.onWindowResize()},!1,a.Jf7)("scroll",function(){return c.onWindowScroll()},!1,a.Jf7)},decls:6,vars:2,consts:[[1,"currency-switcher-wrapper"],[1,"currency-trigger",3,"click"],["selectTrigger",""],["class","selected-display",4,"ngIf","ngIfElse"],["placeholder",""],[1,"selected-display"],[1,"currency-symbol"],[1,"placeholder-display"],["name","cash-outline"]],template:function(n,c){if(1&n&&(a.TgZ(0,"div",0),a.TgZ(1,"div",1,2),a.NdJ("click",function(v){return c.toggleDropdown(v)}),a.YNc(3,T,3,1,"div",3),a.YNc(4,y,4,0,"ng-template",null,4,a.W1O),a.qZA(),a.qZA()),2&n){const g=a.MAs(5);a.xp6(3),a.Q6J("ngIf",c.getSelectedCurrency())("ngIfElse",g)}},directives:[m.O5,p.gu],styles:[".currency-switcher-wrapper[_ngcontent-%COMP%]{display:inline-block;min-width:auto}.currency-trigger[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:8px;background:transparent;border:2px solid transparent;border-radius:8px;cursor:pointer;transition:all .3s ease;min-height:auto;width:-moz-fit-content;width:fit-content}.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary);background:rgba(var(--ion-color-primary-rgb),.05);box-shadow:0 2px 8px rgba(var(--ion-color-primary-rgb),.15)}.currency-trigger[_ngcontent-%COMP%]:active{transform:scale(.98)}.selected-display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;background:linear-gradient(135deg,var(--ion-color-primary),var(--ion-color-primary-shade));color:#fff;border-radius:50%;font-size:14px;font-weight:700;box-shadow:0 2px 6px rgba(var(--ion-color-primary-rgb),.25);transition:all .3s ease}.placeholder-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#9ca3af;font-size:14px;padding:8px}.placeholder-display[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.currency-trigger[_ngcontent-%COMP%]:hover   .selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{transform:scale(1.05);box-shadow:0 4px 12px rgba(var(--ion-color-primary-rgb),.35)}@media (max-width: 768px){.currency-trigger[_ngcontent-%COMP%]{padding:6px}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{width:32px;height:32px;font-size:13px}.placeholder-display[_ngcontent-%COMP%]{padding:6px}}@media (prefers-color-scheme: dark){.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary-tint);background:rgba(var(--ion-color-primary-rgb),.1)}.placeholder-display[_ngcontent-%COMP%]{color:#9ca3af}}[dir=rtl][_ngcontent-%COMP%]   .placeholder-display[_ngcontent-%COMP%]{text-align:left}"]}),i})()},7832:(b,A,h)=>{h.r(A),h.d(A,{EditSalesReturnPageModule:()=>W});var f=h(69808),a=h(34182),d=h(23349),m=h(94030),p=h(70655),e=h(29863),T=h(17158),y=h(65465),C=h(90849),i=h(91472),u=h(32724),n=h(6612),c=h(12317),g=h(35845),v=h(1212);const x=["dst"],Z=["dstPop"],P=["qtyId"],S=["popInput"],w=["popover"],M=["popoverNotif"];function E(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"div",42),e.TgZ(1,"ion-button",43),e.NdJ("click",function(){return e.CHM(t),e.oxw(3).navigateSearch("prev")}),e._UZ(2,"ion-icon",44),e.qZA(),e.TgZ(3,"span",45),e._uU(4),e.qZA(),e.TgZ(5,"ion-button",43),e.NdJ("click",function(){return e.CHM(t),e.oxw(3).navigateSearch("next")}),e._UZ(6,"ion-icon",46),e.qZA(),e.qZA()}if(2&s){const t=e.oxw(3);e.xp6(4),e.Oqu(t.getSearchResultText())}}function I(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"div",37),e.TgZ(1,"ion-item"),e.TgZ(2,"ion-label",9),e._uU(3,"\u0627\u0644\u0628\u062d\u062b \u0641\u064a \u0627\u0644\u0623\u0635\u0646\u0627\u0641"),e.qZA(),e.TgZ(4,"ion-input",38),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).searchTerm=o})("ionInput",function(){return e.CHM(t),e.oxw(2).onSearchTermChange()}),e.qZA(),e.qZA(),e.YNc(5,E,7,1,"div",39),e.TgZ(6,"ion-button",40),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).sortItemListAlphabetically()}),e._UZ(7,"ion-icon",41),e._uU(8),e.qZA(),e.qZA()}if(2&s){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t.searchTerm),e.xp6(1),e.Q6J("ngIf",t.searchMatches.length>0),e.xp6(3),e.hij(" ",t.isItemListSorted?"\u0627\u0644\u062a\u0631\u062a\u064a\u0628 \u0627\u0644\u0623\u0635\u0644\u064a":"\u062a\u0631\u062a\u064a\u0628 \u0623\u0628\u062c\u062f\u064a"," ")}}function D(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"ion-input",57),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().$implicit.quantity=o})("ionBlur",function(){e.CHM(t);const o=e.oxw().index,l=e.oxw(3);return l.hideMe(o),l.editCell(o)}),e.qZA()}if(2&s){const t=e.oxw().$implicit;e.Q6J("ngModel",t.quantity)}}function R(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"span",1),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().index;return e.oxw(3).qtyClick(o)}),e._uU(1),e.qZA()}if(2&s){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.quantity," ")}}function q(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"ion-input",58),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().$implicit.return_price=o})("ionBlur",function(){e.CHM(t);const o=e.oxw().index,l=e.oxw(3);return l.hideMe(o),l.editCell(o)}),e.qZA()}if(2&s){const t=e.oxw().$implicit;e.Q6J("ngModel",t.return_price)}}function L(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"span",1),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().index;return e.oxw(3).qtyClick(o)}),e._uU(1),e.ALo(2,"currencyDisplay"),e.qZA()}if(2&s){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.Dn7(2,1,t.return_price,"SDG",!1)," ")}}function U(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td"),e._UZ(2,"span",51),e.qZA(),e.TgZ(3,"td"),e.YNc(4,D,1,1,"ion-input",52),e.YNc(5,R,2,1,"span",53),e.qZA(),e.TgZ(6,"td"),e.YNc(7,q,1,1,"ion-input",54),e.YNc(8,L,3,5,"span",53),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.ALo(11,"currencyDisplay"),e.qZA(),e.TgZ(12,"td"),e.TgZ(13,"div",32),e.TgZ(14,"ion-button",55),e.NdJ("click",function(){const l=e.CHM(t).index;return e.oxw(3).deleteItem(l)}),e._UZ(15,"ion-icon",56),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&s){const t=_.$implicit,r=_.index,o=e.oxw(3);e.ekj("highlighted",o.isHighlighted(r))("search-match",o.isSearchMatch(r)),e.uIk("data-index",r),e.xp6(2),e.Q6J("innerHTML",o.highlightText(t.item_name,o.searchTerm),e.oJD),e.xp6(2),e.Q6J("ngIf",o.showMe===r),e.xp6(1),e.Q6J("ngIf",o.showMe!==r),e.xp6(2),e.Q6J("ngIf",o.showMe===r),e.xp6(1),e.Q6J("ngIf",o.showMe!==r),e.xp6(2),e.Oqu(e.Dn7(11,11,t.tot,"SDG",!1))}}function G(s,_){if(1&s&&(e.TgZ(0,"ion-card-content",47),e.TgZ(1,"div",48),e.TgZ(2,"table",49),e.TgZ(3,"thead"),e.TgZ(4,"tr"),e.TgZ(5,"th"),e._uU(6,"\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"\u0627\u0644\u0643\u0645\u064a\u0629"),e.qZA(),e.TgZ(9,"th"),e._uU(10),e.qZA(),e.TgZ(11,"th"),e._uU(12),e.qZA(),e.TgZ(13,"th"),e._uU(14,"\u0625\u062c\u0631\u0627\u0621"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"tbody"),e.YNc(16,U,16,15,"tr",50),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&s){const t=e.oxw(2);e.xp6(10),e.hij("\u0633\u0639\u0631 \u0627\u0644\u0625\u0631\u062c\u0627\u0639 (",t.getCurrencySymbol(),")"),e.xp6(2),e.hij("\u0627\u0644\u0645\u062c\u0645\u0648\u0639 (",t.getCurrencySymbol(),")"),e.xp6(4),e.Q6J("ngForOf",t.getDisplayItemList())}}function k(s,_){1&s&&(e.TgZ(0,"ion-card-content"),e.TgZ(1,"div",59),e._UZ(2,"ion-icon",60),e.TgZ(3,"h3"),e._uU(4,"\u0644\u0627 \u062a\u0648\u062c\u062f \u0623\u0635\u0646\u0627\u0641 \u0645\u0631\u062a\u062c\u0639\u0629"),e.qZA(),e.TgZ(5,"p"),e._uU(6,"\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0623\u0635\u0646\u0627\u0641 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629"),e.qZA(),e.qZA(),e.qZA())}function F(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label",9),e._uU(2,"\u0646\u0633\u0628\u0629 \u0627\u0644\u062e\u0635\u0645 (%)"),e.qZA(),e.TgZ(3,"ion-input",61),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).discountPerc=o})("ionInput",function(o){return e.CHM(t),e.oxw(2).onPercentageDiscountChange(o)}),e.qZA(),e.qZA()}if(2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t.discountPerc)}}function B(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label",9),e._uU(2),e.qZA(),e.TgZ(3,"ion-input",62),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).discountAmount=o})("ionInput",function(o){return e.CHM(t),e.oxw(2).onAmountDiscountChange(o)}),e.qZA(),e.qZA()}if(2&s){const t=e.oxw(2);e.xp6(2),e.hij("\u0645\u0628\u0644\u063a \u0627\u0644\u062e\u0635\u0645 (",t.getCurrencySymbol(),")"),e.xp6(1),e.Q6J("ngModel",t.discountAmount)}}function J(s,_){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"currencyDisplay"),e.qZA()),2&s){const t=e.oxw(3);e.xp6(1),e.AsE(" \u0627\u0644\u062e\u0635\u0645: ",t.discountPerc,"% = ",e.Dn7(2,2,t.calculatedDiscountAmount,"SDG",!1)," ")}}function N(s,_){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"currencyDisplay"),e.qZA()),2&s){const t=e.oxw(3);e.xp6(1),e.AsE(" \u0627\u0644\u062e\u0635\u0645: ",e.Dn7(2,2,t.discountAmount,"SDG",!1)," = ",t.calculatedDiscountPerc.toFixed(2),"% ")}}function Y(s,_){if(1&s&&(e.TgZ(0,"ion-row"),e.TgZ(1,"ion-col",63),e.TgZ(2,"div",64),e.YNc(3,J,3,6,"span",18),e.YNc(4,N,3,6,"span",18),e.qZA(),e.qZA(),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("ngIf","percentage"===t.discountType&&t.calculatedDiscountAmount>0),e.xp6(1),e.Q6J("ngIf","amount"===t.discountType&&t.calculatedDiscountPerc>0)}}function H(s,_){if(1&s){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"ion-card"),e.TgZ(2,"ion-card-header"),e.TgZ(3,"ion-card-title",7),e._uU(4,"\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629"),e.qZA(),e.qZA(),e.TgZ(5,"ion-card-content"),e.TgZ(6,"ion-grid"),e.TgZ(7,"ion-row"),e.TgZ(8,"ion-col",8),e.TgZ(9,"ion-item"),e.TgZ(10,"ion-label",9),e._uU(11,"\u0631\u0642\u0645 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629"),e.qZA(),e.TgZ(12,"ion-input",10),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().returnInvo.return_ref=o}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"ion-col",8),e.TgZ(14,"ion-item"),e.TgZ(15,"ion-label",9),e._uU(16,"\u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064a\u0629"),e.qZA(),e.TgZ(17,"ion-input",10),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().returnInvo.original_pay_ref=o}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"ion-row"),e.TgZ(19,"ion-col",8),e.TgZ(20,"ion-item"),e.TgZ(21,"ion-label",9),e._uU(22,"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629"),e.qZA(),e.TgZ(23,"ion-input",11),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().returnInvo.return_date=o}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(24,"ion-col",8),e.TgZ(25,"ion-item"),e.TgZ(26,"ion-label",9),e._uU(27,"\u0646\u0648\u0639 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629"),e.qZA(),e.TgZ(28,"ion-chip",12),e._uU(29),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(30,"ion-card"),e.TgZ(31,"ion-card-header"),e.TgZ(32,"ion-card-title",7),e._uU(33,"\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0639\u0645\u064a\u0644"),e.qZA(),e.qZA(),e.TgZ(34,"ion-card-content"),e.TgZ(35,"app-account-selector",13),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().selectedAccount=o})("accountSelected",function(o){return e.CHM(t),e.oxw().onAccountSelected(o)})("balanceLoaded",function(o){return e.CHM(t),e.oxw().onAccountBalanceLoaded(o)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(36,"ion-card"),e.TgZ(37,"ion-card-header"),e.TgZ(38,"ion-card-title",7),e._uU(39,"\u0633\u0628\u0628 \u0627\u0644\u0625\u0631\u062c\u0627\u0639"),e.qZA(),e.qZA(),e.TgZ(40,"ion-card-content"),e.TgZ(41,"ion-item"),e.TgZ(42,"ion-label",9),e._uU(43,"\u0627\u0643\u062a\u0628 \u0633\u0628\u0628 \u0627\u0644\u0625\u0631\u062c\u0627\u0639"),e.qZA(),e.TgZ(44,"ion-textarea",14),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().returnReason=o}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(45,"ion-card"),e.TgZ(46,"ion-card-header"),e.TgZ(47,"div",15),e.TgZ(48,"ion-card-title",7),e._uU(49,"\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629"),e.qZA(),e.YNc(50,I,9,3,"div",16),e.qZA(),e.qZA(),e.YNc(51,G,17,3,"ion-card-content",17),e.YNc(52,k,7,0,"ion-card-content",18),e.qZA(),e.TgZ(53,"ion-card",19),e.TgZ(54,"ion-card-header"),e.TgZ(55,"ion-card-title",7),e._uU(56,"\u0627\u0644\u062e\u0635\u0645"),e.qZA(),e.qZA(),e.TgZ(57,"ion-card-content"),e.TgZ(58,"ion-grid"),e.TgZ(59,"ion-row"),e.TgZ(60,"ion-col",8),e.TgZ(61,"ion-item"),e.TgZ(62,"ion-label",9),e._uU(63,"\u0646\u0648\u0639 \u0627\u0644\u062e\u0635\u0645"),e.qZA(),e.TgZ(64,"ion-select",20),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().discountType=o})("ionChange",function(o){return e.CHM(t),e.oxw().onDiscountTypeChange(o)}),e.TgZ(65,"ion-select-option",21),e._uU(66,"\u0646\u0633\u0628\u0629 \u0645\u0626\u0648\u064a\u0629 (%)"),e.qZA(),e.TgZ(67,"ion-select-option",22),e._uU(68,"\u0645\u0628\u0644\u063a \u062b\u0627\u0628\u062a"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(69,"ion-col",8),e.YNc(70,F,4,1,"ion-item",18),e.YNc(71,B,4,2,"ion-item",18),e.qZA(),e.qZA(),e.YNc(72,Y,5,2,"ion-row",18),e.qZA(),e.qZA(),e.qZA(),e.TgZ(73,"ion-card",23),e.TgZ(74,"ion-card-header"),e.TgZ(75,"ion-card-title",7),e._uU(76,"\u0627\u0644\u0645\u062c\u0627\u0645\u064a\u0639"),e.qZA(),e.qZA(),e.TgZ(77,"ion-card-content"),e.TgZ(78,"div",24),e.TgZ(79,"div",25),e.TgZ(80,"span",26),e._uU(81,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0641\u0631\u0639\u064a:"),e.qZA(),e.TgZ(82,"span",27),e._uU(83),e.ALo(84,"currencyDisplay"),e.qZA(),e.qZA(),e.TgZ(85,"div",25),e.TgZ(86,"span",26),e._uU(87,"\u0627\u0644\u062e\u0635\u0645:"),e.qZA(),e.TgZ(88,"span",28),e._uU(89),e.ALo(90,"currencyDisplay"),e.qZA(),e.qZA(),e.TgZ(91,"div",29),e.TgZ(92,"span",26),e._uU(93,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"),e.qZA(),e.TgZ(94,"span",30),e._uU(95),e.ALo(96,"currencyDisplay"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(97,"div",31),e.TgZ(98,"div",32),e.TgZ(99,"ion-button",33),e.NdJ("click",function(){return e.CHM(t),e.oxw().updateReturn()}),e._UZ(100,"ion-icon",34),e._uU(101," \u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a "),e.qZA(),e.TgZ(102,"ion-button",35),e.NdJ("click",function(){return e.CHM(t),e.oxw().deleteReturn()}),e._UZ(103,"ion-icon",36),e._uU(104," \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 "),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&s){const t=e.oxw();e.xp6(12),e.Q6J("ngModel",t.returnInvo.return_ref),e.xp6(5),e.Q6J("ngModel",t.returnInvo.original_pay_ref),e.xp6(6),e.Q6J("ngModel",t.returnInvo.return_date),e.xp6(5),e.Q6J("color",t.isReturnAllItems?"success":"warning"),e.xp6(1),e.hij(" ",t.isReturnAllItems?"\u0645\u0631\u062a\u062c\u0639\u0629 \u0643\u0627\u0645\u0644\u0629":"\u0645\u0631\u062a\u062c\u0639\u0629 \u062c\u0632\u0626\u064a\u0629"," "),e.xp6(6),e.Q6J("store_info",t.store_info)("year",t.year)("showAddButton",!1)("ngModel",t.selectedAccount),e.xp6(9),e.Q6J("ngModel",t.returnReason),e.xp6(6),e.Q6J("ngIf",t.itemList.length>0),e.xp6(1),e.Q6J("ngIf",t.itemList.length>0),e.xp6(1),e.Q6J("ngIf",0===t.itemList.length),e.xp6(12),e.Q6J("ngModel",t.discountType),e.xp6(6),e.Q6J("ngIf","percentage"===t.discountType),e.xp6(1),e.Q6J("ngIf","amount"===t.discountType),e.xp6(1),e.Q6J("ngIf",t.returnInvo.discount>0),e.xp6(11),e.Oqu(e.Dn7(84,22,t.getSubtotal(),"SDG",!1)),e.xp6(6),e.Oqu(e.Dn7(90,26,t.returnInvo.discount,"SDG",!1)),e.xp6(6),e.Oqu(e.Dn7(96,30,t.returnInvo.tot_pr,"SDG",!1)),e.xp6(4),e.Q6J("disabled",t.isLoading()),e.xp6(3),e.Q6J("disabled",t.isLoading())}}function Q(s,_){if(1&s&&(e.TgZ(0,"div",65),e._UZ(1,"ion-spinner",66),e.TgZ(2,"p"),e._uU(3),e.qZA(),e.qZA()),2&s){const t=e.oxw();e.xp6(3),e.Oqu(t.currentLoadingMessage)}}const z=[{path:"",component:(()=>{class s{constructor(t,r,o,l,O,K,V,X,ee,te,ne,re,ie,oe,se,ce,ue){this.rout=t,this.platform=r,this.behavApi=o,this._location=l,this.route=O,this.renderer=K,this.modalController=V,this.alertController=X,this.authenticationService=ee,this.storage=te,this.loadingController=ne,this.datePipe=re,this.api=ie,this.toast=oe,this.accountCommunicationService=se,this.cdr=ce,this.currencyService=ue,this.editMode=!0,this.returnRefToEdit="",this.originalReturnData=null,this.isReturnAllItems=!1,this.originalInvoice=null,this.originalItems=[],this.selectedOriginalInvoice=null,this.availableSalesInvoices=[],this.returnReason="",this.discountType="percentage",this.discountAmount=0,this.calculatedDiscountPerc=0,this.calculatedDiscountAmount=0,this.isOpen=!1,this.isOpenNotif=!1,this.newNotif=!1,this.sub_account=[],this.sub_accountLocalSales=[],this.sub_accountSales=[],this.initialInvoices=[],this.items=[],this.itemsLocal=[],this.itemList=[],this.sortedItemList=[],this.isItemListSorted=!1,this.searchTerm="",this.highlightedIndex=-1,this.searchMatches=[],this.salesLocal=[],this.sales=[],this.notifArr=[],this.LogHistoryLocalArr=[],this.purchLocal=[],this.purchase=[],this.randomsNumber=[],this.sub_nameNew="",this.discountPerc=0,this.printMode=!1,this.printArr=[],this.offline=!1,this.color="dark",this.showMe=null,this.status="edit",this.searchLang=0,this.aliasTerm="",this.searchResult=[],this.aliasResult=[],this.finalResult=[],this.loadingItems=!1,this.logHistoryArr=[],this.showNotif=!1,this.device="",this.currenQty=0,this.firstQty=0,this.perchTotQty=0,this.payTotQty=0,this.perchTot=0,this.qtyReal=0,this.availQty=0,this.pendingItemsFromStock=[],this.defaultCategoryId=null,this.statusFromRoute="",this.showBackButton=!0,this.isSaving=!1,this.isDeleting=!1,this.isUpdating=!1,this.currentLoadingMessage="",this.currentLoader=null,this.selectedAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:"",cat_name:"",cat_id:"",phone:"",address:"",currentCustumerStatus:0},this.printArr.push({returnInvo:"",itemList:"",selectedAccount:"",sub_nameNew:"",userInfo:"",sub_balanse:0,balanceStatus:""}),this.selectedItem={id:void 0,dateCreated:"",pay_ref:"",item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:"",tax:0,imageUrl:""}}ngOnInit(){this.initializeCurrency(),this.customerSubscription=this.accountCommunicationService.customerSelected$.subscribe(({id:t,account:r})=>{t&&this.returnInvo&&(console.log("Customer selected in edit sales return, setting cust_id:",t),this.returnInvo.cust_id=t,this.returnInvo.sub_name=r.sub_name,this.selectedAccount=r,console.log("Edit return invoice updated:",this.returnInvo))}),this.route.queryParams.subscribe(t=>{this.returnRefToEdit=t.return_ref||"",this.returnRefToEdit?this.loadReturnForEdit():(this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062a\u062d\u062f\u064a\u062f \u0645\u0631\u062c\u0639 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0644\u0644\u062a\u0639\u062f\u064a\u0644","danger"),this.goBack())}),this.getAppInfo()}ngOnDestroy(){return(0,p.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),this.customerSubscription&&this.customerSubscription.unsubscribe(),this.currencySubscription&&this.currencySubscription.unsubscribe()})}initializeCurrency(){return(0,p.mG)(this,void 0,void 0,function*(){try{yield this.currencyService.initializeCurrency(),yield this.currencyService.loadSupportedCurrencies(),this.store_info&&this.year&&(yield this.currencyService.loadRatesByYear(this.store_info.id,this.year.id)),this.currencySubscription=this.currencyService.getCurrentCurrency().subscribe(t=>{this.cdr.detectChanges()})}catch(t){console.error("Error initializing currency:",t)}})}loadReturnForEdit(){return(0,p.mG)(this,void 0,void 0,function*(){yield this.showLoading("\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629...","updating");try{this.api.getSalesReturnDetail(this.store_info.id,this.returnRefToEdit,this.year.id).subscribe(t=>(0,p.mG)(this,void 0,void 0,function*(){"No record Found"!==t.message&&t.data?(yield this.populateReturnData(t.data),yield this.hideLoading()):(yield this.hideLoading(),this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger"),this.goBack())}),t=>(0,p.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),console.error("Error loading return for edit:",t),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger"),this.goBack()}))}catch(t){yield this.hideLoading(),console.error("Error in loadReturnForEdit:",t),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger"),this.goBack()}})}populateReturnData(t){return(0,p.mG)(this,void 0,void 0,function*(){try{console.log("Populating return data:",t),this.returnInvo={return_id:t.returnInvoice.return_id,return_ref:t.returnInvoice.return_ref,original_pay_ref:t.returnInvoice.original_pay_ref,store_id:t.returnInvoice.store_id,tot_pr:parseFloat(t.returnInvoice.tot_pr),pay:parseFloat(t.returnInvoice.pay||0),return_date:t.returnInvoice.return_date,return_time:t.returnInvoice.return_time,user_id:t.returnInvoice.user_id,cust_id:t.returnInvoice.cust_id,return_method:t.returnInvoice.return_method,discount:parseFloat(t.returnInvoice.discount||0),changee:parseFloat(t.returnInvoice.changee||0),sub_name:t.returnInvoice.sub_name,returnComment:t.returnInvoice.returnComment,yearId:t.returnInvoice.yearId,is_full_return:parseInt(t.returnInvoice.is_full_return),return_reason:t.returnInvoice.return_reason},this.returnReason=this.returnInvo.return_reason||"",this.isReturnAllItems=1===this.returnInvo.is_full_return,t.returnInvoice.cust_id&&(this.selectedAccount={id:t.returnInvoice.cust_id,ac_id:t.returnInvoice.cust_id,sub_name:t.returnInvoice.sub_name,sub_type:"",sub_code:"",sub_balance:"",store_id:this.store_info.id,cat_id:"",cat_name:"",phone:"",address:"",currentCustumerStatus:0}),this.returnInvo.discount>0&&(this.discountType="amount",this.discountAmount=this.returnInvo.discount,this.calculatedDiscountAmount=this.returnInvo.discount,this.calculateDiscountPercentage()),this.itemList=t.returnItems||[],this.itemList.forEach(r=>{r.quantity=parseFloat(r.quantity),r.return_price=parseFloat(r.return_price),r.tot=parseFloat(r.tot)}),console.log("Return data populated successfully"),console.log("Return invoice:",this.returnInvo),console.log("Item list:",this.itemList)}catch(r){console.error("Error populating return data:",r),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger")}})}updateReturn(){return(0,p.mG)(this,void 0,void 0,function*(){if(this.isUpdating)return;const t=this.validateReturnData();if(t)this.presentToast(t,"warning");else{yield this.showLoading("\u062c\u0627\u0631\u064a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629...","updating"),this.isUpdating=!0;try{this.calculateTotals();const r={returnInvoice:Object.assign(Object.assign({},this.returnInvo),{return_reason:this.returnReason,is_full_return:this.isReturnAllItems?1:0,discount:this.returnInvo.discount}),returnItems:this.itemList.map(o=>({item_id:o.id,item_name:o.item_name,quantity:o.quantity,return_price:o.return_price,tot:o.tot}))};console.log("Updating return with data:",r),this.api.updateSalesReturnWithItems(r).subscribe(o=>(0,p.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),this.isUpdating=!1,"Sales return updated successfully"===o.message?(this.presentToast("\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0628\u0646\u062c\u0627\u062d","success"),this.goBack()):this.presentToast("\u0641\u0634\u0644 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629: "+(o.message||"\u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"),"danger")}),o=>(0,p.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),this.isUpdating=!1,console.error("Error updating return:",o),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger")}))}catch(r){yield this.hideLoading(),this.isUpdating=!1,console.error("Error in updateReturn:",r),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger")}}})}deleteReturn(){return(0,p.mG)(this,void 0,void 0,function*(){this.isDeleting||(yield(yield this.alertController.create({header:"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641",message:"\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629\u061f \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062a\u0631\u0627\u062c\u0639 \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0625\u062c\u0631\u0627\u0621.",buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel"},{text:"\u062d\u0630\u0641",cssClass:"danger",handler:()=>(0,p.mG)(this,void 0,void 0,function*(){yield this.performDelete()})}]})).present())})}performDelete(){return(0,p.mG)(this,void 0,void 0,function*(){if(!this.isDeleting){yield this.showLoading("\u062c\u0627\u0631\u064a \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629...","deleting"),this.isDeleting=!0;try{const t={return_ref:this.returnInvo.return_ref,store_id:this.store_info.id,yearId:this.year.id};console.log("Deleting return with data:",t),this.api.deleteSalesReturnWithItems(t).subscribe(r=>(0,p.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),this.isDeleting=!1,"Sales return deleted successfully"===r.message?(this.presentToast("\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0628\u0646\u062c\u0627\u062d","success"),this.goBack()):this.presentToast("\u0641\u0634\u0644 \u0641\u064a \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629: "+(r.message||"\u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"),"danger")}),r=>(0,p.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),this.isDeleting=!1,console.error("Error deleting return:",r),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0641\u064a \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger")}))}catch(t){yield this.hideLoading(),this.isDeleting=!1,console.error("Error in performDelete:",t),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0641\u064a \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger")}}})}validateReturnData(){if(!this.returnInvo.return_ref)return"\u0645\u0631\u062c\u0639 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0645\u0637\u0644\u0648\u0628";if(!this.returnInvo.return_date)return"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0645\u0637\u0644\u0648\u0628";if(!this.selectedAccount||!this.selectedAccount.id)return"\u064a\u062c\u0628 \u0627\u062e\u062a\u064a\u0627\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644";if(!this.itemList||0===this.itemList.length)return"\u064a\u062c\u0628 \u0623\u0646 \u062a\u062d\u062a\u0648\u064a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0639\u0644\u0649 \u0635\u0646\u0641 \u0648\u0627\u062d\u062f \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644";for(let t=0;t<this.itemList.length;t++){const r=this.itemList[t];if(!r.quantity||r.quantity<=0)return`\u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0644\u0644\u0635\u0646\u0641 "${r.item_name}" \u064a\u062c\u0628 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0635\u0641\u0631`;if(!r.return_price||r.return_price<0)return`\u0633\u0639\u0631 \u0627\u0644\u0625\u0631\u062c\u0627\u0639 \u0644\u0644\u0635\u0646\u0641 "${r.item_name}" \u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0635\u0627\u0644\u062d\u0627\u064b`}return!this.returnReason||this.returnReason.trim().length<3?"\u064a\u062c\u0628 \u0643\u062a\u0627\u0628\u0629 \u0633\u0628\u0628 \u0627\u0644\u0625\u0631\u062c\u0627\u0639 (3 \u0623\u062d\u0631\u0641 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644)":null}calculateTotals(){const t=this.itemList.reduce((o,l)=>o+ +l.tot,0);let r=0;"percentage"===this.discountType&&this.discountPerc>0?r=t*this.discountPerc/100:"amount"===this.discountType&&this.discountAmount>0&&(r=this.discountAmount),this.returnInvo.discount=r,this.returnInvo.tot_pr=t-r,console.log("Calculated totals - Subtotal:",t,"Discount:",r,"Total:",this.returnInvo.tot_pr)}calculateDiscountPercentage(){const t=this.itemList.reduce((r,o)=>r+ +o.tot,0);this.calculatedDiscountPerc=t>0&&this.discountAmount>0?this.discountAmount/t*100:0}onDiscountTypeChange(t){this.discountType=t.detail.value,this.discountPerc=0,this.discountAmount=0,this.calculatedDiscountPerc=0,this.calculatedDiscountAmount=0,this.returnInvo.discount=0,this.calculateTotals()}onPercentageDiscountChange(t){this.discountPerc=parseFloat(t.detail.value)||0,this.discountPerc>100?this.discountPerc=100:this.discountPerc<0&&(this.discountPerc=0);const r=this.itemList.reduce((o,l)=>o+ +l.tot,0);this.calculatedDiscountAmount=r*this.discountPerc/100,this.calculateTotals()}onAmountDiscountChange(t){this.discountAmount=parseFloat(t.detail.value)||0,this.discountAmount<0&&(this.discountAmount=0),this.calculateDiscountPercentage(),this.calculateTotals()}editCell(t){this.itemList[t]&&(this.itemList[t].tot=this.itemList[t].quantity*this.itemList[t].return_price,this.calculateTotals())}qtyClick(t){this.showMe=t}hideMe(t){this.showMe=null}deleteItem(t){this.itemList.length>1?(this.itemList.splice(t,1),this.calculateTotals()):this.presentToast("\u064a\u062c\u0628 \u0623\u0646 \u062a\u062d\u062a\u0648\u064a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0639\u0644\u0649 \u0635\u0646\u0641 \u0648\u0627\u062d\u062f \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644","warning")}onAccountSelected(t){console.log("Account selected in edit sales return:",t),this.selectedAccount=t,this.returnInvo.cust_id=t.id,this.returnInvo.sub_name=t.sub_name}onAccountBalanceLoaded(t){console.log("Account balance loaded in edit sales return:",t)}onSearchTermChange(){this.searchTerm.trim()?(this.searchMatches=this.findSearchMatches(),this.highlightedIndex=this.searchMatches.length>0?0:-1):(this.searchMatches=[],this.highlightedIndex=-1)}findSearchMatches(){const t=[],r=this.searchTerm.toLowerCase();return this.getDisplayItemList().forEach((o,l)=>{o.item_name.toLowerCase().includes(r)&&t.push(l)}),t}navigateSearch(t){0!==this.searchMatches.length&&(this.highlightedIndex="next"===t?(this.highlightedIndex+1)%this.searchMatches.length:this.highlightedIndex<=0?this.searchMatches.length-1:this.highlightedIndex-1)}getSearchResultText(){return 0===this.searchMatches.length?"0 / 0":`${this.highlightedIndex+1} / ${this.searchMatches.length}`}isHighlighted(t){return-1!==this.highlightedIndex&&this.searchMatches[this.highlightedIndex]===t}isSearchMatch(t){return this.searchMatches.includes(t)}sortItemListAlphabetically(){this.isItemListSorted?this.isItemListSorted=!1:(this.sortedItemList=[...this.itemList].sort((t,r)=>t.item_name.localeCompare(r.item_name,"ar")),this.isItemListSorted=!0)}getDisplayItemList(){return this.isItemListSorted?this.sortedItemList:this.itemList}highlightText(t,r){if(!r||!t)return t;const o=new RegExp(`(${r})`,"gi");return t.replace(o,"<mark>$1</mark>")}getCurrencySymbol(){return this.currencyService.getCurrentCurrencySymbol()}getAppInfo(){return(0,p.mG)(this,void 0,void 0,function*(){if(this.store_info=yield this.storage.get("store_info"),this.user_info=yield this.storage.get("user_info"),this.year=yield this.storage.get("year"),!this.store_info||!this.user_info||!this.year)return this.presentToast("\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u062a\u0637\u0628\u064a\u0642 \u063a\u064a\u0631 \u0645\u0643\u062a\u0645\u0644\u0629","danger"),void this.rout.navigate(["/folder/login"]);this.store_info&&this.year&&(yield this.currencyService.loadRatesByYear(this.store_info.id,this.year.id)),console.log("App info loaded - Store:",this.store_info,"User:",this.user_info,"Year:",this.year)})}isLoading(){return this.isSaving||this.isDeleting||this.isUpdating||this.loadingItems}showLoading(t,r){return(0,p.mG)(this,void 0,void 0,function*(){this.currentLoadingMessage=t,this.currentLoader&&(yield this.currentLoader.dismiss()),this.currentLoader=yield this.loadingController.create({message:t,cssClass:"custom-loading"}),yield this.currentLoader.present()})}hideLoading(){return(0,p.mG)(this,void 0,void 0,function*(){this.currentLoader&&(yield this.currentLoader.dismiss(),this.currentLoader=null),this.currentLoadingMessage=""})}getSubtotal(){return this.itemList&&0!==this.itemList.length?this.itemList.reduce((t,r)=>t+Number(r.tot||0),0):0}presentToast(t,r="primary"){return(0,p.mG)(this,void 0,void 0,function*(){yield(yield this.toast.create({message:t,duration:3e3,color:r,position:"bottom"})).present()})}goBack(){this._location.back()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(m.F0),e.Y36(d.t4),e.Y36(T.h),e.Y36(f.Ye),e.Y36(m.gz),e.Y36(e.Qsj),e.Y36(d.IN),e.Y36(d.Br),e.Y36(y.u),e.Y36(C.K),e.Y36(d.HT),e.Y36(f.uU),e.Y36(i.r),e.Y36(d.yF),e.Y36(u.n),e.Y36(e.sBO),e.Y36(n.i))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-edit-sales-return"]],viewQuery:function(t,r){if(1&t&&(e.Gf(x,5),e.Gf(Z,5),e.Gf(P,5),e.Gf(S,5),e.Gf(w,5),e.Gf(M,5)),2&t){let o;e.iGM(o=e.CRH())&&(r.nameField=o.first),e.iGM(o=e.CRH())&&(r.dstPop=o.first),e.iGM(o=e.CRH())&&(r.qtyId=o.first),e.iGM(o=e.CRH())&&(r.popInput=o.first),e.iGM(o=e.CRH())&&(r.popover=o.first),e.iGM(o=e.CRH())&&(r.popoverNotif=o.first)}},decls:12,vars:2,consts:[["slot","start"],[3,"click"],["name","arrow-back"],["slot","end"],["class","container",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"container"],[1,"section-title"],["size","6"],["position","stacked"],["type","text","readonly","",3,"ngModel","ngModelChange"],["type","date",3,"ngModel","ngModelChange"],[3,"color"],["accountType","customer","placeholder","\u0627\u062e\u062a\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644","label","\u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644",3,"store_info","year","showAddButton","ngModel","ngModelChange","accountSelected","balanceLoaded"],["placeholder","\u0645\u062b\u0627\u0644: \u0639\u064a\u0628 \u0641\u064a \u0627\u0644\u0645\u0646\u062a\u062c\u060c \u0639\u062f\u0645 \u0645\u0637\u0627\u0628\u0642\u0629 \u0627\u0644\u0645\u0648\u0627\u0635\u0641\u0627\u062a\u060c \u0625\u0644\u062e...","rows","3",3,"ngModel","ngModelChange"],[1,"section-header"],["class","list-controls",4,"ngIf"],["class","ion-no-padding",4,"ngIf"],[4,"ngIf"],[1,"discount-section"],[3,"ngModel","ngModelChange","ionChange"],["value","percentage"],["value","amount"],[1,"totals-card"],[1,"totals-grid"],[1,"total-row"],[1,"label"],[1,"value"],[1,"value","discount"],[1,"total-row","final-total"],[1,"value","positive"],[1,"action-section"],[1,"action-buttons"],["expand","block","color","primary",3,"disabled","click"],["name","save-outline","slot","start"],["expand","block","color","danger","fill","outline",3,"disabled","click"],["name","trash-outline","slot","start"],[1,"list-controls"],["type","text","placeholder","\u0627\u0628\u062d\u062b \u0639\u0646 \u0635\u0646\u0641...","clearInput","true",3,"ngModel","ngModelChange","ionInput"],["class","search-navigation",4,"ngIf"],["fill","outline","size","small",3,"click"],["name","list","slot","start"],[1,"search-navigation"],["fill","clear","size","small",3,"click"],["name","chevron-up"],[1,"search-results"],["name","chevron-down"],[1,"ion-no-padding"],[1,"table-container"],[1,"items-table"],[3,"highlighted","search-match",4,"ngFor","ngForOf"],[3,"innerHTML"],["type","number","min","0.01","step","0.01",3,"ngModel","ngModelChange","ionBlur",4,"ngIf"],[3,"click",4,"ngIf"],["type","number","min","0","step","0.01",3,"ngModel","ngModelChange","ionBlur",4,"ngIf"],["fill","clear","size","small","color","danger",3,"click"],["name","trash-outline"],["type","number","min","0.01","step","0.01",3,"ngModel","ngModelChange","ionBlur"],["type","number","min","0","step","0.01",3,"ngModel","ngModelChange","ionBlur"],[1,"empty-state"],["name","cube-outline","size","large"],["type","number","min","0","max","100","step","0.01",3,"ngModel","ngModelChange","ionInput"],["type","number","min","0","step","0.01",3,"ngModel","ngModelChange","ionInput"],["size","12"],[1,"discount-display"],[1,"loading-overlay"],["name","bubbles"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-buttons",0),e.TgZ(3,"ion-button",1),e.NdJ("click",function(){return r.goBack()}),e._UZ(4,"ion-icon",2),e.qZA(),e.qZA(),e.TgZ(5,"ion-title"),e._uU(6,"\u062a\u0639\u062f\u064a\u0644 \u0645\u0631\u062a\u062c\u0639\u0629 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a"),e.qZA(),e.TgZ(7,"ion-buttons",3),e._UZ(8,"app-currency-switcher"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"ion-content"),e.YNc(10,H,105,34,"div",4),e.YNc(11,Q,4,1,"div",5),e.qZA()),2&t&&(e.xp6(10),e.Q6J("ngIf",r.returnInvo&&r.returnInvo.return_ref),e.xp6(1),e.Q6J("ngIf",r.isLoading()))},directives:[d.Gu,d.sr,d.Sm,d.YG,d.gu,d.wd,c.d,d.W2,f.O5,d.PM,d.Zi,d.Dq,d.FN,d.jY,d.Nd,d.wI,d.Ie,d.Q$,d.pK,d.j9,a.JJ,a.On,d.hM,g.v,d.g2,d.t9,d.QI,d.n0,f.sg,d.as,d.PQ],pipes:[v.v],styles:[".container[_ngcontent-%COMP%]{padding:16px;max-width:1200px;margin:0 auto}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.section-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:var(--ion-color-primary);text-align:center}.list-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-top:12px}@media (max-width: 768px){.list-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:8px}}.list-controls[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{flex:1;margin:0}.search-navigation[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.search-navigation[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]{font-size:.9rem;color:var(--ion-color-medium);min-width:80px;text-align:center}.table-container[_ngcontent-%COMP%]{overflow-x:auto;border-radius:8px;border:1px solid var(--ion-color-light)}.items-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.items-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .items-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:center;border-bottom:1px solid var(--ion-color-light)}.items-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--ion-color-light);font-weight:700;color:var(--ion-color-primary);position:sticky;top:0;z-index:1}.items-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--ion-color-light-shade)}.items-table[_ngcontent-%COMP%]   tr.highlighted[_ngcontent-%COMP%]{background-color:var(--ion-color-primary-tint)!important;border:2px solid var(--ion-color-primary)}.items-table[_ngcontent-%COMP%]   tr.search-match[_ngcontent-%COMP%]{background-color:var(--ion-color-warning-tint)}.items-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:center}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;min-width:40px}.discount-section[_ngcontent-%COMP%]{border:1px solid var(--ion-color-light);border-radius:8px;padding:16px;margin:16px 0;background-color:var(--ion-color-light-tint)}.discount-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;margin-bottom:8px}.discount-display[_ngcontent-%COMP%]{text-align:center;font-size:1rem;font-weight:500;color:var(--ion-color-primary);padding:8px;background-color:var(--ion-color-light);border-radius:4px}.totals-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--ion-color-primary-tint),var(--ion-color-light));border:2px solid var(--ion-color-primary)}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--ion-color-light)}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.totals-grid[_ngcontent-%COMP%]   .total-row.final-total[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-primary);margin-top:8px;padding-top:12px;font-weight:700;font-size:1.1rem}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-dark)}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .value.discount[_ngcontent-%COMP%]{color:var(--ion-color-warning)}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .value.positive[_ngcontent-%COMP%]{color:var(--ion-color-success)}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .value.negative[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.action-section[_ngcontent-%COMP%]{position:sticky;bottom:16px;z-index:10;margin-top:24px}.action-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}@media (max-width: 768px){.action-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{gap:8px}}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#0000004d;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.loading-overlay[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{--color: var(--ion-color-primary);transform:scale(2);margin-bottom:20px}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:1.1rem;text-align:center;margin:0}mark[_ngcontent-%COMP%]{background-color:var(--ion-color-warning);padding:2px 4px;border-radius:2px;font-weight:700}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:16px;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;color:var(--ion-color-dark)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.9rem}ion-card[_ngcontent-%COMP%]{margin:16px 0;border-radius:12px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{text-align:center}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:700}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:12px}.items-table[_ngcontent-%COMP%]{font-size:.9rem}.items-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .items-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 4px}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:4px}.totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{align-self:flex-end}}[dir=rtl][_ngcontent-%COMP%]   .totals-grid[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{direction:rtl}ion-input[_ngcontent-%COMP%]:focus-within, ion-textarea[_ngcontent-%COMP%]:focus-within, ion-select[_ngcontent-%COMP%]:focus-within{--highlight-color: var(--ion-color-primary)}ion-button[_ngcontent-%COMP%]{--border-radius: 8px}ion-button[color=primary][_ngcontent-%COMP%]{font-weight:700}ion-button[fill=outline][_ngcontent-%COMP%]{--border-width: 2px}.edit-mode-indicator[_ngcontent-%COMP%]{background:var(--ion-color-warning);color:var(--ion-color-warning-contrast);padding:8px;text-align:center;font-weight:700;border-radius:4px;margin-bottom:16px}"]}),s})()}];let j=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[m.Bz.forChild(z)],m.Bz]}),s})();var $=h(62279);let W=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[f.ez,a.u5,d.Pc,j,$.m]]}),s})()},1212:(b,A,h)=>{h.d(A,{v:()=>d});var f=h(29863),a=h(6612);let d=(()=>{class m{constructor(e){this.currencyService=e}transform(e,T="SDG",y=!0){if(!e&&0!==e||isNaN(e))return"0.00";try{const C=this.currencyService.getCurrentCurrencyValue();let i=e;return T!==C&&(i=this.currencyService.convertToCurrentCurrency(e,T)),y?this.currencyService.formatCurrency(i,C):i.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch(C){console.error("Currency display pipe error:",C);const i=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e);return y?i+" \u062c.\u0633":i}}}return m.\u0275fac=function(e){return new(e||m)(f.Y36(a.i,16))},m.\u0275pipe=f.Yjl({name:"currencyDisplay",type:m,pure:!1}),m})()},6612:(b,A,h)=>{h.d(A,{i:()=>T});var f=h(70655),a=h(40520),d=h(591),m=h(29863),p=h(90849),e=h(91472);let T=(()=>{class y{constructor(i,u,n){this.http=i,this.storage=u,this.servicesService=n,this.currentCurrency=new d.X("SDG"),this.currentYear=new d.X(null),this.exchangeRates=new d.X({}),this.supportedCurrencies=new d.X([]),this.ratesCache=new Map,this.api=this.servicesService.api}getCurrentCurrency(){return this.currentCurrency.asObservable()}getCurrentCurrencyValue(){return this.currentCurrency.value}setCurrency(i){this.currentCurrency.next(i),this.storage.set("selectedCurrency",i)}setCurrentYear(i){this.currentYear.next(i)}loadRatesByYear(i,u){return(0,f.mG)(this,void 0,void 0,function*(){try{const n=(new a.LE).set("store_id",i).set("year_id",u),c=yield this.http.get(this.api+"currency_rates/latest.php",{params:n}).toPromise();return c&&c.data&&(this.cacheRates(c.data,u),this.exchangeRates.next(c.data)),c}catch(n){return console.error("Error loading currency rates:",n),null}})}getExchangeRate(i){if("SDG"===i)return 1;const u=this.exchangeRates.value;if(Array.isArray(u)){const n=u.find(c=>c.target_currency===i);return n?parseFloat(n.exchange_rate):1}return 1}createCurrencyRate(i){const u={headers:new a.WM({"Content-Type":"application/json"})};return this.http.post(this.api+"currency_rates/create.php",i,u)}getCurrencyRates(i){let u=new a.LE;return Object.keys(i).forEach(n=>{i[n]&&(u=u.set(n,i[n]))}),this.http.get(this.api+"currency_rates/read.php",{params:u})}updateCurrencyRate(i,u){const n=Object.assign({id:i},u),c={headers:new a.WM({"Content-Type":"application/json"})};return this.http.put(this.api+"currency_rates/update.php",n,c)}deleteCurrencyRate(i){const u=(new a.LE).set("id",i);return this.http.delete(this.api+"currency_rates/delete.php",{params:u})}getNearestRate(i,u,n,c){const g=(new a.LE).set("currency",i).set("date",u).set("store_id",n).set("year_id",c);return this.http.get(this.api+"currency_rates/nearestDate.php",{params:g})}convertFromSDG(i,u){return"SDG"!==u&&i?i/this.getExchangeRate(u):i}convertToSDG(i,u){return"SDG"!==u&&i?i*this.getExchangeRate(u):i}formatCurrency(i,u){return`${i.toLocaleString("en-US",{minimumFractionDigits:2})} ${{SDG:"\u062c.\u0633",USD:"$",AED:"\u062f.\u0625",SAR:"\u0631.\u0633"}[u]||u}`}getSupportedCurrencies(){return this.http.get(this.api+"currencies/read.php")}getActiveCurrencies(){const i=(new a.LE).set("active_only","true");return this.http.get(this.api+"currencies/read.php",{params:i})}addSupportedCurrency(i){return this.http.post(this.api+"currencies/create.php",i)}updateSupportedCurrency(i,u){return this.http.put(this.api+"currencies/update.php",Object.assign({id:i},u))}deleteSupportedCurrency(i){const u=(new a.LE).set("id",i);return this.http.delete(this.api+"currencies/delete.php",{params:u})}cacheKey(i,u,n){return`${i}_${u}_${n}`}cacheRates(i,u){Array.isArray(i)&&i.forEach(n=>{const c=this.cacheKey(n.target_currency,n.rate_date,u);this.ratesCache.set(c,n)})}getCachedRate(i,u,n){const c=this.cacheKey(i,u,n);return this.ratesCache.get(c)}clearCache(){this.ratesCache.clear()}initializeCurrency(){return(0,f.mG)(this,void 0,void 0,function*(){try{yield this.storage.create();const i=yield this.storage.get("selectedCurrency");i&&this.currentCurrency.next(i)}catch(i){console.error("Error initializing currency:",i)}})}getCurrentExchangeRates(){return this.exchangeRates.asObservable()}getSupportedCurrenciesObservable(){return this.supportedCurrencies.asObservable()}loadSupportedCurrencies(){return(0,f.mG)(this,void 0,void 0,function*(){try{const i=yield this.getSupportedCurrencies().toPromise();i&&i.data&&this.supportedCurrencies.next(i.data)}catch(i){console.error("Error loading supported currencies:",i)}})}formatAmount(i,u){const n=u||this.getCurrentCurrencyValue();let c=i;return"SDG"!==n&&(c=this.convertFromSDG(i,n)),this.formatCurrency(c,n)}convertToCurrentCurrency(i,u="SDG"){const n=this.getCurrentCurrencyValue();if(u===n)return i;if("SDG"===u)return this.convertFromSDG(i,n);if("SDG"===n)return this.convertToSDG(i,u);{const c=this.convertToSDG(i,u);return this.convertFromSDG(c,n)}}getCurrentCurrencySymbol(){const i=this.getCurrentCurrencyValue();return{SDG:"\u062c.\u0633",USD:"$",AED:"\u062f.\u0625",SAR:"\u0631.\u0633"}[i]||i}getCurrentCurrencySymbolForHeader(i){return`${i} (${this.getCurrentCurrencySymbol()})`}formatAmountWithoutSymbol(i,u){const n=u||this.getCurrentCurrencyValue();let c=i;return"SDG"!==n&&(c=this.convertFromSDG(i,n)),c.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}}return y.\u0275fac=function(i){return new(i||y)(m.LFG(a.eN),m.LFG(p.K),m.LFG(e.r))},y.\u0275prov=m.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()}}]);