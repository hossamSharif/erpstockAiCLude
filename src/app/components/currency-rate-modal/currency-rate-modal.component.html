<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-title>{{ getModalTitle() }}</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="dismiss()">
        <ion-icon name="close" color="light"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="rateForm" (ngSubmit)="save()">
    <ion-list class="form-list">
      
      <!-- Currency Selection -->
      <ion-item class="form-item">
        <ion-label position="stacked" class="form-label">
          العملة <span class="required-asterisk">*</span>
        </ion-label>
        <ion-select 
          formControlName="target_currency" 
          placeholder="اختر العملة"
          interface="popover"
          [disabled]="mode === 'edit'"
          class="form-select">
          <ion-select-option 
            *ngFor="let currency of supportedCurrencies" 
            [value]="currency.currency_code">
            {{ getCurrencyDisplayText(currency) }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <div *ngIf="isFieldInvalid('target_currency')" class="error-message">
        {{ getFieldErrorMessage('target_currency') }}
      </div>

      <!-- Exchange Rate -->
      <ion-item class="form-item">
        <ion-label position="stacked" class="form-label">
          سعر الصرف (مقابل الجنيه السوداني) <span class="required-asterisk">*</span>
        </ion-label>
        <ion-input 
          type="number" 
          formControlName="exchange_rate" 
          step="0.000001"
          placeholder="450.50"
          class="form-input">
        </ion-input>
      </ion-item>
      <div *ngIf="isFieldInvalid('exchange_rate')" class="error-message">
        {{ getFieldErrorMessage('exchange_rate') }}
      </div>

      <!-- Rate Date -->
      <ion-item class="form-item">
        <ion-label position="stacked" class="form-label">
          التاريخ <span class="required-asterisk">*</span>
        </ion-label>
        <ion-datetime 
          formControlName="rate_date" 
          displayFormat="YYYY-MM-DD"
          pickerFormat="YYYY-MM-DD"
          [max]="new Date().toISOString().split('T')[0]"
          class="form-datetime">
        </ion-datetime>
      </ion-item>
      <div *ngIf="isFieldInvalid('rate_date')" class="error-message">
        {{ getFieldErrorMessage('rate_date') }}
      </div>

      <!-- Store ID (Hidden if passed from parent) -->
      <ion-item *ngIf="!store_info" class="form-item">
        <ion-label position="stacked" class="form-label">
          رقم المتجر <span class="required-asterisk">*</span>
        </ion-label>
        <ion-input 
          type="number" 
          formControlName="store_id" 
          placeholder="1"
          class="form-input">
        </ion-input>
      </ion-item>

      <!-- Year ID (Hidden if passed from parent) -->
      <ion-item *ngIf="!year" class="form-item">
        <ion-label position="stacked" class="form-label">
          رقم السنة <span class="required-asterisk">*</span>
        </ion-label>
        <ion-input 
          type="number" 
          formControlName="year_id" 
          placeholder="1"
          class="form-input">
        </ion-input>
      </ion-item>

    </ion-list>

    <!-- Action Buttons -->
    <div class="button-container">
      <ion-button 
        expand="block" 
        type="submit" 
        [disabled]="!rateForm.valid || isLoading"
        color="primary"
        class="save-button">
        <ion-icon name="save-outline" slot="start"></ion-icon>
        {{ getSaveButtonText() }}
      </ion-button>

      <ion-button 
        expand="block" 
        fill="outline" 
        color="medium" 
        (click)="dismiss()"
        class="cancel-button">
        <ion-icon name="close-outline" slot="start"></ion-icon>
        إلغاء
      </ion-button>
    </div>
  </form>
</ion-content>