"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5319],{75319:(y,_,s)=>{s.r(_),s.d(_,{EditPurchaseReturnPageModule:()=>Y});var l=s(69808),h=s(34182),a=s(23349),g=s(94030),u=s(70655),p=s(4441),t=s(29863),m=s(17158),v=s(65465),P=s(90849),A=s(91472),C=s(32724),Z=s(6612);const b=["dst"],x=["dstPop"],T=["qtyId"],M=["popInput"],I=["popover"],O=["popoverNotif"];function E(r,c){if(1&r&&(t.TgZ(0,"div",4),t.TgZ(1,"ion-card"),t.TgZ(2,"ion-card-header"),t.TgZ(3,"ion-card-title",9),t._uU(4,"\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0634\u0631\u0627\u0621 \u0627\u0644\u0623\u0635\u0644\u064a\u0629"),t.qZA(),t.qZA(),t.TgZ(5,"ion-card-content"),t.TgZ(6,"div",10),t.TgZ(7,"div",11),t.TgZ(8,"label"),t._uU(9,"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064a\u0629:"),t.qZA(),t.TgZ(10,"span"),t._uU(11),t.qZA(),t.qZA(),t.TgZ(12,"div",11),t.TgZ(13,"label"),t._uU(14,"\u0627\u0644\u0645\u0648\u0631\u062f:"),t.qZA(),t.TgZ(15,"span"),t._uU(16),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&r){const e=t.oxw();t.xp6(11),t.Oqu(e.selectedOriginalInvoice.pay_ref),t.xp6(5),t.Oqu(e.selectedAccount.sub_name)}}function R(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t.TgZ(10,"ion-button",15),t.NdJ("click",function(){const o=t.CHM(e).index;return t.oxw(2).deleteItem(o)}),t._UZ(11,"ion-icon",16),t.qZA(),t.qZA(),t.qZA()}if(2&r){const e=c.$implicit,n=t.oxw(2);t.xp6(2),t.Oqu(e.item_name),t.xp6(2),t.Oqu(e.quantity),t.xp6(2),t.Oqu(n.formatBalance(e.return_price)),t.xp6(2),t.Oqu(n.formatBalance(e.tot))}}function q(r,c){if(1&r&&(t.TgZ(0,"div",4),t.TgZ(1,"ion-card"),t.TgZ(2,"ion-card-header"),t.TgZ(3,"ion-card-title",9),t._uU(4,"\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0625\u0631\u062c\u0627\u0639"),t.qZA(),t.qZA(),t.TgZ(5,"ion-card-content"),t.TgZ(6,"div",12),t.TgZ(7,"table",13),t.TgZ(8,"thead"),t.TgZ(9,"tr"),t.TgZ(10,"th"),t._uU(11,"\u0627\u0644\u0635\u0646\u0641"),t.qZA(),t.TgZ(12,"th"),t._uU(13,"\u0627\u0644\u0643\u0645\u064a\u0629"),t.qZA(),t.TgZ(14,"th"),t._uU(15),t.qZA(),t.TgZ(16,"th"),t._uU(17),t.qZA(),t.TgZ(18,"th"),t._uU(19,"\u0639\u0645\u0644\u064a\u0627\u062a"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"tbody"),t.YNc(21,R,12,4,"tr",14),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&r){const e=t.oxw();t.xp6(15),t.hij("\u0627\u0644\u0633\u0639\u0631 (",e.getCurrencySymbol(),")"),t.xp6(2),t.hij("\u0627\u0644\u0645\u062c\u0645\u0648\u0639 (",e.getCurrencySymbol(),")"),t.xp6(4),t.Q6J("ngForOf",e.getDisplayItemList())}}function S(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item"),t.TgZ(1,"ion-label",17),t._uU(2,"\u0646\u0633\u0628\u0629 \u0627\u0644\u062e\u0635\u0645 (%)"),t.qZA(),t.TgZ(3,"ion-input",25),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(2).discountPerc=i})("ionInput",function(i){return t.CHM(e),t.oxw(2).onPercentageDiscountChange(i)}),t.qZA(),t.qZA()}if(2&r){const e=t.oxw(2);t.xp6(3),t.Q6J("ngModel",e.discountPerc)}}function w(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item"),t.TgZ(1,"ion-label",17),t._uU(2),t.qZA(),t.TgZ(3,"ion-input",26),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(2).discountAmount=i})("ionInput",function(i){return t.CHM(e),t.oxw(2).onAmountDiscountChange(i)}),t.qZA(),t.qZA()}if(2&r){const e=t.oxw(2);t.xp6(2),t.hij("\u0645\u0628\u0644\u063a \u0627\u0644\u062e\u0635\u0645 (",e.getCurrencySymbol(),")"),t.xp6(1),t.Q6J("ngModel",e.discountAmount)}}function L(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"div",4),t.TgZ(1,"ion-card"),t.TgZ(2,"ion-card-header"),t.TgZ(3,"ion-card-title",9),t._uU(4,"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u062e\u0635\u0645 \u0648\u0627\u0644\u062f\u0641\u0639"),t.qZA(),t.qZA(),t.TgZ(5,"ion-card-content"),t.TgZ(6,"ion-item"),t.TgZ(7,"ion-label",17),t._uU(8,"\u0646\u0648\u0639 \u0627\u0644\u062e\u0635\u0645"),t.qZA(),t.TgZ(9,"ion-select",18),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().discountType=i})("ionSelectionChange",function(i){return t.CHM(e),t.oxw().onDiscountTypeChange(i)}),t.TgZ(10,"ion-select-option",19),t._uU(11,"\u0646\u0633\u0628\u0629 \u0645\u0626\u0648\u064a\u0629"),t.qZA(),t.TgZ(12,"ion-select-option",20),t._uU(13,"\u0645\u0628\u0644\u063a \u062b\u0627\u0628\u062a"),t.qZA(),t.qZA(),t.qZA(),t.YNc(14,S,4,1,"ion-item",21),t.YNc(15,w,4,2,"ion-item",21),t.TgZ(16,"ion-item"),t.TgZ(17,"ion-label",17),t._uU(18),t.qZA(),t.TgZ(19,"ion-input",22),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().returnInvo.pay=i})("ionInput",function(i){return t.CHM(e),t.oxw().payChange(i)}),t.qZA(),t.qZA(),t.TgZ(20,"ion-item"),t.TgZ(21,"ion-label",17),t._uU(22,"\u0633\u0628\u0628 \u0627\u0644\u0625\u0631\u062c\u0627\u0639"),t.qZA(),t.TgZ(23,"ion-textarea",23),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().returnReason=i}),t.qZA(),t.qZA(),t.TgZ(24,"ion-item"),t.TgZ(25,"ion-label",17),t._uU(26,"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0631\u062c\u0627\u0639"),t.qZA(),t.TgZ(27,"ion-input",24),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().returnInvo.return_date=i}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&r){const e=t.oxw();t.xp6(9),t.Q6J("ngModel",e.discountType),t.xp6(5),t.Q6J("ngIf","percentage"===e.discountType),t.xp6(1),t.Q6J("ngIf","amount"===e.discountType),t.xp6(3),t.hij("\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639 (",e.getCurrencySymbol(),")"),t.xp6(1),t.Q6J("ngModel",e.returnInvo.pay),t.xp6(4),t.Q6J("ngModel",e.returnReason),t.xp6(4),t.Q6J("ngModel",e.returnInvo.return_date)}}function U(r,c){if(1&r&&(t.TgZ(0,"div",28),t.TgZ(1,"label"),t._uU(2),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA(),t.qZA()),2&r){const e=t.oxw(2);t.xp6(2),t.hij("\u0627\u0644\u062e\u0635\u0645 (",e.discountPerc,"%):"),t.xp6(2),t.AsE("",e.formatBalance(e.calculatedDiscountAmount)," ",e.getCurrencySymbol(),"")}}function D(r,c){if(1&r&&(t.TgZ(0,"div",28),t.TgZ(1,"label"),t._uU(2,"\u0627\u0644\u062e\u0635\u0645:"),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA(),t.qZA()),2&r){const e=t.oxw(2);t.xp6(4),t.AsE("",e.formatBalance(e.discountAmount)," ",e.getCurrencySymbol(),"")}}function F(r,c){if(1&r&&(t.TgZ(0,"div",4),t.TgZ(1,"ion-card"),t.TgZ(2,"ion-card-header"),t.TgZ(3,"ion-card-title",9),t._uU(4,"\u0645\u0644\u062e\u0635 \u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0625\u0631\u062c\u0627\u0639"),t.qZA(),t.qZA(),t.TgZ(5,"ion-card-content"),t.TgZ(6,"div",27),t.TgZ(7,"div",28),t.TgZ(8,"label"),t._uU(9,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0641\u0631\u0639\u064a:"),t.qZA(),t.TgZ(10,"span"),t._uU(11),t.qZA(),t.qZA(),t.YNc(12,U,5,3,"div",29),t.YNc(13,D,5,2,"div",29),t.TgZ(14,"div",30),t.TgZ(15,"label"),t._uU(16,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0646\u0647\u0627\u0626\u064a:"),t.qZA(),t.TgZ(17,"span"),t._uU(18),t.qZA(),t.qZA(),t.TgZ(19,"div",28),t.TgZ(20,"label"),t._uU(21,"\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639:"),t.qZA(),t.TgZ(22,"span"),t._uU(23),t.qZA(),t.qZA(),t.TgZ(24,"div",28),t.TgZ(25,"label"),t._uU(26,"\u0627\u0644\u0628\u0627\u0642\u064a:"),t.qZA(),t.TgZ(27,"span"),t._uU(28),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&r){const e=t.oxw();t.xp6(11),t.AsE("",e.formatBalance(e.getSubtotal())," ",e.getCurrencySymbol(),""),t.xp6(1),t.Q6J("ngIf","percentage"===e.discountType&&e.discountPerc>0),t.xp6(1),t.Q6J("ngIf","amount"===e.discountType&&e.discountAmount>0),t.xp6(5),t.AsE("",e.formatBalance(e.returnInvo.tot_pr)," ",e.getCurrencySymbol(),""),t.xp6(5),t.AsE("",e.formatBalance(e.returnInvo.pay)," ",e.getCurrencySymbol(),""),t.xp6(4),t.ekj("negative",e.returnInvo.changee<0),t.xp6(1),t.AsE("",e.formatBalance(e.returnInvo.changee)," ",e.getCurrencySymbol(),"")}}function N(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"div",4),t.TgZ(1,"div",31),t.TgZ(2,"ion-button",32),t.NdJ("click",function(){return t.CHM(e),t.oxw().save()}),t._UZ(3,"ion-icon",33),t._uU(4," \u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a "),t.qZA(),t.TgZ(5,"ion-button",34),t.NdJ("click",function(){return t.CHM(e),t.oxw().deleteReturn()}),t._UZ(6,"ion-icon",35),t._uU(7," \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 "),t.qZA(),t.qZA(),t.qZA()}if(2&r){const e=t.oxw();t.xp6(2),t.Q6J("disabled",e.isLoading()),t.xp6(3),t.Q6J("disabled",e.isLoading())}}function B(r,c){if(1&r&&(t.TgZ(0,"div",36),t._UZ(1,"ion-spinner",37),t.TgZ(2,"p"),t._uU(3),t.qZA(),t.qZA()),2&r){const e=t.oxw();t.xp6(3),t.Oqu(e.currentLoadingMessage)}}const k=[{path:"",component:(()=>{class r{constructor(e,n,i,o,d,f,G,j,H,z,W,K,$,X,V,tt,et){this.rout=e,this.platform=n,this.behavApi=i,this._location=o,this.route=d,this.renderer=f,this.modalController=G,this.alertController=j,this.authenticationService=H,this.storage=z,this.loadingController=W,this.datePipe=K,this.api=$,this.toast=X,this.accountCommunicationService=V,this.cdr=tt,this.currencyService=et,this.editMode=!0,this.returnRefToEdit="",this.originalReturnData=null,this.isReturnAllItems=!1,this.originalInvoice=null,this.originalItems=[],this.selectedOriginalInvoice=null,this.availablePurchaseInvoices=[],this.returnReason="",this.discountType="percentage",this.discountAmount=0,this.calculatedDiscountPerc=0,this.calculatedDiscountAmount=0,this.isOpen=!1,this.isOpenNotif=!1,this.newNotif=!1,this.sub_account=[],this.sub_accountLocalSales=[],this.sub_accountSales=[],this.initialInvoices=[],this.items=[],this.itemsLocal=[],this.itemList=[],this.sortedItemList=[],this.isItemListSorted=!1,this.searchTerm="",this.highlightedIndex=-1,this.searchMatches=[],this.purchaseLocal=[],this.purchase=[],this.notifArr=[],this.LogHistoryLocalArr=[],this.randomsNumber=[],this.sub_nameNew="",this.discountPerc=0,this.printMode=!1,this.printArr=[],this.offline=!1,this.color="dark",this.showMe=null,this.status="edit",this.searchLang=0,this.aliasTerm="",this.searchResult=[],this.aliasResult=[],this.finalResult=[],this.loadingItems=!1,this.logHistoryArr=[],this.showNotif=!1,this.device="",this.currenQty=0,this.firstQty=0,this.perchTotQty=0,this.payTotQty=0,this.perchTot=0,this.qtyReal=0,this.availQty=0,this.pendingItemsFromStock=[],this.defaultCategoryId=null,this.statusFromRoute="edit",this.showBackButton=!0,this.isSaving=!1,this.isDeleting=!1,this.isUpdating=!1,this.currentLoadingMessage="",this.currentLoader=null,this.selectedAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:"",cat_name:"",cat_id:"",phone:"",address:"",currentSupplierStatus:0},this.printArr.push({returnInvo:"",itemList:"",selectedAccount:"",sub_nameNew:"",userInfo:"",sub_balanse:0,balanceStatus:""}),this.selectedItem={id:void 0,dateCreated:"",return_ref:"",item_desc:"",item_name:"",item_unit:"",parcode:0,return_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:"",tax:0,imageUrl:""}}ngOnInit(){this.route.queryParams.subscribe(e=>{e.return_ref&&(this.returnRefToEdit=e.return_ref,this.editMode=!0,this.showBackButton=!0,console.log("Edit mode - Return ref:",this.returnRefToEdit))}),this.discountType||(this.discountType="percentage",this.cdr.detectChanges()),this.initializeCurrency(),this.supplierSubscription=this.accountCommunicationService.customerSelected$.subscribe(({id:e,account:n})=>{e&&this.returnInvo&&(console.log("Supplier selected in edit purchase return, setting supplier_id:",e),this.returnInvo.supplier_id=e,this.returnInvo.sub_name=n.sub_name,this.selectedAccount=n,console.log("Edit purchase return invoice updated:",this.returnInvo))}),this.getAppInfo()}ngOnDestroy(){return(0,u.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),this.supplierSubscription&&this.supplierSubscription.unsubscribe(),this.currencySubscription&&this.currencySubscription.unsubscribe()})}initializeCurrency(){return(0,u.mG)(this,void 0,void 0,function*(){try{yield this.currencyService.initializeCurrency(),yield this.currencyService.loadSupportedCurrencies(),this.store_info&&this.year&&(yield this.currencyService.loadRatesByYear(this.store_info.id,this.year.id)),this.currencySubscription=this.currencyService.getCurrentCurrency().subscribe(e=>{this.cdr.detectChanges()})}catch(e){console.error("Error initializing currency:",e)}})}getAppInfo(){this.storage.get("USER_INFO").then(e=>{e&&(this.user_info=e)}),this.storage.get("year").then(e=>{e&&(this.year=e)}),this.storage.get("STORE_INFO").then(e=>{e&&(this.store_info=e,this.returnRefToEdit?this.loadReturnForEditing():this.prepareReturnInvo())})}loadReturnForEditing(){return(0,u.mG)(this,void 0,void 0,function*(){yield this.showLoading("\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629...","saving");try{this.api.getPurchaseReturnDetail(this.store_info.id,this.returnRefToEdit,this.year.id).subscribe(e=>(0,u.mG)(this,void 0,void 0,function*(){console.log("Return data loaded:",e),yield this.hideLoading(),"Purchase return details retrieved successfully"===e.message?this.populateReturnData(e.data):(this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger"),this.goBack())}),e=>(0,u.mG)(this,void 0,void 0,function*(){yield this.hideLoading(),console.log("Error loading return data:",e),this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629","danger"),this.goBack()}))}catch(e){yield this.hideLoading(),console.error("Error in loadReturnForEditing:",e)}})}populateReturnData(e){const n=e.returnInvoice,i=e.returnItems;if(console.log("Populating return data:",n,i),this.originalReturnData=JSON.parse(JSON.stringify(e)),this.returnInvo={return_id:n.return_id,return_ref:n.return_ref,original_pay_ref:n.original_pay_ref,store_id:n.store_id,tot_pr:n.tot_pr,pay:n.pay,return_date:n.return_date,return_time:n.return_time,user_id:n.user_id,supplier_id:n.supplier_id,return_method:n.return_method,discount:n.discount,changee:n.changee,sub_name:n.sub_name,returnComment:n.returnComment,yearId:n.yearId,is_full_return:n.is_full_return,return_reason:n.return_reason},this.returnReason=n.return_reason||"",n.discount>0){const o=i.reduce((d,f)=>d+ +f.quantity*+f.return_price,0);o>0&&(this.calculatedDiscountPerc=+n.discount/o*100,this.calculatedDiscountAmount=+n.discount,Math.abs(this.calculatedDiscountPerc-Math.round(this.calculatedDiscountPerc))<.01?(this.discountType="percentage",this.discountPerc=Math.round(this.calculatedDiscountPerc)):(this.discountType="amount",this.discountAmount=+n.discount))}this.selectedAccount={id:n.supplier_id,ac_id:n.supplier_id,sub_name:n.sub_name,sub_type:"",sub_code:"",sub_balance:"",store_id:n.store_id,cat_name:"",cat_id:"",phone:"",address:"",currentSupplierStatus:0},this.itemList=i.map(o=>({id:o.id,return_ref:o.return_ref,item_name:o.item_name,return_price:o.return_price,quantity:o.quantity,tot:o.tot,store_id:o.store_id,yearId:o.yearId,item_id:o.item_id,dateCreated:o.dateCreated,original_price:o.original_price,tax:o.tax,imageUrl:o.imageUrl})),this.isReturnAllItems=1==n.is_full_return,this.loadOriginalInvoiceForEdit(n.original_pay_ref),this.updateSortedList(),this.getTotal()}loadOriginalInvoiceForEdit(e){return(0,u.mG)(this,void 0,void 0,function*(){try{this.api.getPerchInvoDetail(this.store_info.id,e,this.year.id).subscribe(n=>{this.originalItems=n.data||[],console.log("Original purchase items loaded for editing:",this.originalItems),this.selectedOriginalInvoice={pay_ref:e,supplier_id:this.returnInvo.supplier_id,sub_name:this.returnInvo.sub_name},this.originalInvoice=this.selectedOriginalInvoice},n=>{console.log("Error loading original items for editing:",n)})}catch(n){console.error("Error in loadOriginalInvoiceForEdit:",n)}})}prepareReturnInvo(){this.selectedAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:"",cat_name:"",cat_id:"",phone:"",address:"",currentSupplierStatus:0},this.sub_nameNew="",this.returnInvo={return_id:void 0,return_ref:0,original_pay_ref:"",store_id:"",tot_pr:0,pay:0,return_date:"",return_time:"",user_id:"",supplier_id:null,return_method:"",discount:0,changee:0,sub_name:"",returnComment:"",yearId:this.year.id,is_full_return:0,return_reason:""},this.discountPerc=0,this.returnReason="",this.isReturnAllItems=!1;let e=new Date;this.returnInvo.return_date=this.datePipe.transform(e,"yyyy-MM-dd"),this.returnInvo.return_time=this.datePipe.transform(e,"HH:mm:ss"),this.returnInvo.store_id=this.store_info.id,this.returnInvo.user_id=this.user_info.id,this.returnInvo.yearId=this.year.id,this.itemList=[],this.sortedItemList=[],this.isItemListSorted=!1,this.searchTerm="",this.searchMatches=[],this.highlightedIndex=-1,this.originalInvoice=null,this.originalItems=[],this.selectedOriginalInvoice=null}updateReturn(){return(0,u.mG)(this,void 0,void 0,function*(){yield this.showLoading("\u062c\u0627\u0631\u064a \u062a\u062d\u062f\u064a\u062b \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0631\u062a\u062c\u0639\u0627\u062a \u0627\u0644\u0634\u0631\u0627\u0621...","updating");try{this.returnInvo.return_reason=this.returnReason;const e={invoice:this.returnInvo,items:this.itemList};console.log("Updating purchase return data:",e),this.api.updatePurchaseReturnWithItems(e).subscribe(n=>(0,u.mG)(this,void 0,void 0,function*(){console.log("Purchase return updated:",n),yield this.hideLoading(),this.handleUpdateSuccess()}),n=>(0,u.mG)(this,void 0,void 0,function*(){console.log("Update error:",n),yield this.hideLoading(),this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a\u060c \u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0627\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649","danger")}))}catch(e){yield this.hideLoading(),console.error("Unexpected error in updateReturn:",e),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639 \u0623\u062b\u0646\u0627\u0621 \u0627\u0644\u062a\u062d\u062f\u064a\u062b","danger")}})}deleteReturn(){return(0,u.mG)(this,void 0,void 0,function*(){if(yield this.presentConfirmAlert("\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641","\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629\u061f \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062a\u0631\u0627\u062c\u0639 \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0625\u062c\u0631\u0627\u0621.","\u0646\u0639\u0645\u060c \u0627\u062d\u0630\u0641","\u0625\u0644\u063a\u0627\u0621")){yield this.showLoading("\u062c\u0627\u0631\u064a \u062d\u0630\u0641 \u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0627\u062a...","deleting");try{this.api.deletePurchaseReturnWithItems({return_ref:this.returnInvo.return_ref,store_id:this.returnInvo.store_id,yearId:this.returnInvo.yearId}).subscribe(i=>(0,u.mG)(this,void 0,void 0,function*(){console.log("Purchase return deleted:",i),yield this.hideLoading(),this.presentToast("\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629 \u0628\u0646\u062c\u0627\u062d","success"),this.goBack()}),i=>(0,u.mG)(this,void 0,void 0,function*(){console.log("Delete error:",i),yield this.hideLoading(),this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a\u060c \u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0627\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649","danger")}))}catch(n){yield this.hideLoading(),console.error("Unexpected error in deleteReturn:",n),this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639 \u0623\u062b\u0646\u0627\u0621 \u0627\u0644\u062d\u0630\u0641","danger")}}})}save(){let e=this.returnInvo.return_date;this.returnInvo.sub_name=this.selectedAccount.sub_name,this.returnInvo.return_date=this.datePipe.transform(e,"yyyy-MM-dd"),1==this.validate()&&this.updateReturn()}handleUpdateSuccess(){this.presentToast("\u062a\u0645 \u0627\u0644\u062a\u062d\u062f\u064a\u062b \u0628\u0646\u062c\u0627\u062d","success"),this.printArr=[],this.printArr.push({returnInvo:this.returnInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentSupplierStatus}),console.log("Print array prepared for updated return:",this.printArr),this.presentAlertConfirm()}presentAlertConfirm(){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"\u062a\u0623\u0643\u064a\u062f!",mode:"ios",message:"\u0647\u0644 \u062a\u0631\u064a\u062f \u0637\u0628\u0627\u0639\u0629 \u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0627\u062a \u0627\u0644\u0645\u062d\u062f\u062b\u0629\u061f",buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel",cssClass:"secondary",id:"cancel-button",handler:i=>{this.goBack()}},{text:"\u0645\u0648\u0627\u0641\u0642",id:"confirm-button",handler:()=>{this.presentModal(this.printArr,"purchase_return").then(()=>{this.goBack()})}}]})).present()})}presentModal(e,n){return(0,u.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:p.n,componentProps:{printArr:e,page:n}})).present()})}back(){this._location.back()}goBack(){this._location.back()}validate(){if(!this.selectedOriginalInvoice||!this.returnInvo.original_pay_ref)return this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u0644\u062a\u0623\u0643\u062f \u0645\u0646 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064a\u0629","danger"),!1;if(0==this.itemList.length||""==this.returnInvo.return_ref)return this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062f\u062e\u0627\u0644 \u0627\u0635\u0646\u0627\u0641 \u0627\u0644\u064a \u0627\u0644\u0642\u0627\u0626\u0645\u0629","danger"),!1;const e=this.validateReturnQuantities();if(!e.valid)return this.presentToast(e.message,"danger"),!1;if(!this.returnInvo.supplier_id||!this.selectedAccount.sub_name)return this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062e\u062a\u064a\u0627\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0645\u0648\u0631\u062f","danger"),!1;if(""==this.returnInvo.return_date||null==this.returnInvo.return_date)return this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u062a\u0627\u0631\u064a\u062e ","danger"),!1;const n=this.validateBusinessLogic();return!!n.valid||(this.presentToast(n.message,"danger"),!1)}validateReturnQuantities(){for(const e of this.itemList){const n=this.originalItems.find(i=>i.item_id===e.item_id||i.item_name===e.item_name);if(!n)return{valid:!1,message:`\u0627\u0644\u0635\u0646\u0641 "${e.item_name}" \u063a\u064a\u0631 \u0645\u0648\u062c\u0648\u062f \u0641\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064a\u0629`};if(+e.quantity>+n.quantity)return{valid:!1,message:`\u0643\u0645\u064a\u0629 \u0627\u0644\u0625\u0631\u062c\u0627\u0639 \u0644\u0644\u0635\u0646\u0641 "${e.item_name}" (${e.quantity}) \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0644\u0623\u0635\u0644\u064a\u0629 (${n.quantity})`};if(+e.quantity<=0)return{valid:!1,message:`\u0643\u0645\u064a\u0629 \u0627\u0644\u0625\u0631\u062c\u0627\u0639 \u0644\u0644\u0635\u0646\u0641 "${e.item_name}" \u064a\u062c\u0628 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0623\u0643\u0628\u0631 \u0645\u0646 \u0635\u0641\u0631`}}return{valid:!0,message:""}}validateBusinessLogic(){return+this.returnInvo.discount>+this.returnInvo.tot_pr?{valid:!1,message:"\u0642\u064a\u0645\u0629 \u0627\u0644\u062e\u0635\u0645 \u0644\u0627 \u064a\u0645\u0643\u0646 \u0623\u0646 \u062a\u062a\u062c\u0627\u0648\u0632 \u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629"}:{valid:!0,message:""}}getTotal(){this.recalculateReturnTotals()}recalculateReturnTotals(){let e=0;this.itemList.forEach(i=>{const o=+i.quantity*+i.return_price;i.tot=o.toFixed(2),e+=o});const n=this.calculateDiscountAmount(e);this.returnInvo.discount=n.toFixed(2),this.returnInvo.tot_pr=(e-n).toFixed(2),this.returnInvo.changee=(e-n-+this.returnInvo.pay).toFixed(2)}calculateDiscountAmount(e){return"percentage"===this.discountType?e*(+this.discountPerc/100):+this.discountAmount}presentToast(e,n){return(0,u.mG)(this,void 0,void 0,function*(){(yield this.toast.create({message:e,duration:2e3,color:n,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})}presentConfirmAlert(e,n,i,o){return(0,u.mG)(this,void 0,void 0,function*(){return new Promise(d=>(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:e,message:n,mode:"ios",buttons:[{text:o,role:"cancel",cssClass:"secondary",handler:()=>{d(!1)}},{text:i,handler:()=>{d(!0)}}]})).present()}))})}showLoading(e,n="saving"){return(0,u.mG)(this,void 0,void 0,function*(){switch(yield this.hideLoading(),this.resetLoadingStates(),n){case"saving":this.isSaving=!0;break;case"deleting":this.isDeleting=!0;break;case"updating":this.isUpdating=!0}this.currentLoadingMessage=e,this.currentLoader=yield this.loadingController.create({spinner:"bubbles",mode:"ios",message:e,translucent:!0,backdropDismiss:!1}),yield this.currentLoader.present(),this.cdr.detectChanges()})}hideLoading(){return(0,u.mG)(this,void 0,void 0,function*(){if(this.currentLoader){try{yield this.currentLoader.dismiss()}catch(e){}this.currentLoader=null}this.resetLoadingStates(),this.currentLoadingMessage="",this.cdr.detectChanges()})}resetLoadingStates(){this.isSaving=!1,this.isDeleting=!1,this.isUpdating=!1}isLoading(){return this.isSaving||this.isDeleting||this.isUpdating}getCurrencySymbol(){return this.currencyService.getCurrentCurrencySymbol()}formatBalance(e){return e||0===e?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e)):"0.00"}updateSortedList(){this.sortedItemList=[...this.itemList]}getDisplayItemList(){return this.sortedItemList.length>0?this.sortedItemList:this.itemList}deleteItem(e){const i=this.getDisplayItemList()[e],o=this.itemList.findIndex(d=>d.item_name===i.item_name&&d.return_price===i.return_price&&d.quantity===i.quantity);-1!==o&&this.itemList.splice(o,1),this.discountPerc=0,this.returnInvo.discount=0,this.getTotal(),this.updateSortedList()}onDiscountTypeChange(e){this.discountType=e.detail.value,this.discountPerc=0,this.discountAmount=0,this.returnInvo.discount=0,this.calculatedDiscountPerc=0,this.calculatedDiscountAmount=0,this.calculateChange(),this.cdr.detectChanges()}onPercentageDiscountChange(e){this.discountPerc=e.target.value||0,this.returnInvo.tot_pr>0&&(this.calculatedDiscountAmount=+this.returnInvo.tot_pr*+this.discountPerc/100,this.returnInvo.discount=this.calculatedDiscountAmount.toFixed(2),this.calculateChange())}onAmountDiscountChange(e){this.discountAmount=e.target.value||0,this.returnInvo.tot_pr>0&&this.discountAmount>0?(this.calculatedDiscountPerc=+this.discountAmount/+this.returnInvo.tot_pr*100,this.returnInvo.discount=this.discountAmount,this.calculateChange()):(this.calculatedDiscountPerc=0,this.returnInvo.discount=0,this.calculateChange())}getSubtotal(){return this.itemList&&0!==this.itemList.length?this.itemList.reduce((e,n)=>e+Number(n.tot||0),0):0}calculateChange(){this.returnInvo.changee=+(this.returnInvo.tot_pr-+this.returnInvo.discount)-this.returnInvo.pay}payChange(e){this.discountPerc>0&&(this.returnInvo.discount=(+this.returnInvo.tot_pr*+this.discountPerc/100).toFixed(2)),this.returnInvo.changee=+(this.returnInvo.tot_pr-+this.returnInvo.discount)-e.target.value}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g.F0),t.Y36(a.t4),t.Y36(m.h),t.Y36(l.Ye),t.Y36(g.gz),t.Y36(t.Qsj),t.Y36(a.IN),t.Y36(a.Br),t.Y36(v.u),t.Y36(P.K),t.Y36(a.HT),t.Y36(l.uU),t.Y36(A.r),t.Y36(a.yF),t.Y36(C.n),t.Y36(t.sBO),t.Y36(Z.i))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-edit-purchase-return"]],viewQuery:function(e,n){if(1&e&&(t.Gf(b,5),t.Gf(x,5),t.Gf(T,5),t.Gf(M,5),t.Gf(I,5),t.Gf(O,5)),2&e){let i;t.iGM(i=t.CRH())&&(n.nameField=i.first),t.iGM(i=t.CRH())&&(n.dstPop=i.first),t.iGM(i=t.CRH())&&(n.qtyId=i.first),t.iGM(i=t.CRH())&&(n.popInput=i.first),t.iGM(i=t.CRH())&&(n.popover=i.first),t.iGM(i=t.CRH())&&(n.popoverNotif=i.first)}},decls:21,vars:7,consts:[[1,"container"],[1,"section-header"],["fill","clear",3,"click"],["name","arrow-back"],[1,"section"],[1,"edit-notice"],["name","create-outline","color","primary"],["class","section",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"section-title"],[1,"invoice-info-readonly"],[1,"info-row"],[1,"table-container"],[1,"items-table"],[4,"ngFor","ngForOf"],["fill","clear","color","danger",3,"click"],["name","trash"],["position","stacked"],[3,"ngModel","ngModelChange","ionSelectionChange"],["value","percentage"],["value","amount"],[4,"ngIf"],["type","number","placeholder","\u0623\u062f\u062e\u0644 \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639",3,"ngModel","ngModelChange","ionInput"],["rows","3","placeholder","\u0623\u062f\u062e\u0644 \u0633\u0628\u0628 \u0625\u0631\u062c\u0627\u0639 \u0627\u0644\u0623\u0635\u0646\u0627\u0641",3,"ngModel","ngModelChange"],["type","date","placeholder","\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0631\u062c\u0627\u0639",3,"ngModel","ngModelChange"],["type","number","placeholder","\u0623\u062f\u062e\u0644 \u0646\u0633\u0628\u0629 \u0627\u0644\u062e\u0635\u0645",3,"ngModel","ngModelChange","ionInput"],["type","number","placeholder","\u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a \u0627\u0644\u062e\u0635\u0645",3,"ngModel","ngModelChange","ionInput"],[1,"summary-grid"],[1,"summary-row"],["class","summary-row",4,"ngIf"],[1,"summary-row","total-row"],[1,"action-buttons"],["expand","block","color","success",3,"disabled","click"],["name","save","slot","start"],["expand","block","color","danger","fill","outline",3,"disabled","click"],["name","trash","slot","start"],[1,"loading-overlay"],["name","bubbles"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content"),t.TgZ(1,"ion-card"),t.TgZ(2,"div",0),t.TgZ(3,"div",1),t.TgZ(4,"ion-title"),t._uU(5,"\u062a\u0639\u062f\u064a\u0644 \u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0631\u062a\u062c\u0639\u0627\u062a \u0627\u0644\u0634\u0631\u0627\u0621"),t.qZA(),t.TgZ(6,"ion-button",2),t.NdJ("click",function(){return n.back()}),t._UZ(7,"ion-icon",3),t.qZA(),t.qZA(),t.TgZ(8,"div",4),t.TgZ(9,"ion-card"),t.TgZ(10,"ion-card-content"),t.TgZ(11,"div",5),t._UZ(12,"ion-icon",6),t.TgZ(13,"span"),t._uU(14),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(15,E,17,2,"div",7),t.YNc(16,q,22,3,"div",7),t.YNc(17,L,28,7,"div",7),t.YNc(18,F,29,12,"div",7),t.YNc(19,N,8,2,"div",7),t.qZA(),t.qZA(),t.YNc(20,B,4,1,"div",8),t.qZA()),2&e&&(t.xp6(14),t.hij("\u0648\u0636\u0639 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 - \u0631\u0642\u0645 \u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0629: ",n.returnInvo.return_ref,""),t.xp6(1),t.Q6J("ngIf",n.selectedOriginalInvoice),t.xp6(1),t.Q6J("ngIf",n.itemList.length>0),t.xp6(1),t.Q6J("ngIf",n.itemList.length>0),t.xp6(1),t.Q6J("ngIf",n.itemList.length>0),t.xp6(1),t.Q6J("ngIf",n.itemList.length>0),t.xp6(1),t.Q6J("ngIf",n.isLoading()))},directives:[a.W2,a.PM,a.wd,a.YG,a.gu,a.FN,l.O5,a.Zi,a.Dq,l.sg,a.Ie,a.Q$,a.t9,a.QI,h.JJ,h.On,a.n0,a.pK,a.as,a.g2,a.j9,a.PQ],styles:[".container[_ngcontent-%COMP%]{padding:10px;max-width:1200px;margin:0 auto}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:10px 15px;background:var(--ion-color-primary);border-radius:8px;color:#fff}.section-header[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{margin:0;padding:0;font-size:1.2rem;font-weight:600}.section-header[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--color: white;--background: transparent;--border-radius: 50%;--padding: 8px}.section[_ngcontent-%COMP%]{margin-bottom:20px}.section-title[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:1.1rem;font-weight:600;margin:0;padding:0}.edit-notice[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px;background-color:var(--ion-color-primary-tint);border-radius:8px;font-weight:600;color:var(--ion-color-primary)}.edit-notice[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.invoice-info-readonly[_ngcontent-%COMP%]{display:grid;grid-gap:10px;gap:10px}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--ion-color-light)}.info-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-medium);min-width:150px}.info-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-dark)}.table-container[_ngcontent-%COMP%]{overflow-x:auto;margin-top:15px}.items-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem}.items-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .items-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px;text-align:center;border-bottom:1px solid var(--ion-color-light)}.items-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--ion-color-light);font-weight:600;color:var(--ion-color-dark);position:sticky;top:0;z-index:10}.items-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s ease}.items-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--ion-color-light)}.items-table[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding: 6px;font-size:.8rem}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-gap:12px;gap:12px}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 0}.summary-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-dark)}.summary-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-primary)}.summary-row[_ngcontent-%COMP%]   span.negative[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.summary-row.total-row[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-primary);border-bottom:2px solid var(--ion-color-primary);padding:12px 0}.summary-row.total-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .summary-row.total-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700}.summary-row.total-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--ion-color-success)}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-top:20px}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding: 12px;font-weight:600}@media (min-width: 768px){.action-buttons[_ngcontent-%COMP%]{flex-direction:row;max-width:500px;margin:20px auto 0}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1}}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#00000080;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.loading-overlay[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:50px;height:50px;--color: var(--ion-color-primary)}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:15px;color:#fff;font-size:1rem;text-align:center}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:5px}.items-table[_ngcontent-%COMP%]{font-size:.8rem}.items-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .items-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 4px}.summary-row[_ngcontent-%COMP%]{font-size:.9rem}.section-header[_ngcontent-%COMP%]{padding:8px 12px}.section-header[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.1rem}.info-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.info-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{min-width:auto;margin-bottom:4px}}ion-item.item-has-error[_ngcontent-%COMP%]{--border-color: var(--ion-color-danger);--highlight-color-focused: var(--ion-color-danger)}ion-item.item-has-success[_ngcontent-%COMP%]{--border-color: var(--ion-color-success);--highlight-color-focused: var(--ion-color-success)}ion-card[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 2px 8px #0000001a;margin-bottom:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding-bottom:10px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:0}ion-input.ion-focused[_ngcontent-%COMP%], ion-textarea.ion-focused[_ngcontent-%COMP%], ion-select.ion-focused[_ngcontent-%COMP%]{--highlight-color: var(--ion-color-primary)}ion-button[_ngcontent-%COMP%]:not(.button-disabled):hover{opacity:.9;transform:translateY(-1px);transition:all .2s ease}@media (prefers-color-scheme: dark){.items-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--ion-color-dark);color:var(--ion-color-light)}.loading-overlay[_ngcontent-%COMP%]{background-color:#ffffff1a}.edit-notice[_ngcontent-%COMP%]{background-color:var(--ion-color-primary-shade);color:var(--ion-color-primary-tint)}}"]}),r})()}];let J=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[g.Bz.forChild(k)],g.Bz]}),r})();var Q=s(62279);let Y=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[l.ez,h.u5,a.Pc,J,Q.m]]}),r})()},62279:(y,_,s)=>{s.d(_,{m:()=>p});var l=s(69808),h=s(34182),a=s(23349),g=s(32090),u=s(29863);let p=(()=>{class t{}return t.\u0275fac=function(v){return new(v||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[l.uU],imports:[[l.ez,h.u5,h.UX,a.Pc,g.Fw]]}),t})()},32724:(y,_,s)=>{s.d(_,{n:()=>g});var l=s(591),h=s(5529),a=s(29863);let g=(()=>{class u{constructor(){this.newAccountSubject=new l.X(null),this.newAccount$=this.newAccountSubject.asObservable(),this.customerSelectedSubject=new h.xQ,this.customerSelected$=this.customerSelectedSubject.asObservable()}setNewAccount(t){console.log("AccountCommunicationService: Setting new account:",t),this.newAccountSubject.next(t),t&&t.id&&this.customerSelectedSubject.next({id:t.id,account:t})}setCustomerSelected(t,m){console.log("AccountCommunicationService: Customer selected with ID:",t),this.customerSelectedSubject.next({id:t,account:m})}clearNewAccount(){this.newAccountSubject.next(null)}getCurrentAccount(){return this.newAccountSubject.value}}return u.\u0275fac=function(t){return new(t||u)},u.\u0275prov=a.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);