{"version":3,"file":"src_app_balance-sheet2_balance-sheet2_module_ts.js","mappings":"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","sources":["./src/app/balance-sheet2/balance-sheet2-routing.module.ts","./src/app/balance-sheet2/balance-sheet2.module.ts","./src/app/balance-sheet2/balance-sheet2.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { BalanceSheet2Page } from './balance-sheet2.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: BalanceSheet2Page\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class BalanceSheet2PageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { BalanceSheet2PageRoutingModule } from './balance-sheet2-routing.module';\n\nimport { BalanceSheet2Page } from './balance-sheet2.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    BalanceSheet2PageRoutingModule\n  ],\n  declarations: [BalanceSheet2Page]\n})\nexport class BalanceSheet2PageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ServicesService } from \"../stockService/services.service\";\nimport { AlertController, LoadingController, ModalController, Platform, ToastController } from '@ionic/angular';\nimport { DatePipe } from '@angular/common'; \nimport { Storage } from '@ionic/storage';\nimport { NavigationExtras, Router } from '@angular/router';\n\n@Component({\n  selector: 'app-balance-sheet2',\n  templateUrl: './balance-sheet2.page.html',\n  styleUrls: ['./balance-sheet2.page.scss'], \n})\nexport class BalanceSheet2Page implements OnInit {\n  \n  // Core data\n  accounts: Array<any> = [];\n  filteredAccounts: Array<any> = [];\n  \n  // App info\n  store_info: {id: any, location: any, store_name: any, store_ref: any} | null = null;\n  user_info: {id: any, user_name: any, store_id: any, full_name: any, password: any} | null = null;\n  year: {id: any, yearDesc: any, yearStart: any, yearEnd: any} | null = null;\n  \n  // Filter and UI state\n  segmentValue: string = 'all';\n  showOnlyWithBalance: boolean = false;\n  loading: boolean = false;\n  showEmpty: boolean = false;\n  device: string = '';\n  \n  // Summary totals\n  summary: {\n    total_accounts: number;\n    grand_debit_total: number;\n    grand_credit_total: number;\n    difference: number;\n  } = {\n    total_accounts: 0,\n    grand_debit_total: 0,\n    grand_credit_total: 0,\n    difference: 0\n  };\n\n  constructor(\n    private platform: Platform,\n    private alertController: AlertController,\n    private router: Router,\n    private storage: Storage,\n    private modalController: ModalController,\n    private loadingController: LoadingController,\n    private datePipe: DatePipe,\n    private api: ServicesService,\n    private toast: ToastController\n  ) { \n    this.checkPlatform();\n    this.getAppInfo();\n  }\n\n  ngOnInit() {\n    // Component initialization\n  }\n\n  ionViewDidEnter() {\n    this.getAppInfo();\n  }\n\n  checkPlatform() {\n    if (this.platform.is('desktop')) { \n      this.device = 'desktop';\n    } else if (this.platform.is('mobile')) {\n      this.device = 'mobile';\n    }\n  }\n\n  getAppInfo() { \n    this.storage.get('USER_INFO').then((response) => {\n      if (response) {\n        this.user_info = response;\n      }\n    });\n\n    this.storage.get('year').then((response) => {\n      if (response) {\n        this.year = response;\n      } \n    });\n\n    this.storage.get('STORE_INFO').then((response) => {\n      if (response) {\n        this.store_info = response;\n        this.loadBalanceSheet();\n      }\n    });\n  }\n\n  loadBalanceSheet() {\n    if (!this.store_info?.id || !this.year?.id) return;\n    \n    this.loading = true;\n    this.showEmpty = false;\n    \n    this.api.getComprehensiveBalanceSheet(this.store_info.id, this.year.id).subscribe(\n      (data: any) => {\n        this.loading = false;\n        \n        if (data && data.accounts) {\n          this.accounts = data.accounts;\n          this.summary = data.summary;\n          this.applyFilters();\n        } else {\n          this.showEmpty = true;\n          this.accounts = [];\n        }\n      },\n      (error) => {\n        console.error('Error loading balance sheet:', error);\n        this.loading = false;\n        this.showEmpty = true;\n        this.presentToast('خطأ في تحميل ميزان المراجعة', 'danger');\n      }\n    );\n  }\n\n  segmentChanged(event: any) {\n    this.segmentValue = event.detail.value;\n    this.applyFilters();\n  }\n\n  balanceFilterChanged() {\n    this.applyFilters();\n  }\n\n  applyFilters() {\n    let filtered = [...this.accounts];\n    \n    // Apply category filter\n    if (this.segmentValue !== 'all') {\n      switch (this.segmentValue) {\n        case 'customer':\n          filtered = filtered.filter(acc => acc.cat_id == 1);\n          break;\n        case 'supplier':\n          filtered = filtered.filter(acc => acc.cat_id == 2);\n          break;\n        case 'sales':\n          filtered = filtered.filter(acc => acc.ac_id == 8);\n          break;\n        case 'purchases':\n          filtered = filtered.filter(acc => acc.ac_id == 9);\n          break;\n        case 'other':\n          filtered = filtered.filter(acc => ![1, 2, 8, 9].includes(acc.ac_id));\n          break;\n      }\n    }\n    \n    // Apply balance filter\n    if (this.showOnlyWithBalance) {\n      filtered = filtered.filter(acc => \n        acc.display_debit > 0 || acc.display_credit > 0\n      );\n    }\n    \n    this.filteredAccounts = filtered;\n    this.calculateFilteredTotals();\n  }\n\n  calculateFilteredTotals() {\n    this.summary = {\n      total_accounts: this.filteredAccounts.length,\n      grand_debit_total: this.filteredAccounts.reduce((sum, acc) => sum + acc.display_debit, 0),\n      grand_credit_total: this.filteredAccounts.reduce((sum, acc) => sum + acc.display_credit, 0),\n      difference: 0\n    };\n    this.summary.difference = this.summary.grand_debit_total - this.summary.grand_credit_total;\n  }\n\n  // Format balance display with English numbers\n  formatBalance(balance: number): string {\n    if (!balance && balance !== 0) return '0.00';\n    return new Intl.NumberFormat('en-US', {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2\n    }).format(Math.abs(balance));\n  }\n\n  // Get account type display\n  getAccountTypeDisplay(account: any): string {\n    if (account.ac_id == 1) return 'عميل';\n    if (account.ac_id == 2) return 'مورد';\n    if (account.ac_id == 8) return 'مبيعات';\n    if (account.ac_id == 9) return 'مشتريات';\n    return account.sub_type;\n  }\n\n  // Get balance status display\n  getBalanceStatusDisplay(account: any): string {\n    if (account.balance_status === 'debit') return 'مدين';\n    if (account.balance_status === 'credit') return 'دائن';\n    return 'متوازن';\n  }\n\n  // Get absolute value (helper for template)\n  getAbsoluteValue(value: number): number {\n    if (!value && value !== 0) return 0;\n    return Math.abs(value);\n  }\n\n  // Refresh data\n  refresh() {\n    this.loadBalanceSheet();\n  }\n\n  async presentToast(message: string, color: string = 'primary') {\n    const toast = await this.toast.create({\n      message: message,\n      duration: 2000,\n      color: color,\n      cssClass: 'cust_Toast',\n      mode: 'ios',\n      position: 'top'\n    });\n    await toast.present();\n  }\n}"],"names":[],"sourceRoot":"webpack:///"}