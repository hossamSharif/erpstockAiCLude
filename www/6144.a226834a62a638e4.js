"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6144,3821],{90733:(J,Y,d)=>{d.d(Y,{a:()=>j});var p=d(29863),u=d(23349);let j=(()=>{class k{constructor(){this.hasData=!1,this.isLoading=!1,this.disabled=!1,this.exportPDF=new p.vpe,this.exportExcel=new p.vpe}onExportPDF(){this.hasData&&!this.isLoading&&!this.disabled&&this.exportPDF.emit()}onExportExcel(){this.hasData&&!this.isLoading&&!this.disabled&&this.exportExcel.emit()}}return k.\u0275fac=function(R){return new(R||k)},k.\u0275cmp=p.Xpm({type:k,selectors:[["app-export-buttons"]],inputs:{hasData:"hasData",isLoading:"isLoading",disabled:"disabled"},outputs:{exportPDF:"exportPDF",exportExcel:"exportExcel"},decls:9,vars:2,consts:[[1,"export-buttons"],["fill","outline","color","danger","size","small",1,"export-btn",3,"disabled","click"],["name","document-text-outline","slot","start"],[1,"export-text"],["fill","outline","color","success","size","small",1,"export-btn",3,"disabled","click"],["name","grid-outline","slot","start"]],template:function(R,L){1&R&&(p.TgZ(0,"div",0),p.TgZ(1,"ion-button",1),p.NdJ("click",function(){return L.onExportPDF()}),p._UZ(2,"ion-icon",2),p.TgZ(3,"span",3),p._uU(4,"PDF"),p.qZA(),p.qZA(),p.TgZ(5,"ion-button",4),p.NdJ("click",function(){return L.onExportExcel()}),p._UZ(6,"ion-icon",5),p.TgZ(7,"span",3),p._uU(8,"Excel"),p.qZA(),p.qZA(),p.qZA()),2&R&&(p.xp6(1),p.Q6J("disabled",!L.hasData||L.isLoading||L.disabled),p.xp6(4),p.Q6J("disabled",!L.hasData||L.isLoading||L.disabled))},directives:[u.YG,u.gu],styles:[".export-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.export-btn[_ngcontent-%COMP%]{--border-width: 1px;--border-radius: 6px;--padding-start: 12px;--padding-end: 12px;height:32px;font-size:12px}.export-btn[disabled][_ngcontent-%COMP%]{opacity:.4;pointer-events:none}.export-text[_ngcontent-%COMP%]{margin-left:4px;font-weight:500}@media (max-width: 768px){.export-buttons[_ngcontent-%COMP%]{gap:6px}.export-btn[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;height:28px;font-size:11px}.export-text[_ngcontent-%COMP%]{display:none}}"]}),k})()},12317:(J,Y,d)=>{d.d(Y,{d:()=>o});var p=d(42654),u=d(29863),j=d(6612),k=d(69808),X=d(23349);const R=["selectTrigger"];function L(t,i){if(1&t&&(u.TgZ(0,"div",5),u.TgZ(1,"span",6),u._uU(2),u.qZA(),u.qZA()),2&t){const r=u.oxw();let n;u.xp6(2),u.Oqu(null==(n=r.getSelectedCurrency())?null:n.currency_symbol)}}function e(t,i){1&t&&(u.TgZ(0,"div",7),u._UZ(1,"ion-icon",8),u.TgZ(2,"span"),u._uU(3,"\u0627\u062e\u062a\u0631 \u0627\u0644\u0639\u0645\u0644\u0629"),u.qZA(),u.qZA())}let o=(()=>{class t{constructor(r,n,s){this.currencyService=r,this.renderer=n,this.el=s,this.selectedCurrency="SDG",this.supportedCurrencies=[],this.isDropdownOpen=!1,this.subscription=new p.w,this.dropdownElement=null}ngOnInit(){this.loadSupportedCurrencies(),this.subscription.add(this.currencyService.getCurrentCurrency().subscribe(r=>{this.selectedCurrency=r},r=>{console.error("Error subscribing to currency changes:",r),this.selectedCurrency="SDG"}))}ngOnDestroy(){this.subscription.unsubscribe(),this.destroyDropdown()}loadSupportedCurrencies(){this.subscription.add(this.currencyService.getActiveCurrencies().subscribe(r=>{r&&r.data&&(this.supportedCurrencies=r.data)},r=>{console.error("Error loading currencies:",r),this.supportedCurrencies=[{currency_code:"SDG",currency_name_ar:"\u062c\u0646\u064a\u0647 \u0633\u0648\u062f\u0627\u0646\u064a",currency_symbol:"\u062c.\u0633"},{currency_code:"USD",currency_name_ar:"\u062f\u0648\u0644\u0627\u0631 \u0623\u0645\u0631\u064a\u0643\u064a",currency_symbol:"$"},{currency_code:"AED",currency_name_ar:"\u062f\u0631\u0647\u0645 \u0625\u0645\u0627\u0631\u0627\u062a\u064a",currency_symbol:"\u062f.\u0625"},{currency_code:"SAR",currency_name_ar:"\u0631\u064a\u0627\u0644 \u0633\u0639\u0648\u062f\u064a",currency_symbol:"\u0631.\u0633"}]}))}toggleDropdown(r){r.stopPropagation(),this.isDropdownOpen?this.closeDropdown():this.openDropdown()}openDropdown(){!this.selectTrigger||(this.isDropdownOpen=!0,this.createBodyLevelDropdown())}closeDropdown(){this.isDropdownOpen=!1,this.destroyDropdown()}createBodyLevelDropdown(){this.dropdownElement&&this.destroyDropdown();const n=this.selectTrigger.nativeElement.getBoundingClientRect();this.dropdownElement=this.renderer.createElement("div"),this.renderer.addClass(this.dropdownElement,"currency-dropdown-portal"),this.renderer.setStyle(this.dropdownElement,"position","fixed"),this.renderer.setStyle(this.dropdownElement,"z-index","10000"),this.renderer.setStyle(this.dropdownElement,"background","#ffffff"),this.renderer.setStyle(this.dropdownElement,"border","1px solid #e5e7eb"),this.renderer.setStyle(this.dropdownElement,"border-radius","12px"),this.renderer.setStyle(this.dropdownElement,"box-shadow","0 15px 35px rgba(0, 0, 0, 0.15)"),this.renderer.setStyle(this.dropdownElement,"max-height","300px"),this.renderer.setStyle(this.dropdownElement,"overflow-y","auto"),this.renderer.setStyle(this.dropdownElement,"min-width","200px"),this.positionDropdown(n),this.createCurrencyOptions(),this.renderer.appendChild(document.body,this.dropdownElement),setTimeout(()=>{this.dropdownElement&&(this.renderer.setStyle(this.dropdownElement,"opacity","1"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(0)"))},10)}positionDropdown(r){if(!this.dropdownElement)return;const n=window.innerHeight,c=n-r.bottom,l=r.top;this.renderer.setStyle(this.dropdownElement,"opacity","0"),this.renderer.setStyle(this.dropdownElement,"transform","translateY(-10px)"),this.renderer.setStyle(this.dropdownElement,"transition","all 0.3s ease"),this.renderer.setStyle(this.dropdownElement,"left",r.left+"px"),this.renderer.setStyle(this.dropdownElement,"width",Math.max(r.width,200)+"px"),c>=300||c>=l?this.renderer.setStyle(this.dropdownElement,"top",r.bottom+4+"px"):this.renderer.setStyle(this.dropdownElement,"bottom",n-r.top+4+"px")}createCurrencyOptions(){!this.dropdownElement||this.supportedCurrencies.forEach(r=>{const n=this.renderer.createElement("div");this.renderer.addClass(n,"currency-option-portal"),this.renderer.setStyle(n,"display","flex"),this.renderer.setStyle(n,"align-items","center"),this.renderer.setStyle(n,"gap","12px"),this.renderer.setStyle(n,"padding","12px 16px"),this.renderer.setStyle(n,"cursor","pointer"),this.renderer.setStyle(n,"transition","background-color 0.2s ease"),this.renderer.setStyle(n,"border-bottom","1px solid #f3f4f6"),r.currency_code===this.selectedCurrency&&this.renderer.setStyle(n,"background","linear-gradient(135deg, #eff6ff, #dbeafe)");const s=this.renderer.createElement("div");this.renderer.setStyle(s,"width","36px"),this.renderer.setStyle(s,"height","36px"),this.renderer.setStyle(s,"border-radius","50%"),this.renderer.setStyle(s,"display","flex"),this.renderer.setStyle(s,"align-items","center"),this.renderer.setStyle(s,"justify-content","center"),this.renderer.setStyle(s,"font-weight","bold"),this.renderer.setStyle(s,"font-size","13px"),r.currency_code===this.selectedCurrency?(this.renderer.setStyle(s,"background","var(--ion-color-primary, #3880ff)"),this.renderer.setStyle(s,"color","white")):(this.renderer.setStyle(s,"background","#f1f5f9"),this.renderer.setStyle(s,"color","#475569"));const c=this.renderer.createText(r.currency_symbol);this.renderer.appendChild(s,c);const l=this.renderer.createElement("div");this.renderer.setStyle(l,"flex","1"),this.renderer.setStyle(l,"text-align","right");const A=this.renderer.createElement("div");this.renderer.setStyle(A,"font-size","14px"),this.renderer.setStyle(A,"font-weight","500"),this.renderer.setStyle(A,"color",r.currency_code===this.selectedCurrency?"var(--ion-color-primary, #3880ff)":"#374151"),this.renderer.setStyle(A,"line-height","1.3");const a=this.renderer.createText(r.currency_name_ar);this.renderer.appendChild(A,a);const b=this.renderer.createElement("div");this.renderer.setStyle(b,"font-size","12px"),this.renderer.setStyle(b,"color","#6b7280"),this.renderer.setStyle(b,"font-weight","500");const E=this.renderer.createText(r.currency_code);if(this.renderer.appendChild(b,E),this.renderer.appendChild(l,A),this.renderer.appendChild(l,b),r.currency_code===this.selectedCurrency){const S=this.renderer.createElement("div");this.renderer.setStyle(S,"color","#10b981"),this.renderer.setStyle(S,"font-size","18px");const x=this.renderer.createText("\u2713");this.renderer.appendChild(S,x),this.renderer.appendChild(n,S)}this.renderer.listen(n,"mouseenter",()=>{r.currency_code!==this.selectedCurrency&&this.renderer.setStyle(n,"background","#f8fafc")}),this.renderer.listen(n,"mouseleave",()=>{r.currency_code!==this.selectedCurrency&&this.renderer.setStyle(n,"background","transparent")}),this.renderer.listen(n,"click",S=>{S.stopPropagation(),this.selectCurrency(r,S)}),this.renderer.appendChild(n,s),this.renderer.appendChild(n,l),this.renderer.appendChild(this.dropdownElement,n)})}destroyDropdown(){this.dropdownElement&&(this.renderer.removeChild(document.body,this.dropdownElement),this.dropdownElement=null)}selectCurrency(r,n){n.stopPropagation(),this.selectedCurrency=r.currency_code,this.currencyService.setCurrency(this.selectedCurrency),this.closeDropdown()}getSelectedCurrency(){return this.supportedCurrencies.find(r=>r.currency_code===this.selectedCurrency)}onDocumentClick(r){(!r.target||!r.target.closest(".custom-select-container"))&&this.closeDropdown()}onWindowResize(){if(this.isDropdownOpen&&this.selectTrigger){const r=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(r)}}onWindowScroll(){if(this.isDropdownOpen&&this.selectTrigger){const r=this.selectTrigger.nativeElement.getBoundingClientRect();this.positionDropdown(r)}}getCurrencyDisplayText(r){return`${r.currency_name_ar} (${r.currency_code})`}}return t.\u0275fac=function(r){return new(r||t)(u.Y36(j.i),u.Y36(u.Qsj),u.Y36(u.SBq))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-currency-switcher"]],viewQuery:function(r,n){if(1&r&&u.Gf(R,5),2&r){let s;u.iGM(s=u.CRH())&&(n.selectTrigger=s.first)}},hostBindings:function(r,n){1&r&&u.NdJ("click",function(c){return n.onDocumentClick(c)},!1,u.evT)("resize",function(){return n.onWindowResize()},!1,u.Jf7)("scroll",function(){return n.onWindowScroll()},!1,u.Jf7)},decls:6,vars:2,consts:[[1,"currency-switcher-wrapper"],[1,"currency-trigger",3,"click"],["selectTrigger",""],["class","selected-display",4,"ngIf","ngIfElse"],["placeholder",""],[1,"selected-display"],[1,"currency-symbol"],[1,"placeholder-display"],["name","cash-outline"]],template:function(r,n){if(1&r&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1,2),u.NdJ("click",function(c){return n.toggleDropdown(c)}),u.YNc(3,L,3,1,"div",3),u.YNc(4,e,4,0,"ng-template",null,4,u.W1O),u.qZA(),u.qZA()),2&r){const s=u.MAs(5);u.xp6(3),u.Q6J("ngIf",n.getSelectedCurrency())("ngIfElse",s)}},directives:[k.O5,X.gu],styles:[".currency-switcher-wrapper[_ngcontent-%COMP%]{display:inline-block;min-width:auto}.currency-trigger[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:8px;background:transparent;border:2px solid transparent;border-radius:8px;cursor:pointer;transition:all .3s ease;min-height:auto;width:-moz-fit-content;width:fit-content}.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary);background:rgba(var(--ion-color-primary-rgb),.05);box-shadow:0 2px 8px rgba(var(--ion-color-primary-rgb),.15)}.currency-trigger[_ngcontent-%COMP%]:active{transform:scale(.98)}.selected-display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;background:linear-gradient(135deg,var(--ion-color-primary),var(--ion-color-primary-shade));color:#fff;border-radius:50%;font-size:14px;font-weight:700;box-shadow:0 2px 6px rgba(var(--ion-color-primary-rgb),.25);transition:all .3s ease}.placeholder-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#9ca3af;font-size:14px;padding:8px}.placeholder-display[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.currency-trigger[_ngcontent-%COMP%]:hover   .selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{transform:scale(1.05);box-shadow:0 4px 12px rgba(var(--ion-color-primary-rgb),.35)}@media (max-width: 768px){.currency-trigger[_ngcontent-%COMP%]{padding:6px}.selected-display[_ngcontent-%COMP%]   .currency-symbol[_ngcontent-%COMP%]{width:32px;height:32px;font-size:13px}.placeholder-display[_ngcontent-%COMP%]{padding:6px}}@media (prefers-color-scheme: dark){.currency-trigger[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary-tint);background:rgba(var(--ion-color-primary-rgb),.1)}.placeholder-display[_ngcontent-%COMP%]{color:#9ca3af}}[dir=rtl][_ngcontent-%COMP%]   .placeholder-display[_ngcontent-%COMP%]{text-align:left}"]}),t})()},62279:(J,Y,d)=>{d.d(Y,{m:()=>R});var p=d(69808),u=d(34182),j=d(23349),k=d(32090),X=d(29863);let R=(()=>{class L{}return L.\u0275fac=function(o){return new(o||L)},L.\u0275mod=X.oAB({type:L}),L.\u0275inj=X.cJS({providers:[p.uU],imports:[[p.ez,u.u5,u.UX,j.Pc,k.Fw]]}),L})()},1212:(J,Y,d)=>{d.d(Y,{v:()=>j});var p=d(29863),u=d(6612);let j=(()=>{class k{constructor(R){this.currencyService=R}transform(R,L="SDG",e=!0){if(!R&&0!==R||isNaN(R))return"0.00";try{const o=this.currencyService.getCurrentCurrencyValue();let t=R;return L!==o&&(t=this.currencyService.convertToCurrentCurrency(R,L)),e?this.currencyService.formatCurrency(t,o):t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch(o){console.error("Currency display pipe error:",o);const t=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(R);return e?t+" \u062c.\u0633":t}}}return k.\u0275fac=function(R){return new(R||k)(p.Y36(u.i,16))},k.\u0275pipe=p.Yjl({name:"currencyDisplay",type:k,pure:!1}),k})()},79002:(J,Y,d)=>{d.d(Y,{T:()=>X});var p=d(70655),u=d(80574),j=d(23349),k=d(29863);let X=(()=>{class R{constructor(e){this.injector=e,this.MAX_ROWS_WARNING=1e3,this.MAX_ROWS_LIMIT=5e3}getToastController(){return this.toastController||(this.toastController=this.injector.get(j.yF)),this.toastController}getLoadingController(){return this.loadingController||(this.loadingController=this.injector.get(j.HT)),this.loadingController}getAlertController(){return this.alertController||(this.alertController=this.injector.get(j.Br)),this.alertController}formatDate(e,o="yyyy-MM-dd HH:mm"){const t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");return"yyyy-MM-dd HH:mm"===o?`${t}-${i}-${r} ${n}:${s}`:`${t}-${i}-${r}`}exportToPDF(e){return(0,p.mG)(this,void 0,void 0,function*(){if(!(yield this.checkDataSize(e.data.length)))return;const o=yield this.getLoadingController().create({message:"\u062c\u0627\u0631\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 PDF...",spinner:"crescent"});yield o.present();try{yield this.exportToPDFWithDirectArabicSupport(e),yield this.showSuccessToast("\u062a\u0645 \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 PDF \u0628\u0646\u062c\u0627\u062d \u0645\u0639 \u0627\u0644\u0646\u0635 \u0627\u0644\u0639\u0631\u0628\u064a \u0627\u0644\u0623\u0635\u0644\u064a")}catch(t){console.error("Direct Arabic PDF Export Error:",t),yield this.showErrorToast("\u0641\u0634\u0644 \u0641\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 PDF - \u064a\u0631\u062c\u0649 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649")}finally{yield o.dismiss()}})}exportToPDFWithDirectArabicSupport(e){return(0,p.mG)(this,void 0,void 0,function*(){try{console.log("\u{1f504} Starting direct Arabic-preserving PDF export...");const{PDFDocument:o,rgb:t,StandardFonts:i}=yield d.e(7479).then(d.bind(d,47479)),r=yield o.create();let n=r.addPage([842,595]);const{width:s,height:c}=n.getSize(),l=40,A=s-2*l;let a,b,E=!1;try{console.log("Attempting to load external Arabic font...");const U=yield fetch("https://fonts.gstatic.com/s/cairo/v28/SLXGc1nY6HkvalIkTp2mxdt0UX8gfO8_19co.woff2");if(!U.ok)throw new Error("External font loading failed");{const I=yield U.arrayBuffer();a=yield r.embedFont(I),b=a,E=!0,console.log("\u2705 Successfully loaded external Arabic font")}}catch(U){console.warn("External Arabic font failed, trying TimesRoman:",U);try{a=yield r.embedFont(i.TimesRoman),b=yield r.embedFont(i.TimesRomanBold),console.log("\u2705 Using TimesRoman font")}catch(I){a=yield r.embedFont(i.Helvetica),b=yield r.embedFont(i.HelveticaBold),console.log("\u26a0\ufe0f Using Helvetica font as final fallback")}}const S=20;let x=c-l-30;try{n.drawText(e.title,{x:(s-a.widthOfTextAtSize(e.title,S))/2,y:x,size:S,font:b,color:t(.2,.3,.5)}),console.log("\u2705 Title drawn with original Arabic text")}catch(U){console.warn("Title drawing failed, trying safer approach:",U),n.drawText("Stock Report",{x:(s-a.widthOfTextAtSize("Stock Report",S))/2,y:x,size:S,font:b,color:t(.2,.3,.5)})}if(x-=40,e.subtitle){try{n.drawText(e.subtitle,{x:(s-a.widthOfTextAtSize(e.subtitle,14))/2,y:x,size:14,font:a,color:t(.4,.4,.4)}),console.log("\u2705 Subtitle drawn with original Arabic text")}catch(U){console.warn("Subtitle drawing failed:",U)}x-=25}const f=e.currentDate||this.formatDate(new Date,"yyyy-MM-dd");n.drawText(f,{x:(s-a.widthOfTextAtSize(f,12))/2,y:x,size:12,font:a,color:t(.5,.5,.5)}),x-=40;const v=e.columns.length,O=A/v,B=25,C=30;n.drawRectangle({x:l,y:x-C,width:A,height:C,color:t(.2,.4,.7)});let h=l;e.columns.forEach((U,I)=>{const P=U.title;console.log(`\u{1f4dd} Drawing header: "${P}" (Font: ${E?"Arabic":"Standard"})`);let T=!1;if(!T)try{const y=this.safeCalculateTextWidth(a,P,11);n.drawText(P,{x:Math.max(h+5,h+O-y-10),y:x-18,size:11,font:b,color:t(1,1,1)}),T=!0,console.log(`\u2705 Header "${P}" rendered successfully`)}catch(y){console.warn(`Strategy 1 failed for "${P}":`,y)}if(!T&&E)try{const y=this.cleanArabicForRendering(P),F=this.safeCalculateTextWidth(a,y,11);n.drawText(y,{x:Math.max(h+5,h+O-F-10),y:x-18,size:11,font:b,color:t(1,1,1)}),T=!0,console.log(`\u2705 Header "${y}" rendered with cleaned text`)}catch(y){console.warn(`Strategy 2 failed for "${P}":`,y)}if(!T)try{n.drawText(P,{x:h+10,y:x-18,size:11,font:b,color:t(1,1,1)}),T=!0,console.log(`\u26a0\ufe0f Header "${P}" rendered with standard approach`)}catch(y){console.error(`All strategies failed for "${P}":`,y);try{n.drawText(P,{x:h+5,y:x-18,size:9,font:a,color:t(1,1,1)}),T=!0,console.log("\u26a0\ufe0f Header rendered with minimal approach")}catch(F){console.error(`Final attempt failed for "${P}":`,F)}}I<v-1&&n.drawLine({start:{x:h+O,y:x},end:{x:h+O,y:x-C},thickness:1,color:t(.8,.8,.8)}),h+=O}),x-=C;const M=Math.floor((x-l-50)/B);let g=0,$=1;for(let U=0;U<e.data.length;U++){const I=e.data[U];g>=M&&(yield this.drawSimpleFooter(n,e,$,Math.ceil(e.data.length/M),a,s,l),n=r.addPage([842,595]),x=c-l-40,g=0,$++,n.drawRectangle({x:l,y:x-C,width:A,height:C,color:t(.2,.4,.7)}),h=l,e.columns.forEach((P,D)=>{const T=P.title;let y=!1;if(!y)try{const F=this.safeCalculateTextWidth(a,T,11);n.drawText(T,{x:Math.max(h+5,h+O-F-10),y:x-18,size:11,font:b,color:t(1,1,1)}),y=!0}catch(F){}if(!y)try{const F=this.cleanArabicForRendering(T);n.drawText(F,{x:h+10,y:x-18,size:11,font:b,color:t(1,1,1)}),y=!0}catch(F){}if(!y)try{n.drawText(T,{x:h+5,y:x-18,size:10,font:a,color:t(1,1,1)}),y=!0}catch(F){}D<v-1&&n.drawLine({start:{x:h+O,y:x},end:{x:h+O,y:x-C},thickness:1,color:t(.8,.8,.8)}),h+=O}),x-=C),U%2==0&&n.drawRectangle({x:l,y:x-B,width:A,height:B,color:t(.95,.95,.95)}),h=l,e.columns.forEach((P,D)=>{const T=this.getCellValue(I,P,U+1).toString(),y=10,F=O-10;let w=T,W=this.safeCalculateTextWidth(a,w,y);for(;W>F&&w.length>1;)w=w.slice(0,-1),W=this.safeCalculateTextWidth(a,w+"...",y);w!==T&&w.length>0&&(w+="...",W=this.safeCalculateTextWidth(a,w,y));let z=!1;if(!z)try{n.drawText(w,{x:Math.max(h+5,h+O-W-5),y:x-15,size:y,font:a,color:t(0,0,0)}),z=!0}catch(m){console.warn(`Cell text strategy 1 failed for "${w}":`,m)}if(!z&&this.detectArabicText(w))try{const m=this.cleanArabicForRendering(w),N=this.safeCalculateTextWidth(a,m,y);n.drawText(m,{x:Math.max(h+5,h+O-N-5),y:x-15,size:y,font:a,color:t(0,0,0)}),z=!0}catch(m){console.warn(`Cell text strategy 2 failed for "${w}":`,m)}if(!z)try{n.drawText(w,{x:h+5,y:x-15,size:y,font:a,color:t(0,0,0)}),z=!0}catch(m){console.warn(`Cell text strategy 3 failed for "${w}":`,m)}n.drawRectangle({x:h,y:x-B,width:O,height:B,borderColor:t(.8,.8,.8),borderWidth:.5}),h+=O}),x-=B,g++}const Z=Math.ceil(e.data.length/M)||1;yield this.drawSimpleFooter(n,e,$,Z,a,s,l);const H=yield r.save(),G=new Blob([H],{type:"application/pdf"}),V=URL.createObjectURL(G),K=document.createElement("a");K.href=V,K.download=`${e.fileName}.pdf`,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(V),console.log("\u2705 PDF exported successfully with PRESERVED Arabic text!")}catch(o){throw console.error("\u274c Direct Arabic PDF export failed:",o),o}})}drawSimpleFooter(e,o,t,i,r,n,s){return(0,p.mG)(this,void 0,void 0,function*(){try{const{rgb:c}=yield d.e(7479).then(d.bind(d,47479)),l=s;try{e.drawText(`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`,{x:s,y:l,size:8,font:r,color:c(.4,.4,.4)})}catch(S){e.drawText(`User: ${o.userName}`,{x:s,y:l,size:8,font:r,color:c(.4,.4,.4)})}const A=`Page ${t} of ${i}`,a=r.widthOfTextAtSize(A,8);e.drawText(A,{x:(n-a)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const b=this.formatDate(new Date,"yyyy-MM-dd HH:mm"),E=r.widthOfTextAtSize(b,8);e.drawText(b,{x:n-s-E,y:l,size:8,font:r,color:c(.4,.4,.4)})}catch(c){console.warn("Footer drawing failed:",c)}})}safeCalculateTextWidth(e,o,t){try{return e.widthOfTextAtSize(o,t)}catch(i){return o.length*t*.6}}cleanArabicForRendering(e){return e&&e.replace(/[\u064B-\u0652]/g,"").replace(/[\u0653-\u0655]/g,"").replace(/[\u0670\u0640]/g,"").replace(/\u200C/g,"").replace(/\u200D/g,"").normalize("NFKC").trim()}detectArabicText(e){return!!e&&/[\u0600-\u06FF]/.test(e)}processTextForPDF(e){return this.detectArabicText(e)?{text:e,alignment:"right"}:{text:e,alignment:"left"}}exportToPDFWithModernLib(e){return(0,p.mG)(this,void 0,void 0,function*(){try{console.log("Using modern pdf-lib with native Arabic text support...");const{PDFDocument:o,rgb:t}=yield d.e(7479).then(d.bind(d,47479)),i=yield o.create();let r=i.addPage([842,595]);const{width:n,height:s}=r.getSize(),c=40,l=n-2*c;let a,b,E=!1;try{const T=yield this.loadArabicFont();a=yield i.embedFont(T),b=a,E=!0,console.log("\u2705 Arabic-compatible font embedded successfully")}catch(T){console.warn("\u274c Arabic font embedding failed, trying advanced built-in fonts:",T);try{const{StandardFonts:y}=yield d.e(7479).then(d.bind(d,47479));a=yield i.embedFont(y.TimesRoman),b=yield i.embedFont(y.TimesRomanBold),E=!0,console.log("\u26a0\ufe0f Using TimesRoman font with Unicode support")}catch(y){console.warn("\u274c TimesRoman failed, trying Helvetica");try{const{StandardFonts:F}=yield d.e(7479).then(d.bind(d,47479));a=yield i.embedFont(F.Helvetica),b=yield i.embedFont(F.HelveticaBold),E=!0,console.log("\u26a0\ufe0f Using Helvetica font - attempting Arabic support")}catch(F){console.warn("\u274c All font strategies failed, using enhanced Arabic text processing");const{StandardFonts:w}=yield d.e(7479).then(d.bind(d,47479));a=yield i.embedFont(w.Courier),b=a,E=!0,console.log("\u26a0\ufe0f Using Courier font with enhanced Arabic text processing")}}}const S=20,x=e.title,f=this.safeGetTextWidth(a,x,S);this.safeDrawText(r,x,{x:(n-f)/2,y:s-c-30,size:S,font:b,color:t(.2,.3,.5)});let v=s-c-60;if(e.subtitle){const T=e.subtitle,y=this.safeGetTextWidth(a,T,14);this.safeDrawText(r,T,{x:(n-y)/2,y:v,size:14,font:a,color:t(.4,.4,.4)}),v-=25}const O=e.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),B=this.safeGetTextWidth(a,O,12);this.safeDrawText(r,O,{x:(n-B)/2,y:v,size:12,font:a,color:t(.5,.5,.5)}),v-=40;const C=e.columns.length,h=l/C,M=25,g=30;r.drawRectangle({x:c,y:v-g,width:l,height:g,color:t(.2,.4,.7)});let $=c;e.columns.forEach((T,y)=>{const F=T.title,W=this.safeGetTextWidth(a,F,11);this.safeDrawText(r,F,{x:Math.max($+5,$+h-10-W),y:v-18,size:11,font:b,color:t(1,1,1)}),y<C-1&&r.drawLine({start:{x:$+h,y:v},end:{x:$+h,y:v-g},thickness:1,color:t(.8,.8,.8)}),$+=h}),v-=g;const H=Math.floor((v-c-50)/M);let G=0,V=1;for(let T=0;T<e.data.length;T++){const y=e.data[T];if(G>=H){yield this.addModernPDFFooter(r,e,V,Math.ceil(e.data.length/H),a,n,c);const F=i.addPage([842,595]);r=F,v=s-c-40,G=0,V++,F.drawRectangle({x:c,y:v-g,width:l,height:g,color:t(.2,.4,.7)}),$=c,e.columns.forEach((w,W)=>{const z=w.title,N=this.safeGetTextWidth(a,z,11);this.safeDrawText(r,z,{x:Math.max($+5,$+h-10-N),y:v-18,size:11,font:b,color:t(1,1,1)}),W<C-1&&F.drawLine({start:{x:$+h,y:v},end:{x:$+h,y:v-g},thickness:1,color:t(.8,.8,.8)}),$+=h}),v-=g}T%2==0&&r.drawRectangle({x:c,y:v-M,width:l,height:M,color:t(.95,.95,.95)}),$=c,e.columns.forEach((F,w)=>{const z=this.getCellValue(y,F,T+1).toString();let N=z;const _=h-10;let Q=this.safeGetTextWidth(a,N,10);for(;Q>_&&N.length>1;)N=N.slice(0,-1),Q=this.safeGetTextWidth(a,N+"...",10);N!==z&&(N+="..."),Q=this.safeGetTextWidth(a,N,10),this.safeDrawText(r,N,{x:Math.max($+5,$+h-5-Q),y:v-15,size:10,font:a,color:t(0,0,0)}),r.drawRectangle({x:$,y:v-M,width:h,height:M,borderColor:t(.8,.8,.8),borderWidth:.5}),$+=h}),v-=M,G++}const K=Math.ceil(e.data.length/H)||1;this.addModernPDFFooter(r,e,V,K,a,n,c);const U=yield i.save(),I=new Blob([U],{type:"application/pdf"}),P=URL.createObjectURL(I),D=document.createElement("a");D.href=P,D.download=`${e.fileName}.pdf`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(P),console.log("PDF exported successfully with pdf-lib!")}catch(o){throw console.error("Modern PDF Export Error:",o),o}})}exportToPDFWithAlternativeMethod(e){return(0,p.mG)(this,void 0,void 0,function*(){try{console.log("Using alternative PDF export method with enhanced Arabic support...");const{PDFDocument:o,rgb:t,StandardFonts:i}=yield d.e(7479).then(d.bind(d,47479)),r=yield o.create();let n=r.addPage([842,595]);const{width:s,height:c}=n.getSize(),l=40,A=s-2*l,a=yield r.embedFont(i.Helvetica),b=yield r.embedFont(i.HelveticaBold);console.log("\u2705 Using Helvetica with enhanced Arabic text processing");const E=20,S=this.enhancedArabicTextProcessing(e.title),x=this.safeGetTextWidth(a,S,E);this.safeDrawText(n,S,{x:(s-x)/2,y:c-l-30,size:E,font:b,color:t(.2,.3,.5)});let f=c-l-60;if(e.subtitle){const D=this.enhancedArabicTextProcessing(e.subtitle),T=this.safeGetTextWidth(a,D,14);this.safeDrawText(n,D,{x:(s-T)/2,y:f,size:14,font:a,color:t(.4,.4,.4)}),f-=25}const v=e.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),O=this.safeGetTextWidth(a,v,12);this.safeDrawText(n,v,{x:(s-O)/2,y:f,size:12,font:a,color:t(.5,.5,.5)}),f-=40;const B=e.columns.length,C=A/B,h=25,M=30;n.drawRectangle({x:l,y:f-M,width:A,height:M,color:t(.2,.4,.7)});let g=l;e.columns.forEach((D,T)=>{const y=this.enhancedArabicTextProcessing(D.title),w=this.safeGetTextWidth(a,y,11);this.safeDrawText(n,y,{x:Math.max(g+5,g+C-10-w),y:f-18,size:11,font:b,color:t(1,1,1)}),T<B-1&&n.drawLine({start:{x:g+C,y:f},end:{x:g+C,y:f-M},thickness:1,color:t(.8,.8,.8)}),g+=C}),f-=M;const Z=Math.floor((f-l-50)/h);let H=0,G=1;for(let D=0;D<e.data.length;D++){const T=e.data[D];H>=Z&&(yield this.addEnhancedPDFFooter(n,e,G,Math.ceil(e.data.length/Z),a,s,l),n=r.addPage([842,595]),f=c-l-40,H=0,G++,n.drawRectangle({x:l,y:f-M,width:A,height:M,color:t(.2,.4,.7)}),g=l,e.columns.forEach((y,F)=>{const w=this.enhancedArabicTextProcessing(y.title),z=this.safeGetTextWidth(a,w,11);this.safeDrawText(n,w,{x:Math.max(g+5,g+C-10-z),y:f-18,size:11,font:b,color:t(1,1,1)}),F<B-1&&n.drawLine({start:{x:g+C,y:f},end:{x:g+C,y:f-M},thickness:1,color:t(.8,.8,.8)}),g+=C}),f-=M),D%2==0&&n.drawRectangle({x:l,y:f-h,width:A,height:h,color:t(.95,.95,.95)}),g=l,e.columns.forEach((y,F)=>{const w=this.getCellValue(T,y,D+1).toString(),W=this.enhancedArabicTextProcessing(w);let m=W;const N=C-10;let _=this.safeGetTextWidth(a,m,10);for(;_>N&&m.length>1;)m=m.slice(0,-1),_=this.safeGetTextWidth(a,m+"...",10);m!==W&&(m+="..."),_=this.safeGetTextWidth(a,m,10),this.safeDrawText(n,m,{x:Math.max(g+5,g+C-5-_),y:f-15,size:10,font:a,color:t(0,0,0)}),n.drawRectangle({x:g,y:f-h,width:C,height:h,borderColor:t(.8,.8,.8),borderWidth:.5}),g+=C}),f-=h,H++}const V=Math.ceil(e.data.length/Z)||1;yield this.addEnhancedPDFFooter(n,e,G,V,a,s,l);const K=yield r.save(),U=new Blob([K],{type:"application/pdf"}),I=URL.createObjectURL(U),P=document.createElement("a");P.href=I,P.download=`${e.fileName}.pdf`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(I),console.log("PDF exported successfully with enhanced Arabic method!")}catch(o){throw console.error("Alternative PDF Export Error:",o),o}})}generateHTMLTable(e){let n=`\n      <div style="direction: rtl; text-align: right;">\n        <div style="text-align: center; color: #1F4E79; font-size: 18px; font-weight: bold; margin: 10px 0;">${e.title}</div>\n        ${e.subtitle?`<div style="text-align: center; margin: 5px 0; color: #666;">${e.subtitle}</div>`:""}\n        <div style="text-align: center; margin: 5px 0; color: #888; font-size: 12px;">${e.currentDate||(new Date).toLocaleDateString("en-US")}</div>\n        \n        <table style="width: 100%; border-collapse: collapse; margin: 10px 0; font-family: Arial, "Noto Sans Arabic", serif;">\n          <thead>\n            <tr>\n              ${e.columns.map(s=>`<th style="background-color: #4472C4; color: white; padding: 8px; text-align: center; font-weight: bold;">${s.title}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n    `;return e.data.forEach((s,c)=>{const l=c%2==0?"#f8f9fa":"#ffffff";n+="<tr>",e.columns.forEach(A=>{const a=this.getCellValue(s,A,c+1);n+=`<td style="padding: 6px; border: 1px solid #ddd; text-align: center; background-color: ${l};">${a}</td>`}),n+="</tr>"}),n+=`\n          </tbody>\n        </table>\n        \n        <div style="margin-top: 20px; font-size: 10px; color: #666;">\n          <div>\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${e.userName}</div>\n          <div>\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${(new Date).toLocaleString("en-US")}</div>\n        </div>\n      </div>\n    `,n}enhancedArabicTextProcessing(e){if(!e)return"";try{let o=this.cleanArabicTextForPDF(e);return/[\u0600-\u06FF]/.test(o)?(o=o.normalize("NFKC").replace(/[\u200C\u200D]/g,"").replace(/\s+/g," ").trim(),console.log("\u2705 Preserved Arabic text with basic cleaning"),o):(console.log("\u26a0\ufe0f Arabic text lost during cleaning, using smart transliteration"),this.smartArabicTransliteration(e))}catch(o){return console.warn("Enhanced Arabic processing failed, using fallback:",o),this.smartArabicTransliteration(e)}}addEnhancedPDFFooter(e,o,t,i,r,n,s){return(0,p.mG)(this,void 0,void 0,function*(){const{rgb:c}=yield d.e(7479).then(d.bind(d,47479)),l=s,A=this.enhancedArabicTextProcessing(`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`);this.safeDrawText(e,A,{x:s,y:l,size:8,font:r,color:c(.4,.4,.4)});const a=this.enhancedArabicTextProcessing(`\u0635\u0641\u062d\u0629 ${t} \u0645\u0646 ${i}`),b=this.safeGetTextWidth(r,a,8);this.safeDrawText(e,a,{x:(n-b)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const E=this.enhancedArabicTextProcessing(`\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`),S=this.safeGetTextWidth(r,E,8);this.safeDrawText(e,E,{x:n-s-S,y:l,size:8,font:r,color:c(.4,.4,.4)})})}exportToPDFWithTextConversion(e){return(0,p.mG)(this,void 0,void 0,function*(){try{console.log("Using PDF export with Arabic text conversion...");const{PDFDocument:o,rgb:t,StandardFonts:i}=yield d.e(7479).then(d.bind(d,47479)),r=yield o.create();let n=r.addPage([842,595]);const{width:s,height:c}=n.getSize(),l=40,A=s-2*l,a=yield r.embedFont(i.Helvetica),b=yield r.embedFont(i.HelveticaBold),E=20,S=this.convertArabicToProfessionalEnglish(e.title),x=a.widthOfTextAtSize(S,E);n.drawText(S,{x:(s-x)/2,y:c-l-30,size:E,font:b,color:t(.2,.3,.5)});let f=c-l-60;if(e.subtitle){const D=this.convertArabicToProfessionalEnglish(e.subtitle),T=a.widthOfTextAtSize(D,14);n.drawText(D,{x:(s-T)/2,y:f,size:14,font:a,color:t(.4,.4,.4)}),f-=25}const v=e.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),O=a.widthOfTextAtSize(v,12);n.drawText(v,{x:(s-O)/2,y:f,size:12,font:a,color:t(.5,.5,.5)}),f-=40;const B=e.columns.length,C=A/B,h=25,M=30;n.drawRectangle({x:l,y:f-M,width:A,height:M,color:t(.2,.4,.7)});let g=l;e.columns.forEach((D,T)=>{const y=this.convertArabicToProfessionalEnglish(D.title),w=a.widthOfTextAtSize(y,11);n.drawText(y,{x:Math.max(g+5,g+(C-w)/2),y:f-18,size:11,font:b,color:t(1,1,1)}),T<B-1&&n.drawLine({start:{x:g+C,y:f},end:{x:g+C,y:f-M},thickness:1,color:t(.8,.8,.8)}),g+=C}),f-=M;const Z=Math.floor((f-l-50)/h);let H=0,G=1;for(let D=0;D<e.data.length;D++){const T=e.data[D];H>=Z&&(yield this.addConvertedPDFFooter(n,e,G,Math.ceil(e.data.length/Z),a,s,l),n=r.addPage([842,595]),f=c-l-40,H=0,G++,n.drawRectangle({x:l,y:f-M,width:A,height:M,color:t(.2,.4,.7)}),g=l,e.columns.forEach((y,F)=>{const w=this.convertArabicToProfessionalEnglish(y.title),z=a.widthOfTextAtSize(w,11);n.drawText(w,{x:Math.max(g+5,g+(C-z)/2),y:f-18,size:11,font:b,color:t(1,1,1)}),F<B-1&&n.drawLine({start:{x:g+C,y:f},end:{x:g+C,y:f-M},thickness:1,color:t(.8,.8,.8)}),g+=C}),f-=M),D%2==0&&n.drawRectangle({x:l,y:f-h,width:A,height:h,color:t(.95,.95,.95)}),g=l,e.columns.forEach((y,F)=>{const w=this.getCellValue(T,y,D+1).toString(),W=this.convertArabicToProfessionalEnglish(w);let m=W;const N=C-10;let _=a.widthOfTextAtSize(m,10);for(;_>N&&m.length>1;)m=m.slice(0,-1),_=a.widthOfTextAtSize(m+"...",10);m!==W&&(m+="..."),_=a.widthOfTextAtSize(m,10),n.drawText(m,{x:Math.max(g+5,g+(C-_)/2),y:f-15,size:10,font:a,color:t(0,0,0)}),n.drawRectangle({x:g,y:f-h,width:C,height:h,borderColor:t(.8,.8,.8),borderWidth:.5}),g+=C}),f-=h,H++}const V=Math.ceil(e.data.length/Z)||1;yield this.addConvertedPDFFooter(n,e,G,V,a,s,l);const K=yield r.save(),U=new Blob([K],{type:"application/pdf"}),I=URL.createObjectURL(U),P=document.createElement("a");P.href=I,P.download=`${e.fileName}.pdf`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(I),console.log("PDF exported successfully with text conversion!")}catch(o){throw console.error("Fallback PDF Export Error:",o),o}})}addConvertedPDFFooter(e,o,t,i,r,n,s){return(0,p.mG)(this,void 0,void 0,function*(){const{rgb:c}=yield d.e(7479).then(d.bind(d,47479)),l=s,A=this.convertArabicToProfessionalEnglish(`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`);e.drawText(A,{x:s,y:l,size:8,font:r,color:c(.4,.4,.4)});const a=`Page ${t} of ${i}`,b=r.widthOfTextAtSize(a,8);e.drawText(a,{x:(n-b)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const E=`Export Date: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`,S=r.widthOfTextAtSize(E,8);e.drawText(E,{x:n-s-S,y:l,size:8,font:r,color:c(.4,.4,.4)})})}addModernPDFFooter(e,o,t,i,r,n,s){return(0,p.mG)(this,void 0,void 0,function*(){const{rgb:c}=yield d.e(7479).then(d.bind(d,47479)),l=s;this.safeDrawText(e,`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${o.userName}`,{x:s,y:l,size:8,font:r,color:c(.4,.4,.4)});const a=`\u0635\u0641\u062d\u0629 ${t} \u0645\u0646 ${i}`,b=this.safeGetTextWidth(r,a,8);this.safeDrawText(e,a,{x:(n-b)/2,y:l,size:8,font:r,color:c(.4,.4,.4)});const E=`\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`,S=this.safeGetTextWidth(r,E,8);this.safeDrawText(e,E,{x:n-s-S,y:l,size:8,font:r,color:c(.4,.4,.4)})})}reverseArabicText(e){try{return this.segmentText(e).map(i=>i.isArabic?i.text.split("").reverse().join(""):i.text).join("")}catch(o){return console.warn("Arabic text processing failed:",o),e}}segmentText(e){const o=[];let t="",i=!1;for(let r=0;r<e.length;r++){const n=e[r],s=/[\u0600-\u06FF]/.test(n);0===r?(t=n,i=s):s===i?t+=n:(o.push({text:t,isArabic:i}),t=n,i=s)}return t&&o.push({text:t,isArabic:i}),o}exportToExcel(e){return(0,p.mG)(this,void 0,void 0,function*(){if(!(yield this.checkDataSize(e.data.length)))return;const o=yield this.getLoadingController().create({message:"\u062c\u0627\u0631\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 Excel...",spinner:"crescent"});yield o.present();try{const t=u.P6.book_new(),i=this.prepareExcelData(e),r=u.P6.aoa_to_sheet(i);this.applyModernExcelStyling(r,e);const n=e.columns.map(s=>({wch:s.width||15}));r["!cols"]=n,u.P6.book_append_sheet(t,r,"\u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a"),u.NC(t,`${e.fileName}.xlsx`),yield this.showSuccessToast("\u062a\u0645 \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 Excel \u0628\u0646\u062c\u0627\u062d")}catch(t){console.error("Excel Export Error:",t),yield this.showErrorToast("\u0641\u0634\u0644 \u0641\u064a \u062a\u0635\u062f\u064a\u0631 \u0645\u0644\u0641 Excel")}finally{yield o.dismiss()}})}checkDataSize(e){return(0,p.mG)(this,void 0,void 0,function*(){return 0===e?(yield this.showErrorToast("\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0644\u062a\u0635\u062f\u064a\u0631"),!1):e>this.MAX_ROWS_LIMIT?(yield this.showErrorToast(`\u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0643\u062b\u064a\u0631\u0629 \u062c\u062f\u0627\u064b (${e} \u0635\u0641). \u0627\u0644\u062d\u062f \u0627\u0644\u0623\u0642\u0635\u0649 \u0647\u0648 ${this.MAX_ROWS_LIMIT} \u0635\u0641`),!1):!(e>this.MAX_ROWS_WARNING)||(yield this.showConfirmationAlert("\u062a\u062d\u0630\u064a\u0631",`\u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0643\u062b\u064a\u0631\u0629 (${e} \u0635\u0641). \u0642\u062f \u064a\u0633\u062a\u063a\u0631\u0642 \u0627\u0644\u062a\u0635\u062f\u064a\u0631 \u0648\u0642\u062a\u0627\u064b \u0637\u0648\u064a\u0644\u0627\u064b. \u0647\u0644 \u062a\u0631\u064a\u062f \u0627\u0644\u0645\u062a\u0627\u0628\u0639\u0629\u061f`))})}processArabicText(e){if(!e)return"";try{return/[\u0600-\u06FF\u0750-\u077F]/.test(e)?this.convertArabicToProfessionalEnglish(e):e}catch(o){return console.warn("Arabic text processing failed:",o),e}}convertArabicToProfessionalEnglish(e){try{if(!e||!this.detectArabicText(e))return e;const o={"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u062e\u0632\u0648\u0646":"Inventory Report",\u062a\u0642\u0631\u064a\u0631:"Report","\u0627\u0644\u0645\u062e\u0632\u0648\u0646 \u0627\u0644\u0625\u0641\u062a\u062a\u0627\u062d\u064a":"Opening Stock","\u0627\u0644\u0645\u062e\u0632\u0648\u0646 (in stock)":"Stock Qty",\u0627\u0644\u0645\u062e\u0632\u0648\u0646:"Inventory",\u0627\u0644\u062a\u0633\u0644\u0633\u0644:"Serial No.","\u0645\u0639\u0631\u0641 \u0627\u0644\u0635\u0646\u0641":"Item ID","\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641 (English)":"Item Name (English)","\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641":"Item Name",\u0627\u0644\u0635\u0646\u0641:"Item","\u0627\u0633\u0645 \u0645\u0633\u062a\u0639\u0627\u0631 (Alias)":"Alias Name","\u0627\u0633\u0645 \u0645\u0633\u062a\u0639\u0627\u0631":"Alias","\u0627\u0644\u0645\u0648\u062f\u064a\u0644 (model)":"Model",\u0627\u0644\u0645\u0648\u062f\u064a\u0644:"Model","\u0627\u0644\u0643\u0648\u062f (part no)":"Part Number",\u0627\u0644\u0643\u0648\u062f:"Code","\u0631\u0642\u0645 \u0627\u0644\u0642\u0637\u0639\u0629":"Part Number","\u0627\u0644\u0645\u0627\u0631\u0643\u0629 (brand)":"Brand",\u0627\u0644\u0645\u0627\u0631\u0643\u0629:"Brand","\u0627\u0642\u0644 \u0643\u0645\u064a\u0629 (MSQ)":"Min. Stock Qty","\u0627\u0642\u0644 \u0643\u0645\u064a\u0629":"Min. Qty","\u0627\u0644\u062d\u062f \u0627\u0644\u0623\u062f\u0646\u0649":"Minimum","\u0627\u0644\u0648\u062d\u062f\u0647 (unit)":"Unit",\u0627\u0644\u0648\u062d\u062f\u0647:"Unit",\u0627\u0644\u0648\u062d\u062f\u0629:"Unit","\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621 (purch price)":"Purchase Price","\u0633\u0639\u0631 \u0627\u0644\u0634\u0631\u0627\u0621":"Purchase Price","\u0633\u0639\u0631 \u0627\u0644\u0648\u062d\u062f\u0647 (selling price)":"Selling Price","\u0633\u0639\u0631 \u0627\u0644\u0648\u062d\u062f\u0647":"Unit Price","\u0633\u0639\u0631 \u0627\u0644\u0628\u064a\u0639":"Selling Price","\u0646\u0633\u0628\u0629 \u0627\u0644\u0641\u0627\u0626\u062f\u0629 (profit perc)":"Profit %","\u0646\u0633\u0628\u0629 \u0627\u0644\u0641\u0627\u0626\u062f\u0629":"Profit %","\u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0644\u0645\u062a\u0627\u062d\u0629":"Available Qty",\u0627\u0644\u0643\u0645\u064a\u0629:"Quantity",\u0627\u0644\u0645\u062c\u0645\u0648\u0639:"Total","\u0627\u062e\u0631 \u0639\u0645\u0644\u064a\u0629 \u0628\u064a\u0639":"Last Sale Date",\u0627\u0644\u0625\u0641\u062a\u062a\u0627\u062d\u064a:"Opening",\u0627\u0644\u0625\u062c\u0631\u0627\u0621\u0627\u062a:"Actions",\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645:"User","\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Date",\u0635\u0641\u062d\u0629:"Page",\u0645\u0646:"of",\u0625\u0644\u0649:"to",\u0641\u064a:"on",\u0627\u0644\u062a\u0627\u0631\u064a\u062e:"Date",\u0627\u0644\u0648\u0642\u062a:"Time",\u0645\u062a\u0648\u0641\u0631:"Available","\u063a\u064a\u0631 \u0645\u062a\u0648\u0641\u0631":"Out of Stock",\u0646\u0634\u0637:"Active","\u063a\u064a\u0631 \u0646\u0634\u0637":"Inactive",\u062c\u062f\u064a\u062f:"New",\u0645\u0633\u062a\u0639\u0645\u0644:"Used",\u0642\u0637\u0639\u0629:"Piece",\u0642\u0637\u0639:"Pieces",\u0643\u064a\u0644\u0648:"Kg",\u062c\u0631\u0627\u0645:"Gram",\u0645\u062a\u0631:"Meter",\u0644\u062a\u0631:"Liter"};let t=e.trim();const i=Object.keys(o).sort((r,n)=>n.length-r.length);for(const r of i)t.includes(r)&&(t=t.replace(new RegExp(r,"g"),o[r]));return t===e&&(t=e.split(/\s+/).map(s=>{const c=s.trim();return o[c]||this.transliterateArabicWord(c)}).join(" ")),this.detectArabicText(t)&&(console.warn("Arabic characters still present after conversion, applying full transliteration"),t=this.safeArabicToEnglishTransliteration(t)),t}catch(o){return console.warn("Professional Arabic conversion failed:",o),this.transliterateArabicWord(e)}}transliterateArabicWord(e){const o={\u0627:"a",\u0623:"a",\u0625:"i",\u0622:"aa",\u0628:"b",\u062a:"t",\u062b:"th",\u062c:"j",\u062d:"h",\u062e:"kh",\u062f:"d",\u0630:"dh",\u0631:"r",\u0632:"z",\u0633:"s",\u0634:"sh",\u0635:"s",\u0636:"d",\u0637:"t",\u0638:"dh",\u0639:"a",\u063a:"gh",\u0641:"f",\u0642:"q",\u0643:"k",\u0644:"l",\u0645:"m",\u0646:"n",\u0647:"h",\u0629:"h",\u0648:"w",\u064a:"y",\u0649:"a",\u0621:""};let t="";for(const i of e)t+=o[i]||i;return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}safeArabicToEnglishTransliteration(e){const o={\u0621:"",\u0622:"aa",\u0623:"a",\u0624:"u",\u0625:"i",\u0626:"i",\u0627:"a",\u0628:"b",\u0629:"h",\u062a:"t",\u062b:"th",\u062c:"j",\u062d:"h",\u062e:"kh",\u062f:"d",\u0630:"dh",\u0631:"r",\u0632:"z",\u0633:"s",\u0634:"sh",\u0635:"s",\u0636:"d",\u0637:"t",\u0638:"dh",\u0639:"a",\u063a:"gh",\u0640:"",\u0641:"f",\u0642:"q",\u0643:"k",\u0644:"l",\u0645:"m",\u0646:"n",\u0647:"h",\u0648:"w",\u0649:"a",\u064a:"y","\u064b":"","\u064c":"","\u064d":"","\u064e":"","\u064f":"","\u0650":"","\u0651":"","\u0652":"","\u0653":"","\u0654":"","\u0655":"","\u0656":"","\u0657":"","\u0658":"","\u0659":"","\u065a":"","\u065b":"","\u065c":"","\u065d":"","\u065e":"","\u065f":"","\u0660":"0","\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9",\u06a9:"k",\u06af:"g",\u067e:"p",\u0686:"ch",\u0698:"zh",\u06a4:"v",\u06a5:"f",\u06a6:"f",\u06a7:"q",\u06a8:"q",\u06aa:"k",\u06ab:"g",\u06ac:"g",\u06ad:"ng",\u06ae:"ng",\ufefb:"la",\ufef7:"laa",\ufef9:"laa",\ufef5:"laa",\ufe70:"",\ufe71:"",\ufe72:"",\ufe73:"",\ufe74:"",\ufe76:"",\ufe77:"",\ufe78:"",\ufe79:"",\ufe7a:"",\ufe7b:"",\ufe7c:"",\ufe7d:"",\ufe7e:"",\ufe7f:"",\ufe80:"",\ufe81:"aa",\ufe82:"aa",\ufe83:"a",\ufe84:"a",\ufe85:"u",\ufe86:"u",\ufe87:"i",\ufe88:"i",\ufe89:"i",\ufe8a:"i",\ufe8b:"i",\ufe8c:"i",\ufe8d:"a",\ufe8e:"a",\ufe8f:"b",\ufe90:"b",\ufe91:"b",\ufe92:"b",\ufe93:"h",\ufe94:"h",\ufe95:"t",\ufe96:"t",\ufe97:"t",\ufe98:"t",\ufe99:"th",\ufe9a:"th",\ufe9b:"th",\ufe9c:"th",\ufe9d:"j",\ufe9e:"j",\ufe9f:"j",\ufea0:"j",\ufea1:"h",\ufea2:"h",\ufea3:"h",\ufea4:"h",\ufea5:"kh",\ufea6:"kh",\ufea7:"kh",\ufea8:"kh",\ufea9:"d",\ufeaa:"d",\ufeab:"dh",\ufeac:"dh",\ufead:"r",\ufeae:"r",\ufeaf:"z",\ufeb0:"z",\ufeb1:"s",\ufeb2:"s",\ufeb3:"s",\ufeb4:"s",\ufeb5:"sh",\ufeb6:"sh",\ufeb7:"sh",\ufeb8:"sh",\ufeb9:"s",\ufeba:"s",\ufebb:"s",\ufebc:"s",\ufebd:"d",\ufebe:"d",\ufebf:"d",\ufec0:"d",\ufec1:"t",\ufec2:"t",\ufec3:"t",\ufec4:"t",\ufec5:"dh",\ufec6:"dh",\ufec7:"dh",\ufec8:"dh",\ufec9:"a",\ufeca:"a",\ufecb:"a",\ufecc:"a",\ufecd:"gh",\ufece:"gh",\ufecf:"gh",\ufed0:"gh",\ufed1:"f",\ufed2:"f",\ufed3:"f",\ufed4:"f",\ufed5:"q",\ufed6:"q",\ufed7:"q",\ufed8:"q",\ufed9:"k",\ufeda:"k",\ufedb:"k",\ufedc:"k",\ufedd:"l",\ufede:"l",\ufedf:"l",\ufee0:"l",\ufee1:"m",\ufee2:"m",\ufee3:"m",\ufee4:"m",\ufee5:"n",\ufee6:"n",\ufee7:"n",\ufee8:"n",\ufee9:"h",\ufeea:"h",\ufeeb:"h",\ufeec:"h",\ufeed:"w",\ufeee:"w",\ufeef:"a",\ufef0:"a",\ufef1:"y",\ufef2:"y",\ufef3:"y",\ufef4:"y"};let t="";for(const i of e)o[i]?t+=o[i]:/[\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]/.test(i)?t+="x":t+=i;return t=t.replace(/\s+/g," ").trim(),t.length>0&&(t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()),t||"Text"}loadArabicFont(){return(0,p.mG)(this,void 0,void 0,function*(){try{const e=["https://fonts.gstatic.com/s/cairo/v28/SLXGc1nY6HkvalIkTp2mxdt0UX8gfO8_19co.woff2","https://fonts.gstatic.com/s/nototc/v35/m8JVjfNVeKWVnh3QMuKkFcZlbkGG1dKFzQ.woff2","https://fonts.gstatic.com/s/scheherazadnew/v16/4UaZrEhTvBiF3i89P6gvLJ2lfjz_-ruOvKsv.woff2","https://cdn.jsdelivr.net/gh/googlefonts/noto-fonts@main/hinted/ttf/NotoSansArabic/NotoSansArabic-Regular.ttf"];for(const o of e)try{console.log(`Attempting to load Arabic font from: ${o}`);const t=yield fetch(o,{method:"GET",mode:"cors",cache:"default",headers:{Accept:"font/woff2,font/woff,font/ttf,*/*"}});if(t.ok&&200===t.status){const i=yield t.arrayBuffer();if(i.byteLength>1e3)return console.log(`\u2705 Arabic font loaded successfully from CDN: ${i.byteLength} bytes`),i}}catch(t){console.warn(`\u274c Failed to load font from ${o}:`,t);continue}try{console.log("Attempting to load Arabic font from local assets...");const o=yield fetch("./assets/fonts/NotoSansArabic-Regular.ttf");if(o.ok){const t=yield o.arrayBuffer();return console.log("\u2705 Arabic font loaded from local assets"),t}}catch(o){console.warn("\u274c No local Arabic font found")}try{console.log("Attempting to create Arabic font using CSS Font Loading API..."),yield new FontFace("ArabicFont","url(https://fonts.gstatic.com/s/cairo/v28/SLXGc1nY6HkvalIkTp2mxdt0UX8gfO8_19co.woff2)").load(),console.log("\u2705 Arabic font created using Font Loading API");const i=document.createElement("canvas").getContext("2d");throw i&&(i.font="16px ArabicFont",i.fillText("\u062a\u062c\u0631\u0628\u0629",10,30)),new Error("FontFace to ArrayBuffer conversion needed")}catch(o){console.warn("\u274c Font Loading API failed")}throw new Error("All Arabic font loading strategies failed")}catch(e){throw console.warn("All Arabic font loading attempts failed:",e),e}})}safeGetTextWidth(e,o,t){try{return e.widthOfTextAtSize(o,t)}catch(i){return console.warn("Error calculating text width, using fallback:",i),o.length*t*.6}}safeDrawText(e,o,t){try{let i=o;return/[\u0600-\u06FF]/.test(o)&&(console.log("Processing Arabic text for PDF:",o.substring(0,20)+"..."),i=this.fixArabicTextForPDF(o),i=this.processArabicTextForPDF(i),console.log("Arabic text processed successfully")),e.drawText(i,t),!0}catch(i){console.warn("Failed to draw processed Arabic text:",i),console.warn("Original text:",o);const r=[()=>{const n=this.cleanArabicTextForPDF(o);e.drawText(n,t),console.log("\u2705 Successfully drawn with cleaned Arabic text")},()=>{const n=this.simplifyArabicText(o);e.drawText(n,t),console.log("\u2705 Successfully drawn with simplified Arabic text")},()=>{const n=this.smartArabicTransliteration(o);e.drawText(n,t),console.log("\u26a0\ufe0f Drawn with smart transliteration")}];for(let n=0;n<r.length;n++)try{return r[n](),!0}catch(s){if(console.warn(`Fallback strategy ${n+1} failed:`,s),n===r.length-1)return console.error("All fallback strategies failed"),!1}return!1}}fixArabicTextForPDF(e){let o=e;return Object.entries({\ufedf:"\u0644\u0627",\ufee0:"\u0644\u0627",\ufee1:"\u0644\u0625",\ufee2:"\u0644\u0625",\ufee3:"\u0644\u0622",\ufee4:"\u0644\u0622","\u064b":"","\u064c":"","\u064d":"","\u064e":"","\u064f":"","\u0650":"","\u0651":"","\u0652":""}).forEach(([i,r])=>{o=o.replace(new RegExp(i,"g"),r)}),o}cleanArabicTextForPDF(e){return e?e.replace(/[\u064B-\u0652]/g,"").replace(/[\u0653-\u0655]/g,"").replace(/[\u0670\u0640]/g,"").replace(/\u200C/g,"").replace(/\u200D/g,"").trim():""}simplifyArabicText(e){if(!e)return"";const t=e.match(/[\u0621-\u063A\u0641-\u064A\u0660-\u0669\u0020-\u007E]/g);return t?t.join(""):e}smartArabicTransliteration(e){if(!e)return"";if(!/[\u0600-\u06FF]/.test(e))return e;const t={"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u062e\u0632\u0648\u0646":"Stock Report","\u0627\u0644\u0645\u062e\u0632\u0648\u0646 \u0627\u0644\u0625\u0641\u062a\u062a\u0627\u062d\u064a":"Opening Inventory","\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641":"Item Name",\u0627\u0644\u0643\u0645\u064a\u0629:"Quantity",\u0627\u0644\u0633\u0639\u0631:"Price",\u0627\u0644\u0645\u062c\u0645\u0648\u0639:"Total",\u0627\u0644\u062a\u0627\u0631\u064a\u062e:"Date",\u0627:"a",\u0628:"b",\u062a:"t",\u062b:"th",\u062c:"j",\u062d:"h",\u062e:"kh",\u062f:"d",\u0630:"dh",\u0631:"r",\u0632:"z",\u0633:"s",\u0634:"sh",\u0635:"s",\u0636:"d",\u0637:"t",\u0638:"dh",\u0639:"a",\u063a:"gh",\u0641:"f",\u0642:"q",\u0643:"k",\u0644:"l",\u0645:"m",\u0646:"n",\u0647:"h",\u0648:"w",\u064a:"y"};let i=e;return Object.keys(t).forEach(r=>{i.includes(r)&&(i=i.replace(new RegExp(r,"g"),t[r]))}),i}processArabicTextForPDF(e){if(!e)return"";try{let o=this.cleanArabicTextForPDF(e);return/[\u0600-\u06FF]/.test(o)&&(o=o.normalize("NFKC")),o}catch(o){return console.warn("Arabic text processing failed, returning original:",o),e}}prepareExcelData(e){const o=[],t=new Array(e.columns.length).fill("");if(t[0]=e.title,o.push(t),e.subtitle){const s=new Array(e.columns.length).fill("");s[0]=e.subtitle,o.push(s)}const i=new Array(e.columns.length).fill("");i[0]=e.currentDate||this.formatDate(new Date,"yyyy-MM-dd"),o.push(i),o.push(new Array(e.columns.length).fill("")),o.push(e.columns.map(s=>s.title)),e.data.forEach((s,c)=>{const l=e.columns.map(A=>this.getCellValue(s,A,c+1));o.push(l)}),o.push(new Array(e.columns.length).fill(""));const r=new Array(e.columns.length).fill("");r[0]=`\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645: ${e.userName}`,o.push(r);const n=new Array(e.columns.length).fill("");return n[0]=`\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0635\u062f\u064a\u0631: ${this.formatDate(new Date,"yyyy-MM-dd HH:mm")}`,o.push(n),o}applyModernExcelStyling(e,o){const t=o.columns.length,i=this.numberToExcelColumn(t-1);e["!merges"]||(e["!merges"]=[]);let r=0;const n=`A${r+1}`,s=`A${r+1}:${i}${r+1}`;if(e[n]&&(e[n].s={font:{bold:!0,sz:18,color:{rgb:"1F4E79"}},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:"E7F3FF"}},border:{top:{style:"thin",color:{rgb:"1F4E79"}},bottom:{style:"thin",color:{rgb:"1F4E79"}},left:{style:"thin",color:{rgb:"1F4E79"}},right:{style:"thin",color:{rgb:"1F4E79"}}}}),e["!merges"].push(this.decodeRange(s)),r++,o.subtitle){const E=`A${r+1}`,S=`A${r+1}:${i}${r+1}`;e[E]&&(e[E].s={font:{bold:!0,sz:14,color:{rgb:"2F75B5"}},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:"F2F8FF"}}}),e["!merges"].push(this.decodeRange(S)),r++}const c=`A${r+1}`,l=`A${r+1}:${i}${r+1}`;e[c]&&(e[c].s={font:{sz:11,color:{rgb:"666666"}},alignment:{horizontal:"center",vertical:"center"}}),e["!merges"].push(this.decodeRange(l)),r+=2;const A=r+1;for(let E=0;E<t;E++){const x=`${this.numberToExcelColumn(E)}${A}`;e[x]&&(e[x].s={font:{bold:!0,sz:12,color:{rgb:"FFFFFF"}},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:"4472C4"}},border:{top:{style:"thin",color:{rgb:"FFFFFF"}},bottom:{style:"thin",color:{rgb:"FFFFFF"}},left:{style:"thin",color:{rgb:"FFFFFF"}},right:{style:"thin",color:{rgb:"FFFFFF"}}}})}const a=A+1,b=a+o.data.length-1;for(let E=a;E<=b;E++){const x=(E-a)%2==0?"FFFFFF":"F8F9FA";for(let f=0;f<t;f++){const O=`${this.numberToExcelColumn(f)}${E}`;if(e[O]){e[O].s={font:{sz:10},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:x}},border:{top:{style:"thin",color:{rgb:"E1E5E9"}},bottom:{style:"thin",color:{rgb:"E1E5E9"}},left:{style:"thin",color:{rgb:"E1E5E9"}},right:{style:"thin",color:{rgb:"E1E5E9"}}}};const B=o.columns[f];B&&"currency"===B.type&&(e[O].s.alignment.horizontal="right"),B&&"serialNumber"===B.key&&(e[O].s.font.bold=!0,e[O].s.fill={fgColor:{rgb:"E7F3FF"}})}}}}numberToExcelColumn(e){let o="";for(;e>=0;)o=String.fromCharCode(65+e%26)+o,e=Math.floor(e/26)-1;return o}decodeRange(e){const o=e.split(":"),t=this.cellRefToCoords(o[0]),i=this.cellRefToCoords(o[1]);return{s:{c:t.c,r:t.r},e:{c:i.c,r:i.r}}}cellRefToCoords(e){const o=e.match(/([A-Z]+)(\d+)/);if(!o)return{c:0,r:0};const t=o[1],i=parseInt(o[2])-1;let r=0;for(let n=0;n<t.length;n++)r=26*r+(t.charCodeAt(n)-64);return r-=1,{c:r,r:i}}getCellValue(e,o,t){let i;if("serialNumber"===o.key)i=t||1;else if("finalAmount"===o.key)i=(parseFloat(e.tot_pr)||0)-(parseFloat(e.discount)||0);else if("stockValue"===o.key)i=(parseFloat(e.quantity)||0)*(parseFloat(e.pay_price)||0);else if("profitPercentage"===o.key){const r=parseFloat(e.pay_price)||0,n=parseFloat(e.perch_price)||0;i=r&&n&&0!==n?(r-n)/n*100:0}else i=this.getNestedValue(e,o.key);if(null==i)return"";switch(o.type){case"currency":return this.formatCurrency(i);case"date":return this.formatDate(i,"yyyy-MM-dd");case"number":if("profitPercentage"===o.key){const r=parseFloat(i);return isNaN(r)?"0.00%":`${r.toFixed(2)}%`}return this.formatNumber(i);default:return i.toString()}}getNestedValue(e,o){return o.split(".").reduce((t,i)=>t&&t[i],e)}formatCurrency(e){const o=parseFloat(e);return isNaN(o)?"0.00":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o)}formatNumber(e){const o=parseFloat(e);return isNaN(o)?"0":new Intl.NumberFormat("en-US").format(o)}generateDynamicTitle(e){return{"sales-record":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a","purchase-record":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u0634\u062a\u0631\u064a\u0627\u062a","item-stock":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u062e\u0632\u0648\u0646",cash2:"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u062e\u0632\u064a\u0646\u0629",statement2:"\u0643\u0634\u0641 \u0627\u0644\u062d\u0633\u0627\u0628","spend-record2":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a","balance-sheet2":"\u0627\u0644\u0645\u064a\u0632\u0627\u0646\u064a\u0629 \u0627\u0644\u0639\u0645\u0648\u0645\u064a\u0629","sub-account2":"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0641\u0631\u0639\u064a\u0629"}[e]||"\u062a\u0642\u0631\u064a\u0631"}generateDynamicSubtitle(e,o){let t="";return o.selectedAccount&&o.selectedAccount.sub_name&&(t+="sales-record"===e?`\u0627\u0644\u0639\u0645\u064a\u0644: ${o.selectedAccount.sub_name}`:"purchase-record"===e?`\u0627\u0644\u0645\u0648\u0631\u062f: ${o.selectedAccount.sub_name}`:`\u0627\u0644\u062d\u0633\u0627\u0628: ${o.selectedAccount.sub_name}`),o.dateFilter&&(t&&(t+=" - "),"single"===o.dateFilter.type&&o.dateFilter.date?t+=`\u0641\u064a \u062a\u0627\u0631\u064a\u062e ${this.formatDateArabic(o.dateFilter.date)}`:"range"===o.dateFilter.type&&o.dateFilter.startDate&&o.dateFilter.endDate&&(t+=`\u0641\u064a \u0627\u0644\u0641\u062a\u0631\u0629 \u0645\u0646 ${this.formatDateArabic(o.dateFilter.startDate)} \u0625\u0644\u0649 ${this.formatDateArabic(o.dateFilter.endDate)}`)),o.searchTerm&&(t&&(t+=" - "),t+=`\u0627\u0644\u0628\u062d\u062b: ${o.searchTerm}`),t}formatDateArabic(e){if(!e)return"";const t=new Date(e);return`${t.getDate()} ${["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"][t.getMonth()]}`}showSuccessToast(e){return(0,p.mG)(this,void 0,void 0,function*(){yield(yield this.getToastController().create({message:e,duration:3e3,color:"success",position:"top",mode:"ios"})).present()})}showErrorToast(e){return(0,p.mG)(this,void 0,void 0,function*(){yield(yield this.getToastController().create({message:e,duration:3e3,color:"danger",position:"top",mode:"ios"})).present()})}showConfirmationAlert(e,o){return(0,p.mG)(this,void 0,void 0,function*(){return new Promise(t=>(0,p.mG)(this,void 0,void 0,function*(){yield(yield this.getAlertController().create({header:e,message:o,buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel",handler:()=>t(!1)},{text:"\u0645\u062a\u0627\u0628\u0639\u0629",handler:()=>t(!0)}]})).present()}))})}}return R.\u0275fac=function(e){return new(e||R)(k.LFG(k.zs3))},R.\u0275prov=k.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})()}}]);