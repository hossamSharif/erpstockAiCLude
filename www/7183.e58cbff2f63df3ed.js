"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7183],{37183:($,m,c)=>{c.r(m),c.d(m,{SalessndPageModule:()=>k});var p=c(69808),d=c(34182),o=c(23349),_=c(94030),l=c(70655),I=c(4441),e=c(29863);let b=(()=>{class n{transform(t,s){let i=s.toString();if(void 0!==i&&null!==i.length)return 0===i.length||0===t.length?t:i?t.filter(a=>-1!=a.item_name.toLocaleLowerCase().indexOf(i)):t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"filterByName",type:n,pure:!0}),n})(),v=(()=>{class n{transform(t,s){let i=s.toString();if(void 0!==i&&null!==i.length)return 0===i.length||0===t.length?t:i?t.filter(a=>-1!=a.aliasEn.toLocaleLowerCase().indexOf(i)):t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"filterByAlias",type:n,pure:!0}),n})(),A=(()=>{class n{transform(t,s){let i=s.toString();if(void 0!==i&&null!==i.length)return 0===i.length||0===t.length?t:i?t.filter(a=>-1!=a.item_desc.toLocaleLowerCase().indexOf(i)):t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"filterByEnName",type:n,pure:!0}),n})();var y=c(15439),S=c(17158),T=c(65465),C=c(90849),L=c(91472);const Z=["dst"],x=["dstPop"],w=["qtyId"],M=["popInput"],P=["popover"],q=["popoverNotif"];function Q(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"input",20),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(3).selectedAccount.sub_name=i})("change",function(i){return e.CHM(t),e.oxw(3).pickAccount(i)}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("ngModel",t.selectedAccount.sub_name)}}function N(n,r){1&n&&e._UZ(0,"option",23),2&n&&e.Q6J("value",r.$implicit.sub_name)}function F(n,r){if(1&n&&(e.TgZ(0,"datalist",21),e.YNc(1,N,1,1,"option",22),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t.sub_account)}}function O(n,r){1&n&&(e.TgZ(0,"ion-label"),e.TgZ(1,"ion-text",24),e._uU(2,"\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644 "),e.qZA(),e.qZA())}function H(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"ion-button",25),e.NdJ("click",function(){return e.CHM(t),e.oxw(3).refresh("account")}),e._UZ(1,"ion-icon",26),e.qZA()}}function R(n,r){if(1&n&&(e.TgZ(0,"ion-col",16),e.TgZ(1,"ion-item",14),e.YNc(2,Q,1,1,"input",17),e.YNc(3,F,2,1,"datalist",18),e.YNc(4,O,3,0,"ion-label",1),e.YNc(5,H,2,0,"ion-button",19),e.qZA(),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.sub_account),e.xp6(1),e.Q6J("ngIf",t.sub_account),e.xp6(1),e.Q6J("ngIf",!t.sub_account),e.xp6(1),e.Q6J("ngIf",!t.sub_account)}}function J(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"ion-col",16),e.TgZ(1,"ion-item",14),e.TgZ(2,"ion-input",27),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw(2).sub_nameNew=i}),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngModel",t.sub_nameNew)}}function Y(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"ion-grid"),e.TgZ(1,"ion-row",3),e.TgZ(2,"ion-col",4),e.TgZ(3,"ion-card",5),e.TgZ(4,"ion-grid",5),e.TgZ(5,"ion-row",3),e.TgZ(6,"ion-col",6),e.TgZ(7,"ion-radio-group",7),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().radioVal=i})("ionChange",function(i){return e.CHM(t),e.oxw().radioChange(i)}),e.TgZ(8,"ion-grid",5),e.TgZ(9,"ion-row"),e.TgZ(10,"ion-col",5),e.TgZ(11,"ion-item",8),e._UZ(12,"ion-radio",9),e.TgZ(13,"ion-label"),e._uU(14,"\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062d\u0633\u0627\u0628\u0627\u062a "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"ion-col",5),e.TgZ(16,"ion-item",8),e._UZ(17,"ion-radio",9),e.TgZ(18,"ion-label"),e._uU(19,"\u062d\u0633\u0627\u0628 \u062c\u062f\u064a\u062f"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(20,"ion-col",10),e.TgZ(21,"ion-item",8),e.TgZ(22,"input",11),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().payInvo.pay_date=i}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(23,"ion-row"),e.YNc(24,R,6,4,"ion-col",12),e.YNc(25,J,3,1,"ion-col",12),e.TgZ(26,"ion-col",13),e.TgZ(27,"ion-item",14),e.TgZ(28,"ion-input",15),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().payInvo.payComment=i}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(7),e.Q6J("ngModel",t.radioVal),e.xp6(5),e.Q6J("value",0),e.xp6(5),e.Q6J("value",1),e.xp6(5),e.Q6J("ngModel",t.payInvo.pay_date),e.xp6(2),e.Q6J("ngIf",0==t.radioVal),e.xp6(1),e.Q6J("ngIf",1==t.radioVal),e.xp6(3),e.Q6J("ngModel",t.payInvo.payComment)}}function D(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"ion-grid",28),e.TgZ(1,"ion-row",3),e.TgZ(2,"ion-col",29),e.TgZ(3,"ion-card"),e.TgZ(4,"ion-grid"),e.TgZ(5,"ion-row",30),e.TgZ(6,"ion-col",31),e.TgZ(7,"ion-label",32),e.TgZ(8,"strong"),e._uU(9,"\u0627\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0628\u0644\u063a"),e.qZA(),e.qZA(),e.TgZ(10,"ion-item",14),e.TgZ(11,"ion-input",27),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().payInvo.tot_pr=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(12,"ion-col",31),e.TgZ(13,"ion-label",32),e.TgZ(14,"strong"),e._uU(15," \u0627\u0644\u0645\u062f\u0641\u0648\u0639 \u0646\u0642\u062f\u0627"),e.qZA(),e.qZA(),e.TgZ(16,"ion-item",14),e.TgZ(17,"ion-input",7),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().payInvo.pay=i})("ionChange",function(i){return e.CHM(t),e.oxw().payChange(i)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"ion-col",31),e.TgZ(19,"ion-label",32),e.TgZ(20,"strong"),e._uU(21,"\u0627\u0644\u0645\u062a\u0628\u0642\u064a"),e.qZA(),e.qZA(),e.TgZ(22,"ion-item",14),e.TgZ(23,"ion-input",33),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().payInvo.changee=i}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(24,"ion-row",30),e.TgZ(25,"ion-col",34),e.TgZ(26,"ion-button",35),e.NdJ("click",function(){return e.CHM(t),e.oxw().save()}),e.TgZ(27,"ion-label",36),e._uU(28," \u062d\u0641\u0640\u0640\u0638"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(11),e.Q6J("ngModel",t.payInvo.tot_pr),e.xp6(6),e.Q6J("ngModel",t.payInvo.pay),e.xp6(6),e.Q6J("ngModel",t.payInvo.changee)("readonly",!0)}}const B=[{path:"",component:(()=>{class n{constructor(t,s,i,a,h,f,g,V,G,U,z,j,W,K){this.rout=t,this.platform=s,this.behavApi=i,this._location=a,this.route=h,this.renderer=f,this.modalController=g,this.alertController=V,this.authenticationService=G,this.storage=U,this.loadingController=z,this.datePipe=j,this.api=W,this.toast=K,this.isOpen=!1,this.isOpenNotif=!1,this.newNotif=!1,this.sub_account=[],this.sub_accountLocalSales=[],this.sub_accountSales=[],this.initialInvoices=[],this.items=[],this.itemsLocal=[],this.itemList=[],this.salesLocal=[],this.sales=[],this.notifArr=[],this.LogHistoryLocalArr=[],this.purchLocal=[],this.purchase=[],this.randomsNumber=[],this.sub_nameNew="",this.discountPerc=0,this.radioVal=0,this.radioVal2=1,this.printMode=!1,this.printArr=[],this.offline=!1,this.color="dark",this.showMe=null,this.status="new",this.searchLang=0,this.searchTerm="",this.aliasTerm="",this.searchResult=[],this.aliasResult=[],this.finalResult=[],this.loadingItems=!1,this.logHistoryArr=[],this.showNotif=!1,this.device="",this.currenQty=0,this.firstQty=0,this.perchTotQty=0,this.payTotQty=0,this.perchTot=0,this.qtyReal=0,this.availQty=0,this.selectedAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:"",cat_name:"",cat_id:"",phone:"",address:"",currentCustumerStatus:0},this.route.queryParams.subscribe(u=>{u&&u.payInvo&&(this.status="initial",this.payInvo=JSON.parse(u.payInvo),null==this.payInvo.cust_id?(this.radioVal=1,this.sub_nameNew=JSON.parse(u.sub_name)):this.selectedAccount.sub_name=JSON.parse(u.sub_name),this.user_info=JSON.parse(u.user_info),this.store_info=JSON.parse(u.store_info),this.itemList=JSON.parse(u.itemList),this.discountPerc=(+this.payInvo.discount/+this.payInvo.tot_pr*100).toFixed(2),this.prepareOffline(),this.getAppInfoCase2())}),this.printArr.push({payInvo:"",itemList:"",selectedAccount:"",sub_nameNew:"",userInfo:"",sub_balanse:0,balanceStatus:""}),this.selectedItem={id:void 0,dateCreated:"",pay_ref:"",item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:""}}checkPlatform(){this.platform.is("desktop")?this.device="desktop":this.platform.is("mobile")&&(this.device="mobile")}changeMode(){1==this.offline?(this.offline=!1,this.color="primary"):0==this.offline&&(this.offline=!0,this.color="dark"),this.storage.set("offline",this.offline).then(t=>{})}ionViewDidLeave(){}ionViewDidEnter(){setTimeout(()=>{},1e4)}ngOnInit(){this.prepareOffline(),"new"==this.status?this.getAppInfo():"initial"==this.status&&(this.getAppInfoCase2(),this.radioVal2=1)}presentPopover(t){this.popover.event=t,this.isOpen=!0,this.clear(),this.searchResult=this.items,setTimeout(()=>{this.setFocusOnInput("popInput")},2e3)}presentPopoverNotif(t){this.notifArr=[],this.showNotif=!1,this.popoverNotif.event=t,this.isOpenNotif=!0}didDissmis(){this.isOpen=!1,this.getItemPaysByItemId(),this.setFocusOnInput("qtyId")}didDissmisNotif(){this.isOpenNotif=!1}bothItemAndAccount(t,s){return(0,l.mG)(this,void 0,void 0,function*(){yield this.getAllStockItemsWithouteCounts(),yield this.getSalesAccount(t,s)})}searchItem(t){this.searchResult=[],this.aliasTerm=t.target.value;const s=new b,i=new v,a=new A;let h;h=0==this.searchLang?s.transform(this.items,t.target.value):a.transform(this.items,t.target.value);const f=i.transform(this.items,this.aliasTerm);h.length>0&&h.forEach(g=>{this.searchResult.push(g)}),f.length>0&&f.forEach(g=>{this.searchResult.push(g)})}clear(t){t?this.selectedItem={id:void 0,dateCreated:"",pay_ref:this.payInvo.pay_ref,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:""}:this.searchTerm=""}getStockItems(){this.storage.get("year").then(t=>{t&&(this.year=t,0==this.offline?(this.loadingItems=!0,this.api.stockItems(1,this.year.id).subscribe(s=>{this.items=s.data,this.items.forEach(a=>{+a.tswiaQuantity>0?a.salesQuantity=+a.salesQuantity+ +a.tswiaQuantity:+a.tswiaQuantity<0&&(a.perchQuantity=+a.perchQuantity+Math.abs(+a.tswiaQuantity)),a.quantity=+a.perchQuantity+ +a.firstQuantity-+a.salesQuantity}),this.searchResult=this.items,this.loadingItems=!1,this.storage.set("itemsLocal",this.items).then(a=>{})},s=>{this.loadingItems=!1},()=>{this.loadingItems=!1})):(this.items=this.itemsLocal,this.items.forEach(s=>{+s.tswiaQuantity>0?s.salesQuantity=+s.salesQuantity+ +s.tswiaQuantity:+s.tswiaQuantity<0&&(s.perchQuantity=+s.perchQuantity+Math.abs(+s.tswiaQuantity)),s.quantity=+s.perchQuantity+ +s.firstQuantity-+s.salesQuantity}),this.searchResult=this.items))})}getAllStockItemsWithouteCounts(){this.storage.get("year").then(t=>{t&&(this.year=t,0==this.offline?(this.loadingItems=!0,this.api.getAllStockItemsWithouteCounts(1,this.year.id).subscribe(s=>{this.items=s.data,this.loadingItems=!1,this.storage.set("itemsLocal",this.items).then(a=>{})},s=>{this.loadingItems=!1},()=>{this.loadingItems=!1})):(this.items=this.itemsLocal,this.searchResult=this.items))})}afterSync(t){t.forEach(s=>{if(0==this.LogHistoryLocalArr.some(i=>i.logRef===s.logRef))this.LogHistoryLocalArr.push(s);else{let i=this.LogHistoryLocalArr.findIndex(a=>a.logRef===s.logRef);-1!=i&&(this.LogHistoryLocalArr[i]=s)}}),this.storage.set("LogHistoryLocal",this.LogHistoryLocalArr).then(s=>{})}presentAlertConfirm(t){return(0,l.mG)(this,void 0,void 0,function*(){let s="\u0647\u0644 \u062a\u0631\u064a\u062f \u0637\u0628\u0627\u0639\u0629 \u0641\u0627\u062a\u0648\u0631\u0629 \u061f ";t&&(s="\u0647\u0644 \u062a\u0631\u064a\u062f \u062d\u0630\u0641 \u0627\u0644\u0633\u062c\u0644 \u061f "),yield(yield this.alertController.create({cssClass:"my-custom-class",header:"\u062a\u0623\u0643\u064a\u062f!",mode:"ios",message:s,buttons:[{text:"\u0625\u0644\u063a\u0627\u0621",role:"cancel",cssClass:"secondary",id:"cancel-button",handler:a=>{this.prepareInvo()}},{text:"\u0645\u0648\u0627\u0641\u0642",id:"confirm-button",handler:()=>{t?this.deleteSalesInvoInit():this.presentModal(this.printArr,"sales")}}]})).present()})}Print(t){this.printMode=!0;var s=window.open("","PRINT","height=400,width=600");return s.document.write("<html><head>"),s.document.write('<style type="text/css">'),s.document.write(".sumsDiv{border-style: solid;border-color: gray;border-width: .5px;} .flr{ display: block; float: right; } .show{ } .hide{width:0px;height:0px} .w45 {width:45%} .w50 {width:50%} .w100 {width:100%} td, th {border: 1px solid #dddddd;text-align: center;padding: 8px;} tr:nth-child(even) {background-color: #dddddd;} .table{text-align: center;width: 100%; margin: 12px;}.ion-margin{ margin: 10px; } .ion-margin-top{ margin-top: 10px; } .rtl {  direction: rtl; } .ion-text-center{ text-align: center; } .ion-text-end{ text-align: left; } .ion-text-start{ text-align: right; }"),s.document.write("</style></head><body>"),s.document.write(document.getElementById(t).innerHTML),s.document.write("</body></html>"),s.document.close(),s.focus(),s.print(),s.close(),this.printMode=!1,!0}getOffliemode(){this.storage.get("offline").then(t=>{this.offline=t,1==this.offline?this.color="dark":0==this.offline?this.color="primary":this.SetOffliemode()})}SetOffliemode(){this.storage.set("offline",!1).then(t=>{this.offline=t,this.color="primary"})}getAppInfo(){this.getOffliemode(),this.storage.get("USER_INFO").then(t=>{t&&(this.user_info=t)}),this.storage.get("year").then(t=>{t&&(this.year=t)}),this.storage.get("STORE_INFO").then(t=>{t&&(this.store_info=t,this.prepareInvo())})}getAppInfoCase2(){this.getOffliemode(),this.storage.get("USER_INFO").then(t=>{t&&(this.user_info=t)}),this.storage.get("year").then(t=>{t&&(this.year=t)}),this.storage.get("STORE_INFO").then(t=>{t&&(this.store_info=t)}),this.storage.get("LogHistoryLocal").then(t=>{t&&(this.LogHistoryLocalArr=t)}),this.storage.get("searchLang").then(t=>{t&&(this.searchLang=t)})}prepareOffline(){this.storage.get("salesLocal").then(t=>{t&&(this.salesLocal=t)}),this.storage.get("sales").then(t=>{t&&(this.sales=t)}),this.storage.get("sub_accountLocalSales").then(t=>{t&&(this.sub_accountLocalSales=t)}),this.storage.get("sub_accountSales").then(t=>{t&&(this.sub_accountSales=t,this.getSubBalance())})}newLogic(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.getAppInfo(),yield this.prepareInvo()})}getItemLocalOff(){this.storage.get("itemsLocal").then(t=>{t&&(this.itemsLocal=t,this.items=this.itemsLocal,this.searchResult=this.items)})}getAccountOffline(){this.storage.get("sub_accountSales").then(t=>{t&&(this.sub_account=t,this.getSubBalance(),this.addSubaccountLocal())})}radioChange(t){}recalSubBalance(){this.sub_account.forEach(t=>{t.sub_balance=0;let s=+t.changeeTot+ +t.fromDebitTot,i=+t.purchChangeeTot+ +t.toCreditTot;0==this.radioVal&&this.selectedAccount.id==t.id&&(s=+s+ +this.payInvo.changee),s==i?(t.sub_balance=0,t.currentCustumerStatus=""):s>i?(t.sub_balance=(+s-+i).toFixed(2),t.currentCustumerStatus="debit",+this.selectedAccount.id==+t.id&&(this.selectedAccount.sub_balance=t.sub_balance,this.selectedAccount.currentCustumerStatus=t.currentCustumerStatus)):i>s&&(t.sub_balance=(+i-+s).toFixed(2),t.currentCustumerStatus="credit",+this.selectedAccount.id==+t.id&&(this.selectedAccount.sub_balance=t.sub_balance,this.selectedAccount.currentCustumerStatus=t.currentCustumerStatus))})}getSubBalance(){this.sub_account.forEach(t=>{t.sub_balance=0;let s=+t.changeeTot+ +t.fromDebitTot,i=+t.purchChangeeTot+ +t.toCreditTot;s==i?(t.sub_balance=0,this.currentCustumerStatus=""):s>i?(t.sub_balance=(+s-+i).toFixed(2),this.currentCustumerStatus="debit"):i>s&&(t.sub_balance=(+i-+s).toFixed(2),this.currentCustumerStatus="credit")})}radioChange2(t,s){"from"==s&&(1==t.target.value&&"initial"==this.status?(this.status="toFinal",this.payInvo.yearId=this.year.id,this.itemList.length>0&&this.itemList.forEach(i=>{i.yearId=this.year.id})):0==t.target.value&&"toFinal"==this.status&&(this.status="initial"))}prepareInvo(){this.selectedAccount={id:"",ac_id:"",sub_name:"",sub_type:"",sub_code:"",sub_balance:"",store_id:"",cat_id:"",cat_name:"",phone:"",address:"",currentCustumerStatus:0},this.sub_nameNew="",this.radioVal=0,this.radioVal2=1,this.payInvo={pay_id:void 0,pay_ref:0,store_id:"",tot_pr:0,pay:0,pay_date:"",pay_time:"",user_id:"",cust_id:null,pay_method:"",discount:0,changee:0,sub_name:"",payComment:"",nextPay:null,yearId:this.year.id},this.discountPerc=0;let t=new Date;this.payInvo.pay_date=this.datePipe.transform(t,"yyyy-MM-dd"),this.payInvo.pay_time=this.datePipe.transform(t,"HH:mm:ss"),this.generateRandom(),this.payInvo.store_id=this.store_info.id,this.payInvo.user_id=this.user_info.id,this.payInvo.yearId=this.year.id,this.itemList=[],this.getSalesAccount()}setFocusOnInput(t){"dst"==t?this.nameField.nativeElement.focus():"dstPop"==t?(this.dstPop.setFocus(),this.isOpen=!0,this.clear(),this.searchResult=this.items,setTimeout(()=>{this.popInput.setFocus()},1500)):"qtyId"==t?this.qtyId.setFocus():"popInput"==t&&this.popInput.setFocus()}isFocused(t){}getItems(){0==this.offline?this.api.getItems().subscribe(t=>{this.items=t.data},t=>{}):this.items=this.itemsLocal}getSalesAccount(t,s){0==this.offline?this.api.getSalesAccounts(this.store_info.id,this.year.id).subscribe(i=>{this.sub_account=i.data,this.getSubBalance(),this.addSubaccountLocal(),"sync both"==t&&(this.storage.set("sub_accountSales",this.sub_account).then(h=>{}),this.afterSync(s))},i=>{}):this.MixSubaccountSalesOffline()}addSubaccountLocal(){if(this.sub_account){if(this.sub_accountLocalSales)for(let t=0;t<this.sub_accountLocalSales.length;t++)this.sub_account.push(this.sub_accountLocalSales[t])}else this.sub_accountLocalSales&&(this.sub_account=this.sub_accountLocalSales)}MixSubaccountSalesOffline(){if(this.sub_account=[],this.sub_accountLocalSales)for(let t=0;t<this.sub_accountLocalSales.length;t++)this.sub_account.push(this.sub_accountLocalSales[t]);if(this.sub_accountSales)for(let t=0;t<this.sub_accountSales.length;t++)this.sub_account.push(this.sub_accountSales[t])}generateRandom(){let t=new Date,s=t.getMonth().toString()+t.getDay().toString()+t.getHours().toString()+t.getMinutes().toString()+t.getSeconds().toString()+t.getMilliseconds().toString();this.payInvo.pay_ref=this.store_info.store_ref+s}pickAccount(t){let s=this.sub_account.filter(i=>i.sub_name==t.target.value);s.length>0?(this.selectedAccount={id:s[0].id,ac_id:s[0].ac_id,sub_name:s[0].sub_name,sub_type:s[0].sub_type,sub_code:s[0].sub_code,store_id:s[0].store_id,sub_balance:s[0].sub_balance,cat_id:s[0].cat_id,cat_name:s[0].cat_name,phone:s[0].phone,address:s[0].address,currentCustumerStatus:s[0].currentCustumerStatus},this.payInvo.cust_id=this.selectedAccount.id,this.payInvo.sub_name=this.selectedAccount.sub_name):(this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u0645 \u0627\u0644\u062d\u0633\u0627\u0628 ","danger"),this.selectedItem.item_name="")}selectFromPop(t){this.selectedItem={id:t.id,dateCreated:t.dateCreated,pay_ref:this.payInvo.pay_ref,item_desc:t.item_desc,item_name:t.item_name,item_unit:t.item_unit,parcode:t.parcode,pay_price:t.pay_price,perch_price:t.perch_price,qty:"",tot:t.pay_price,availQty:t.quantity,aliasEn:t.aliasEn},this.searchTerm=t.item_name,this.didDissmis()}getItemPaysByItemId(){this.api.getItemQtyPaysByItemId(this.store_info.id,this.selectedItem.id,this.year.id).subscribe(t=>{console.log("getItemPaysByItemId",t),"No record Found"!=t.message&&(this.payTotQty=t.data[0].salesQuantity),this.getQtyPurchByItemId()},t=>{this.presentToast("1\u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{})}getQtyPurchByItemId(){this.api.getQtyPurchByItemId(this.store_info.id,this.selectedItem.id,this.year.id).subscribe(t=>{let s=t;"No record Found"!=s.message&&(this.perchTotQty=s.data[0].perchQuantity,this.firstQty=s.data[0].firstQuantity),this.getQtyTswiaByItemId()},t=>{this.presentToast("  \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{})}getQtyTswiaByItemId(){this.api.getQtyTswiaByItemId(this.store_info.id,this.selectedItem.id,this.year.id).subscribe(t=>{console.log("getQtyTswiaByItemId",t);let s=t;"No record Found"!=s.message&&(this.availQty=s.data[0].availQty,this.qtyReal=s.data[0].qtyReal),this.getQtyTotalItemId()},t=>{this.presentToast("  \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{})}getQtyTotalItemId(){+this.availQty-+this.qtyReal<0?this.perchTotQty=+this.perchTotQty+Math.abs(+this.availQty-+this.qtyReal):+this.availQty-+this.qtyReal>0&&(this.payTotQty=+this.availQty-+this.qtyReal+ +this.payTotQty),this.availQty=+this.perchTotQty-+this.payTotQty,console.log(this.payTotQty,this.payTotQty)}pickDetail(t){let s=[];s=this.items.filter(1==this.searchLang?i=>i.item_desc==t.target.value:i=>i.item_name==t.target.value),s.length>0?(this.selectedItem={id:s[0].id,dateCreated:s[0].dateCreated,pay_ref:this.payInvo.pay_ref,item_desc:s[0].item_desc,item_name:s[0].item_name,item_unit:s[0].item_unit,parcode:s[0].parcode,pay_price:s[0].pay_price,perch_price:s[0].perch_price,qty:"",tot:s[0].pay_price,availQty:s[0].quantity,aliasEn:s[0].aliasEn},this.setFocusOnInput("qtyId")):(this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641 ","danger"),this.selectedItem.item_name="",this.selectedItem.item_desc="")}qtyhange(t){this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2);let s=[];this.itemList.length>0?(s=this.itemList.filter(i=>i.item_name==this.selectedItem.item_name),s.length>0?+this.selectedItem.qty+ +s[0].quantity>+this.selectedItem.availQty&&this.presentToast("\u0627\u0644\u0635\u0646\u0641 \u0645\u0648\u062c\u0648\u062f \u0628\u0627\u0644\u0642\u0627\u0626\u0645\u0629 , \u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0643\u0645\u064a\u0629 \u0627\u0644\u062c\u062f\u064a\u062f \u0627\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0645\u062a\u0648\u0641\u0631 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646","warning"):+this.selectedItem.qty>+this.selectedItem.availQty&&this.presentToast("\u0627\u0644\u0643\u0645\u064a\u0629 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646 \u063a\u064a\u0631 \u0643\u0627\u0641\u064a\u0629","warning")):+this.selectedItem.qty>+this.selectedItem.availQty&&this.presentToast("\u0627\u0644\u0643\u0645\u064a\u0629 \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646 \u063a\u064a\u0631 \u0643\u0627\u0641\u064a\u0629","warning")}pricehange(t){this.selectedItem.tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2)}payChange(t){this.discountPerc>0&&(this.payInvo.discount=(+this.payInvo.tot_pr*+this.discountPerc/100).toFixed(2)),this.payInvo.changee=+(this.payInvo.tot_pr-+this.payInvo.discount)-t.target.value}discountChange(t){this.discountPerc=(+this.payInvo.discount/+this.payInvo.tot_pr*100).toFixed(2),this.payInvo.changee=+(this.payInvo.tot_pr-t.target.value)-this.payInvo.pay}discountPerChange(t){this.payInvo.discount=(+this.payInvo.tot_pr*+this.discountPerc/100).toFixed(2),this.payInvo.changee=+(this.payInvo.tot_pr-this.payInvo.discount)-this.payInvo.pay}deleteItem(t){this.itemList.splice(t,1),this.payInvo.pay=0,this.discountPerc=0,this.payInvo.discount=0,this.getTotal()}presentToast(t,s){return(0,l.mG)(this,void 0,void 0,function*(){(yield this.toast.create({message:t,duration:2e3,color:s,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})}getTotal(){let t=this.itemList.reduce((s,i)=>s+ +i.tot,0);this.payInvo.tot_pr=t-+this.payInvo.discount,this.payInvo.changee=+(t-+this.payInvo.discount)-this.payInvo.pay,this.payInvo.tot_pr=this.payInvo.tot_pr.toFixed(2),this.payInvo.changee=this.payInvo.changee.toFixed(2)}refresh(t){"account"==t?this.getSalesAccount():this.getAllStockItemsWithouteCounts()}addTolist(){if(""==this.selectedItem.item_name||""==this.selectedItem.id||0==+this.selectedItem.qty)this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u0635\u0646\u0641 \u0648\u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0643\u0645\u064a\u0629","danger");else{let t=[];if(this.itemList.length>0&&(t=this.itemList.filter(s=>s.item_name==this.selectedItem.item_name&&s.pay_price==this.selectedItem.pay_price)),0==t.length){let s=new Date,i=this.datePipe.transform(s,"dd-MM-YYYY");this.itemList.push({id:"NULL",pay_ref:this.selectedItem.pay_ref,item_name:this.selectedItem.item_name,pay_price:this.selectedItem.pay_price,quantity:+this.selectedItem.qty,tot:this.selectedItem.tot,store_id:+this.store_info.id,yearId:+this.year.id,item_id:+this.selectedItem.id,dateCreated:i,perch_price:this.selectedItem.perch_price})}else{this.selectedItem.qty=+t[0].quantity+ +this.selectedItem.qty;let s=this.itemList.map(i=>i.item_name).indexOf(this.selectedItem.item_name);this.itemList[s].quantity=+this.selectedItem.qty,this.itemList[s].tot=(this.selectedItem.qty*+this.selectedItem.pay_price).toFixed(2)}this.selectedItem={id:void 0,dateCreated:"",pay_ref:this.payInvo.pay_ref,item_desc:"",item_name:"",item_unit:"",parcode:0,pay_price:0,perch_price:0,qty:0,tot:0,availQty:0,aliasEn:""},this.discountPerc=0,this.payInvo.discount=0,this.getTotal(),this.setFocusOnInput("dstPop")}}qtyClick(t){this.showMe=t}hideMe(t){this.showMe=null}editCell(t){+this.itemList[t].quantity>0&&+this.itemList[t].pay_price>0?(this.itemList[t].tot=+this.itemList[t].quantity*+this.itemList[t].pay_price,this.discountPerc=0,this.payInvo.discount=0,this.hideMe(t),this.getTotal()):this.presentToast("\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u062f\u062e\u0627\u0644 ","danger")}validate(){let t=[];return this.sub_account&&(t=this.sub_account.filter(s=>s.sub_name==this.sub_nameNew),console.log(t)),1==this.radioVal&&""==this.sub_nameNew?(this.presentToast(" 12\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062e\u062a\u064a\u0627\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644","danger"),!1):0==this.radioVal&&""==this.selectedAccount.sub_name?(this.presentToast("1 \u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062e\u062a\u064a\u0627\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644","danger"),!1):null==this.payInvo.cust_id&&0==this.radioVal&&""==this.selectedAccount.sub_name?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062e\u062a\u064a\u0627\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644","danger"),!1):""==this.payInvo.pay_date||null==this.payInvo.pay_date?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u062a\u0627\u0631\u064a\u062e ","danger"),!1):this.payInvo.changee<0?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0645\u0631\u0627\u062c\u0639\u0629 \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u0633\u062a\u0644\u0645 \u0648\u0627\u0644\u062e\u0635\u0645  ","danger"),!1):!(1==this.radioVal&&t.length>0&&(this.presentToast("\u0627\u0644\u0639\u0645\u064a\u0644 \u0645\u0648\u062c\u0648\u062f \u0645\u0633\u0628\u0642\u0627 , \u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631\u0629 \u0645\u0646 \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0639\u0645\u0644\u0627\u0621","danger"),1))}saveIntial(){1==this.radioVal&&(this.payInvo.sub_name=this.sub_nameNew,this.payInvo.cust_id=null),this.initialInvoices.length>0&&(this.initialInvoices=this.initialInvoices.filter(t=>t.payInvo.pay_ref!=this.payInvo.pay_ref)),this.initialInvoices.push({payInvo:this.payInvo,itemList:this.itemList}),this.storage.set("initialInvoices",this.initialInvoices).then(t=>{this.printArr=[],this.recalSubBalance(),this.printArr.push({payInvo:this.payInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus}),this.presentAlertConfirm(),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success"),this.prepareInvo(),this.status="new"})}saveInvoInit(){this.api.saveSalesInvoInit(this.payInvo).subscribe(t=>{this.saveitemListinit()},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}deleteInitial(){this.initialInvoices.length>0&&(this.initialInvoices=this.initialInvoices.filter(t=>t.payInvo.pay_ref!=this.payInvo.pay_ref)),this.storage.set("initialInvoices",this.initialInvoices).then(t=>{this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0630\u0641 \u0628\u0646\u062c\u0627\u062d","success"),this.status="new",this.prepareInvo()})}deleteSalesInvoInit(){"toFinal"!=this.status&&this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),this.api.deleteSalesInvoInit(this.payInvo.pay_id).subscribe(t=>{"Post Not Deleted"!=t.message?this.deleteSalesitemListInit():this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}deleteSalesitemListInit(){this.api.deleteSalesitemListInit(this.payInvo.pay_ref).subscribe(t=>{"Post Not Deleted"!=t.message?"toFinal"!=this.status&&(this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0630\u0641 \u0628\u0646\u062c\u0627\u062d","success"),this.prepareInvo()):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}save(){let t=this.payInvo.pay_date;this.payInvo.sub_name=this.selectedAccount.sub_name,this.payInvo.pay_date=this.datePipe.transform(t,"yyyy-MM-dd"),console.log("save testing",this.validate(),this.payInvo,this.payInvo.sub_name),1==this.validate()&&(this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ..."),0==this.radioVal2&&0==this.radioVal&&"new"==this.status?this.saveInvoInit():0==this.radioVal&&null!=this.selectedAccount.id?1==this.offline?this.saveInvoLocal():this.saveInvo():0==this.radioVal&&null==this.selectedAccount.id&&""!=this.selectedAccount.sub_name?1==this.offline?this.saveInvoLocal():this.saveSubAccount():1==this.radioVal&&(1==this.offline?this.saveSubAccountlocal():this.saveSubAccount()))}saveLogHistory(){let t,s,i;this.logHistoryArr.length>1?(i=this.logHistoryArr[1],s=this.logHistoryArr[0],t="new account"):(i=this.logHistoryArr[0],t=void 0),this.api.saveLogHistoryMultiSales(i,s,t).subscribe(a=>{"Post Not Created"!=a.message?(this.logHistoryArr=[],this.presentAlertConfirm(),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success")):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},a=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")})}performSync(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.saveLogHistory(),yield this.getAllStockItemsWithouteCounts()})}back(){this._location.back()}updateInitInvo(){this.api.updateInitSalesInvo(this.payInvo).subscribe(t=>{this.deleteSalesitemListInit4update()},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger").then(()=>{this.loadingController.dismiss()})})}deleteSalesitemListInit4update(){this.api.deleteSalesitemListInit(this.payInvo.pay_ref).subscribe(t=>{"Post Not Deleted"!=t.message?this.saveitemListinit():this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger").then(()=>{this.loadingController.dismiss()})},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger").then(()=>{this.loadingController.dismiss()})})}preparenewaccount(){this.selectedAccount.sub_name.length>0&&null==this.selectedAccount.id||(this.selectedAccount.sub_name=this.sub_nameNew,this.payInvo.sub_name=this.selectedAccount.sub_name),this.selectedAccount.id=null,this.selectedAccount.ac_id=1,this.selectedAccount.sub_type="debit",this.selectedAccount.sub_code=null,this.selectedAccount.sub_balance="0",this.selectedAccount.cat_id=1,this.selectedAccount.cat_name="\u0627\u0644\u0639\u0645\u0644\u0627\u0621",this.selectedAccount.store_id=this.store_info.id}saveSubAccount(){this.preparenewaccount(),this.api.saveSubAccount(this.selectedAccount).subscribe(t=>{"Post Not Created"!=t.message?(this.payInvo.cust_id=t.message,0==this.radioVal&&null==this.selectedAccount.id&&0==this.offline&&(this.sub_accountLocalSales=this.sub_accountLocalSales.filter(s=>s.sub_name!=this.selectedAccount.sub_name),this.storage.set("sub_accountLocalSales",this.sub_accountLocalSales).then(s=>{this.selectedAccount.id=this.payInvo.cust_id,this.sub_accountSales.push(this.selectedAccount),this.storage.set("sub_accountSales",this.sub_accountSales).then(i=>{})})),this.selectedAccount.id=t.message,this.logHistoryArr.push({id:null,logRef:this.generateRandom2("insert customer"),userId:this.user_info.id,typee:"insert customer",datee:y(new Date).locale("en").format("YYYY-MM-DD HH:mm:ss"),logStatus:0,logToken:JSON.stringify(this.selectedAccount),yearId:this.year.id,store_id:this.store_info.id}),this.saveInvo()):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveSubAccountInit(){this.preparenewaccount(),this.api.saveSubAccount(this.selectedAccount).subscribe(t=>{"Post Not Created"!=t.message?(this.payInvo.cust_id=t.message,this.saveInvoInit()):this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u0627\u0646\u0634\u0627\u0621 \u062d\u0633\u0627\u0628 \u0644\u0644\u0639\u0645\u064a\u0644 , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveSubAccountlocal(){this.preparenewaccount(),this.sub_account||(this.sub_account=[]),this.sub_account.push(this.selectedAccount),this.sub_accountLocalSales.push(this.selectedAccount),this.storage.set("sub_accountLocalSales",this.sub_accountLocalSales).then(t=>{this.saveInvoLocal()})}saveInvo(){this.api.saveSalesInvo(this.payInvo).subscribe(t=>{this.sales=this.sales.filter(i=>i.payInvo.pay_ref!=this.payInvo.pay_ref),this.sales.push({payInvo:this.payInvo,itemList:[]}),[].push({payInvo:this.payInvo,itemList:[]}),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success"),this.prepareInvo()},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveInvoLocal(){this.salesLocal.push({payInvo:this.payInvo,itemList:[]}),this.storage.set("salesLocal",this.salesLocal).then(t=>{this.printArr=[],this.recalSubBalance(),this.printArr.push({payInvo:this.payInvo,itemList:[],selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus}),this.prepareInvo(),this.status="new",this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success")})}saveitemListinit(){this.api.saveSalesitemListInit(this.itemList).subscribe(t=>{this.recalSubBalance(),this.printArr=[],this.recalSubBalance(),this.printArr.push({payInvo:this.payInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus}),this.presentAlertConfirm(),this.presentToast("\u062a\u0645 \u0627\u0644\u062d\u0641\u0638 \u0628\u0646\u062c\u0627\u062d","success"),this.prepareInvo(),this.status="new"},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})}saveitemList(){return(0,l.mG)(this,void 0,void 0,function*(){this.api.saveSalesitemList(this.itemList).subscribe(t=>{this.recalSubBalance(),this.printArr=[],this.printArr.push({payInvo:this.payInvo,itemList:this.itemList,selectedAccount:this.selectedAccount,sub_nameNew:this.sub_nameNew,user_name:this.user_info.full_name,sub_balanse:this.selectedAccount.sub_balance,balanceStatus:this.selectedAccount.currentCustumerStatus}),this.sales=this.sales.filter(i=>i.payInvo.pay_ref!=this.payInvo.pay_ref),this.sales.push({payInvo:this.payInvo,itemList:this.itemList});let s=[];s.push({payInvo:this.payInvo,itemList:this.itemList}),this.logHistoryArr.push({id:null,logRef:this.generateRandom2("insert sales"),userId:this.user_info.id,typee:"insert sales",datee:y(new Date).locale("en").format("YYYY-MM-DD HH:mm:ss"),logStatus:0,logToken:JSON.stringify(s[0]),yearId:this.year.id,store_id:this.store_info.id}),"toFinal"==this.status&&this.deleteSalesInvoInit(),this.performSync()},t=>{this.presentToast("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a , \u062e\u0637\u0627 \u0641\u064a \u0627\u0644\u0625\u062a\u0635\u0627\u0644 \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")},()=>{this.loadingController.dismiss()})})}generateRandom2(t){let s=new Date,i=s.getMonth().toString()+s.getDay().toString()+s.getHours().toString()+s.getMinutes().toString()+s.getSeconds().toString()+s.getMilliseconds().toString()+t;return this.store_info.store_ref+i}deleteInitInvo(){}presentModal(t,s){return(0,l.mG)(this,void 0,void 0,function*(){this.recalSubBalance();const i=yield this.modalController.create({component:I.n,componentProps:{printArr:this.printArr,page:s}});return i.onDidDismiss().then(a=>{null!==a&&this.prepareInvo()}),yield i.present()})}presentLoadingWithOptions(t){return(0,l.mG)(this,void 0,void 0,function*(){const s=yield this.loadingController.create({spinner:"bubbles",mode:"ios",duration:5e3,message:t,translucent:!0,backdropDismiss:!1});yield s.present(),yield s.onDidDismiss()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.F0),e.Y36(o.t4),e.Y36(S.h),e.Y36(p.Ye),e.Y36(_.gz),e.Y36(e.Qsj),e.Y36(o.IN),e.Y36(o.Br),e.Y36(T.u),e.Y36(C.K),e.Y36(o.HT),e.Y36(p.uU),e.Y36(L.r),e.Y36(o.yF))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-salessnd"]],viewQuery:function(t,s){if(1&t&&(e.Gf(Z,5),e.Gf(x,5),e.Gf(w,5),e.Gf(M,5),e.Gf(P,5),e.Gf(q,5)),2&t){let i;e.iGM(i=e.CRH())&&(s.nameField=i.first),e.iGM(i=e.CRH())&&(s.dstPop=i.first),e.iGM(i=e.CRH())&&(s.qtyId=i.first),e.iGM(i=e.CRH())&&(s.popInput=i.first),e.iGM(i=e.CRH())&&(s.popover=i.first),e.iGM(i=e.CRH())&&(s.popoverNotif=i.first)}},decls:9,vars:2,consts:[["slot","start"],[4,"ngIf"],["class","ion-margin-top",4,"ngIf"],["dir","rtl"],["size","12"],[1,"ion-no-padding","ion-no-margin"],["size","4"],[3,"ngModel","ngModelChange","ionChange"],["lines","none"],[1,"ion-margin-end",3,"value"],["size","3"],["type","date","id","startingDate","name","startingDate",2,"width","100%",3,"ngModel","ngModelChange"],["size","3","offset","1",4,"ngIf"],["size","3",1,"ion-text-start"],[1,"custInput"],["placeholder","\u0623\u0643\u062a\u0628 \u062a\u0639\u0644\u064a\u0642\u0627",3,"ngModel","ngModelChange"],["size","3","offset","1"],["class","bnone","placeholder","\u0627\u062e\u062a\u0631  \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644","list","accountsSales","id","accountSales",3,"ngModel","ngModelChange","change",4,"ngIf"],["style","border: none;","id","accountsSales","style","height: auto;max-height: 20px;",4,"ngIf"],["fill","clear","size","small","slot","end",3,"click",4,"ngIf"],["placeholder","\u0627\u062e\u062a\u0631  \u062d\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064a\u0644","list","accountsSales","id","accountSales",1,"bnone",3,"ngModel","ngModelChange","change"],["id","accountsSales",2,"height","auto","max-height","20px"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","danger"],["fill","clear","size","small","slot","end",3,"click"],["name","refresh","color","success"],[3,"ngModel","ngModelChange"],[1,"ion-margin-top"],["size","9",1,"ion-no-padding"],[1,"ion-justify-content-center"],["size","9"],[1,"ion-padding"],[3,"ngModel","readonly","ngModelChange"],["size","5"],["expand","block","routerDirection","root","color","success",3,"click"],[1,"ion-text-center"]],template:function(t,s){1&t&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-buttons",0),e._UZ(3,"ion-menu-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"\u0641\u0627\u062a\u0648\u0631\u0629 \u0645\u0628\u064a\u0639\u0627\u062a"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"ion-content"),e.YNc(7,Y,29,7,"ion-grid",1),e.YNc(8,D,29,4,"ion-grid",2),e.qZA()),2&t&&(e.xp6(7),e.Q6J("ngIf",s.user_info&&s.store_info),e.xp6(1),e.Q6J("ngIf",s.user_info&&s.store_info))},directives:[o.Gu,o.sr,o.Sm,o.fG,o.wd,o.W2,p.O5,o.jY,o.Nd,o.wI,o.PM,o.se,o.QI,d.JJ,d.On,o.Ie,o.B7,o.U5,o.Q$,d.Fj,o.pK,o.j9,p.sg,d.YN,d.Kr,o.yW,o.YG,o.gu],styles:[".custInput[_ngcontent-%COMP%]{border-style:solid;border-color:var(--ion-color-light);border-radius:5px}.cust-card[_ngcontent-%COMP%]{border-radius:5px}.show[_ngcontent-%COMP%]{visibility:visible}.hide[_ngcontent-%COMP%]{visibility:hidden}.custRow[_ngcontent-%COMP%]{margin-top:5rem}.bnone[_ngcontent-%COMP%]{border:none}.red[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.darko[_ngcontent-%COMP%]{color:var(--ion-color-dark)}ion-popover[_ngcontent-%COMP%]{--offset-y: -30px }.custInp[_ngcontent-%COMP%]{border-right-style:solid;border-right-width:.5px;text-align:center}.table[_ngcontent-%COMP%]{text-align:center;width:100%;margin:12px}tr[_ngcontent-%COMP%]:nth-child(even){background-color:#ddd}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:center;padding:8px;font-size:16px;font-weight:700;color:#000}"]}),n})()}];let E=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[_.Bz.forChild(B)],_.Bz]}),n})(),k=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[p.ez,d.u5,o.Pc,E]]}),n})()}}]);